<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PyTorch Handbook 00 ï¼ˆArchiveï¼‰ | aiken's blog</title>
<meta name=keywords content="Python,Pytorch"><meta name=description content="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†
@AikenH 2020 + 2021
this part is about pytorch basic unit, help me to code deep learning better.
Tensorå¼ é‡è®¡ç®—
ä¸¤ä¸ªtensorçš„æ•°ä¹˜

è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12


# ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘
# è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼
batch1 = torch.randn(10,3,4)
batch2 = torch.randn(10,4,5)
out = torch.bmm(batch1, batch2)
out.size()

'''output ans is
torch.size([10,3,5])'''

# æŒ‰ä½ç›¸ä¹˜
res = torch.mul(batch1,batch2)


viewå’Œpermuteçš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚
å¼ é‡å‘½å


1
2
3
4


NCHW = [â€˜Nâ€™, â€˜Câ€™, â€˜Hâ€™, â€˜Wâ€™]
images = torch.randn(32, 3, 56, 56, names=NCHW)
images.sum('C')
images.select('C', index=0)


ç±»å‹è½¬æ¢


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12


# tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢
ndarray = tensor.cpu().numpy()
tensor = torch.from_numpy(ndarray).float()

# tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢
image = torchvision.transforms.functional.to_pil_image(tensor)
path = r'./figure.jpg'
tensor = torchvision.transforms.functional.to_tensor(PIL.Image.open(path))

# np.ndarray ä¸ PIL.Imageçš„äº’æ¢
image = PIL.Image.fromarray(nd.array.astype(np.uint8))
ndarray = np.asarray(PIL.Image.open(path))


ç»´åº¦å †å 
Stackï¼Œæ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹"><meta name=author content="aikenhong"><link rel=canonical href=https://hugotest-phi.vercel.app/posts/pytorch/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://hugotest-phi.vercel.app/favicon/ghost.ico><link rel=icon type=image/png sizes=16x16 href=https://hugotest-phi.vercel.app/favicon/ghost-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hugotest-phi.vercel.app/favicon/ghost-32x32.png><link rel=apple-touch-icon href=https://hugotest-phi.vercel.app/favicon/ghost-apple-touch-icon.png><link rel=mask-icon href=https://hugotest-phi.vercel.app/favicon/ghost-192x192.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://hugotest-phi.vercel.app/posts/pytorch/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://cdn.jsdmirror.com/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdmirror.com/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdmirror.com/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.css><script defer src=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.js></script><script defer src=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-tc-webfont@1.0.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel=stylesheet><meta property="og:url" content="https://hugotest-phi.vercel.app/posts/pytorch/"><meta property="og:site_name" content="aiken's blog"><meta property="og:title" content="PyTorch Handbook 00 ï¼ˆArchiveï¼‰"><meta property="og:description" content="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ† @AikenH 2020 + 2021
this part is about pytorch basic unit, help me to code deep learning better.
Tensorå¼ é‡è®¡ç®— ä¸¤ä¸ªtensorçš„æ•°ä¹˜ è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°
1 2 3 4 5 6 7 8 9 10 11 12 # ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘ # è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼ batch1 = torch.randn(10,3,4) batch2 = torch.randn(10,4,5) out = torch.bmm(batch1, batch2) out.size() '''output ans is torch.size([10,3,5])''' # æŒ‰ä½ç›¸ä¹˜ res = torch.mul(batch1,batch2) viewå’Œpermuteçš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚
å¼ é‡å‘½å 1 2 3 4 NCHW = [â€˜Nâ€™, â€˜Câ€™, â€˜Hâ€™, â€˜Wâ€™] images = torch.randn(32, 3, 56, 56, names=NCHW) images.sum('C') images.select('C', index=0) ç±»å‹è½¬æ¢ 1 2 3 4 5 6 7 8 9 10 11 12 # tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢ ndarray = tensor.cpu().numpy() tensor = torch.from_numpy(ndarray).float() # tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢ image = torchvision.transforms.functional.to_pil_image(tensor) path = r'./figure.jpg' tensor = torchvision.transforms.functional.to_tensor(PIL.Image.open(path)) # np.ndarray ä¸ PIL.Imageçš„äº’æ¢ image = PIL.Image.fromarray(nd.array.astype(np.uint8)) ndarray = np.asarray(PIL.Image.open(path)) ç»´åº¦å †å  Stackï¼Œæ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-15T08:00:57+00:00"><meta property="article:modified_time" content="2021-12-15T08:00:57+00:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Pytorch"><meta property="og:image" content="https://hugotest-phi.vercel.app/cover/cover4.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hugotest-phi.vercel.app/cover/cover4.jpeg"><meta name=twitter:title content="PyTorch Handbook 00 ï¼ˆArchiveï¼‰"><meta name=twitter:description content="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†
@AikenH 2020 + 2021
this part is about pytorch basic unit, help me to code deep learning better.
Tensorå¼ é‡è®¡ç®—
ä¸¤ä¸ªtensorçš„æ•°ä¹˜

è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12


# ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘
# è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼
batch1 = torch.randn(10,3,4)
batch2 = torch.randn(10,4,5)
out = torch.bmm(batch1, batch2)
out.size()

'''output ans is
torch.size([10,3,5])'''

# æŒ‰ä½ç›¸ä¹˜
res = torch.mul(batch1,batch2)


viewå’Œpermuteçš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚
å¼ é‡å‘½å


1
2
3
4


NCHW = [â€˜Nâ€™, â€˜Câ€™, â€˜Hâ€™, â€˜Wâ€™]
images = torch.randn(32, 3, 56, 56, names=NCHW)
images.sum('C')
images.select('C', index=0)


ç±»å‹è½¬æ¢


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12


# tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢
ndarray = tensor.cpu().numpy()
tensor = torch.from_numpy(ndarray).float()

# tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢
image = torchvision.transforms.functional.to_pil_image(tensor)
path = r'./figure.jpg'
tensor = torchvision.transforms.functional.to_tensor(PIL.Image.open(path))

# np.ndarray ä¸ PIL.Imageçš„äº’æ¢
image = PIL.Image.fromarray(nd.array.astype(np.uint8))
ndarray = np.asarray(PIL.Image.open(path))


ç»´åº¦å †å 
Stackï¼Œæ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hugotest-phi.vercel.app/posts/"},{"@type":"ListItem","position":2,"name":"PyTorch Handbook 00 ï¼ˆArchiveï¼‰","item":"https://hugotest-phi.vercel.app/posts/pytorch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PyTorch Handbook 00 ï¼ˆArchiveï¼‰","name":"PyTorch Handbook 00 ï¼ˆArchiveï¼‰","description":"Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ† @AikenH 2020 + 2021\nthis part is about pytorch basic unit, help me to code deep learning better.\nTensorå¼ é‡è®¡ç®— ä¸¤ä¸ªtensorçš„æ•°ä¹˜ è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 # ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘ # è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼ batch1 = torch.randn(10,3,4) batch2 = torch.randn(10,4,5) out = torch.bmm(batch1, batch2) out.size() \u0026#39;\u0026#39;\u0026#39;output ans is torch.size([10,3,5])\u0026#39;\u0026#39;\u0026#39; # æŒ‰ä½ç›¸ä¹˜ res = torch.mul(batch1,batch2) viewå’Œpermuteçš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚\nå¼ é‡å‘½å 1 2 3 4 NCHW = [â€˜Nâ€™, â€˜Câ€™, â€˜Hâ€™, â€˜Wâ€™] images = torch.randn(32, 3, 56, 56, names=NCHW) images.sum(\u0026#39;C\u0026#39;) images.select(\u0026#39;C\u0026#39;, index=0) ç±»å‹è½¬æ¢ 1 2 3 4 5 6 7 8 9 10 11 12 # tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢ ndarray = tensor.cpu().numpy() tensor = torch.from_numpy(ndarray).float() # tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢ image = torchvision.transforms.functional.to_pil_image(tensor) path = r\u0026#39;./figure.jpg\u0026#39; tensor = torchvision.transforms.functional.to_tensor(PIL.Image.open(path)) # np.ndarray ä¸ PIL.Imageçš„äº’æ¢ image = PIL.Image.fromarray(nd.array.astype(np.uint8)) ndarray = np.asarray(PIL.Image.open(path)) ç»´åº¦å †å  Stackï¼Œæ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹\n","keywords":["Python","Pytorch"],"articleBody":"Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ† @AikenH 2020 + 2021\nthis part is about pytorch basic unit, help me to code deep learning better.\nTensorå¼ é‡è®¡ç®— ä¸¤ä¸ªtensorçš„æ•°ä¹˜ è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 # ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘ # è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼ batch1 = torch.randn(10,3,4) batch2 = torch.randn(10,4,5) out = torch.bmm(batch1, batch2) out.size() '''output ans is torch.size([10,3,5])''' # æŒ‰ä½ç›¸ä¹˜ res = torch.mul(batch1,batch2) viewå’Œpermuteçš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚\nå¼ é‡å‘½å 1 2 3 4 NCHW = [â€˜Nâ€™, â€˜Câ€™, â€˜Hâ€™, â€˜Wâ€™] images = torch.randn(32, 3, 56, 56, names=NCHW) images.sum('C') images.select('C', index=0) ç±»å‹è½¬æ¢ 1 2 3 4 5 6 7 8 9 10 11 12 # tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢ ndarray = tensor.cpu().numpy() tensor = torch.from_numpy(ndarray).float() # tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢ image = torchvision.transforms.functional.to_pil_image(tensor) path = r'./figure.jpg' tensor = torchvision.transforms.functional.to_tensor(PIL.Image.open(path)) # np.ndarray ä¸ PIL.Imageçš„äº’æ¢ image = PIL.Image.fromarray(nd.array.astype(np.uint8)) ndarray = np.asarray(PIL.Image.open(path)) ç»´åº¦å †å  Stackï¼Œæ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹\næµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸Šdim=0å°±æ˜¯åŸºæœ¬çš„å †èµ·æ¥ï¼Œdim=1å°±æ˜¯æŒ‰ç…§è¡Œæ¥å †ï¼Œdim=2å°±æ˜¯æŒ‰ç…§åˆ—æ¥å †\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 a = torch.arange(1,10).reshape(3,3) b = torch.arange(10,100,10).reshape(3,3) c = torch.arange(100,1000,100).reshape(3,3) print('-----------------a----------------') print(a) print('-----------------b----------------') print(b) print('-----------------c----------------') print(c) print('-----------------dim =0----------------') d = torch.stack((a,b,c),dim = 0) print(d.shape) print('the value of d:- {}'.format(d[2,1,0])) print(d) # ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠå•ä¸ªå½“æˆæ•´ä½“ç›´æ¥ä»ä¸Šå¾€ä¸‹å †å  # ä»¥x[:][:]ä¸ºæ„æˆå•å…ƒ print('-----------------dim =1----------------') d = torch.stack((a,b,c),dim = 1) print(d.shape) print('the value of d:- {}'.format(d[1,2,2])) print(d) # å°†æ¯ä¸ªçš„ç¬¬ä¸€ä¸ªç»´åº¦ï¼ŒæŒ‰æ¬¡åºçº³å‡ºæ¥ï¼ŒåŒvalueçš„å †åœ¨ä¸€èµ· # for exampleï¼š[a[i][:],b[i][:],c[i][:] ]ç»„æˆæ–°çš„å•å…ƒå— # ä¸ï¼Œå¦ä¸€ç§ç†è§£ï¼Œä»¥x[i][:] ä¸ºå•å…ƒ print('-----------------dim =2----------------') d = torch.stack((a,b,c),dim = 2) print(d.shape) print('the value of d:- {}'.format(d[1,2,1])) print(d) # ç›¸åº”çš„ä»¥x[i][j]ä¸ºå•å…ƒæ„æˆ listçš„æƒ…å†µä¸‹çš„ç»´åº¦å †å æµ‹è¯•ä»£ç å¦‚ä¸‹\nç›¸åº”çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸Šä¸€èˆ¬æ˜¯æŒ‰ç…§dim=1æ¥è¿›è¡Œå †å \n1 2 3 4 5 6 7 8 A = torch.randn([3,4,2]) B = [A[:,i] for i in range(A.size(1))] # è¿™æ ·ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªlist,æŒ‰ç…§æˆ‘ä»¬indexçš„æ’åº print(A) print(B) C = torch.stack(B,dim=1) print('---------------------result-----------------------') print(C) Cat\nå®é™…ä¸Šåº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„å †å æ€è·¯\nåŸºæœ¬çš„å¼ é‡å‡½æ•° torch.split() åˆ’åˆ†tensor\ntorch.randpermè¿›è¡Œlistçš„ä¹±åºå¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å’ŒshuffleåŒºåˆ†ï¼Œè¿™æ˜¯å¦ä¸€ç§ä¹±åºçš„æ“ä½œ # catæ“ä½œ a = [] for i in range(3): a.append(torch.tensor([i,i])) all_inputs = torch.cat(a) # randpermçš„æ•ˆæœ test1 idx = torch.randperm(all_inputs.size(0)) print(idx) a1, b = all_inputs, all_inputs[idx] print(a1,b) # test2 ï¼Œ print('-------------------------') # randperm è¿›è¡Œlistçš„shuffle tensor_a = torch.randint(0,10,[8]) print('origin version ', tensor_a) idx = torch.randperm(tensor_a.size(0)) print('shuffle idx ', idx) tensor_b = tensor_a[idx] print('after operation ', tensor_b) .fill_()æŒ‰ç…§è¾“å…¥çš„å€¼å¯¹å¼ é‡è¿›è¡Œå¡«å……\né€‰å–åˆ’çª— nn.unfoldæ‹†è§£å·ç§¯ä¸­çš„åˆ’çª—æ­¥éª¤\n1 2 3 4 5 6 7 8 import torch inputs = torch.randn(1,3,224,224) unfold = torch.nn.Unfold(4,stride=4) output = unfold(inputs) # res output output.size() $ [1,4,3136] # 3136 = (224/4) * (224/4) Torchç¯å¢ƒè®¾ç½® pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ– yTorch å’Œ Pythonçš„éšæœºæ•°ç”Ÿæˆå™¨å°±ç®—éšæœºç§å­ä¸€æ ·ä¹Ÿä¸ä¼šäº§ç”Ÿä¸€æ ·çš„ç»“æœã€‚\næˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®¾ç½®Pytorchçš„éšæœºæ•°ç§å­ï¼šï¼ˆé€šå¸¸å’ŒGPUä¸€èµ·ä½¿ç”¨ï¼‰\n1 torch.manual_seed(seed) nn.parameter() Main ideaï¼šparameterçš„ä½œç”¨ï¼Œä¸»è¦æ˜¯å°†å‚æ•°å’Œmodelç»‘å®šåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå¯èƒ½éœ€è¦è®­ç»ƒçš„å‚æ•°æœ‰å“ªäº›ï¼Œå¯ä»¥éœ€è¦è¿›è¡Œè®­ç»ƒçš„å‚æ•°åŠ è¿›å»ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦freeze itçš„æ—¶å€™å°±ä½¿ç”¨detachæˆ–è€…ç›´æ¥ä¿®æ”¹require_gradæ¥è®©å‚æ•°ä¸åœ¨æ¥å—è®­ç»ƒå°±å¥½äº†ï¼Œ require_gradæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚å¯ä»¥ç»“åˆä¸Šé¢çš„ä»£ç åˆ†æã€‚ tensorå˜é‡æ˜¯ä¸å¯è®­ç»ƒçš„ï¼Œåªæœ‰ä¿®æ”¹æˆparameteræ‰èƒ½è¿›è¡Œè®­ç»ƒã€‚ è‡ªå¸¦çš„ç½‘ç»œç»“æ„ä¸­çš„ä¸€äº›weightå’Œbiasåº”è¯¥éƒ½æ˜¯parameterçš„å˜é‡ nn.Softmaxä¸­çš„dim å…¶å®æ²¡é‚£ä¹ˆå¤æ‚ï¼Œå°±å’Œæ•°æ®çš„ç»´åº¦æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé‚£ä¸€ä¸ªç»´åº¦çš„æ•°æ®ä¹‹åçš„æ•°æ®å…¨éƒ¨åŠ èµ·æ¥å¤„ç†å°±ç”¨å“ªä¸ªç»´åº¦å»åšã€‚\nIMAGE = N* DATAï¼Œdim=1 è¯´æ˜dim = 0 çš„Channel æ˜¯éœ€è¦è¢«æ’å¤–çš„ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„softmaxæ˜¯åŸºäºdataè¿›è¡Œçš„ã€‚å¯ä»¥æ‰¾å¯»æºç è¿›è¡Œè¿›ä¸€æ­¥åˆ†æè§£é‡Šã€‚\næµ‹è¯•ã€éªŒè¯æ¨¡å— åŸºæœ¬ç¼–å†™ model.eval()å’Œmodel.train()çš„åŒºåˆ« é€šå¸¸åœ¨æ¨¡å‹æµ‹è¯•çš„æ—¶å€™ä¼šæ‰§è¡Œmodel.eval()åˆ‡æ¢æ¨¡å‹çš„çŠ¶æ€ï¼Œè€Œåœ¨è®­ç»ƒçš„æ—¶å€™ä¼šæ‰§è¡Œmodel.train()ï¼Œmodelåœ¨è¿™ä¸¤ä¸ªçŠ¶æ€ä¸‹çš„åŒºåˆ«ä¸»è¦æœ‰ï¼š\nåœ¨trainçŠ¶æ€ä¸‹ä¼šå¯ç”¨BNå’ŒDropoutï¼Œè€Œåœ¨evalä¸å¯ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼›\nå¯ç”¨BNæŒ‡çš„æ˜¯ï¼šç”¨åˆ°æ¯ä¸€ä¸ªBatchæ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼›ä¸å¯ç”¨åˆ™æŒ‡çš„æ˜¯ä½¿ç”¨æ•´ä½“çš„å‡å€¼å’Œæ–¹å·®ï¼ˆåŒæ—¶åœæ­¢æ›´æ–°meanå’Œvarï¼‰ è€Œå¯¹äºDropoutæ¥è¯´ï¼šå¯ç”¨çš„æ—¶å€™æŒ‡çš„æ˜¯ä¼šéšæœºè¿›è¡Œdropoutï¼Œè€Œå…³é—­çš„è¯å°±ä¼šç”¨åˆ°å…¨éƒ¨çš„ç½‘ç»œé“¾æ¥ with torch.no_grad() ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œwrapèµ·æ¥çš„éƒ¨åˆ†ä¸ä¼štrack grade\nä¸»è¦ç”¨äºåœæ­¢autogradæ¨¡å—çš„å·¥ä½œï¼Œè¢«withåŒ…è£¹èµ·æ¥çš„éƒ¨åˆ†ä¼šåœæ­¢æ¢¯åº¦çš„æ›´æ–°ï¼Œå¾—åˆ°è¿›ä¸€æ­¥çš„åŠ é€ŸæŠŠï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šåœ¨éªŒè¯çš„æ—¶å€™ä¸ä¼šæ‰§è¡Œstep()ç­‰æ“ä½œï¼Œæ‰€ä»¥èƒ½å¤ŸèŠ‚çœè®¡ç®—æ¨¡å‹æ¢¯åº¦çš„æ—¶é—´ã€‚\næ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜ @Aiken 2020\nåŸºäºonenoteç¬”è®°ï¼Œæˆ‘ä»¬çŸ¥é“å…³é”®åœ¨äºå¦‚ä½•è‡ªç”±çš„è¯»å–æ¨¡å‹ä¸­çš„å‚æ•°ï¼Œå¹¶é€‰æ‹©æ€§çš„å–å‡ºæ¥ã€‚\npytorch æ¨¡å‹éƒ¨åˆ†å‚æ•°çš„åŠ è½½_LXX516çš„åšå®¢-CSDNåšå®¢_pytorch åŠ è½½éƒ¨åˆ†å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 # è‡³å°‘åŸºäºè¿™æ ·çš„æ–¹å¼æˆ‘ä»¬èƒ½æŠŠæ¨¡å‹ä¸­å‚æ•°çš„stringå–å‡ºæ¥ã€‚ pretrained_dict=torch.load(model_weight) model_dict=myNet.state_dict() # 1. filter out unnecessary keys pretrained_dict = {k: v for k, v in pretrained_dict.items() if k in model_dict} # 2. overwrite entries in the existing state dict model_dict.update(pretrained_dict) myNet.load_state_dict(model_dict) GPUç›¸å…³çš„è®¾ç½® @written by Aiken, 2020 this document is about Pytorchâ€˜s CUDA, \u0026 GPU setting.\næŸ¥çœ‹GPUçŠ¶æ€ è®¾ç½®é»˜è®¤GPUè®¾å¤‡ ä¸€èˆ¬ä½¿ç”¨GPUä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç³»ç»Ÿä¸­æœ‰å¤šå°‘GPUè®¾å¤‡ï¼Œå› ä¸ºé»˜è®¤çš„GPUè®¾å¤‡æ˜¯0ï¼Œè€Œä¸”ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ç›´æ¥ä½¿ç”¨è¿™å¼ å¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœåªä½¿ç”¨å•å¡çš„è¯ï¼Œåˆ‡æ¢ä¸€ä¸‹é»˜è®¤çš„GPUè®¾å¤‡ï¼Œèƒ½å¤Ÿé¿å…ä¸€å®šçš„å†²çªã€‚\n1 2 3 4 # æŸ¥çœ‹GPUä½¿ç”¨çŠ¶æ€ $ nvidia-smi # or $ gpustat [--watch] è®¾å¤‡åŸºæœ¬ä¿¡æ¯ æŸ¥çœ‹æ˜¯å¦å­˜åœ¨GPUï¼Œæ•°é‡ï¼Œç±»å‹\n1 2 3 4 5 import torch # æŸ¥çœ‹æ˜¯å¦å­˜åœ¨GPUï¼Œæ•°é‡ï¼Œç±»å‹ torch.cuda.is_available() torch.cuda.device_count() torch.cuda.get_device_name(0) æŸ¥çœ‹æŒ‡å®šçš„GPUçš„å®¹é‡å’Œåç§°\n1 2 torch.cuda.get_device_capability(device) torch.cuda.get_device_name(device) è®¾ç½®å½“å‰ç³»ç»Ÿçš„é»˜è®¤gpu_devicesï¼Œæ¨èä½¿ç”¨osæ¥è®¾ç½®ï¼ˆå®é™…ä¸Šæ˜¯å‘½ä»¤è¡Œä¸­çš„æ“ä½œï¼‰å®é™…ä¸Šæ˜¯ç³»ç»Ÿè®¾å®šé’ˆå¯¹å½“å‰è¿›ç¨‹çš„å¯è§GPUï¼Œå…¶ä»–çš„GPUä¼šå¯¹å½“å‰çš„ç¨‹åºéšè—ï¼Œæ‰€ä»¥é»˜è®¤çš„0\n1 2 os.environ['CUDA_VISIBLE_DEVICES'] = \"id\" #æ¨èç”¨æ³• # å¯ä»¥åœ¨vscodeçš„launch.jsonä¸­è®¾ç½®env æ³¨æ„äº‹é¡¹ï¼šè¯¥å‘½ä»¤éœ€è¦åœ¨æ‰€æœ‰è°ƒç”¨äº†CUDAçš„ä»£ç ã€å­ç¨‹åºä¹‹å‰ï¼ŒåŒ…æ‹¬importï¼Œæ‰€ä»¥å¾ˆå¤šä»£ç çš„importéƒ½æ˜¯åœ¨main()ä¸­çš„ã€‚\nGPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰ ç¼“å­˜çˆ†ç‚¸é—®é¢˜ GPUä½¿ç”¨é€”ä¸­éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œåœ¨æ¯æ¬¡iterationä¹‹åè®°å¾—æ¸…é™¤åœ¨GPUä¸­å ç”¨çš„memoryï¼Œcacheç­‰ï¼Œä¸ç„¶æœ‰æ—¶å€™ä¼šå¯¼è‡´ç¼“å­˜å’Œå†…å­˜çš„é€’å¢å’Œçˆ†ç‚¸ã€‚\nå…·ä½“æ“ä½œï¼š\n1 2 torch.cuda.empty_cache() # after every iteration è¿è¡Œæ•ˆç‡ä¼˜åŒ– cudnn.benchmarkã€pytorchè®ºå› pytorchä¸­æ–‡ç½‘ ã€zhihuç©¶æåˆ†ææ–‡ åŸºæœ¬ä½¿ç”¨æ€è·¯ï¼š\nåœ¨ç¨‹åºçš„å¼€å§‹ï¼Œè®©cudnnèŠ±è´¹ä¸€ç‚¹é¢å¤–çš„æ—¶é—´ï¼Œæ‰¾åˆ°é€‚ç”¨äºå½“å‰é…ç½®çš„æœ€ä½³ç®—æ³•ï¼Œä»è€Œä¼˜åŒ–è¿è¡Œæ•ˆç‡ã€‚\næ³¨æ„äº‹é¡¹ï¼š\nä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„input_sizeåœ¨æ¯ä¸ªiterationéƒ½å­˜åœ¨å˜åŒ–çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªiterationéƒ½è¦æ‰§è¡Œä¸€æ¬¡æœç´¢ï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚\nå…·ä½“æ“ä½œ\n1 torch.backends.cudnn.benchmark = true è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼ è®¾ç½®ç›¸åº”çš„éšæœºç§å­ 1 2 3 4 torch.cuda.empty_cache() # part2 è®¾ç½®éšæœºç§å­ torch.cuda.manual_seed(seed) torch.cuda.manual_seed_all(seed) CUDAè½¬æ¢ ä½¿ç”¨.cuda()æ¥å¯¹æ¨¡å‹ï¼Œæ•°æ®ï¼ŒLossè¿›è¡Œèµ‹å€¼ï¼Œæˆ–è€…ä½¿ç”¨to_devices()æ¥è®¾ç½®åˆ°ç›¸åº”çš„GPUè®¾å¤‡\nå°†æ¨¡å‹è½¬åŒ–åˆ°cudaä¸­è¦åœ¨ä¼˜åŒ–å™¨çš„å»ºç«‹ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºoptimizeræ˜¯å¯¹äºæ¨¡å‹å»ºç«‹çš„ï¼Œå¯¹æ¨¡å‹æ‰§è¡Œcudaåå·²ç»å’ŒåŸæœ¬çš„å‚æ•°å’Œæ¨¡å‹éƒ½ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼Œæ‰€ä»¥ä¸€å®šè¦åœ¨å»ºç«‹ä¼˜åŒ–å™¨ä¹‹å‰å°±å¯¹æ¨¡å‹è¿›è¡ŒCuda çš„è½¬åŒ–ã€‚\næ˜¯å¦è¦å¯¹lossè½¬æ¢åˆ°CUDAï¼Œå–å†³äºä¸€ä¸‹çš„ä¸¤ç§æƒ…å†µï¼š\næŸå¤±å‡½æ•°æ˜¯Functionalï¼šè¿™æ ·çš„è¯åªè¦ä¼ å…¥çš„å‚æ•°æ˜¯CUDAçš„å°±ä¼šå†CUDAä¸Šè®¡ç®— æŸå¤±å‡½æ•°æ˜¯Class with paramsï¼šå¦‚æœç±»å†…æœ‰å‚æ•°çš„è¯ï¼Œä¹Ÿè¦è½¬æ¢åˆ°CUDAæ‰èƒ½ä¸€èµ·åœ¨CUDAä¸Šè®¡ç®— 1 2 3 4 5 if torch.cuda.is_available(): try: loss = loss.cuda() except AttributeError: print('the loss is not cuda-able {}'.format(type(loss))) å¤šGPUå¹¶è¡Œ ä¸»è¦ä½¿ç”¨çš„å‘½ä»¤nn.DataParallel()\n1 2 model = nn.DataParaller(model,device_ids=None) # å¦‚æœä¸è®¾å®šidçš„è¯ï¼Œåº”è¯¥æ˜¯è‡ªåŠ¨æŒ‡å®šå…¨éƒ¨å¯è§çš„GPUçš„ CPU å¶ç„¶ä¼šç”±äºpin_memory çš„è®¾ç½®æ¥è‡´ä½¿CPUçš„ä¸æ­£å¸¸è¿è¡Œï¼ˆæ»¡è½½ç­‰ç­‰ï¼‰ï¼Œå¹¶éæ€»æ˜¯è¿™æ ·ã€‚\næ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½® é™åˆ¶æˆ–å¢åŠ pytorchçš„çº¿ç¨‹ä¸ªæ•°ï¼æŒ‡å®šæ ¸æ•°æˆ–è€…æ»¡æ ¸è¿è¡ŒPytorchï¼ï¼ï¼_lei_qiçš„åšå®¢-CSDNåšå®¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 import os from multiprocessing import cpu_count # è®¾ç½®ç¯å¢ƒå˜é‡æ¥æ§åˆ¶çº¿ç¨‹å¤šå‘çš„æƒ…å†µ cpu_num = cpu_count() # æ ¸å¿ƒä»£ç  os.environ['OMP_NUM_THREADS'] = str(cpu_num) # ä¸‹é¢è¿™äº›åº”è¯¥æ˜¯ä¸ä¸€å®šè¯æœ‰ os.environ ['OPENBLAS_NUM_THREADS'] = str(cpu_num) os.environ ['MKL_NUM_THREADS'] = str(cpu_num) os.environ ['VECLIB_MAXIMUM_THREADS'] = str(cpu_num) os.environ ['NUMEXPR_NUM_THREADS'] = str(cpu_num) # ä»å…¶ä»–èµ„æ–™ä¸­å¯ä»¥æ„Ÿè§‰è¿™æ¡ä»£ç åº”è¯¥æ˜¯å’Œæ ¸å¿ƒä»£ç ä¸€æ ·çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸¤ä¸ªå†™ä¸€ä¸ªåº”è¯¥å°±å¯ä»¥äº† torch.set_num_threds(cpu_num) ç½‘ç»œå®šä¹‰æ¨¡å— æ•°æ®å®šä¹‰æ¨¡å— åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ® torchvision.datasets.imagefolder() è¿™ä¸ªå‡½æ•°å®é™…ä¸Šèƒ½ä»£æ›¿æˆ‘ä»¬ä¹‹å‰å†™çš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äºè‡ªå·±å†™çš„æœ‰ä¸€éƒ¨åˆ†ç»Ÿä¸€è§„åˆ™å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„è‡ªå®šä¹‰ç¨‹åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥ç›®å‰æˆ‘ä»¬åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä½¿ç”¨è¯¥æ–¹æ³•æ¥è¿›è¡Œæ›¿ä»£ã€‚\nä½†æ˜¯ç”±äºæ˜¯ä¸€ä¸ªé‡è¦çš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¿˜æ˜¯ä»‹ç»ä¸€ä¸‹è¯¥å·¥å…·çš„ä½¿ç”¨æ–¹å¼ï¼š\ntorch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨ è‡ªå®šä¹‰datasetçš„ç»§æ‰¿ä»¥åŠåç»­è°ƒç”¨éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½å¿˜è®°å°†å…¶è½¬æ¢æˆdataloaerï¼Œç„¶åè¿›è¡Œiterå‘½ä»¤çš„æ‰§è¡Œã€‚ ä¹Ÿå¯ä»¥ç”¨enumerateå‡½æ•°æ¥è¿›è¡Œè°ƒç”¨ï¼Œå°±æ˜¯è®°å¾—è°ƒç”¨çš„æ ¼å¼æ˜¯ä»€ä¹ˆå°±å¥½ å¯ä»¥å‚è€ƒbasicunitä¸­çš„å¯¹shuffleçš„è®¤çŸ¥å¯¹è¯¥å‡½æ•°è¿›è¡Œè¿›ä¸€æ­¥çš„ç†è§£ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®šä¹‰datasetçš„éƒ¨åˆ† class RL_AET_Dataset(torch.utils.data.Dataset): def __init__(self): super(RL_AET_Dataset,self).__init__() pass def __len__(self): pass def __getitem(self): pass # å£°æ˜å’Œæ„å»ºéƒ¨åˆ† è¦è®°å¾—ä½¿ç”¨dataloader train_l_dataset = RL_AET_Dataset(x_l, y_l, args) train_l_dataloader =torch.utils.data.DataLoader(train_l_dataset,batch_size=args['b_s'],shuffle=True,num_workers=args['num_workers'],drop_last=True,pin_memory=True) #è°ƒç”¨è¿­ä»£éƒ¨åˆ† labeled_loader = iter(train_l_dataloader) #all_label_info = [*next(labeled_loader)] Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š ç–‘æƒ‘è§£ç­” ç”¨composeé›†æˆçš„æ‰€æœ‰transformï¼Œéƒ½ä¼šåº”ç”¨ï¼Œæœ‰ä¸ªto_tensorï¼Œåˆ‡to_tensorä¼šè‡ªåŠ¨è½¬æ¢PILä¸­çš„channelå’Œæ•°å€¼èŒƒå›´ã€‚\ncomposeä¸­çš„å˜æ¢ç»„åˆçš„é¡ºåºå…³ç³»\nPILå¤„ç†çš„å›¾åƒå˜æ¢ï¼ˆæ¯”å¦‚æ•°æ®å¢å¼ºä¹‹ç±»çš„æ–¹æ³•ï¼‰ to_tensor() å¤„ç†tensorçš„æ–¹æ³•ï¼šnormalize ç¤ºä¾‹ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 data_transforms = transforms.Compose([ transforms.RandomResizedCrop(224), transforms.RandomHorizontalFlip(). transforms.ToTensor(), transforms.Normalize([a,b,c],[A,B,C])]) # ç„¶åç›´æ¥åŠ å…¥datasetä¸­çš„å‚æ•°ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„éƒ¨åˆ† # åœ¨datasetä¸­çš„å†™æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„datasetä¸­è¿›è¡Œå®šä¹‰ if self.transformer is not None: img = self.transform(img) # å…·ä½“çš„æºç ç»†èŠ‚è¡¨ç°å¦‚ä¸‹ for t in self.transforms: img = t(img) return img Dataloaderä¸­çš„å‚æ•° shuffleæœºåˆ¶\nä¸»è¦è§£å†³é—®é¢˜ï¼š\næ˜¯å¦æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½è¿›è¡Œéšæœºçš„æ“ä½œï¼Œè¿˜æ˜¯åªæœ‰åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰è¿›è¡Œéšæœº ä¸¤ç§ä¸åŒä½¿ç”¨Dataloaderçš„æ–¹å¼æ˜¯å¦ä¼šå¯¹shuffleçš„æ–¹å¼è¿›è¡ŒåŒºåˆ† ç»“è®ºï¼š\næ¯æ¬¡å¯¹dataloaderè¿›è¡Œé‡æ–°è°ƒç”¨ï¼ˆé‡æ–°æ”¾åˆ°enumerateï¼‰ï¼Œæˆ–è€…é‡æ–°å®šä¹‰iterï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œshuffleã€‚ num_worker\nå‚è€ƒèµ„æ–™1 å‚è€ƒèµ„æ–™2ï¼špytorchä¸­æ–‡æ–‡æ¡£ğŸ‘‡\nnum_workers (int, optional) â€“ ç”¨å¤šå°‘ä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ã€‚0è¡¨ç¤ºæ•°æ®å°†åœ¨ä¸»è¿›ç¨‹ä¸­åŠ è½½(é»˜è®¤: 0) ç”¨num_workerä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå°†æ•°æ®åœ¨ä¸»è¿›ç¨‹å±•ç¤ºè¿˜æ²¡æœ‰è°ƒç”¨åˆ°è¯¥æ•°æ®ä¹‹å‰å°±å°†åç»­çš„æ•°æ®å­˜å…¥RAMï¼Œæ‰€ä»¥åœ¨æ•°æ®è¯»å–ä¸Šä¼šæ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å ç”¨çš„RAMå’ŒCPUèµ„æºä¼šæ¯”è¾ƒå¤§ã€‚\nsamples:\ntorch.utils.data - PyTorch 1.9.0 documentation ä¸€æ–‡å¼„æ‡‚Pytorchçš„DataLoader, DataSet, Samplerä¹‹é—´çš„å…³ç³» å®˜æ–¹çš„è§£é‡Šæ˜¯ï¼š\nsamplerÂ (SamplerÂ orÂ Iterable,Â optional)Â â€“Â definesÂ theÂ strategyÂ toÂ drawÂ samplesÂ fromÂ theÂ dataset.Â CanÂ beÂ anyÂ IterableÂ withÂ lenÂ implemented.Â IfÂ specified,Â shuffleÂ mustÂ notÂ beÂ specified.\nå®šä¹‰ä»æ•°æ®é›†ï¼ˆè¿˜æ˜¯æœ€å¼€å§‹çš„å“ªä¸ªæ•°æ®é›†ï¼Œä¸èƒ½æ˜¯é¢å¤–çš„æ•°æ®é›†ï¼‰ä¸­æå–æ ·æœ¬çš„ç­–ç•¥ï¼šæ˜¯å¦èƒ½é€šè¿‡è¯¥Methodå»å®ç°Hard-Taskæˆ–è€…åƒMeta-Taskä¸€æ ·çš„é‡‡æ ·è¿‡ç¨‹å‘¢ï¼Ÿä»Meta-Transfer-Learningä¸­çœ‹æ¥æ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹å®ƒçš„å†™æ³•ã€‚\ncollate_fn() collate_fnçš„ä½œç”¨å°±æ˜¯å°†ä¸€ä¸ªbatchçš„æ•°æ®è¿›è¡Œåˆå¹¶æ“ä½œã€‚é»˜è®¤çš„collate_fnæ˜¯å°†imgå’Œlabelåˆ†åˆ«åˆå¹¶æˆimgså’Œlabelsï¼Œæ‰€ä»¥å¦‚æœä½ çš„__getitem__æ–¹æ³•åªæ˜¯è¿”å›Â img,Â label,é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨é»˜è®¤çš„collate_fnæ–¹æ³•, ä½†æ˜¯å¦‚æœä½ æ¯æ¬¡è¯»å–çš„æ•°æ®æœ‰img,Â box,Â labelç­‰ç­‰ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦è‡ªå®šä¹‰collate_fnæ¥å°†å¯¹åº”çš„æ•°æ®åˆå¹¶æˆä¸€ä¸ªbatchæ•°æ®ï¼Œè¿™æ ·æ–¹ä¾¿åç»­çš„è®­ç»ƒæ­¥éª¤ã€‚\nç¼–å†™collate_fnå¯ä»¥å‚è€ƒqidongçš„æ–‡ç« ä¸»è¦æ˜¯æ¥å—æ•°æ®å’Œæ ‡ç­¾åˆ—è¡¨ï¼Œå°†å…¶æ•´åˆæˆä¸€ä¸ªçŸ©é˜µçš„å½¢å¼; å¦‚æœå¯¹ä¼ å‚æœ‰éœ€æ±‚,å¯ä»¥å‚è€ƒlambdaçš„å½¢å¼æˆ–è€…æ˜¯ç±»å®šä¹‰çš„å½¢å¼å»ä¼ å…¥ 1 2 3 4 5 6 7 8 9 10 11 dataload = DataLoader(dataset, lambda x: collate_fn(x, **params)) class collater(): def __init__(**params): self.params = ... def __call(self,datas): # make it a batch in this function, then we will instance this class ... def _helpful_fn(self): ... using collate_fn, we can augment the dataset more flexible.\nç¼–å†™æ¨¡å‹ æ¨¡å‹åŸºæœ¬å•å…ƒ nn.conv2Dï¼š\nkernel_size[1]åº”è¯¥æŒ‡çš„æ˜¯å·ç§¯æ ¸çš„å®½ï¼ˆä¸ä¸€å®šéƒ½æ˜¯æ­£æ–¹å½¢çš„ï¼‰ æ¨¡å‹å‚æ•°å…±äº«ï¼š pytorchï¼šå¯¹æ¯”cloneã€detachä»¥åŠcopy_ç­‰å¼ é‡å¤åˆ¶æ“ä½œ 1 2 3 # å‡è®¾æœ‰modelaå’Œmodelbï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œä¸‹é™çš„æ—¶å€™æ‰§è¡Œå‚æ•°ç»Ÿä¸€ï¼Œ for a_para,b_para in zip(modela.parameters(),modelb.parameters()): b_para.data.copy_(a_para.data) ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ @Aiken 2021 ä¸»è¦å¯¹æ¯”çš„æ˜¯ModuleListå’ŒSequtial\n**ç»“è®ºï¼š**é€šå¸¸ä½¿ç”¨çš„è¯ï¼Œè¿™é‡Œæˆ‘ä¸ªäººæ¨èä½¿ç”¨çš„æ˜¯sequtialç»“åˆcollectionä¸­çš„orderdictæ¥æ„å»ºçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é›†æˆäº†å†…éƒ¨çš„forwardï¼ŒåŒæ—¶é€šè¿‡``orderdict`ä¹Ÿèƒ½ç»™printå¸¦æ¥æ›´å¥½çš„å¯è§†åŒ–æ•ˆæœã€‚\nä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯æˆ‘ä»¬ä¼šç”¨åˆ°ModuleList\nè¯¦è§£PyTorchä¸­çš„ModuleListå’ŒSequential ä¸»è¦åŒºåˆ«ï¼š\nnn.Sequentialå†…éƒ¨å®ç°äº†forwardå‡½æ•°ï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†™forwardå‡½æ•°ã€‚è€Œnn.ModuleListåˆ™æ²¡æœ‰å®ç°å†…éƒ¨forwardå‡½æ•°ã€‚\nnn.Sequentialå¯ä»¥ä½¿ç”¨OrderedDictå¯¹æ¯å±‚è¿›è¡Œå‘½åï¼Œä¸Šé¢å·²ç»é˜è¿°è¿‡äº†ï¼›\nnn.Sequentialé‡Œé¢çš„æ¨¡å—æŒ‰ç…§é¡ºåºè¿›è¡Œæ’åˆ—çš„ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿å‰ä¸€ä¸ªæ¨¡å—çš„è¾“å‡ºå¤§å°å’Œä¸‹ä¸€ä¸ªæ¨¡å—çš„è¾“å…¥å¤§å°æ˜¯ä¸€è‡´çš„ã€‚è€Œnn.ModuleList å¹¶æ²¡æœ‰å®šä¹‰ä¸€ä¸ªç½‘ç»œï¼Œå®ƒåªæ˜¯å°†ä¸åŒçš„æ¨¡å—å‚¨å­˜åœ¨ä¸€èµ·ï¼Œè¿™äº›æ¨¡å—ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆå…ˆåé¡ºåºå¯è¨€ã€‚ç½‘ç»œçš„æ‰§è¡Œé¡ºåºæŒ‰ç…§æˆ‘ä»¬åœ¨forwardä¸­æ€ä¹ˆç¼–å†™æ¥å†³å®šçš„\næœ‰çš„æ—¶å€™ç½‘ç»œä¸­æœ‰å¾ˆå¤šç›¸ä¼¼æˆ–è€…é‡å¤çš„å±‚ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè€ƒè™‘ç”¨ for å¾ªç¯æ¥åˆ›å»ºå®ƒä»¬ï¼Œè€Œä¸æ˜¯ä¸€è¡Œä¸€è¡Œåœ°å†™ï¼Œè¿™ç§æ—¶å€™å°±ä½¿ç”¨ModuleListï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 class net4(nn.Module): def __init__(self): super(net4, self).__init__() layers = [nn.Linear(10, 10) for i in range(5)] self.linears = nn.ModuleList(layers) def forward(self, x): for layer in self.linears: x = layer(x) return x net = net4() print(net) # net4( # (linears): ModuleList( # (0): Linear(in_features=10, out_features=10, bias=True) # (1): Linear(in_features=10, out_features=10, bias=True) # (2): Linear(in_features=10, out_features=10, bias=True) # ) # ) åŸºæœ¬ä½¿ç”¨ï¼š\nnn.sequential\nå¯ä»¥é€šè¿‡listå’Œ*ä»¥åŠadd moudleæ¥è¿›è¡Œè¿­ä»£çš„å®šä¹‰ï¼ŒåŒæ—¶è¿™ç§å®šä¹‰æ–¹å¼ï¼Œä¼šæ–¹ä¾¿æˆ‘ä»¬çš„é‡å¤æ³¨å†Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 from collections import OrderedDict class net_seq(nn.Module): def __init__(self): super(net_seq, self).__init__() self.seq = nn.Sequential(OrderedDict([ ('conv1', nn.Conv2d(1,20,5)), ('relu1', nn.ReLU()), ('conv2', nn.Conv2d(20,64,5)), ('relu2', nn.ReLU()) ])) def forward(self, x): return self.seq(x) net_seq = net_seq() print(net_seq) #net_seq( # (seq): Sequential( # (conv1): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1)) # (relu1): ReLU() # (conv2): Conv2d(20, 64, kernel_size=(5, 5), stride=(1, 1)) # (relu2): ReLU() # ) #) nn.ModuleList:ä¸pythonè‡ªå¸¦çš„Listä¸åŒçš„åœ°æ–¹åœ¨äºä»–ä¼šè‡ªåŠ¨å°†ç½‘ç»œæ³¨å†Œåˆ°Parameterä¸­ï¼Œæˆä¸ºç½‘ç»œï¼Œä½†æ˜¯éœ€è¦è‡ªå·±å»ç¼–å†™forwardè¿‡ç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 class net_modlist(nn.Module): def __init__(self): super(net_modlist, self).__init__() self.modlist = nn.ModuleList([ nn.Conv2d(1, 20, 5), nn.ReLU(), nn.Conv2d(20, 64, 5), nn.ReLU() ]) def forward(self, x): for m in self.modlist: x = m(x) return x net_modlist = net_modlist() print(net_modlist) #net_modlist( # (modlist): ModuleList( # (0): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1)) # (1): ReLU() # (2): Conv2d(20, 64, kernel_size=(5, 5), stride=(1, 1)) # (3): ReLU() # ) #) for param in net_modlist.parameters(): print(type(param.data), param.size()) #","wordCount":"2434","inLanguage":"en","image":"https://hugotest-phi.vercel.app/cover/cover4.jpeg","datePublished":"2021-12-15T08:00:57Z","dateModified":"2021-12-15T08:00:57Z","author":[{"@type":"Person","name":"aikenhong"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://hugotest-phi.vercel.app/posts/pytorch/"},"publisher":{"@type":"Organization","name":"aiken's blog","logo":{"@type":"ImageObject","url":"https://hugotest-phi.vercel.app/favicon/ghost.ico"}}}</script></head><body id=top><script type=module src=https://cdn.jsdmirror.com/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js defer></script><script nomodule src=https://cdn.jsdmirror.com/npm/ionicons@7.1.0/dist/ionicons/ionicons.js defer></script><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hugotest-phi.vercel.app/ accesskey=h title="aiken's blog (Alt + H)">aiken's blog</a><div class=logo-switches><button id=theme-toggle-nav accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hugotest-phi.vercel.app/ title=home><span>home</span></a></li><li><a href=https://hugotest-phi.vercel.app/archives/ title=archives><span>archives</span></a></li><li><a href=https://hugotest-phi.vercel.app/search title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><div class=sidebar><ul><li class=logo style=--bg:#333><a href=#><div class=logo-icon><img src=/logo/logo.png></div><div class=logo-text>Aiken's Blog</div></a></li><div class=menulist><li style=--bg:#f44336><a href=https://hugotest-phi.vercel.app/ title=home><div class=logo-icon><ion-icon name=home-outline></ion-icon></div><div class=logo-text>home</div></a></li><li style=--bg:#b145e9><a href=https://hugotest-phi.vercel.app/posts/ title=posts><div class=logo-icon><ion-icon name=newspaper-outline></ion-icon></div><div class=logo-text>posts</div></a></li><li style=--bg:#0f93c7><a href=https://hugotest-phi.vercel.app/tags/ title=tags><div class=logo-icon><ion-icon name=pricetags-outline></ion-icon></div><div class=logo-text>tags</div></a></li><li style=--bg:#ffa117><a href=https://hugotest-phi.vercel.app/categories/ title=categories><div class=logo-icon><ion-icon name=grid-outline></ion-icon></div><div class=logo-text>categories</div></a></li><li style=--bg:#0fc70f><a href=https://hugotest-phi.vercel.app/archives/ title=archives><div class=logo-icon><ion-icon name=folder-outline></ion-icon></div><div class=logo-text>archives</div></a></li><li style=--bg:#d16111><a href=https://hugotest-phi.vercel.app/about/ title=about><div class=logo-icon><ion-icon name=person></ion-icon></div><div class=logo-text>about</div></a></li><li style=--bg:#15c095><a href=https://hugotest-phi.vercel.app/search title="search (Alt + /)" accesskey=/><div class=logo-icon><ion-icon name=search></ion-icon></div><div class=logo-text>search</div></a></li></div><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt +T)"><li><div class=logo-icon id=moon><ion-icon name=moon-outline></ion-icon></div><div class=logo-icon id=sun><ion-icon name=sunny-outline></ion-icon></div></li></button></div></ul></div><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hugotest-phi.vercel.app/>Home</a>&nbsp;Â»&nbsp;<a href=https://hugotest-phi.vercel.app/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">PyTorch Handbook 00 ï¼ˆArchiveï¼‰</h1><div class=post-meta><span title='2021-12-15 08:00:57 +0000 UTC'>December 15, 2021</span>&nbsp;Â·&nbsp;12 min&nbsp;Â·&nbsp;2434 words&nbsp;Â·&nbsp;aikenhong&nbsp;Â·&nbsp;<a href=/tags/python> Python</a>&nbsp;Â·&nbsp;<a href=/tags/pytorch> Pytorch</a>&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/PyTorch.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://hugotest-phi.vercel.app/cover/cover4.jpeg alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#basic-part%e5%9f%ba%e7%a1%80%e8%ae%be%e5%ae%9a%e9%83%a8%e5%88%86 aria-label="Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†">Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†</a><ul class=header-level-1><li><a href=#tensor%e5%bc%a0%e9%87%8f%e8%ae%a1%e7%ae%97 aria-label=Tensorå¼ é‡è®¡ç®—>Tensorå¼ é‡è®¡ç®—</a><ul class=header-level-2><li><a href=#%e4%b8%a4%e4%b8%aatensor%e7%9a%84%e6%95%b0%e4%b9%98 aria-label=ä¸¤ä¸ªtensorçš„æ•°ä¹˜>ä¸¤ä¸ªtensorçš„æ•°ä¹˜</a></li><li><a href=#%e5%bc%a0%e9%87%8f%e5%91%bd%e5%90%8d aria-label=å¼ é‡å‘½å>å¼ é‡å‘½å</a></li><li><a href=#%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2 aria-label=ç±»å‹è½¬æ¢>ç±»å‹è½¬æ¢</a></li><li><a href=#%e7%bb%b4%e5%ba%a6%e5%a0%86%e5%8f%a0 aria-label=ç»´åº¦å †å >ç»´åº¦å †å </a></li></ul></li><li><a href=#%e5%9f%ba%e6%9c%ac%e7%9a%84%e5%bc%a0%e9%87%8f%e5%87%bd%e6%95%b0 aria-label=åŸºæœ¬çš„å¼ é‡å‡½æ•°>åŸºæœ¬çš„å¼ é‡å‡½æ•°</a><ul class=header-level-2><li><a href=#%e9%80%89%e5%8f%96%e5%88%92%e7%aa%97 aria-label=é€‰å–åˆ’çª—>é€‰å–åˆ’çª—</a></li></ul></li><li><a href=#torch%e7%8e%af%e5%a2%83%e8%ae%be%e7%bd%ae aria-label=Torchç¯å¢ƒè®¾ç½®>Torchç¯å¢ƒè®¾ç½®</a><ul class=header-level-2><li><a href=#pytorch%e4%b8%ad%e7%9a%84%e9%9a%8f%e6%9c%ba%e7%a7%8d%e5%ad%90%e5%88%9d%e5%a7%8b%e5%8c%96 aria-label=pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–>pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–</a></li><li><a href=#nnparameter aria-label=nn.parameter()>nn.parameter()</a></li><li><a href=#nnsoftmax%e4%b8%ad%e7%9a%84dim aria-label=nn.Softmaxä¸­çš„dim>nn.Softmaxä¸­çš„dim</a></li></ul></li><li><a href=#%e6%b5%8b%e8%af%95%e9%aa%8c%e8%af%81%e6%a8%a1%e5%9d%97 aria-label=æµ‹è¯•ã€éªŒè¯æ¨¡å—>æµ‹è¯•ã€éªŒè¯æ¨¡å—</a><ul class=header-level-2><li><a href=#%e5%9f%ba%e6%9c%ac%e7%bc%96%e5%86%99 aria-label=åŸºæœ¬ç¼–å†™>åŸºæœ¬ç¼–å†™</a></li><li><a href=#modeleval%e5%92%8cmodeltrain%e7%9a%84%e5%8c%ba%e5%88%ab aria-label=model.eval()å’Œmodel.train()çš„åŒºåˆ«>model.eval()å’Œmodel.train()çš„åŒºåˆ«</a></li><li><a href=#with-torchno_grad aria-label="with torch.no_grad()">with torch.no_grad()</a></li><li><a href=#%e6%a8%a1%e5%9e%8b%e7%9a%84%e4%bf%9d%e5%ad%98%e5%92%8c%e8%af%bb%e5%8f%96%e4%b8%93%e9%a2%98 aria-label=æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜>æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜</a></li></ul></li></ul></li><li><a href=#gpu%e7%9b%b8%e5%85%b3%e7%9a%84%e8%ae%be%e7%bd%ae aria-label=GPUç›¸å…³çš„è®¾ç½®>GPUç›¸å…³çš„è®¾ç½®</a><ul class=header-level-1><li><a href=#%e6%9f%a5%e7%9c%8bgpu%e7%8a%b6%e6%80%81 aria-label=æŸ¥çœ‹GPUçŠ¶æ€>æŸ¥çœ‹GPUçŠ¶æ€</a><ul class=header-level-2><li><a href=#%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4gpu%e8%ae%be%e5%a4%87 aria-label=è®¾ç½®é»˜è®¤GPUè®¾å¤‡>è®¾ç½®é»˜è®¤GPUè®¾å¤‡</a></li><li><a href=#%e8%ae%be%e5%a4%87%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af aria-label=è®¾å¤‡åŸºæœ¬ä¿¡æ¯><strong>è®¾å¤‡åŸºæœ¬ä¿¡æ¯</strong></a></li></ul></li><li><a href=#gpu%e4%bd%bf%e7%94%a8%e7%8e%87%e4%bc%98%e5%8c%96%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label=GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰>GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰</a><ul class=header-level-2><li><a href=#%e7%bc%93%e5%ad%98%e7%88%86%e7%82%b8%e9%97%ae%e9%a2%98 aria-label=ç¼“å­˜çˆ†ç‚¸é—®é¢˜>ç¼“å­˜çˆ†ç‚¸é—®é¢˜</a></li><li><a href=#%e8%bf%90%e8%a1%8c%e6%95%88%e7%8e%87%e4%bc%98%e5%8c%96 aria-label=è¿è¡Œæ•ˆç‡ä¼˜åŒ–>è¿è¡Œæ•ˆç‡ä¼˜åŒ–</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e4%bd%bf%e7%94%a8gpu%e7%9a%84%e6%96%b9%e5%bc%8f aria-label=è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼>è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e7%9b%b8%e5%ba%94%e7%9a%84%e9%9a%8f%e6%9c%ba%e7%a7%8d%e5%ad%90 aria-label=è®¾ç½®ç›¸åº”çš„éšæœºç§å­>è®¾ç½®ç›¸åº”çš„éšæœºç§å­</a></li><li><a href=#cuda%e8%bd%ac%e6%8d%a2 aria-label=CUDAè½¬æ¢>CUDAè½¬æ¢</a></li><li><a href=#%e5%a4%9agpu%e5%b9%b6%e8%a1%8c aria-label=å¤šGPUå¹¶è¡Œ>å¤šGPUå¹¶è¡Œ</a></li></ul></li></ul></li><li><a href=#cpu aria-label=CPU>CPU</a><ul class=header-level-1><li><a href=#%e6%a0%b8%e5%bf%83%e5%92%8c%e7%ba%bf%e7%a8%8b%e6%95%b0%e8%ae%be%e7%bd%ae aria-label=æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®>æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®</a></li></ul></li><li><a href=#%e7%bd%91%e7%bb%9c%e5%ae%9a%e4%b9%89%e6%a8%a1%e5%9d%97 aria-label=ç½‘ç»œå®šä¹‰æ¨¡å—>ç½‘ç»œå®šä¹‰æ¨¡å—</a><ul class=header-level-1><li><a href=#%e6%95%b0%e6%8d%ae%e5%ae%9a%e4%b9%89%e6%a8%a1%e5%9d%97 aria-label=æ•°æ®å®šä¹‰æ¨¡å—>æ•°æ®å®šä¹‰æ¨¡å—</a><ul class=header-level-2><li><a href=#%e5%88%a9%e7%94%a8torchvision%e8%af%bb%e5%8f%96%e6%9c%ac%e5%9c%b0%e6%95%b0%e6%8d%ae aria-label=åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®>åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®</a></li><li><a href=#torch-%e8%87%aa%e5%ae%9a%e4%b9%89dataset%e5%90%8e%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label="torch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨">torch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨</a></li><li><a href=#dataloader%e4%b8%ad%e7%9a%84transformer aria-label=Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š>Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š</a></li><li><a href=#dataloader%e4%b8%ad%e7%9a%84%e5%8f%82%e6%95%b0 aria-label=Dataloaderä¸­çš„å‚æ•°>Dataloaderä¸­çš„å‚æ•°</a><ul class=header-level-3><li><a href=#collate_fn aria-label=collate_fn()>collate_fn()</a></li></ul></li></ul></li><li><a href=#%e7%bc%96%e5%86%99%e6%a8%a1%e5%9e%8b aria-label=ç¼–å†™æ¨¡å‹>ç¼–å†™æ¨¡å‹</a><ul class=header-level-2><li><a href=#%e6%a8%a1%e5%9e%8b%e5%9f%ba%e6%9c%ac%e5%8d%95%e5%85%83 aria-label=æ¨¡å‹åŸºæœ¬å•å…ƒ>æ¨¡å‹åŸºæœ¬å•å…ƒ</a></li><li><a href=#%e6%a8%a1%e5%9e%8b%e5%8f%82%e6%95%b0%e5%85%b1%e4%ba%ab aria-label=æ¨¡å‹å‚æ•°å…±äº«ï¼š>æ¨¡å‹å‚æ•°å…±äº«ï¼š</a></li><li><a href=#%e7%bd%91%e7%bb%9c%e5%ae%9a%e4%b9%89%e7%9a%84%e6%96%b9%e5%bc%8f%e5%af%b9%e6%af%94%e5%88%86%e6%9e%90 aria-label=ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ>ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ</a></li><li><a href=#detach--detach_ aria-label="Detach & detach_">Detach & detach_</a></li><li><a href=#%e6%a8%a1%e5%9e%8b%e8%b0%83%e7%94%a8%e7%9a%84tips aria-label=æ¨¡å‹è°ƒç”¨çš„Tips>æ¨¡å‹è°ƒç”¨çš„Tips</a></li><li><a href=#warm-up-factor aria-label="Warm-up factor">Warm-up factor</a></li><li><a href=#weight-decayl2 aria-label="Weight decayï¼ˆL2ï¼‰">Weight decayï¼ˆL2ï¼‰</a></li><li><a href=#learning-rate-decay aria-label="Learning Rate Decay">Learning Rate Decay</a></li></ul></li><li><a href=#%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0 aria-label=æŸå¤±å‡½æ•°>æŸå¤±å‡½æ•°</a><ul class=header-level-2><li><a href=#crossentropy%e4%ba%a4%e5%8f%89%e7%86%b5 aria-label=CrossEntropyäº¤å‰ç†µ>CrossEntropyäº¤å‰ç†µ</a></li></ul></li><li><a href=#%e4%bc%98%e5%8c%96%e5%99%a8%e8%ae%be%e8%ae%a1 aria-label=ä¼˜åŒ–å™¨è®¾è®¡>ä¼˜åŒ–å™¨è®¾è®¡</a></li><li><a href=#%e6%a8%a1%e5%9e%8b%e5%8f%82%e6%95%b0%e5%88%9d%e5%a7%8b%e5%8c%96%e5%92%8c%e6%9e%b6%e6%9e%84%e6%9f%a5%e7%9c%8b%e6%96%b9%e6%b3%95 aria-label=æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•>æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•</a><ul class=header-level-2><li><a href=#childrenmodulesparameters aria-label=childrenã€modulesã€parametersï¼š>childrenã€modulesã€parametersï¼š</a></li><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96%e5%8e%9f%e5%88%99%e7%bb%a7%e7%bb%ad%e8%b0%83%e7%a0%94 aria-label=åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰>åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰</a></li><li><a href=#%e5%85%b8%e5%9e%8b%e7%9a%84%e5%8f%82%e6%95%b0%e5%88%9d%e5%a7%8b%e5%8c%96%e6%96%b9%e6%b3%95 aria-label=å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•>å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•</a></li></ul></li><li><a href=#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b%e5%92%8c%e7%bb%b4%e5%ba%a6 aria-label=æ•°æ®ç±»å‹å’Œç»´åº¦>æ•°æ®ç±»å‹å’Œç»´åº¦</a><ul class=header-level-2><li><a href=#%e8%be%93%e5%85%a5%e6%95%b0%e6%8d%ae%e7%9a%84%e9%80%9a%e9%81%93 aria-label=è¾“å…¥æ•°æ®çš„é€šé“>è¾“å…¥æ•°æ®çš„é€šé“</a></li><li><a href=#%e6%a0%87%e7%ad%be%e7%9a%84%e5%bd%a2%e5%bc%8f%e8%bd%ac%e6%8d%a2one-hot aria-label=æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot>æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot</a></li></ul></li></ul></li><li><a href=#visualize-%e5%8f%af%e8%a7%86%e5%8c%96%e9%83%a8%e5%88%86 aria-label="Visualize å¯è§†åŒ–éƒ¨åˆ†">Visualize å¯è§†åŒ–éƒ¨åˆ†</a><ul class=header-level-1><li><a href=#tensorboard-in-pytorch aria-label="Tensorboard in Pytorch">Tensorboard in Pytorch</a><ul class=header-level-2><li><a href=#histogram-%e7%9b%b4%e6%96%b9%e5%9b%be%e5%8f%82%e6%95%b0%e7%bb%9f%e8%ae%a1 aria-label="Histogram ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡">Histogram ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡</a></li><li><a href=#embedding-projection aria-label="Embedding Projection">Embedding Projection</a></li><li><a href=#pr_curve aria-label=PR_CURVE>PR_CURVE</a></li><li><a href=#add_text aria-label=Add_TEXT>Add_TEXT</a></li><li><a href=#add_figure aria-label=ADD_Figure>ADD_Figure</a></li></ul></li><li><a href=#%e5%8f%af%e8%a7%86%e5%8c%96%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c%e7%83%ad%e5%8a%9b%e5%9b%becam aria-label=å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰>å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰</a><ul class=header-level-2><li><a href=#%e7%ae%97%e6%b3%95%e5%8e%9f%e7%90%86 aria-label=ç®—æ³•åŸç†>ç®—æ³•åŸç†</a></li><li><a href=#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0 aria-label=ä»£ç å®ç°ï¼š>ä»£ç å®ç°ï¼š</a></li></ul></li><li><a href=#bugs aria-label=BUGs>BUGs</a></li></ul></li><li><a href=#debug aria-label=DEBUG>DEBUG</a><ul class=header-level-1><li><a href=#1importerror-cannot-import-name-pillow_version aria-label="1.ImportError: cannot import name &lsquo;PILLOW_VERSION&rsquo;">1.ImportError: cannot import name &lsquo;PILLOW_VERSION&rsquo;</a></li><li><a href=#2%e6%a8%a1%e5%9e%8b%e5%8f%82%e6%95%b0%e8%ae%a1%e7%ae%97%e9%87%8f%e7%bb%9f%e8%ae%a1-and-debug%e8%be%93%e5%87%ba aria-label="2.æ¨¡å‹å‚æ•°&è®¡ç®—é‡ç»Ÿè®¡ and Debugè¾“å‡º">2.æ¨¡å‹å‚æ•°&è®¡ç®—é‡ç»Ÿè®¡ and Debugè¾“å‡º</a></li><li><a href=#3pytorch%e5%8a%a0%e8%bd%bd%e9%a2%84%e8%ae%ad%e7%bb%83%e6%a8%a1%e5%9e%8b aria-label=3.PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹>3.PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹</a></li><li><a href=#4some-of-the-strides-of-a-given-numpy-array-are-negative aria-label="4.some of the strides of a given numpy array are negative.">4.some of the strides of a given numpy array are negative.</a></li><li><a href=#5%e8%af%bb%e5%8f%96loader%e7%9a%84%e6%97%b6%e5%80%99%e5%9b%be%e5%83%8f%e7%9a%84%e5%a4%a7%e5%b0%8f%e4%b8%8d%e4%b8%80 aria-label=5.è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€>5.è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€</a></li><li><a href=#6bus-error-dataloader-num_worker aria-label="6.bus error dataloader num_worker">6.bus error dataloader num_worker</a></li><li><a href=#7bus-errorinsufficient-shared-memoryshm aria-label="7.bus errorï¼šinsufficient shared memoryï¼ˆshmï¼‰">7.bus errorï¼šinsufficient shared memoryï¼ˆshmï¼‰</a></li><li><a href=#8%e8%ae%ad%e7%bb%83%e8%bf%87%e7%a8%8b%e4%b8%adcache%e5%92%8cmemory%e7%9a%84%e5%8d%a0%e7%94%a8%e9%80%90%e6%b8%90%e5%8d%87%e9%ab%98 aria-label=8.è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜>8.è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜</a></li><li><a href=#9%e6%a2%af%e5%ba%a6%e7%88%86%e7%82%b8%e9%97%ae%e9%a2%98%e7%ae%97%e6%b3%95%e6%b2%a1%e6%9c%89%e5%ad%a6%e4%b9%a0%e6%95%88%e6%9e%9c aria-label=9.æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ>9.æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ</a></li><li><a href=#10%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2%e9%97%ae%e9%a2%98%e6%b1%87%e6%80%bb aria-label=10.ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»>10.ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»</a></li><li><a href=#11%e6%95%b0%e6%8d%ae%e7%bb%b4%e5%ba%a6%e4%b8%8d%e5%af%b9%e5%ba%94%e9%97%ae%e9%a2%98%e6%b1%87%e6%80%bb aria-label=11.æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»>11.æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»</a></li><li><a href=#12%e5%8f%96%e5%87%ba%e5%85%b7%e4%bd%93%e6%95%b0%e5%80%bc%e6%97%b6%e5%80%99%e7%9a%84%e9%97%ae%e9%a2%98 aria-label=12.å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜>12.å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜</a></li><li><a href=#13cpu%e5%8d%a0%e7%94%a899 aria-label=13.CPUå ç”¨99%>13.CPUå ç”¨99%</a></li><li><a href=#14-%e9%a2%84%e6%b5%8b%e5%80%bc%e5%85%a8%e4%b8%ba0%e6%a8%a1%e5%9e%8b%e6%94%b6%e6%95%9b%e5%88%b0%e5%a5%87%e6%80%aa%e7%9a%84%e5%9c%b0%e6%96%b9%e6%8d%9f%e5%a4%b1%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4%e5%85%a8%e5%9d%87%e7%ad%89 aria-label="14. é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰">14. é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰</a></li><li><a href=#15%e6%a8%a1%e5%9e%8b%e9%83%a8%e5%88%86-%e8%ae%ad%e7%bb%83%e4%b8%ad%e6%a8%a1%e5%9e%8b%e5%87%86%e7%a1%ae%e7%8e%87%e4%b8%8d%e4%b8%8a%e5%8d%87 aria-label="15.æ¨¡å‹éƒ¨åˆ†ï¼š è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡">15.æ¨¡å‹éƒ¨åˆ†ï¼š è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡</a></li><li><a href=#16-on-entry-to-sgemm-parameter-number-8-had-an-illegal-value aria-label="16. On entry to SGEMM parameter number 8 had an illegal value">16. On entry to SGEMM parameter number 8 had an illegal value</a></li><li><a href=#17-cuda-error-device-side-assert-triggered-cuda-kernel-errors-might-be-asynchronously-reported-at-some-other-api-call aria-label="17. CUDA error: device-side assert triggered CUDA kernel errors might be asynchronously reported at some other API call">17. CUDA error: device-side assert triggered CUDA kernel errors might be asynchronously reported at some other API call</a></li><li><a href=#runtimeerror-the-derivative-for-target-is-not-implemented aria-label="RuntimeError the derivative for target is not implemented">RuntimeError the derivative for target is not implemented</a></li><li><a href=#only-tensors-created-explicitly-by-the-user-graph-leaves-support-the-deepcopy-protocol-at-the-moment aria-label="Only Tensors created explicitly by the user (graph leaves) support the deepcopy protocol at the moment">Only Tensors created explicitly by the user (graph leaves) support the deepcopy protocol at the moment</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;document.addEventListener("DOMContentLoaded",function(){if(checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),elements.length>0){activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")}const t=document.getElementById("top-link");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{const e=window.pageYOffset||document.documentElement.scrollTop;if(e===0)return;elements&&elements.length>0&&(elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase(),n=document.querySelector(`.inner ul li a[href="#${t}"]`);n.classList.remove("read")}),activeElement=Array.from(elements).find(t=>{if(getOffsetTop(t)-e>0&&getOffsetTop(t)-e<window.innerHeight/2)return t})||activeElement,elements.forEach((t)=>{const o=encodeURI(t.getAttribute("id")).toLowerCase(),s=document.querySelector(`.inner ul li a[href="#${o}"]`);if(t===activeElement){s.classList.add("active");const e=document.querySelector(".toc .inner"),t=s.offsetTop,n=e.clientHeight,o=s.clientHeight,i=t-n/2+o/2;e.scrollTo({top:i,behavior:"smooth"})}else getOffsetTop(t)<e&&s.classList.add("read"),s.classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return!document.querySelector(".hugo-encryptor-prompt")&&elements.length!=0&&(elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),console.log("Elements re-queried:",elements)),0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=basic-partåŸºç¡€è®¾å®šéƒ¨åˆ†>Basic PartåŸºç¡€è®¾å®šéƒ¨åˆ†<a hidden class=anchor aria-hidden=true href=#basic-partåŸºç¡€è®¾å®šéƒ¨åˆ†>#</a></h1><p>@AikenH 2020 + 2021</p><p>this part is about pytorch basic unit, help me to code deep learning better.</p><h2 id=tensorå¼ é‡è®¡ç®—>Tensorå¼ é‡è®¡ç®—<a hidden class=anchor aria-hidden=true href=#tensorå¼ é‡è®¡ç®—>#</a></h2><h3 id=ä¸¤ä¸ªtensorçš„æ•°ä¹˜>ä¸¤ä¸ªtensorçš„æ•°ä¹˜<a hidden class=anchor aria-hidden=true href=#ä¸¤ä¸ªtensorçš„æ•°ä¹˜>#</a></h3><p>è®¡ç®—ä¸¤ä¸ªtensorçš„çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„å…¶ä¸­çš„batchè¦ç›¸äº’å¯¹åº”ï¼Œå¦‚æœä¸è€ƒè™‘batchï¼Œå°±æ˜¯å¦ä¸€ä¸ªå‡½æ•°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ç®€å•çš„åˆ†æä¸€ä¸‹ç®—æ³•çš„é€»è¾‘</span>
</span></span><span class=line><span class=cl><span class=c1># è¿™æ˜¯å‰²è£‚å‡ºæ¥batchçš„çŸ©é˜µç›¸ä¹˜å½¢å¼</span>
</span></span><span class=line><span class=cl><span class=n>batch1</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>batch2</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>out</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>bmm</span><span class=p>(</span><span class=n>batch1</span><span class=p>,</span> <span class=n>batch2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>out</span><span class=o>.</span><span class=n>size</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;output ans is
</span></span></span><span class=line><span class=cl><span class=s1>torch.size([10,3,5])&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‰ä½ç›¸ä¹˜</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span><span class=n>batch1</span><span class=p>,</span><span class=n>batch2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>viewå’Œpermute</strong>çš„ä½¿ç”¨å®é™…ä¸Šéƒ½æ˜¯ä¸æ”¹å˜åŸå€¼ï¼Œè¦ç”¨èµ‹å€¼çš„æ–¹å¼å»åšï¼Œä¸»è¦æ˜¯ä½¿ç”¨æ–¹å¼è¦å¯¹ï¼Œä¸€ä¸ªæ˜¯æŒ‰ç…§é¡ºåºå»åšã€‚</p><h3 id=å¼ é‡å‘½å>å¼ é‡å‘½å<a hidden class=anchor aria-hidden=true href=#å¼ é‡å‘½å>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>NCHW</span> <span class=o>=</span> <span class=p>[</span><span class=err>â€˜</span><span class=n>N</span><span class=err>â€™</span><span class=p>,</span> <span class=err>â€˜</span><span class=n>C</span><span class=err>â€™</span><span class=p>,</span> <span class=err>â€˜</span><span class=n>H</span><span class=err>â€™</span><span class=p>,</span> <span class=err>â€˜</span><span class=n>W</span><span class=err>â€™</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>images</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=n>NCHW</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>images</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>images</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç±»å‹è½¬æ¢>ç±»å‹è½¬æ¢<a hidden class=anchor aria-hidden=true href=#ç±»å‹è½¬æ¢>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># tensor ä¸ nd.arrayè¿›è¡Œäº’æ¢</span>
</span></span><span class=line><span class=cl><span class=n>ndarray</span> <span class=o>=</span> <span class=n>tensor</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>tensor</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>from_numpy</span><span class=p>(</span><span class=n>ndarray</span><span class=p>)</span><span class=o>.</span><span class=n>float</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># tensorä¸PIL.IMAGEè¿›è¡Œäº’æ¢</span>
</span></span><span class=line><span class=cl><span class=n>image</span> <span class=o>=</span> <span class=n>torchvision</span><span class=o>.</span><span class=n>transforms</span><span class=o>.</span><span class=n>functional</span><span class=o>.</span><span class=n>to_pil_image</span><span class=p>(</span><span class=n>tensor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>path</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;./figure.jpg&#39;</span>
</span></span><span class=line><span class=cl><span class=n>tensor</span> <span class=o>=</span> <span class=n>torchvision</span><span class=o>.</span><span class=n>transforms</span><span class=o>.</span><span class=n>functional</span><span class=o>.</span><span class=n>to_tensor</span><span class=p>(</span><span class=n>PIL</span><span class=o>.</span><span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># np.ndarray ä¸ PIL.Imageçš„äº’æ¢</span>
</span></span><span class=line><span class=cl><span class=n>image</span> <span class=o>=</span> <span class=n>PIL</span><span class=o>.</span><span class=n>Image</span><span class=o>.</span><span class=n>fromarray</span><span class=p>(</span><span class=n>nd</span><span class=o>.</span><span class=n>array</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ndarray</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>PIL</span><span class=o>.</span><span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç»´åº¦å †å >ç»´åº¦å †å <a hidden class=anchor aria-hidden=true href=#ç»´åº¦å †å >#</a></h3><p>Stackï¼Œ<strong>æ™®é€šçš„ç»´åº¦å †å çš„æµ‹è¯•ä»£ç å¦‚ä¸‹</strong></p><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸Šdim=0å°±æ˜¯åŸºæœ¬çš„å †èµ·æ¥ï¼Œdim=1å°±æ˜¯æŒ‰ç…§è¡Œæ¥å †ï¼Œdim=2å°±æ˜¯æŒ‰ç…§åˆ—æ¥å †</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>100</span><span class=p>,</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span><span class=mi>1000</span><span class=p>,</span><span class=mi>100</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----------------a----------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----------------b----------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----------------c----------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----------------dim =0----------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>stack</span><span class=p>((</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>),</span><span class=n>dim</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;the value of d:-    </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠå•ä¸ªå½“æˆæ•´ä½“ç›´æ¥ä»ä¸Šå¾€ä¸‹å †å </span>
</span></span><span class=line><span class=cl><span class=c1># ä»¥x[:][:]ä¸ºæ„æˆå•å…ƒ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----------------dim =1----------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>stack</span><span class=p>((</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>),</span><span class=n>dim</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;the value of d:-    </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># å°†æ¯ä¸ªçš„ç¬¬ä¸€ä¸ªç»´åº¦ï¼ŒæŒ‰æ¬¡åºçº³å‡ºæ¥ï¼ŒåŒvalueçš„å †åœ¨ä¸€èµ·</span>
</span></span><span class=line><span class=cl><span class=c1># for exampleï¼š[a[i][:],b[i][:],c[i][:] ]ç»„æˆæ–°çš„å•å…ƒå—</span>
</span></span><span class=line><span class=cl><span class=c1># ä¸ï¼Œå¦ä¸€ç§ç†è§£ï¼Œä»¥x[i][:] ä¸ºå•å…ƒ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----------------dim =2----------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>stack</span><span class=p>((</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>),</span><span class=n>dim</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;the value of d:-    </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># ç›¸åº”çš„ä»¥x[i][j]ä¸ºå•å…ƒæ„æˆ</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>listçš„æƒ…å†µä¸‹çš„ç»´åº¦å †å æµ‹è¯•ä»£ç å¦‚ä¸‹</strong></p><p>ç›¸åº”çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸Šä¸€èˆ¬æ˜¯æŒ‰ç…§dim=1æ¥è¿›è¡Œå †å </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>A</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>B</span> <span class=o>=</span> <span class=p>[</span><span class=n>A</span><span class=p>[:,</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>A</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>1</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=c1># è¿™æ ·ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªlist,æŒ‰ç…§æˆ‘ä»¬indexçš„æ’åº</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>B</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>C</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;---------------------result-----------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>C</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Cat</strong></p><p>å®é™…ä¸Šåº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„å †å æ€è·¯</p><h2 id=åŸºæœ¬çš„å¼ é‡å‡½æ•°>åŸºæœ¬çš„å¼ é‡å‡½æ•°<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬çš„å¼ é‡å‡½æ•°>#</a></h2><p>torch.split() åˆ’åˆ†tensor</p><p>torch.randpermè¿›è¡Œlistçš„ä¹±åºå¤„ç†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å’ŒshuffleåŒºåˆ†ï¼Œè¿™æ˜¯å¦ä¸€ç§ä¹±åºçš„æ“ä½œ</span>
</span></span><span class=line><span class=cl><span class=c1># catæ“ä½œ</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>([</span><span class=n>i</span><span class=p>,</span><span class=n>i</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>all_inputs</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>cat</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># randpermçš„æ•ˆæœ test1</span>
</span></span><span class=line><span class=cl><span class=n>idx</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randperm</span><span class=p>(</span><span class=n>all_inputs</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>all_inputs</span><span class=p>,</span> <span class=n>all_inputs</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a1</span><span class=p>,</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># test2 ï¼Œ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># randperm è¿›è¡Œlistçš„shuffle</span>
</span></span><span class=line><span class=cl><span class=n>tensor_a</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>10</span><span class=p>,[</span><span class=mi>8</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;origin version &#39;</span><span class=p>,</span> <span class=n>tensor_a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>idx</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randperm</span><span class=p>(</span><span class=n>tensor_a</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;shuffle idx &#39;</span><span class=p>,</span> <span class=n>idx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>tensor_b</span> <span class=o>=</span> <span class=n>tensor_a</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;after operation &#39;</span><span class=p>,</span> <span class=n>tensor_b</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>.fill_()æŒ‰ç…§è¾“å…¥çš„å€¼å¯¹å¼ é‡è¿›è¡Œå¡«å……</p><h3 id=é€‰å–åˆ’çª—>é€‰å–åˆ’çª—<a hidden class=anchor aria-hidden=true href=#é€‰å–åˆ’çª—>#</a></h3><p><code>nn.unfold</code>æ‹†è§£å·ç§¯ä¸­çš„åˆ’çª—æ­¥éª¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=n>inputs</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>unfold</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>Unfold</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=n>stride</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=n>unfold</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># res output</span>
</span></span><span class=line><span class=cl><span class=n>output</span><span class=o>.</span><span class=n>size</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>3136</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 3136 = (224/4) * (224/4)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=torchç¯å¢ƒè®¾ç½®>Torchç¯å¢ƒè®¾ç½®<a hidden class=anchor aria-hidden=true href=#torchç¯å¢ƒè®¾ç½®>#</a></h2><h3 id=pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–>pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–<a hidden class=anchor aria-hidden=true href=#pytorchä¸­çš„éšæœºç§å­åˆå§‹åŒ–>#</a></h3><p>yTorch å’Œ Pythonçš„éšæœºæ•°ç”Ÿæˆå™¨å°±ç®—éšæœºç§å­ä¸€æ ·ä¹Ÿä¸ä¼šäº§ç”Ÿä¸€æ ·çš„ç»“æœã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®¾ç½®Pytorchçš„éšæœºæ•°ç§å­ï¼šï¼ˆé€šå¸¸å’ŒGPUä¸€èµ·ä½¿ç”¨ï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>manual_seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=nnparameter>nn.parameter()<a hidden class=anchor aria-hidden=true href=#nnparameter>#</a></h3><ol><li>Main ideaï¼š<strong>parameterçš„ä½œç”¨ï¼Œä¸»è¦æ˜¯å°†å‚æ•°å’Œmodelç»‘å®šåœ¨ä¸€èµ·</strong>ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå¯èƒ½éœ€<strong>è¦è®­ç»ƒçš„å‚æ•°</strong>æœ‰å“ªäº›ï¼Œå¯ä»¥éœ€è¦è¿›è¡Œè®­ç»ƒçš„å‚æ•°åŠ è¿›å»ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦freeze itçš„æ—¶å€™å°±ä½¿ç”¨detachæˆ–è€…ç›´æ¥ä¿®æ”¹require_gradæ¥è®©å‚æ•°ä¸åœ¨æ¥å—è®­ç»ƒå°±å¥½äº†ï¼Œ require_gradæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚å¯ä»¥ç»“åˆä¸Šé¢çš„ä»£ç åˆ†æã€‚</li><li>tensorå˜é‡æ˜¯ä¸å¯è®­ç»ƒçš„ï¼Œåªæœ‰ä¿®æ”¹æˆparameteræ‰èƒ½è¿›è¡Œè®­ç»ƒã€‚</li><li>è‡ªå¸¦çš„ç½‘ç»œç»“æ„ä¸­çš„ä¸€äº›weightå’Œbiasåº”è¯¥éƒ½æ˜¯parameterçš„å˜é‡</li></ol><h3 id=nnsoftmaxä¸­çš„dim>nn.Softmaxä¸­çš„dim<a hidden class=anchor aria-hidden=true href=#nnsoftmaxä¸­çš„dim>#</a></h3><p>å…¶å®æ²¡é‚£ä¹ˆå¤æ‚ï¼Œå°±å’Œæ•°æ®çš„ç»´åº¦æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé‚£ä¸€ä¸ªç»´åº¦çš„æ•°æ®ä¹‹åçš„æ•°æ®å…¨éƒ¨åŠ èµ·æ¥å¤„ç†å°±ç”¨å“ªä¸ªç»´åº¦å»åšã€‚</p><p>IMAGE = N* DATAï¼Œdim=1 è¯´æ˜dim = 0 çš„Channel æ˜¯éœ€è¦è¢«æ’å¤–çš„ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„softmaxæ˜¯åŸºäºdataè¿›è¡Œçš„ã€‚å¯ä»¥æ‰¾å¯»æºç è¿›è¡Œè¿›ä¸€æ­¥åˆ†æè§£é‡Šã€‚</p><h2 id=æµ‹è¯•éªŒè¯æ¨¡å—>æµ‹è¯•ã€éªŒè¯æ¨¡å—<a hidden class=anchor aria-hidden=true href=#æµ‹è¯•éªŒè¯æ¨¡å—>#</a></h2><h3 id=åŸºæœ¬ç¼–å†™>åŸºæœ¬ç¼–å†™<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ç¼–å†™>#</a></h3><h3 id=modelevalå’Œmodeltrainçš„åŒºåˆ«>model.eval()å’Œmodel.train()çš„åŒºåˆ«<a hidden class=anchor aria-hidden=true href=#modelevalå’Œmodeltrainçš„åŒºåˆ«>#</a></h3><p>é€šå¸¸åœ¨æ¨¡å‹æµ‹è¯•çš„æ—¶å€™ä¼šæ‰§è¡Œ<code>model.eval()</code>åˆ‡æ¢æ¨¡å‹çš„çŠ¶æ€ï¼Œè€Œåœ¨è®­ç»ƒçš„æ—¶å€™ä¼šæ‰§è¡Œ<code>model.train()</code>ï¼Œmodelåœ¨è¿™ä¸¤ä¸ªçŠ¶æ€ä¸‹çš„åŒºåˆ«ä¸»è¦æœ‰ï¼š</p><p>åœ¨<strong>train</strong>çŠ¶æ€ä¸‹ä¼šå¯ç”¨BNå’ŒDropoutï¼Œè€Œåœ¨<strong>eval</strong>ä¸å¯ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼›</p><ul><li>å¯ç”¨BNæŒ‡çš„æ˜¯ï¼šç”¨åˆ°æ¯ä¸€ä¸ªBatchæ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼›ä¸å¯ç”¨åˆ™æŒ‡çš„æ˜¯ä½¿ç”¨æ•´ä½“çš„å‡å€¼å’Œæ–¹å·®ï¼ˆåŒæ—¶åœæ­¢æ›´æ–°meanå’Œvarï¼‰</li><li>è€Œå¯¹äºDropoutæ¥è¯´ï¼šå¯ç”¨çš„æ—¶å€™æŒ‡çš„æ˜¯ä¼šéšæœºè¿›è¡Œdropoutï¼Œè€Œå…³é—­çš„è¯å°±ä¼šç”¨åˆ°å…¨éƒ¨çš„ç½‘ç»œé“¾æ¥</li></ul><h3 id=with-torchno_grad>with torch.no_grad()<a hidden class=anchor aria-hidden=true href=#with-torchno_grad>#</a></h3><p>ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œwrapèµ·æ¥çš„éƒ¨åˆ†ä¸ä¼štrack grade</p><p>ä¸»è¦ç”¨äºåœæ­¢autogradæ¨¡å—çš„å·¥ä½œï¼Œè¢«<code>with</code>åŒ…è£¹èµ·æ¥çš„éƒ¨åˆ†ä¼šåœæ­¢æ¢¯åº¦çš„æ›´æ–°ï¼Œå¾—åˆ°è¿›ä¸€æ­¥çš„åŠ é€ŸæŠŠï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šåœ¨éªŒè¯çš„æ—¶å€™ä¸ä¼šæ‰§è¡Œ<code>step()</code>ç­‰æ“ä½œï¼Œæ‰€ä»¥èƒ½å¤ŸèŠ‚çœè®¡ç®—æ¨¡å‹æ¢¯åº¦çš„æ—¶é—´ã€‚</p><h3 id=æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜>æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜<a hidden class=anchor aria-hidden=true href=#æ¨¡å‹çš„ä¿å­˜å’Œè¯»å–ä¸“é¢˜>#</a></h3><p>@Aiken 2020</p><p>åŸºäºonenoteç¬”è®°ï¼Œæˆ‘ä»¬çŸ¥é“å…³é”®åœ¨äºå¦‚ä½•è‡ªç”±çš„è¯»å–æ¨¡å‹ä¸­çš„å‚æ•°ï¼Œå¹¶é€‰æ‹©æ€§çš„å–å‡ºæ¥ã€‚</p><p><a href=https://blog.csdn.net/LXX516/article/details/80124768 target=_blank rel=noopener>pytorch æ¨¡å‹éƒ¨åˆ†å‚æ•°çš„åŠ è½½_LXX516çš„åšå®¢-CSDNåšå®¢_pytorch åŠ è½½éƒ¨åˆ†å‚æ•°</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è‡³å°‘åŸºäºè¿™æ ·çš„æ–¹å¼æˆ‘ä»¬èƒ½æŠŠæ¨¡å‹ä¸­å‚æ•°çš„stringå–å‡ºæ¥ã€‚</span>
</span></span><span class=line><span class=cl><span class=n>pretrained_dict</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>model_weight</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model_dict</span><span class=o>=</span><span class=n>myNet</span><span class=o>.</span><span class=n>state_dict</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. filter out unnecessary keys</span>
</span></span><span class=line><span class=cl><span class=n>pretrained_dict</span> <span class=o>=</span> <span class=p>{</span><span class=n>k</span><span class=p>:</span> <span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>pretrained_dict</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> <span class=k>if</span> <span class=n>k</span> <span class=ow>in</span> <span class=n>model_dict</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. overwrite entries in the existing state dict</span>
</span></span><span class=line><span class=cl><span class=n>model_dict</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>pretrained_dict</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>myNet</span><span class=o>.</span><span class=n>load_state_dict</span><span class=p>(</span><span class=n>model_dict</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=gpuç›¸å…³çš„è®¾ç½®>GPUç›¸å…³çš„è®¾ç½®<a hidden class=anchor aria-hidden=true href=#gpuç›¸å…³çš„è®¾ç½®>#</a></h1><p>@written by Aiken, 2020 this document is about Pytorchâ€˜s CUDA, & GPU setting.</p><h2 id=æŸ¥çœ‹gpuçŠ¶æ€>æŸ¥çœ‹GPUçŠ¶æ€<a hidden class=anchor aria-hidden=true href=#æŸ¥çœ‹gpuçŠ¶æ€>#</a></h2><h3 id=è®¾ç½®é»˜è®¤gpuè®¾å¤‡>è®¾ç½®é»˜è®¤GPUè®¾å¤‡<a hidden class=anchor aria-hidden=true href=#è®¾ç½®é»˜è®¤gpuè®¾å¤‡>#</a></h3><p>ä¸€èˆ¬ä½¿ç”¨GPUä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç³»ç»Ÿä¸­æœ‰å¤šå°‘GPUè®¾å¤‡ï¼Œå› ä¸ºé»˜è®¤çš„GPUè®¾å¤‡æ˜¯0ï¼Œè€Œä¸”ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ç›´æ¥ä½¿ç”¨è¿™å¼ å¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœåªä½¿ç”¨å•å¡çš„è¯ï¼Œåˆ‡æ¢ä¸€ä¸‹é»˜è®¤çš„GPUè®¾å¤‡ï¼Œèƒ½å¤Ÿé¿å…ä¸€å®šçš„å†²çªã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æŸ¥çœ‹GPUä½¿ç”¨çŠ¶æ€</span>
</span></span><span class=line><span class=cl>$ nvidia-smi
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl>$ gpustat <span class=o>[</span>--watch<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è®¾å¤‡åŸºæœ¬ä¿¡æ¯><strong>è®¾å¤‡åŸºæœ¬ä¿¡æ¯</strong><a hidden class=anchor aria-hidden=true href=#è®¾å¤‡åŸºæœ¬ä¿¡æ¯>#</a></h3><ol><li><p>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨GPUï¼Œæ•°é‡ï¼Œç±»å‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æ˜¯å¦å­˜åœ¨GPUï¼Œæ•°é‡ï¼Œç±»å‹</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>device_count</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>get_device_name</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>æŸ¥çœ‹æŒ‡å®šçš„GPUçš„å®¹é‡å’Œåç§°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>get_device_capability</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>get_device_name</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>è®¾ç½®å½“å‰ç³»ç»Ÿçš„é»˜è®¤gpu_devicesï¼Œæ¨èä½¿ç”¨osæ¥è®¾ç½®ï¼ˆå®é™…ä¸Šæ˜¯å‘½ä»¤è¡Œä¸­çš„æ“ä½œï¼‰å®é™…ä¸Šæ˜¯ç³»ç»Ÿè®¾å®šé’ˆå¯¹å½“å‰è¿›ç¨‹çš„å¯è§GPUï¼Œå…¶ä»–çš„GPUä¼šå¯¹å½“å‰çš„ç¨‹åºéšè—ï¼Œæ‰€ä»¥é»˜è®¤çš„0</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;CUDA_VISIBLE_DEVICES&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;id&#34;</span> <span class=c1>#æ¨èç”¨æ³•</span>
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥åœ¨vscodeçš„launch.jsonä¸­è®¾ç½®env</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>æ³¨æ„äº‹é¡¹ï¼šè¯¥å‘½ä»¤éœ€è¦åœ¨æ‰€æœ‰è°ƒç”¨äº†CUDAçš„ä»£ç ã€å­ç¨‹åºä¹‹å‰ï¼ŒåŒ…æ‹¬<code>import</code>ï¼Œæ‰€ä»¥å¾ˆå¤šä»£ç çš„importéƒ½æ˜¯åœ¨main()ä¸­çš„ã€‚</strong></p></li></ol><h2 id=gpuä½¿ç”¨ç‡ä¼˜åŒ–æ³¨æ„äº‹é¡¹>GPUä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆæ³¨æ„äº‹é¡¹ï¼‰<a hidden class=anchor aria-hidden=true href=#gpuä½¿ç”¨ç‡ä¼˜åŒ–æ³¨æ„äº‹é¡¹>#</a></h2><h3 id=ç¼“å­˜çˆ†ç‚¸é—®é¢˜>ç¼“å­˜çˆ†ç‚¸é—®é¢˜<a hidden class=anchor aria-hidden=true href=#ç¼“å­˜çˆ†ç‚¸é—®é¢˜>#</a></h3><p>GPUä½¿ç”¨é€”ä¸­éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œåœ¨æ¯æ¬¡iterationä¹‹åè®°å¾—<strong>æ¸…é™¤åœ¨GPUä¸­å ç”¨</strong>çš„memoryï¼Œcacheç­‰ï¼Œä¸ç„¶æœ‰æ—¶å€™ä¼šå¯¼è‡´ç¼“å­˜å’Œå†…å­˜çš„é€’å¢å’Œçˆ†ç‚¸ã€‚</p><p>å…·ä½“æ“ä½œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>empty_cache</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># after every iteration</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è¿è¡Œæ•ˆç‡ä¼˜åŒ–>è¿è¡Œæ•ˆç‡ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#è¿è¡Œæ•ˆç‡ä¼˜åŒ–>#</a></h3><p><code>cudnn.benchmark</code>ã€<a href=https://discuss.pytorch.org/t/what-does-torch-backends-cudnn-benchmark-do/5936 target=_blank rel=noopener>pytorchè®ºå›</a>
<a href=https://www.pytorchtutorial.com/when-should-we-set-cudnn-benchmark-to-true/ target=_blank rel=noopener>pytorchä¸­æ–‡ç½‘</a>
ã€<a href=https://zhuanlan.zhihu.com/p/73711222 target=_blank rel=noopener>zhihuç©¶æåˆ†ææ–‡</a></p><p><strong>åŸºæœ¬ä½¿ç”¨æ€è·¯</strong>ï¼š</p><p>åœ¨ç¨‹åºçš„å¼€å§‹ï¼Œè®©cudnnèŠ±è´¹ä¸€ç‚¹é¢å¤–çš„æ—¶é—´ï¼Œæ‰¾åˆ°é€‚ç”¨äºå½“å‰é…ç½®çš„æœ€ä½³ç®—æ³•ï¼Œä»è€Œä¼˜åŒ–è¿è¡Œæ•ˆç‡ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„input_sizeåœ¨æ¯ä¸ªiterationéƒ½å­˜åœ¨å˜åŒ–çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªiterationéƒ½è¦æ‰§è¡Œä¸€æ¬¡æœç´¢ï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</p><p><strong>å…·ä½“æ“ä½œ</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>backends</span><span class=o>.</span><span class=n>cudnn</span><span class=o>.</span><span class=n>benchmark</span> <span class=o>=</span> <span class=n>true</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è®¾ç½®ä½¿ç”¨gpuçš„æ–¹å¼>è®¾ç½®ä½¿ç”¨GPUçš„æ–¹å¼<a hidden class=anchor aria-hidden=true href=#è®¾ç½®ä½¿ç”¨gpuçš„æ–¹å¼>#</a></h3><h3 id=è®¾ç½®ç›¸åº”çš„éšæœºç§å­>è®¾ç½®ç›¸åº”çš„éšæœºç§å­<a hidden class=anchor aria-hidden=true href=#è®¾ç½®ç›¸åº”çš„éšæœºç§å­>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>empty_cache</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># part2 è®¾ç½®éšæœºç§å­</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>manual_seed</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>manual_seed_all</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cudaè½¬æ¢>CUDAè½¬æ¢<a hidden class=anchor aria-hidden=true href=#cudaè½¬æ¢>#</a></h3><p>ä½¿ç”¨<code>.cuda()</code>æ¥å¯¹<code>æ¨¡å‹</code>ï¼Œ<code>æ•°æ®</code>ï¼Œ<code>Loss</code>è¿›è¡Œèµ‹å€¼ï¼Œæˆ–è€…ä½¿ç”¨<code>to_devices()</code>æ¥è®¾ç½®åˆ°ç›¸åº”çš„GPUè®¾å¤‡</p><p>å°†æ¨¡å‹è½¬åŒ–åˆ°cudaä¸­è¦åœ¨ä¼˜åŒ–å™¨çš„å»ºç«‹ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºoptimizeræ˜¯å¯¹äºæ¨¡å‹å»ºç«‹çš„ï¼Œå¯¹æ¨¡å‹æ‰§è¡Œcudaåå·²ç»å’ŒåŸæœ¬çš„å‚æ•°å’Œæ¨¡å‹éƒ½ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼Œæ‰€ä»¥ä¸€å®š<strong>è¦åœ¨å»ºç«‹ä¼˜åŒ–å™¨ä¹‹å‰å°±å¯¹æ¨¡å‹è¿›è¡ŒCuda çš„è½¬åŒ–</strong>ã€‚</p><p>æ˜¯å¦è¦å¯¹lossè½¬æ¢åˆ°CUDAï¼Œå–å†³äºä¸€ä¸‹çš„ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æŸå¤±å‡½æ•°æ˜¯Functionalï¼šè¿™æ ·çš„è¯åªè¦ä¼ å…¥çš„å‚æ•°æ˜¯CUDAçš„å°±ä¼šå†CUDAä¸Šè®¡ç®—</li><li>æŸå¤±å‡½æ•°æ˜¯Class with paramsï¼šå¦‚æœç±»å†…æœ‰å‚æ•°çš„è¯ï¼Œä¹Ÿè¦è½¬æ¢åˆ°CUDAæ‰èƒ½ä¸€èµ·åœ¨CUDAä¸Šè®¡ç®—</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>loss</span> <span class=o>=</span> <span class=n>loss</span><span class=o>.</span><span class=n>cuda</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>except</span> <span class=ne>AttributeError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;the loss is not cuda-able </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>loss</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å¤šgpuå¹¶è¡Œ>å¤šGPUå¹¶è¡Œ<a hidden class=anchor aria-hidden=true href=#å¤šgpuå¹¶è¡Œ>#</a></h3><p>ä¸»è¦ä½¿ç”¨çš„å‘½ä»¤<code>nn.DataParallel()</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>DataParaller</span><span class=p>(</span><span class=n>model</span><span class=p>,</span><span class=n>device_ids</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœä¸è®¾å®šidçš„è¯ï¼Œåº”è¯¥æ˜¯è‡ªåŠ¨æŒ‡å®šå…¨éƒ¨å¯è§çš„GPUçš„</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=cpu>CPU<a hidden class=anchor aria-hidden=true href=#cpu>#</a></h1><p>å¶ç„¶ä¼šç”±äº<code>pin_memory</code> çš„è®¾ç½®æ¥è‡´ä½¿CPUçš„ä¸æ­£å¸¸è¿è¡Œï¼ˆæ»¡è½½ç­‰ç­‰ï¼‰ï¼Œå¹¶éæ€»æ˜¯è¿™æ ·ã€‚</p><h2 id=æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®>æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®<a hidden class=anchor aria-hidden=true href=#æ ¸å¿ƒå’Œçº¿ç¨‹æ•°è®¾ç½®>#</a></h2><p><a href=https://blog.csdn.net/lei_qi/article/details/115358703 target=_blank rel=noopener>é™åˆ¶æˆ–å¢åŠ pytorchçš„çº¿ç¨‹ä¸ªæ•°ï¼æŒ‡å®šæ ¸æ•°æˆ–è€…æ»¡æ ¸è¿è¡ŒPytorchï¼ï¼ï¼_lei_qiçš„åšå®¢-CSDNåšå®¢</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>multiprocessing</span> <span class=kn>import</span> <span class=n>cpu_count</span>
</span></span><span class=line><span class=cl><span class=c1># è®¾ç½®ç¯å¢ƒå˜é‡æ¥æ§åˆ¶çº¿ç¨‹å¤šå‘çš„æƒ…å†µ</span>
</span></span><span class=line><span class=cl><span class=n>cpu_num</span> <span class=o>=</span> <span class=n>cpu_count</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># æ ¸å¿ƒä»£ç </span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;OMP_NUM_THREADS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>cpu_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># ä¸‹é¢è¿™äº›åº”è¯¥æ˜¯ä¸ä¸€å®šè¯æœ‰</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span> <span class=p>[</span><span class=s1>&#39;OPENBLAS_NUM_THREADS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>cpu_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span> <span class=p>[</span><span class=s1>&#39;MKL_NUM_THREADS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>cpu_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span> <span class=p>[</span><span class=s1>&#39;VECLIB_MAXIMUM_THREADS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>cpu_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span> <span class=p>[</span><span class=s1>&#39;NUMEXPR_NUM_THREADS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>cpu_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»å…¶ä»–èµ„æ–™ä¸­å¯ä»¥æ„Ÿè§‰è¿™æ¡ä»£ç åº”è¯¥æ˜¯å’Œæ ¸å¿ƒä»£ç ä¸€æ ·çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸¤ä¸ªå†™ä¸€ä¸ªåº”è¯¥å°±å¯ä»¥äº†</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>set_num_threds</span><span class=p>(</span><span class=n>cpu_num</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=ç½‘ç»œå®šä¹‰æ¨¡å—>ç½‘ç»œå®šä¹‰æ¨¡å—<a hidden class=anchor aria-hidden=true href=#ç½‘ç»œå®šä¹‰æ¨¡å—>#</a></h1><h2 id=æ•°æ®å®šä¹‰æ¨¡å—>æ•°æ®å®šä¹‰æ¨¡å—<a hidden class=anchor aria-hidden=true href=#æ•°æ®å®šä¹‰æ¨¡å—>#</a></h2><h3 id=åˆ©ç”¨torchvisionè¯»å–æœ¬åœ°æ•°æ®>åˆ©ç”¨TorchVisionè¯»å–æœ¬åœ°æ•°æ®<a hidden class=anchor aria-hidden=true href=#åˆ©ç”¨torchvisionè¯»å–æœ¬åœ°æ•°æ®>#</a></h3><p><code>torchvision.datasets.imagefolder()</code> è¿™ä¸ªå‡½æ•°å®é™…ä¸Šèƒ½ä»£æ›¿æˆ‘ä»¬ä¹‹å‰å†™çš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äºè‡ªå·±å†™çš„æœ‰ä¸€éƒ¨åˆ†ç»Ÿä¸€è§„åˆ™å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„è‡ªå®šä¹‰ç¨‹åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥ç›®å‰æˆ‘ä»¬åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ä½¿ç”¨è¯¥æ–¹æ³•æ¥è¿›è¡Œæ›¿ä»£ã€‚</p><p>ä½†æ˜¯ç”±äºæ˜¯ä¸€ä¸ªé‡è¦çš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¿˜æ˜¯ä»‹ç»ä¸€ä¸‹è¯¥å·¥å…·çš„ä½¿ç”¨æ–¹å¼ï¼š</p><h3 id=torch-è‡ªå®šä¹‰datasetåçš„ä½¿ç”¨>torch è‡ªå®šä¹‰Datasetåçš„ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#torch-è‡ªå®šä¹‰datasetåçš„ä½¿ç”¨>#</a></h3><ol><li>è‡ªå®šä¹‰datasetçš„ç»§æ‰¿ä»¥åŠåç»­è°ƒç”¨éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½å¿˜è®°å°†å…¶è½¬æ¢æˆdataloaerï¼Œç„¶åè¿›è¡Œiterå‘½ä»¤çš„æ‰§è¡Œã€‚</li><li>ä¹Ÿå¯ä»¥ç”¨enumerateå‡½æ•°æ¥è¿›è¡Œè°ƒç”¨ï¼Œå°±æ˜¯è®°å¾—è°ƒç”¨çš„æ ¼å¼æ˜¯ä»€ä¹ˆå°±å¥½</li><li>å¯ä»¥å‚è€ƒbasicunitä¸­çš„å¯¹shuffleçš„è®¤çŸ¥å¯¹è¯¥å‡½æ•°è¿›è¡Œè¿›ä¸€æ­¥çš„ç†è§£ã€‚</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å®šä¹‰datasetçš„éƒ¨åˆ†</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RL_AET_Dataset</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>Dataset</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>RL_AET_Dataset</span><span class=p>,</span><span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>__getitem</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=c1># å£°æ˜å’Œæ„å»ºéƒ¨åˆ† è¦è®°å¾—ä½¿ç”¨dataloader</span>
</span></span><span class=line><span class=cl><span class=n>train_l_dataset</span> <span class=o>=</span> <span class=n>RL_AET_Dataset</span><span class=p>(</span><span class=n>x_l</span><span class=p>,</span> <span class=n>y_l</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>train_l_dataloader</span> <span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>DataLoader</span><span class=p>(</span><span class=n>train_l_dataset</span><span class=p>,</span><span class=n>batch_size</span><span class=o>=</span><span class=n>args</span><span class=p>[</span><span class=s1>&#39;b_s&#39;</span><span class=p>],</span><span class=n>shuffle</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>num_workers</span><span class=o>=</span><span class=n>args</span><span class=p>[</span><span class=s1>&#39;num_workers&#39;</span><span class=p>],</span><span class=n>drop_last</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>pin_memory</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#è°ƒç”¨è¿­ä»£éƒ¨åˆ†</span>
</span></span><span class=line><span class=cl><span class=n>labeled_loader</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=n>train_l_dataloader</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#all_label_info =  [*next(labeled_loader)]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=dataloaderä¸­çš„transformer>Dataloaderä¸­çš„transformerï¼ˆï¼‰ï¼š<a hidden class=anchor aria-hidden=true href=#dataloaderä¸­çš„transformer>#</a></h3><p><strong>ç–‘æƒ‘è§£ç­” ç”¨composeé›†æˆçš„æ‰€æœ‰transformï¼Œéƒ½ä¼šåº”ç”¨ï¼Œæœ‰ä¸ªto_tensorï¼Œåˆ‡to_tensorä¼šè‡ªåŠ¨è½¬æ¢PILä¸­çš„channelå’Œæ•°å€¼èŒƒå›´ã€‚</strong></p><ol><li><p>composeä¸­çš„å˜æ¢ç»„åˆçš„é¡ºåºå…³ç³»</p><ul><li>PILå¤„ç†çš„å›¾åƒå˜æ¢ï¼ˆæ¯”å¦‚æ•°æ®å¢å¼ºä¹‹ç±»çš„æ–¹æ³•ï¼‰</li><li><code>to_tensor()</code></li><li>å¤„ç†tensorçš„æ–¹æ³•ï¼š<code>normalize</code></li></ul></li><li><p>ç¤ºä¾‹ä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data_transforms</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                        <span class=n>transforms</span><span class=o>.</span><span class=n>RandomResizedCrop</span><span class=p>(</span><span class=mi>224</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                        <span class=n>transforms</span><span class=o>.</span><span class=n>RandomHorizontalFlip</span><span class=p>()</span><span class=o>.</span>
</span></span><span class=line><span class=cl>                        <span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=n>transforms</span><span class=o>.</span><span class=n>Normalize</span><span class=p>([</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>c</span><span class=p>],[</span><span class=n>A</span><span class=p>,</span><span class=n>B</span><span class=p>,</span><span class=n>C</span><span class=p>])])</span>
</span></span><span class=line><span class=cl><span class=c1># ç„¶åç›´æ¥åŠ å…¥datasetä¸­çš„å‚æ•°ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„éƒ¨åˆ†</span>
</span></span><span class=line><span class=cl><span class=c1># åœ¨datasetä¸­çš„å†™æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„datasetä¸­è¿›è¡Œå®šä¹‰</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>transformer</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># å…·ä½“çš„æºç ç»†èŠ‚è¡¨ç°å¦‚ä¸‹</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>transforms</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>t</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>img</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=dataloaderä¸­çš„å‚æ•°>Dataloaderä¸­çš„å‚æ•°<a hidden class=anchor aria-hidden=true href=#dataloaderä¸­çš„å‚æ•°>#</a></h3><p>shuffleæœºåˆ¶</p><p>ä¸»è¦è§£å†³é—®é¢˜ï¼š</p><ol><li>æ˜¯å¦æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½è¿›è¡Œéšæœºçš„æ“ä½œï¼Œè¿˜æ˜¯åªæœ‰åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰è¿›è¡Œéšæœº</li><li>ä¸¤ç§ä¸åŒä½¿ç”¨Dataloaderçš„æ–¹å¼æ˜¯å¦ä¼šå¯¹shuffleçš„æ–¹å¼è¿›è¡ŒåŒºåˆ†</li></ol><p>ç»“è®ºï¼š</p><ol><li>æ¯æ¬¡å¯¹dataloaderè¿›è¡Œé‡æ–°è°ƒç”¨ï¼ˆé‡æ–°æ”¾åˆ°enumerateï¼‰ï¼Œæˆ–è€…é‡æ–°å®šä¹‰iterï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œshuffleã€‚</li></ol><p>num_worker</p><p><a href=https://www.cnblogs.com/hesse-summer/p/11343870.html target=_blank rel=noopener>å‚è€ƒèµ„æ–™1</a>
å‚è€ƒèµ„æ–™2ï¼špytorchä¸­æ–‡æ–‡æ¡£ğŸ‘‡</p><p><strong>num_workers</strong> (<em>int</em>, optional) â€“ ç”¨å¤šå°‘ä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ã€‚0è¡¨ç¤ºæ•°æ®å°†åœ¨ä¸»è¿›ç¨‹ä¸­åŠ è½½(é»˜è®¤: 0)
ç”¨num_workerä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå°†æ•°æ®åœ¨ä¸»è¿›ç¨‹å±•ç¤ºè¿˜æ²¡æœ‰è°ƒç”¨åˆ°è¯¥æ•°æ®ä¹‹å‰å°±å°†åç»­çš„æ•°æ®å­˜å…¥RAMï¼Œæ‰€ä»¥åœ¨æ•°æ®è¯»å–ä¸Šä¼šæ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å ç”¨çš„RAMå’ŒCPUèµ„æºä¼šæ¯”è¾ƒå¤§ã€‚</p><p>samples:</p><p><a href="https://pytorch.org/docs/stable/data.html?highlight=dataloader#torch.utils.data.DataLoader" target=_blank rel=noopener>torch.utils.data - PyTorch 1.9.0 documentation</a></p><p><a href=https://www.cnblogs.com/marsggbo/p/11308889.html target=_blank rel=noopener>ä¸€æ–‡å¼„æ‡‚Pytorchçš„DataLoader, DataSet, Samplerä¹‹é—´çš„å…³ç³»</a></p><p>å®˜æ–¹çš„è§£é‡Šæ˜¯ï¼š</p><p>samplerÂ (SamplerÂ orÂ Iterable,Â optional)Â â€“Â definesÂ theÂ strategyÂ toÂ drawÂ samplesÂ fromÂ theÂ dataset.Â CanÂ beÂ anyÂ IterableÂ withÂ <strong>len</strong>Â implemented.Â IfÂ specified,Â shuffleÂ mustÂ notÂ beÂ specified.</p><p>å®šä¹‰ä»æ•°æ®é›†ï¼ˆè¿˜æ˜¯æœ€å¼€å§‹çš„å“ªä¸ªæ•°æ®é›†ï¼Œä¸èƒ½æ˜¯é¢å¤–çš„æ•°æ®é›†ï¼‰ä¸­æå–æ ·æœ¬çš„ç­–ç•¥ï¼šæ˜¯å¦èƒ½é€šè¿‡è¯¥Methodå»å®ç°Hard-Taskæˆ–è€…åƒMeta-Taskä¸€æ ·çš„é‡‡æ ·è¿‡ç¨‹å‘¢ï¼Ÿä»Meta-Transfer-Learningä¸­çœ‹æ¥æ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹å®ƒçš„å†™æ³•ã€‚</p><h4 id=collate_fn>collate_fn()<a hidden class=anchor aria-hidden=true href=#collate_fn>#</a></h4><p>collate_fnçš„ä½œç”¨å°±æ˜¯å°†ä¸€ä¸ªbatchçš„æ•°æ®è¿›è¡Œåˆå¹¶æ“ä½œã€‚é»˜è®¤çš„collate_fnæ˜¯å°†imgå’Œlabelåˆ†åˆ«åˆå¹¶æˆimgså’Œlabelsï¼Œæ‰€ä»¥å¦‚æœä½ çš„__getitem__æ–¹æ³•åªæ˜¯è¿”å›Â img,Â label,é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨é»˜è®¤çš„collate_fnæ–¹æ³•,
ä½†æ˜¯å¦‚æœä½ æ¯æ¬¡è¯»å–çš„æ•°æ®æœ‰img,Â box,Â labelç­‰ç­‰ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦è‡ªå®šä¹‰collate_fnæ¥å°†å¯¹åº”çš„æ•°æ®åˆå¹¶æˆä¸€ä¸ªbatchæ•°æ®ï¼Œè¿™æ ·æ–¹ä¾¿åç»­çš„è®­ç»ƒæ­¥éª¤ã€‚</p><ul><li>ç¼–å†™collate_fnå¯ä»¥å‚è€ƒqidongçš„æ–‡ç« ä¸»è¦æ˜¯æ¥å—æ•°æ®å’Œæ ‡ç­¾åˆ—è¡¨ï¼Œå°†å…¶æ•´åˆæˆä¸€ä¸ªçŸ©é˜µçš„å½¢å¼;</li><li>å¦‚æœå¯¹ä¼ å‚æœ‰éœ€æ±‚,å¯ä»¥å‚è€ƒ<code>lambda</code>çš„å½¢å¼æˆ–è€…æ˜¯ç±»å®šä¹‰çš„å½¢å¼å»ä¼ å…¥</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>dataload</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span><span class=n>dataset</span><span class=p>,</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>collate_fn</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=o>**</span><span class=n>params</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>collater</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=o>**</span><span class=n>params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>params</span> <span class=o>=</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>__call</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>datas</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># make it a batch in this function, then we will instance this class</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_helpful_fn</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span></code></pre></td></tr></table></div></div><p>using collate_fn, we can augment the dataset more flexible.</p><h2 id=ç¼–å†™æ¨¡å‹>ç¼–å†™æ¨¡å‹<a hidden class=anchor aria-hidden=true href=#ç¼–å†™æ¨¡å‹>#</a></h2><h3 id=æ¨¡å‹åŸºæœ¬å•å…ƒ>æ¨¡å‹åŸºæœ¬å•å…ƒ<a hidden class=anchor aria-hidden=true href=#æ¨¡å‹åŸºæœ¬å•å…ƒ>#</a></h3><p>nn.conv2Dï¼š</p><ul><li>kernel_size[1]åº”è¯¥æŒ‡çš„æ˜¯å·ç§¯æ ¸çš„å®½ï¼ˆä¸ä¸€å®šéƒ½æ˜¯æ­£æ–¹å½¢çš„ï¼‰</li></ul><h3 id=æ¨¡å‹å‚æ•°å…±äº«>æ¨¡å‹å‚æ•°å…±äº«ï¼š<a hidden class=anchor aria-hidden=true href=#æ¨¡å‹å‚æ•°å…±äº«>#</a></h3><p><a href=https://www.cnblogs.com/wwzone/articles/12917333.html target=_blank rel=noopener>pytorchï¼šå¯¹æ¯”cloneã€detachä»¥åŠcopy_ç­‰å¼ é‡å¤åˆ¶æ“ä½œ</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å‡è®¾æœ‰modelaå’Œmodelbï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œä¸‹é™çš„æ—¶å€™æ‰§è¡Œå‚æ•°ç»Ÿä¸€ï¼Œ</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>a_para</span><span class=p>,</span><span class=n>b_para</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>modela</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span><span class=n>modelb</span><span class=o>.</span><span class=n>parameters</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=n>b_para</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>copy_</span><span class=p>(</span><span class=n>a_para</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ>ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ<a hidden class=anchor aria-hidden=true href=#ç½‘ç»œå®šä¹‰çš„æ–¹å¼å¯¹æ¯”åˆ†æ>#</a></h3><p>@Aiken 2021 ä¸»è¦å¯¹æ¯”çš„æ˜¯ModuleListå’ŒSequtial</p><p>**ç»“è®ºï¼š**é€šå¸¸ä½¿ç”¨çš„è¯ï¼Œè¿™é‡Œæˆ‘ä¸ªäººæ¨èä½¿ç”¨çš„æ˜¯<code>sequtial</code>ç»“åˆ<code>collection</code>ä¸­çš„<code>orderdict</code>æ¥æ„å»ºçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é›†æˆäº†å†…éƒ¨çš„<code>forward</code>ï¼ŒåŒæ—¶é€šè¿‡``orderdict`ä¹Ÿèƒ½ç»™printå¸¦æ¥æ›´å¥½çš„å¯è§†åŒ–æ•ˆæœã€‚</p><p>ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯æˆ‘ä»¬ä¼šç”¨åˆ°<code>ModuleList</code></p><p><a href=https://zhuanlan.zhihu.com/p/75206669 target=_blank rel=noopener>è¯¦è§£PyTorchä¸­çš„ModuleListå’ŒSequential</a></p><p>ä¸»è¦åŒºåˆ«ï¼š</p><ol><li><p>nn.Sequentialå†…éƒ¨å®ç°äº†forwardå‡½æ•°ï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†™forwardå‡½æ•°ã€‚è€Œnn.ModuleListåˆ™æ²¡æœ‰å®ç°å†…éƒ¨forwardå‡½æ•°ã€‚</p></li><li><p>nn.Sequentialå¯ä»¥ä½¿ç”¨OrderedDictå¯¹æ¯å±‚è¿›è¡Œå‘½åï¼Œä¸Šé¢å·²ç»é˜è¿°è¿‡äº†ï¼›</p></li><li><p>nn.Sequentialé‡Œé¢çš„æ¨¡å—æŒ‰ç…§é¡ºåºè¿›è¡Œæ’åˆ—çš„ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿å‰ä¸€ä¸ªæ¨¡å—çš„è¾“å‡ºå¤§å°å’Œä¸‹ä¸€ä¸ªæ¨¡å—çš„è¾“å…¥å¤§å°æ˜¯ä¸€è‡´çš„ã€‚è€Œnn.ModuleList å¹¶æ²¡æœ‰å®šä¹‰ä¸€ä¸ªç½‘ç»œï¼Œå®ƒåªæ˜¯å°†ä¸åŒçš„æ¨¡å—å‚¨å­˜åœ¨ä¸€èµ·ï¼Œè¿™äº›æ¨¡å—ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆå…ˆåé¡ºåºå¯è¨€ã€‚<strong>ç½‘ç»œçš„æ‰§è¡Œé¡ºåºæŒ‰ç…§æˆ‘ä»¬åœ¨forwardä¸­æ€ä¹ˆç¼–å†™æ¥å†³å®šçš„</strong></p></li><li><p>æœ‰çš„æ—¶å€™ç½‘ç»œä¸­æœ‰å¾ˆå¤šç›¸ä¼¼æˆ–è€…é‡å¤çš„å±‚ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè€ƒè™‘ç”¨ for å¾ªç¯æ¥åˆ›å»ºå®ƒä»¬ï¼Œè€Œä¸æ˜¯ä¸€è¡Œä¸€è¡Œåœ°å†™ï¼Œè¿™ç§æ—¶å€™å°±ä½¿ç”¨ModuleListï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>net4</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>net4</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>layers</span> <span class=o>=</span> <span class=p>[</span><span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>linears</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>ModuleList</span><span class=p>(</span><span class=n>layers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>layer</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>linears</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=n>layer</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>net</span> <span class=o>=</span> <span class=n>net4</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>net</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># net4(</span>
</span></span><span class=line><span class=cl><span class=c1>#   (linears): ModuleList(</span>
</span></span><span class=line><span class=cl><span class=c1>#     (0): Linear(in_features=10, out_features=10, bias=True)</span>
</span></span><span class=line><span class=cl><span class=c1>#     (1): Linear(in_features=10, out_features=10, bias=True)</span>
</span></span><span class=line><span class=cl><span class=c1>#     (2): Linear(in_features=10, out_features=10, bias=True)</span>
</span></span><span class=line><span class=cl><span class=c1>#   )</span>
</span></span><span class=line><span class=cl><span class=c1># )</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><p>åŸºæœ¬ä½¿ç”¨ï¼š</p><ol><li><p>nn.sequential</p><p>å¯ä»¥é€šè¿‡listå’Œ*ä»¥åŠadd moudleæ¥è¿›è¡Œè¿­ä»£çš„å®šä¹‰ï¼ŒåŒæ—¶è¿™ç§å®šä¹‰æ–¹å¼ï¼Œä¼šæ–¹ä¾¿æˆ‘ä»¬çš„é‡å¤æ³¨å†Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>OrderedDict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>net_seq</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>net_seq</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>seq</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span><span class=n>OrderedDict</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s1>&#39;conv1&#39;</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>5</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                         <span class=p>(</span><span class=s1>&#39;relu1&#39;</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=s1>&#39;conv2&#39;</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span><span class=mi>64</span><span class=p>,</span><span class=mi>5</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                       <span class=p>(</span><span class=s1>&#39;relu2&#39;</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                       <span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>seq</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>net_seq</span> <span class=o>=</span> <span class=n>net_seq</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>net_seq</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#net_seq(</span>
</span></span><span class=line><span class=cl><span class=c1>#  (seq): Sequential(</span>
</span></span><span class=line><span class=cl><span class=c1>#    (conv1): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))</span>
</span></span><span class=line><span class=cl><span class=c1>#    (relu1): ReLU()</span>
</span></span><span class=line><span class=cl><span class=c1>#    (conv2): Conv2d(20, 64, kernel_size=(5, 5), stride=(1, 1))</span>
</span></span><span class=line><span class=cl><span class=c1>#    (relu2): ReLU()</span>
</span></span><span class=line><span class=cl><span class=c1>#  )</span>
</span></span><span class=line><span class=cl><span class=c1>#)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>nn.ModuleList:ä¸pythonè‡ªå¸¦çš„Listä¸åŒçš„åœ°æ–¹åœ¨äºä»–ä¼šè‡ªåŠ¨å°†ç½‘ç»œæ³¨å†Œåˆ°Parameterä¸­ï¼Œæˆä¸ºç½‘ç»œï¼Œä½†æ˜¯éœ€è¦è‡ªå·±å»ç¼–å†™forwardè¿‡ç¨‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>net_modlist</span><span class=p>(</span><span class=n>nn</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>net_modlist</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>modlist</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>ModuleList</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                       <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>5</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                       <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>5</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                        <span class=n>nn</span><span class=o>.</span><span class=n>ReLU</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>modlist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=n>m</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>net_modlist</span> <span class=o>=</span> <span class=n>net_modlist</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>net_modlist</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#net_modlist(</span>
</span></span><span class=line><span class=cl><span class=c1>#  (modlist): ModuleList(</span>
</span></span><span class=line><span class=cl><span class=c1>#    (0): Conv2d(1, 20, kernel_size=(5, 5), stride=(1, 1))</span>
</span></span><span class=line><span class=cl><span class=c1>#    (1): ReLU()</span>
</span></span><span class=line><span class=cl><span class=c1>#    (2): Conv2d(20, 64, kernel_size=(5, 5), stride=(1, 1))</span>
</span></span><span class=line><span class=cl><span class=c1>#    (3): ReLU()</span>
</span></span><span class=line><span class=cl><span class=c1>#  )</span>
</span></span><span class=line><span class=cl><span class=c1>#)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>param</span> <span class=ow>in</span> <span class=n>net_modlist</span><span class=o>.</span><span class=n>parameters</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>param</span><span class=o>.</span><span class=n>data</span><span class=p>),</span> <span class=n>param</span><span class=o>.</span><span class=n>size</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1>#&lt;class &#39;torch.Tensor&#39;&gt; torch.Size([20, 1, 5, 5])</span>
</span></span><span class=line><span class=cl><span class=c1>#&lt;class &#39;torch.Tensor&#39;&gt; torch.Size([20])</span>
</span></span><span class=line><span class=cl><span class=c1>#&lt;class &#39;torch.Tensor&#39;&gt; torch.Size([64, 20, 5, 5])</span>
</span></span><span class=line><span class=cl><span class=c1>#&lt;class &#39;torch.Tensor&#39;&gt; torch.Size([64])</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=detach--detach_>Detach & detach_<a hidden class=anchor aria-hidden=true href=#detach--detach_>#</a></h3><p>è¿™ä¸ªæ¨¡å—åœ¨åç»­è¿›è¡Œpretrainæˆ–è€…transferçš„æ—¶å€™åº”è¯¥ä¼šç»å¸¸è¢«ç”¨åˆ°ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•è¿˜æ˜¯éœ€è¦ç†Ÿç»ƒæŒæ¡çš„</p><p><a href=https://www.cnblogs.com/wanghui-garcia/p/10677071.html target=_blank rel=noopener>è¯¦ç»†çš„åˆ†æä»‹ç»</a></p><p><code>detach</code>æ˜¯äº§ç”Ÿä¸€ç»„ä¸éœ€è¦ä¸‹é™çš„â€œ<code>Copy</code>â€ï¼šå¦‚æœè¦ä¿®æ”¹åŸå€¼çš„è¯å°±è¦è¿›è¡Œèµ‹å€¼æ“ä½œã€‚</p><p><code>detach_</code>åˆ™æ˜¯ä¿®æ”¹æœ¬èº«å‚æ•°çš„å±æ€§ï¼ˆ<code>require_grad</code>etc.ï¼‰æ‰§è¡Œå‡½æ•°å°±èƒ½å°†å‚æ•°ä¿®æ”¹ä¸ºä¸éœ€è¦ä¸‹é™çš„æƒ…å†µï¼Œä¸éœ€è¦æ‰§è¡Œèµ‹å€¼å¤„ç†ã€‚</p><h3 id=æ¨¡å‹è°ƒç”¨çš„tips>æ¨¡å‹è°ƒç”¨çš„Tips<a hidden class=anchor aria-hidden=true href=#æ¨¡å‹è°ƒç”¨çš„tips>#</a></h3><p><strong>ä½¿ç”¨listè¿›è¡Œå¤šæ¨¡å‹çš„æ··åˆè°ƒç”¨</strong></p><p>ç”±äºpythoné»˜è®¤çš„æ˜¯å¼•ç”¨èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯æµ…æ‹·è´çš„æ–¹å¼ï¼Ÿ
é€šè¿‡listæ¥è¿›è¡Œæ¨¡å‹çš„æ‰¹é‡æ„å»ºï¼Œé€šè¿‡listæ¥å°†æ¨¡å‹æ•´åˆèµ·æ¥ï¼Œæ˜¯<strong>ä¸ä¼š</strong>ä½¿ç”¨<strong>é¢å¤–çš„å­˜å‚¨ç©ºé—´</strong>çš„ï¼Œå®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªåœ°å€ã€‚åŸºäºè¿™æ ·çš„å‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºlistæ¥ç®€åŒ–ä»£ç ï¼Œé€šè¿‡LOOPæ¥æ‰§è¡Œï¼Œç›¸å…³çš„è°ƒç”¨æ“ä½œï¼Œæ¯”å¦‚ç”Ÿæˆå™¨æˆ–è€…é¢„æµ‹ä¹‹ç±»çš„ï¼Œæ¥<strong>ç®€åŒ–</strong>ä»£ç ç»“æ„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>model1</span> <span class=o>=</span> <span class=n>AET_model</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model2</span> <span class=o>=</span> <span class=n>AET_model</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>model1</span><span class=p>,</span><span class=n>model2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>id</span><span class=p>(</span><span class=n>model1</span><span class=p>)</span><span class=o>==</span><span class=nb>id</span><span class=p>(</span><span class=n>model2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;the address of those model is same, so donot need extra space&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># å…·ä½“å¯ä»¥ç®€åŒ–ä»€ä¹ˆç±»å‹çš„æ“ä½œï¼š</span>
</span></span><span class=line><span class=cl><span class=n>optimizer_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>models_t</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>model_list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>optimizer_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>optim</span><span class=o>.</span><span class=n>SGD</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=n>models_t</span><span class=o>.</span><span class=n>parameters</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                            <span class=n>lr</span><span class=p>,</span><span class=n>mom</span><span class=err>ï¼Œ</span><span class=n>wd</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>optimizer1</span> <span class=o>=</span> <span class=n>_</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>optimizer2</span> <span class=o>=</span> <span class=n>_</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># like this</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=warm-up-factor>Warm-up factor<a hidden class=anchor aria-hidden=true href=#warm-up-factor>#</a></h3><p>å¯¹äºè¿™ä¸€éƒ¨åˆ†çš„æ¦‚å¿µæˆ‘è¿˜æ˜¯æœ‰äº›ä¸äº†è§£ï¼Œæ˜¯å¦å’Œå†·å¯åŠ¨å’Œçƒ­å¯åŠ¨çš„æ¦‚å¿µæ˜¯ç›¸å…³çš„ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œé¡ºä¾¿å°±å­¦ä¹ ä¸€ä¸‹å†·å¯åŠ¨å’Œçƒ­å¯åŠ¨çš„æ¦‚å¿µã€‚</p><p>å…·ä½“è§£æï¼š</p><ol><li><a href=https://stackoverflow.com/questions/55933867/what-does-learning-rate-warm-up-mean target=_blank rel=noopener>neural network - What does &ldquo;learning rate warm-up&rdquo; mean? - Stack Overflow</a></li><li><a href=https://blog.csdn.net/qq_36387683/article/details/97265084 target=_blank rel=noopener>å…³äºwarm_upå­¦ä¹ ç‡_äº‘ä¸­å¯»é›¾çš„åšå®¢-CSDNåšå®¢</a></li></ol><p><a href=https://blog.csdn.net/xys430381_1/article/details/107468446 target=_blank rel=noopener>pytorchå­¦ä¹ ç‡è°ƒæ•´æ–¹æ³•ï¼ˆwarm upï¼‰ ï¼Œlabel smoothã€apexæ··åˆç²¾åº¦è®­ç»ƒã€æ¢¯åº¦ç´¯åŠ _xys430381_1çš„ä¸“æ -CSDNåšå®¢</a></p><p><a href=https://www.zhihu.com/question/338066667 target=_blank rel=noopener>ç¥ç»ç½‘ç»œä¸­ warmup ç­–ç•¥ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼›æœ‰ä»€ä¹ˆç†è®ºè§£é‡Šä¹ˆï¼Ÿ</a></p><h3 id=weight-decayl2>Weight decayï¼ˆL2ï¼‰<a hidden class=anchor aria-hidden=true href=#weight-decayl2>#</a></h3><p>å®é™…ä¸Šå°±æ˜¯å¯¹æƒé‡è¿›è¡ŒL2æ­£åˆ™åŒ–ï¼Œè®©æƒé‡è¡°å‡åˆ°æ›´å°çš„å€¼ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘æ¨¡å‹çš„è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œæ‰€ä»¥æƒé‡è¡°å‡å®é™…ä¸Šä¹Ÿå«L2æ­£åˆ™åŒ–ã€‚</p><p>å…·ä½“çš„æ•°å­¦æ¨å¯¼åç»­å°†é›†æˆåˆ°<strong>GoodNoteç¬”è®°</strong>ä¸Šï¼Œå°†æ­£åˆ™åŒ–å•ç‹¬ä½œä¸ºä¸€ä¸ªæ¨¡å—å»æ•´ç†ã€‚</p><p><strong>æƒé‡è¡°å‡ï¼ˆL2æ­£åˆ™åŒ–ï¼‰çš„ä½œç”¨</strong></p><p><strong>ä½œç”¨ï¼š</strong> æƒé‡è¡°å‡ï¼ˆL2æ­£åˆ™åŒ–ï¼‰å¯ä»¥é¿å…æ¨¡å‹è¿‡æ‹Ÿåˆé—®é¢˜ã€‚</p><p><strong>æ€è€ƒï¼š</strong> L2æ­£åˆ™åŒ–é¡¹æœ‰è®©wå˜å°çš„æ•ˆæœï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆwå˜å°å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆå‘¢ï¼Ÿ</p><p><strong>åŸç†ï¼š</strong> ï¼ˆ1ï¼‰ä»æ¨¡å‹çš„å¤æ‚åº¦ä¸Šè§£é‡Šï¼šæ›´å°çš„æƒå€¼wï¼Œä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¡¨ç¤ºç½‘ç»œçš„å¤æ‚åº¦æ›´ä½ï¼Œå¯¹æ•°æ®çš„æ‹Ÿåˆæ›´å¥½ï¼ˆè¿™ä¸ªæ³•åˆ™ä¹Ÿå«åšå¥¥å¡å§†å‰ƒåˆ€ï¼‰ï¼Œè€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹ï¼ŒL2æ­£åˆ™åŒ–çš„æ•ˆæœå¾€å¾€å¥½äºæœªç»æ­£åˆ™åŒ–çš„æ•ˆæœã€‚ï¼ˆ2ï¼‰ä»æ•°å­¦æ–¹é¢çš„è§£é‡Šï¼šè¿‡æ‹Ÿåˆçš„æ—¶å€™ï¼Œæ‹Ÿåˆå‡½æ•°çš„ç³»æ•°å¾€å¾€éå¸¸å¤§ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿‡æ‹Ÿåˆï¼Œå°±æ˜¯æ‹Ÿåˆå‡½æ•°éœ€è¦é¡¾å¿Œæ¯ä¸€ä¸ªç‚¹ï¼Œæœ€ç»ˆå½¢æˆçš„æ‹Ÿåˆå‡½æ•°æ³¢åŠ¨å¾ˆå¤§ã€‚åœ¨æŸäº›å¾ˆå°çš„åŒºé—´é‡Œï¼Œå‡½æ•°å€¼çš„å˜åŒ–å¾ˆå‰§çƒˆã€‚è¿™å°±æ„å‘³ç€å‡½æ•°åœ¨æŸäº›å°åŒºé—´é‡Œçš„å¯¼æ•°å€¼ï¼ˆç»å¯¹å€¼ï¼‰éå¸¸å¤§ï¼Œç”±äºè‡ªå˜é‡å€¼å¯å¤§å¯å°ï¼Œæ‰€ä»¥åªæœ‰ç³»æ•°è¶³å¤Ÿå¤§ï¼Œæ‰èƒ½ä¿è¯å¯¼æ•°å€¼å¾ˆå¤§ã€‚è€Œæ­£åˆ™åŒ–æ˜¯é€šè¿‡çº¦æŸå‚æ•°çš„èŒƒæ•°ä½¿å…¶ä¸è¦å¤ªå¤§ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘è¿‡æ‹Ÿåˆæƒ…å†µã€‚</p><p><div class=post-img-view><a data-fancybox=gallery href=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png><img alt=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png loading=lazy src=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png class=responsive-image src=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png style="display:block;margin:0 auto" alt=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175236273.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p>image-20201205175236273</p><p>å†…å®¹æ¥è‡ªï¼š <a href=https://blog.csdn.net/u012162613/article/details/44261657 target=_blank rel=noopener>æ­£åˆ™åŒ–æ–¹æ³•ï¼šL1å’ŒL2 regularizationã€æ•°æ®é›†æ‰©å¢ã€dropout</a></p><h3 id=learning-rate-decay>Learning Rate Decay<a hidden class=anchor aria-hidden=true href=#learning-rate-decay>#</a></h3><p>å½“æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªåˆé€‚çš„lrï¼Œä½†æ˜¯æŸå¤±è®­ç»ƒåˆ°ä¸€å®šç¨‹åº¦ä»¥åå°±ä¸å†ä¸‹é™äº†ï¼Œå°±åœ¨ä¸€ä¸ªåŒºé—´ä¸­æ¥å›åŠ¨è¡ï¼Œå¯èƒ½æ˜¯å‡ºç°äº†ä¸€ä¸‹çš„é—®é¢˜ï¼š</p><p><div class=post-img-view><a data-fancybox=gallery href=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png><img alt=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png loading=lazy src=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png class=responsive-image src=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png style="display:block;margin:0 auto" alt=https://raw.githubusercontent.com/AikenH/md-image/master/img/image-20201205175605729.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p>image-20201205175605729</p><p>å¯¹è¿™ç§é—®é¢˜çš„è§£å†³å°±æ˜¯é€šè¿‡å­¦ä¹ ç‡è¡°å‡æ¥å®ç°çš„ï¼šå°†å­¦ä¹ ç‡éšç€è®­ç»ƒçš„è¿›è¡Œæ¥è¿›è¡Œè¡°å‡ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ¯”è¾ƒç›´è§‚äº†ã€‚å…·ä½“çš„æ–¹æ³•æè¿°å¯ä»¥åœ¨ <code>../project_note/è®­ç»ƒå‚æ•°è°ƒæ•´ç­–ç•¥.md</code>ä¸­æ‰¾åˆ°ã€‚</p><p>ä¹Ÿå¯ä»¥å‚è€ƒå¦‚ä¸‹è¿æ¥ï¼š<a href=https://blog.csdn.net/weixin_42662358/article/details/93732852 target=_blank rel=noopener>è¯¦ç»†ç†è§£pytorchçš„å…­ç§å­¦ä¹ ç‡pytorch</a></p><h2 id=æŸå¤±å‡½æ•°>æŸå¤±å‡½æ•°<a hidden class=anchor aria-hidden=true href=#æŸå¤±å‡½æ•°>#</a></h2><p>nnä¸­è‡ªå¸¦çš„Loss Functionæ¯”å¦‚è¯´MSEä¹‹ç±»çš„ï¼Œè®¡ç®—å‡ºæ¥çš„å€¼æœ¬èº«å°±å·²ç»å¯¹batchå–äº†å¹³å‡å€¼ï¼ŒåŒæ—¶æˆ‘ä»¬è¿›è¡Œäº¤å‰ç†µçš„è®¡ç®—çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ç°å¯¹ä»–è¿›è¡Œsoftmaxï¼Œå› ä¸ºå†CEä¸­å·²ç»é›†æˆäº†softmaxçš„æ“ä½œã€‚</p><h3 id=crossentropyäº¤å‰ç†µ>CrossEntropyäº¤å‰ç†µ<a hidden class=anchor aria-hidden=true href=#crossentropyäº¤å‰ç†µ>#</a></h3><p>è¿™é‡Œä¼šä»‹ç»ä¸€ä¸‹Pytorchä¸­çš„CEæŸå¤±çš„å…·ä½“å®ç°çš„æ–¹æ³•ï¼Œè¿™é‡Œç»™å‡ºä¸‰ç§æ–¹å¼çš„å¯¹æ¯”ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=c1># initial data and calculate method</span>
</span></span><span class=line><span class=cl><span class=n>input_x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn</span><span class=p>((</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>label</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>cri</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>CrossEntropyLoss</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>nll_f</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>NLLLoss</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># output softmax and logsoftmax and pred</span>
</span></span><span class=line><span class=cl><span class=n>softamx_x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>softmax</span><span class=p>(</span><span class=n>input_x</span><span class=p>,</span><span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logsoftmax_x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>softamx_x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;softamx_x </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>softamx_x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;pre_res </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>softamx_x</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;log_softamx_x </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>logsoftmax_x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># calculate official ce and NLL</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;torch ce </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>cri</span><span class=p>(</span><span class=n>input_x</span><span class=p>,</span><span class=n>label</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;nll_cal </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>nll_f</span><span class=p>(</span><span class=n>logsoftmax_x</span><span class=p>,</span><span class=n>label</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># calculate the manual ce loss we cal</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=n>logsoftmax_x</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>label</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>label</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;manual cal </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=nb>sum</span><span class=p>(</span><span class=n>res</span><span class=p>)</span><span class=o>/</span><span class=nb>len</span><span class=p>(</span><span class=n>label</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥å‘ç°ä¸‰ç§æ–¹å¼è®¡ç®—å‡ºæ¥çš„æŸå¤±æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±è¯´æ˜äº†æˆ‘ä»¬åœ¨è®¡ç®—çš„æ—¶å€™è¦è®°ä½ï¼Œceä¸­æ˜¯è‡ªå·±é›†æˆäº†softmaxçš„æ“ä½œï¼ŒåŒæ—¶åœ¨Nllä¸­æ˜¯å­˜åœ¨äº†å–negativeçš„æ“ä½œçš„ã€‚æŒ‰ç…§è¿™ä¸ªæ“ä½œæ‰‹å†Œå»å®ç°è‡ªå·±ç›¸åº”çš„æŸå¤±å‡½æ•°è®¾è®¡</p><h2 id=ä¼˜åŒ–å™¨è®¾è®¡>ä¼˜åŒ–å™¨è®¾è®¡<a hidden class=anchor aria-hidden=true href=#ä¼˜åŒ–å™¨è®¾è®¡>#</a></h2><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ·»åŠ ä¸€äº›å¸¸è§çš„ä¼˜åŒ–å™¨å‚æ•°çš„è®¾ç½®åŒ…æ‹¬SGDå’ŒAdamçš„å¯¹åº”è®¾ç½®ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹è®¾ç½®Adam
å®é™…ä¸ŠAdamçš„è®¾ç½®å¯¹äºå­¦ä¹ ç‡æ¥è¯´æ²¡æœ‰é‚£ä¹ˆæ•æ„Ÿï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦äº†è§£å‚æ•°çš„æ„æ€æ‰çŸ¥é“æ€ä¹ˆå»è®¾ç½®è¯¥ä¼˜åŒ–å™¨</p><h2 id=æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•>æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•<a hidden class=anchor aria-hidden=true href=#æ¨¡å‹å‚æ•°åˆå§‹åŒ–å’Œæ¶æ„æŸ¥çœ‹æ–¹æ³•>#</a></h2><p>å®é™…ä¸Šå¯¹å‚æ•°åˆå§‹åŒ–ä¹Ÿå°±æ˜¯éœ€è¦å¯¹æ•´ä½“çš„æ¶æ„è¿›è¡Œéå†ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªä¼šå½’ä¸ºä¸€ä¸ªå­è¯¾é¢˜</p><p>å‚æ•°çš„åˆå§‹åŒ–æ–¹æ³•åªè¦ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼ï¼Œæ— è®ºæˆ‘ä»¬é‡‡å–é‚£ç§å®šä¹‰çš„æ–¹å¼ï¼Œï¼Œéƒ½èƒ½éå†åˆ°å…¶ä¸­æ‰€åŒ…å«çš„æ‰€æœ‰ç½‘ç»œå±‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å¦‚æœç›´æ¥åœ¨ç½‘ç»œå®šä¹‰çš„æ—¶å€™ç›´æ¥è¿›è¡Œåˆå§‹åŒ–</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>modules</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>kaiming_normal_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=p>,</span><span class=n>mode</span><span class=o>=</span><span class=s1>&#39;fan_out&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>nn</span><span class=o>.</span><span class=n>BatchNorm2d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>bias</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœæ˜¯åœ¨æ¨¡å‹å®šä¹‰çš„å¤–éƒ¨çš„è¯</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>layer</span> <span class=ow>in</span> <span class=n>model</span><span class=o>.</span><span class=n>modules</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>layer</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>kaiming_normal_</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>weight</span><span class=p>,</span><span class=n>mode</span><span class=o>=</span><span class=s1>&#39;fan_out&#39;</span><span class=p>,</span> <span class=n>nonlinearity</span><span class=o>=</span><span class=s1>&#39;relu&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=n>layer</span><span class=o>.</span><span class=n>bias</span> <span class=n>isnotNone</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>bias</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=mf>0.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>layer</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>BatchNorm2d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>weight</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>bias</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=mf>0.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>layer</span><span class=p>,</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>xavier_normal_</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>weight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=n>layer</span><span class=o>.</span><span class=n>bias</span> <span class=n>isnotNone</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>constant_</span><span class=p>(</span><span class=n>layer</span><span class=o>.</span><span class=n>bias</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=mf>0.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>layer</span><span class=o>.</span><span class=n>weight</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>Parameter</span><span class=p>(</span><span class=n>tensor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•æ¯”å¦‚parametersï¼Œchildren</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=childrenmodulesparameters>childrenã€modulesã€parametersï¼š<a hidden class=anchor aria-hidden=true href=#childrenmodulesparameters>#</a></h3><p><code>model.modules</code>ä¼šéå†modelä¸­æ‰€æœ‰çš„å­å±‚ï¼Œè€Œ<code>children</code>åªä¼šéå†å½“å‰å±‚ï¼Œä¹Ÿå°±æ˜¯æœ€å¤–å±‚çš„æƒ…å†µï¼Œæ‰€ä»¥å¦‚æœè¦è¿›è¡Œå‚æ•°çš„åˆå§‹åŒ–çš„è¯ï¼Œæœ€å¥½æ˜¯ç”¨ç±»å†…æˆ–è€…ç±»å¤–çš„ä¸¤ç§æ–¹æ³•æ¥å®ç°åˆå§‹åŒ–</p><p><code>parameter</code>è¿”å›çš„æ˜¯æ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼Œæ‰€ä»¥åˆå§‹åŒ–æœ€å¥½ä½¿ç”¨çš„æ˜¯``modules`ï¼Œè€Œparameterä¸€èˆ¬ç”¨æ¥åˆå§‹åŒ–å‚æ•°</p><p><strong>ç”¨numelä¸parametersè®¡ç®—å‚æ•°çš„ä¸ªæ•°</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#å¯ä»¥ç®€æ´çš„å†™æˆä¸‹é¢çš„å½¢å¼</span>
</span></span><span class=line><span class=cl><span class=c1>#numel()å‡½æ•°æœ¬èº«çš„ä½œç”¨æ˜¯è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>count_parameters</span><span class=p>(</span><span class=n>model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>sum</span><span class=p>(</span><span class=n>P</span><span class=o>.</span><span class=n>numel</span><span class=p>()</span> <span class=k>for</span> <span class=n>P</span> <span class=ow>in</span> <span class=n>model</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span> <span class=k>if</span> <span class=n>P</span><span class=o>.</span><span class=n>requires_grad</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#å¸®åŠ©ç†è§£çš„ç»“æ„å½¢å¼å¯ä»¥è¡¨è¾¾å¦‚ä¸‹ï¼š</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>count_parameters</span><span class=p>(</span><span class=n>model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>model</span><span class=o>.</span><span class=n>parameters</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>requires_grad</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ans</span> <span class=o>+=</span> <span class=n>p</span><span class=o>.</span><span class=n>numel</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åˆå§‹åŒ–åŸåˆ™ç»§ç»­è°ƒç ”>åˆå§‹åŒ–åŸåˆ™ï¼šï¼ˆç»§ç»­è°ƒç ”ï¼‰<a hidden class=anchor aria-hidden=true href=#åˆå§‹åŒ–åŸåˆ™ç»§ç»­è°ƒç ”>#</a></h3><p><a href=https://blog.csdn.net/ys1305/article/details/94332007 target=_blank rel=noopener>pytorchä¸­çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•æ€»ç»“_ys1305çš„åšå®¢-CSDNåšå®¢_pytorch å‚æ•°åˆå§‹åŒ–</a></p><p><strong>Batch-Normalization</strong>ï¼š<a href=https://www.cnblogs.com/shine-lee/p/11989612.html target=_blank rel=noopener>Batch Normalizationè¯¦è§£ - shine-lee - åšå®¢å›­ (cnblogs.com)</a></p><ul><li>convï¼š<code>kaming_normal_</code></li><li>fcï¼š<code>constan_,xvaier</code></li><li>bnï¼š<code>normal_\constant|</code></li></ul><h3 id=å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•>å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•<a hidden class=anchor aria-hidden=true href=#å…¸å‹çš„å‚æ•°åˆå§‹åŒ–æ–¹æ³•>#</a></h3><p>EnAETä¸­å¯ä»¥çœ‹åˆ°å‚è€ƒçš„æºç å¦‚ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBNä¸­åªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œå‚æ•°çš„åˆå§‹åŒ–ï¼Œæˆ–è€…ç›´æ¥ç½®0ã€1å³å¯.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>modules</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>nn</span><span class=o>.</span><span class=n>Conv2d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>kernel_size</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>m</span><span class=o>.</span><span class=n>kernel_size</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=n>m</span><span class=o>.</span><span class=n>out_channels</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>normal_</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>2.</span> <span class=o>/</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>nn</span><span class=o>.</span><span class=n>BatchNorm2d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>fill_</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=n>bias</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>zero_</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>nn</span><span class=o>.</span><span class=n>Linear</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>nn</span><span class=o>.</span><span class=n>init</span><span class=o>.</span><span class=n>xavier_normal_</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>weight</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>    <span class=c1># what&#39;s this method</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=n>bias</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>zero_</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=æ•°æ®ç±»å‹å’Œç»´åº¦>æ•°æ®ç±»å‹å’Œç»´åº¦<a hidden class=anchor aria-hidden=true href=#æ•°æ®ç±»å‹å’Œç»´åº¦>#</a></h2><p>åœ¨ç®—æ³•ç¼–å†™çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®çš„ç±»å‹å’Œç»´åº¦çš„å¯¹é½å’Œchannelæ˜¯å¾ˆé‡è¦çš„ï¼Œåœ¨è¿™é‡Œä¹Ÿå¾ˆå®¹æ˜“å‡ºç°å¾ˆå¤šçš„bugï¼Œåœ¨è¿™é‡Œåšä¸€ä¸ªä¿¡æ¯çš„æ±‡æ€»</p><h3 id=è¾“å…¥æ•°æ®çš„é€šé“>è¾“å…¥æ•°æ®çš„é€šé“<a hidden class=anchor aria-hidden=true href=#è¾“å…¥æ•°æ®çš„é€šé“>#</a></h3><p>ç»“è®ºï¼špytorchç½‘ç»œè¾“å…¥å›¾ç‰‡çš„shapeè¦æ±‚é€šé“æ˜¯<strong>channel_first</strong>ï¼ˆé€šé“åœ¨å‰ï¼‰çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„å›¾ç‰‡ä¸æ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰§è¡Œç›¸åº”çš„å˜åŒ–ã€‚</p><p>TODOï¼šæ•´ç†å„ç§æ•°æ®è¯»å–æ–¹å¼è¯»å…¥çš„channel first æˆ–æ˜¯ last : skimage,PIL,numpy</p><p>æ•´ç†ç›¸åº”çš„å„ç§æ•°æ®ç±»å‹è¿›è¡Œtransposeï¼ˆnumpyï¼‰çš„æ–¹å¼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ä¹Ÿå¯ä»¥ä½¿ç”¨viewå‡½æ•°ï¼Œä½†æ˜¯ç›¸åº”çš„ï¼Œviewéœ€è¦è®¡ç®—å‡ºå„ä¸ªç»´åº¦ç›¸åº”çš„æ•°å€¼</span>
</span></span><span class=line><span class=cl><span class=c1># viewï¼ˆï¼‰ç›´æ¥ä½¿ç”¨çš„æ—¶å€™ä¸æ”¹å˜åŸå€¼çš„å¤§å°ï¼Œpermuteä¹Ÿä¸æ”¹å˜ï¼Œä½¿ç”¨çš„æ–¹æ³•ä¸åŒè€Œå·²</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>permute</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot>æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot<a hidden class=anchor aria-hidden=true href=#æ ‡ç­¾çš„å½¢å¼è½¬æ¢one-hot>#</a></h3><p>è¿›è¡Œè®­ç»ƒä¹‹å‰è¦å°†æ•°æ®è½¬åŒ–ä¸ºonehotçš„å½¢å¼ï¼Œæ‰èƒ½è¾“å…¥è®­ç»ƒï¼Œè€Œä¸”ä¸€èˆ¬å› ä¸ºæ˜¯batch_sizeçš„å½¢å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è½¬åŒ–ä¸ºçŸ©é˜µå½¢å¼çš„onehotï¼Œä¸èƒ½ç”¨å•ä¸ªlabelçš„è½¬åŒ–æ–¹æ³•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_onehot_single</span><span class=p>(</span><span class=n>num</span><span class=p>,</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;æ ¹æ®ç±»åˆ«æ•°é‡å’Œindexç”Ÿæˆsingleï¼Œonehot&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># BTWï¼šscatteræ–¹æ³•ä¹Ÿèƒ½ç”Ÿæˆone-hot</span>
</span></span><span class=line><span class=cl>    <span class=n>onehot</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>onehot</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>onehot</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸»è¦æ˜¯ä¸‹é¢è¿™ç§æ–¹æ³•éœ€è¦æŒæ¡ï¼Œ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_onehot_array</span><span class=p>(</span><span class=n>width</span><span class=p>,</span><span class=n>target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;æ ¹æ®labelç”ŸæˆonehotçŸ©é˜µã€‚
</span></span></span><span class=line><span class=cl><span class=s1>    widthï¼šç±»åˆ«æ•° targetï¼šå…·ä½“çš„labeldata&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>target</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;the type of target is </span><span class=si>{}</span><span class=s1> &#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>target</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;break down&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>onehot</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>length</span><span class=p>,</span> <span class=n>width</span><span class=p>)</span><span class=o>.</span><span class=n>scatter_</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>target</span><span class=o>.</span><span class=n>view</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>onehot</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=visualize-å¯è§†åŒ–éƒ¨åˆ†>Visualize å¯è§†åŒ–éƒ¨åˆ†<a hidden class=anchor aria-hidden=true href=#visualize-å¯è§†åŒ–éƒ¨åˆ†>#</a></h1><h2 id=tensorboard-in-pytorch>Tensorboard in Pytorch<a hidden class=anchor aria-hidden=true href=#tensorboard-in-pytorch>#</a></h2><p>@Aiken H 2021 review ä¹‹å‰è¿™ä¸€éƒ¨åˆ†çš„projectionå’Œmodeléƒ½æ²¡æœ‰æˆåŠŸæ˜¾ç¤ºï¼Œè¿™æ¬¡åœ¨æ–°æ¡†æ¶ä¸­å±•ç¤ºä¸€ä¸‹ã€‚</p><p><a href=https://pytorch.org/tutorials/intermediate/tensorboard_tutorial.html target=_blank rel=noopener>Visualizing Models, Data, and Training with TensorBoard - PyTorch Tutorials 1.8.1+cu102 documentation</a></p><p><a href=https://blog.csdn.net/bigbennyguo/article/details/87956434 target=_blank rel=noopener>è¯¦è§£PyTorché¡¹ç›®ä½¿ç”¨TensorboardXè¿›è¡Œè®­ç»ƒå¯è§†åŒ–_æµ…åº¦å¯º-CSDNåšå®¢_tensorboardx</a></p><p><a href="https://pytorch.apachecn.org/#/docs/1.7/17?id=%e4%bd%bf%e7%94%a8-tensorboard-%e5%8f%af%e8%a7%86%e5%8c%96%e6%a8%a1%e5%9e%8b%ef%bc%8c%e6%95%b0%e6%8d%ae%e5%92%8c%e8%ae%ad%e7%bb%83" target=_blank rel=noopener>ä½¿ç”¨ TensorBoard å¯è§†åŒ–æ¨¡å‹ï¼Œæ•°æ®å’Œè®­ç»ƒ (apachecn.org)</a></p><p>åœ¨pytorchæ•™ç¨‹ä¸­çš„Projectionå¯ä»¥ç»“åˆåç»­è¾“å‡ºçš„Featureä½¿ç”¨æ¥åˆ†æç›¸åº”çš„èšç±»å’Œåˆ†ç±»å¯é æ€§</p><p>å¯ä»¥å°è¯•ä½¿ç”¨ï¼Œæ•™ç¨‹å†™çš„å¾ˆç®€å•æ˜“æ‡‚ã€‚</p><h3 id=histogram-ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡>Histogram ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡<a hidden class=anchor aria-hidden=true href=#histogram-ç›´æ–¹å›¾å‚æ•°ç»Ÿè®¡>#</a></h3><p>ä¸€èˆ¬æ¥è¯´ç”¨æ¥ç»Ÿè®¡æ¨¡å‹ä¸­é—´çš„ä¸€äº›å‚æ•°çš„åˆ†å¸ƒæƒ…å†µï¼Œå…·ä½“çš„ä½¿ç”¨åœ¨è®­ç»ƒçš„epochä¹‹é—´ï¼Œå’Œvalæ˜¯ä¸€ä¸ªæ¯”è¾ƒç±»ä¼¼çš„æœºåˆ¶ï¼Œå…·ä½“çš„ä»£ç æ ·ä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># visualize those parameter as historgram</span>
</span></span><span class=line><span class=cl><span class=c1># we can add other model here</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>10</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span><span class=n>param</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>main_model</span><span class=o>.</span><span class=n>named_parameters</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>writer</span><span class=o>.</span><span class=n>add_histogram</span><span class=p>(</span><span class=s1>&#39;main_model&#39;</span><span class=o>+</span><span class=n>name</span><span class=p>,</span><span class=n>param</span><span class=o>.</span><span class=n>clone</span><span class=p>()</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>numpy</span><span class=p>(),</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=embedding-projection>Embedding Projection<a hidden class=anchor aria-hidden=true href=#embedding-projection>#</a></h3><p>@Aiken H 2021 è¿™ä¸€éƒ¨åˆ†å¯èƒ½æ‰æ˜¯ç¥ç»ç½‘ç»œçš„ç‰¹å¾åˆ†å¸ƒçš„å¯è§†åŒ–å›¾ã€‚</p><p>ä¸‹é¢è¿™ä¸ªæ˜¯Googleçš„Embedding Projectionï¼Œéœ€è¦ä¸Šä¼ .tsvä¿å­˜çš„æ•°æ®ï¼Œä½†æ˜¯å®é™…ä¸Šå°±æ˜¯Tensorboardä¸Šä¹Ÿæœ‰é›†æˆçš„åŠŸèƒ½</p><p><a href=http://projector.tensorflow.org/ target=_blank rel=noopener>Embedding projector - visualization of high-dimensional data</a></p><p><a href=https://www.tensorflow.org/tensorboard/tensorboard_projector_plugin target=_blank rel=noopener>Visualizing Data using the Embedding Projector in TensorBoard</a></p><h3 id=pr_curve>PR_CURVE<a hidden class=anchor aria-hidden=true href=#pr_curve>#</a></h3><p>è¿™é‡Œä¼šè´´ä¸Špr_curveä¸­éœ€è¦çš„å‚æ•°å’Œæˆ‘ä»¬è¿™è¾¹ç¼–å†™çš„ç¤ºä¾‹ä»£ç </p><h3 id=add_text>Add_TEXT<a hidden class=anchor aria-hidden=true href=#add_text>#</a></h3><p>æ¢è¡Œå¤±æ•ˆé—®é¢˜, è¿™æ˜¯å› ä¸ºåœ¨Tensorboardä¸­è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯Markdownçš„æ ¼å¼, æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬åœ¨æ¢è¡Œç¬¦<code>\n</code>ä¹‹å‰, éœ€è¦ä¿ç•™ä¸¤ä¸ªç©ºæ ¼æ‰èƒ½å®ç°çœŸæ­£çš„æ¢è¡Œ</p><h3 id=add_figure>ADD_Figure<a hidden class=anchor aria-hidden=true href=#add_figure>#</a></h3><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬ç¼–å†™çš„figureåœ¨stepä¸­æ²¡æœ‰å…¨éƒ¨ç°å®å‡ºæ¥, è¿™æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨å‘½ä»¤æ¥å±•ç¤ºæ‰€æœ‰çš„å›¾ç‰‡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>--</span><span class=n>samples_per_plugin</span> <span class=n>images</span><span class=o>=</span><span class=mi>9999</span>
</span></span><span class=line><span class=cl><span class=c1># 999 &gt; the num you want to displ</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾cam>å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾ï¼ˆCAMï¼‰<a hidden class=anchor aria-hidden=true href=#å¯è§†åŒ–ç¥ç»ç½‘ç»œçƒ­åŠ›å›¾cam>#</a></h2><p>@Aiken2020 ä¸ºäº†ä¾¿äºæŸ¥çœ‹ç¥ç»ç½‘ç»œçš„<strong>è¾“å‡º</strong>ï¼Œå¯¹äºå›¾åƒçš„å“ªä¸€éƒ¨åˆ†<strong>æ›´åŠ çš„ä¾§é‡</strong>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å¯¼ç½‘ç»œè¿›è¡Œåˆ†ç±»çš„ä¸»è¦æ˜¯å›¾åƒçš„å“ªäº›åŒºåŸŸï¼Œï¼ˆç›¸åº”çš„ä¹Ÿå¯ä»¥æŒ‰ç…§ç±»ä¼¼çš„æ–¹æ³•æŸ¥çœ‹Attention Networkçš„æ•ˆæœæŠŠï¼‰ï¼Œå°±æƒ³ç€<strong>å¯è§†åŒ–ä¸€ä¸‹CAM</strong>ã€‚çœ‹æŒ‡å¯¼åˆ†ç±»çš„é«˜å“åº”åŒºåŸŸæ˜¯å¦è½åœ¨æ ¸å¿ƒåŒºåŸŸã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href=https://blog.csdn.net/sinat_37532065/article/details/103362517 target=_blank rel=noopener>CAM Pytorch</a></p><h3 id=ç®—æ³•åŸç†>ç®—æ³•åŸç†<a hidden class=anchor aria-hidden=true href=#ç®—æ³•åŸç†>#</a></h3><p>å…¶è®¡ç®—æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹äºä¸€ä¸ªCNNæ¨¡å‹ï¼Œå¯¹å…¶æœ€åä¸€ä¸ªfeaturemapåšå…¨å±€å¹³å‡æ± åŒ–ï¼ˆGAPï¼‰è®¡ç®—å„é€šé“å‡å€¼ï¼Œç„¶åé€šè¿‡FCå±‚ç­‰æ˜ å°„åˆ°class scoreï¼Œæ‰¾å‡ºargmaxï¼Œ<strong>è®¡ç®—æœ€å¤§çš„é‚£ä¸€ç±»çš„è¾“å‡ºç›¸å¯¹äºæœ€åä¸€ä¸ªfeaturemapçš„æ¢¯åº¦</strong>ï¼ˆå®é™…ä¸Šå°±æ˜¯æœ€åä¸€ä¸ªmapä¸­å“ªäº›å¯¹äºåˆ†ç±»çš„å˜åŒ–å…¶æ›´å¤§çš„ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼æƒé‡çš„æœºåˆ¶ï¼‰ï¼Œå†æŠŠè¿™ä¸ªæ¢¯åº¦å¯è§†åŒ–åˆ°åŸå›¾ä¸Šå³å¯ã€‚ç›´è§‚æ¥è¯´ï¼Œå°±æ˜¯çœ‹ä¸€ä¸‹<strong>ç½‘ç»œæŠ½å–åˆ°çš„é«˜å±‚ç‰¹å¾çš„å“ªéƒ¨åˆ†å¯¹æœ€ç»ˆçš„classifierå½±å“æ›´å¤§</strong>ã€‚</p><p><div class=post-img-view><a data-fancybox=gallery href=https://raw.githubusercontent.com/AikenH/md-image/master/img/20191203102807477.png><img alt=ImgInGIthu loading=lazy src=https://raw.githubusercontent.com/AikenH/md-image/master/img/20191203102807477.png class=responsive-image src=https://raw.githubusercontent.com/AikenH/md-image/master/img/20191203102807477.png style="display:block;margin:0 auto" alt=ImgInGIthu></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><ul><li><p>Quote: æ‰¾åˆ°äº†ä¸€ç¯‡åŸºäºKerasçš„CAMå®ç°ï¼Œæ„Ÿè°¢ï¼š</p><p><a href=https://blog.csdn.net/Einstellung/article/details/82858974 target=_blank rel=noopener>https://blog.csdn.net/Einstellung/article/details/82858974</a>
ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¹ æƒ¯ç”¨Pytorchä¸€ç‚¹ï¼Œæ‰€ä»¥å‚è€ƒç€æ”¹äº†ä¸€ç‰ˆPytorchçš„å®ç°ã€‚å…¶ä¸­ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹å›°æ‰°äº†ä¸€ä¸‹ï¼Œå› ä¸ºPytorchçš„è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶ï¼Œä¸€èˆ¬åªä¼šä¿å­˜å‡½æ•°å€¼å¯¹è¾“å…¥çš„å¯¼æ•°å€¼ï¼Œè€Œä¸­é—´å˜é‡çš„å¯¼æ•°å€¼éƒ½æ²¡æœ‰ä¿ç•™ï¼Œè€Œæ­¤å¤„æˆ‘ä»¬éœ€è¦è®¡ç®—è¾“å‡ºå±‚ç›¸å¯¹äºæœ€åä¸€ä¸ªfeature mapæ¢¯åº¦ï¼Œæ‰€ä»¥å‚è€ƒhttps://blog.csdn.net/qq_27061325/article/details/84728539è§£å†³äº†è¯¥é—®é¢˜ã€‚</p></li></ul><h3 id=ä»£ç å®ç°>ä»£ç å®ç°ï¼š<a hidden class=anchor aria-hidden=true href=#ä»£ç å®ç°>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cv2</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>draw_CAM</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>img_path</span><span class=p>,</span> <span class=n>save_path</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>visual_heatmap</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    ç»˜åˆ¶ Class Activation Map
</span></span></span><span class=line><span class=cl><span class=s1>    :param model: åŠ è½½å¥½æƒé‡çš„Pytorch model
</span></span></span><span class=line><span class=cl><span class=s1>    :param img_path: æµ‹è¯•å›¾ç‰‡è·¯å¾„
</span></span></span><span class=line><span class=cl><span class=s1>    :param save_path: CAMç»“æœä¿å­˜è·¯å¾„
</span></span></span><span class=line><span class=cl><span class=s1>    :param transform: è¾“å…¥å›¾åƒé¢„å¤„ç†æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=s1>    :param visual_heatmap: æ˜¯å¦å¯è§†åŒ–åŸå§‹heatmapï¼ˆè°ƒç”¨matplotlibï¼‰
</span></span></span><span class=line><span class=cl><span class=s1>    :return:
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># å›¾åƒåŠ è½½&amp;é¢„å¤„ç†</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>img_path</span><span class=p>)</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>transform</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>transform</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>unsqueeze</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># è·å–æ¨¡å‹è¾“å‡ºçš„feature/score</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>eval</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>features</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>features</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>classifier</span><span class=p>(</span><span class=n>features</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ä¸ºäº†èƒ½è¯»å–åˆ°ä¸­é—´æ¢¯åº¦å®šä¹‰çš„è¾…åŠ©å‡½æ•°</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract</span><span class=p>(</span><span class=n>g</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>global</span> <span class=n>features_grad</span>
</span></span><span class=line><span class=cl>        <span class=n>features_grad</span> <span class=o>=</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># é¢„æµ‹å¾—åˆ†æœ€é«˜çš„é‚£ä¸€ç±»å¯¹åº”çš„è¾“å‡ºscore</span>
</span></span><span class=line><span class=cl>    <span class=n>pred</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>output</span><span class=p>)</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>pred_class</span> <span class=o>=</span> <span class=n>output</span><span class=p>[:,</span> <span class=n>pred</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>features</span><span class=o>.</span><span class=n>register_hook</span><span class=p>(</span><span class=n>extract</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pred_class</span><span class=o>.</span><span class=n>backward</span><span class=p>()</span> <span class=c1># è®¡ç®—æ¢¯åº¦</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>grads</span> <span class=o>=</span> <span class=n>features_grad</span>   <span class=c1># è·å–æ¢¯åº¦</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pooled_grads</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>functional</span><span class=o>.</span><span class=n>adaptive_avg_pool2d</span><span class=p>(</span><span class=n>grads</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># æ­¤å¤„batch sizeé»˜è®¤ä¸º1ï¼Œæ‰€ä»¥å»æ‰äº†ç¬¬0ç»´ï¼ˆbatch sizeç»´ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>pooled_grads</span> <span class=o>=</span> <span class=n>pooled_grads</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>features</span> <span class=o>=</span> <span class=n>features</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># 512æ˜¯æœ€åä¸€å±‚featureçš„é€šé“æ•°</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>512</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span> <span class=o>*=</span> <span class=n>pooled_grads</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ä»¥ä¸‹éƒ¨åˆ†åŒKerasç‰ˆå®ç°</span>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>=</span> <span class=n>features</span><span class=o>.</span><span class=n>detach</span><span class=p>()</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>heatmap</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=n>heatmap</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>heatmap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å¯è§†åŒ–åŸå§‹çƒ­åŠ›å›¾</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>visual_heatmap</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plt</span><span class=o>.</span><span class=n>matshow</span><span class=p>(</span><span class=n>heatmap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>img</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=n>img_path</span><span class=p>)</span>  <span class=c1># ç”¨cv2åŠ è½½åŸå§‹å›¾åƒ</span>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>resize</span><span class=p>(</span><span class=n>heatmap</span><span class=p>,</span> <span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>img</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>  <span class=c1># å°†çƒ­åŠ›å›¾çš„å¤§å°è°ƒæ•´ä¸ºä¸åŸå§‹å›¾åƒç›¸åŒ</span>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=n>heatmap</span><span class=p>)</span>  <span class=c1># å°†çƒ­åŠ›å›¾è½¬æ¢ä¸ºRGBæ ¼å¼</span>
</span></span><span class=line><span class=cl>    <span class=n>heatmap</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>applyColorMap</span><span class=p>(</span><span class=n>heatmap</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLORMAP_JET</span><span class=p>)</span>  <span class=c1># å°†çƒ­åŠ›å›¾åº”ç”¨äºåŸå§‹å›¾åƒ</span>
</span></span><span class=line><span class=cl>    <span class=n>superimposed_img</span> <span class=o>=</span> <span class=n>heatmap</span> <span class=o>*</span> <span class=mf>0.4</span> <span class=o>+</span> <span class=n>img</span>  <span class=c1># è¿™é‡Œçš„0.4æ˜¯çƒ­åŠ›å›¾å¼ºåº¦å› å­</span>
</span></span><span class=line><span class=cl>    <span class=n>cv2</span><span class=o>.</span><span class=n>imwrite</span><span class=p>(</span><span class=n>save_path</span><span class=p>,</span> <span class=n>superimposed_img</span><span class=p>)</span>  <span class=c1># å°†å›¾åƒä¿å­˜åˆ°ç¡¬ç›˜</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=bugs>BUGs<a hidden class=anchor aria-hidden=true href=#bugs>#</a></h2><p>å¦‚æœæƒ³è¦å±•ç¤ºå‡ºæ‰€æœ‰stepçš„å›¾ç‰‡, æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œæ‰§è¡Œtensoroardçš„æ—¶å€™æ‰§è¡Œä¸‹åˆ—å‘½ä»¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tensorboard --logdir log/cifar100_resnet18 --samples_per_plugin <span class=nv>images</span><span class=o>=</span><span class=m>999999</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=debug>DEBUG<a hidden class=anchor aria-hidden=true href=#debug>#</a></h1><h2 id=1importerror-cannot-import-name-pillow_version>1.ImportError: cannot import name &lsquo;PILLOW_VERSION&rsquo;<a hidden class=anchor aria-hidden=true href=#1importerror-cannot-import-name-pillow_version>#</a></h2><p>PILç‰ˆæœ¬è¿‡é«˜ï¼Œæ¢ä½å°±å¯ä»¥ï¼Œä»–ä¸é…æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜</p><p><code>pip install Pillow==6.2.2 --user</code></p><h2 id=2æ¨¡å‹å‚æ•°è®¡ç®—é‡ç»Ÿè®¡-and-debugè¾“å‡º>2.æ¨¡å‹å‚æ•°&è®¡ç®—é‡ç»Ÿè®¡ and Debugè¾“å‡º<a hidden class=anchor aria-hidden=true href=#2æ¨¡å‹å‚æ•°è®¡ç®—é‡ç»Ÿè®¡-and-debugè¾“å‡º>#</a></h2><ol><li>ç”¨æ¥è®¡ç®—æ¨¡å‹æ„å»ºä¸­ç½‘ç»œçš„å‚æ•°ï¼Œç©ºé—´å¤§å°ï¼ŒMAddï¼ŒFLOPsç­‰æŒ‡æ ‡ï¼Œcount_paramså¾ˆå¥½å†™ï¼Œç„¶åå‰©ä¸‹çš„è®¡ç®—æˆ‘ä»¬äº¤ç»™ä¸¤ä¸ªç¬¬ä¸‰æ–¹çš„åº“æ¥å®ç°ï¼š<code>torchstat</code>,<code>thop</code></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>torchstat</span> <span class=kn>import</span> <span class=n>stat</span>
</span></span><span class=line><span class=cl><span class=n>stat</span><span class=p>(</span><span class=n>model</span><span class=p>,(</span><span class=mi>3</span><span class=p>,</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>))</span> <span class=c1>#thatâ€˜s all using it in the eval stage</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>torchsummary</code>æ¥æŸ¥çœ‹å„å±‚è¾“å‡ºçš„æ•°æ®çš„ç»´åº¦æ•°ç›®</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>torchsummary</span> <span class=kn>import</span> <span class=n>summary</span>
</span></span><span class=line><span class=cl><span class=n>summary</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>cuda</span><span class=p>(),</span><span class=n>input_size</span><span class=o>=</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>),</span><span class=n>batch_size</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>ç›¸åº”çš„Debugè¿˜å¯ä»¥ä½¿ç”¨<code>torchsnooper</code>è¿›è¡Œï¼šå˜é‡çš„ç±»å‹å’Œç»´åº¦è¿½è¸ªè¿™ä¸ªæ¨¡å—é€šè¿‡<code>@xxxx</code>ä¿®é¥°å™¨çš„æ–¹æ³•è°ƒç”¨åœ¨æŒ‡å®šçš„methodå‰é¢ï¼Œèƒ½å¤Ÿåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¾“å‡ºä¸€äº›<strong>å‚æ•°å€¼çš„ç±»å‹</strong>å’Œ<strong>æ•°å€¼å˜åŒ–</strong>çš„è¾ƒä¸ºè¯¦ç»†çš„ä¿¡æ¯ã€‚ä¸ªäººç†è§£çš„æœ€ä½³ä½¿ç”¨ç¯å¢ƒæ˜¯ï¼Œç”¨äºè°ƒè¯•æˆ–è€…ç›‘æ§<strong>ç±»å‹ä¹‹é—´çš„é”™è¯¯</strong>ã€‚</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># è¿™ä¸ªpackageå¦‚æœæ²¡è®°é”™çš„è¯å¥½åƒæ˜¯ä½¿ç”¨è£…é¥°å™¨çš„æ–¹æ³•å»è¿›è¡Œæµ‹è¯•</span>
</span></span><span class=line><span class=cl><span class=o>@...</span>
</span></span><span class=line><span class=cl><span class=n>method</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=3pytorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹>3.PyTorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹<a hidden class=anchor aria-hidden=true href=#3pytorchåŠ è½½é¢„è®­ç»ƒæ¨¡å‹>#</a></h2><p>å…·ä½“é”™è¯¯ï¼šåœ¨äºæ¨¡å‹Dictä¸­çš„Keyå’Œé¢„è®­ç»ƒmodelä¸­çš„Keyä¸å¯¹åº”ï¼Œæ— æ³•åŒ¹é…ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>Unexpected</span> <span class=err>key(s)</span> <span class=err>in</span> <span class=err>state_dict:</span> <span class=s2>&#34;module.features. ...&#34;</span><span class=err>.ï¼ŒExpected</span> <span class=s2>&#34;.features....&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>é—®é¢˜åˆ†æï¼š</p><p><strong>situation1</strong>ï¼šå¯ä»¥çœ‹åˆ°å‰é¢å¤šäº†moduleè¿™ä¸ªstrï¼Œè¿™ä¸€èˆ¬æ˜¯ç”±äºå…¶ä¸­ä¸€æ–¹ä½¿ç”¨äº†å¤šGPUè®­ç»ƒåç›´æ¥ä¿å­˜çš„ï¼Œä¹Ÿå°±æ˜¯<code>DataParallel</code>æ¨¡å¼ä¸‹å¯¼è‡´çš„ä¸åŒ¹é…é—®é¢˜ã€‚</p><p><strong>solution1</strong>ï¼š <a href=https://blog.csdn.net/qq_32998593/article/details/89343507 target=_blank rel=noopener>å‚è€ƒèµ„æ–™</a></p><ol><li><p>loadæ¨¡å‹åå»æ‰å¤šä½™çš„å‚æ•°åœ¨äº‹å…ˆçš„æ—¶å€™å‘ç°è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„dictå°è£…çš„ç»“æ„ï¼Œæ‰€ä»¥æ²¡æ³•è¿™æ ·ç®€å•çš„è¿›è¡Œèµ‹å€¼å¤„ç†:x:</p></li><li><p>ç”¨ç©ºç™½ä»£æ›¿moduleï¼Œæš‚æ—¶è¿˜æ²¡å°è¯•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¼šé‡åˆ°å’Œç¬¬ä¸€ä¸ªä¸€æ ·çš„é—®é¢˜:x:</p></li><li><p>:zap:æœ€ç®€å•çš„æ–¹æ³•ï¼šåŠ è½½æ¨¡å‹åå°†æ¨¡å‹è¿›è¡ŒDataParallelï¼Œå†è¿›è¡Œæ•°æ®çš„è½¬åŒ–ï¼Œå°†æ•°æ®è¿›è¡Œå¹¶è¡ŒåŒ–ã€‚å…·ä½“çš„æ“ä½œå¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>cuda</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># å°†idsè®¾ç½®æˆæ‹¥æœ‰çš„GPUå³å¯ï¼Œä½†æ˜¯ä¸çŸ¥é“å•GPUçš„æƒ…å†µå¯ä¸å¯ä»¥å®ç°è¿™ç§æƒ…å†µ</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>nn</span><span class=o>.</span><span class=n>DataParallel</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>device_ids</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><p><strong>Situation2ï¼š</strong> ä¿å­˜æ¨¡å‹æ ¼å¼ä¸º.pth.tarï¼Œæ— æ³•è½½å…¥è®­ç»ƒå¥½çš„æ¨¡å‹</p><p><strong>Solution2</strong>ï¼š</p><p>åŸå› æ˜¯å› ä¸ºè¢«ä¿å­˜çš„æ¨¡å‹æ˜¯åœ¨é«˜ç‰ˆæœ¬çš„pytorchä¸‹å®ç°çš„ï¼Œä½†æ˜¯å†ä½ç‰ˆæœ¬ä¸­è¯»å–çš„æ¨¡å‹æ˜¯.pthæ ¼å¼çš„ï¼Œå°±ä¼šå‡ºç°ç‰ˆæœ¬å†²çªã€‚
è§£å†³æ–¹æ³•å¦‚ä¸‹ğŸ‘‡ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># åœ¨é«˜ç‰ˆæœ¬çš„ç¯å¢ƒä¸­load modelï¼Œç„¶åå†é‡æ–°ä¿å­˜ï¼Œä¿å­˜çš„æ—¶å€™æ·»åŠ å‚æ•°ï¼Œä½¿å¾—ä¿å­˜æˆæ—§ç‰ˆæœ¬å³å¯</span>
</span></span><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>checkpoint</span><span class=p>,</span><span class=n>save_path</span><span class=p>,</span><span class=n>_use_new_zipfile_serialization</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># DONE</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>xxx is a zip archive(did you mean to use torch.jit.load()?)</strong></p><p>ä½¿ç”¨ä½ç‰ˆæœ¬çš„Torchå»Loadé«˜ç‰ˆæœ¬ï¼ˆ>1.6ï¼‰ä¿å­˜çš„æ¨¡å‹ï¼ˆ.pth.tarï¼‰é‡åˆ°çš„é—®é¢˜,</p><p>è¿™ç§é”™è¯¯ï¼Œä¸»è¦æ˜¯æ¨¡å‹çš„ç‰ˆæœ¬å†²çªã€‚</p><p><strong>è§£å†³åŠæ³•</strong>ï¼šåœ¨é«˜ç‰ˆæœ¬çš„ç¯å¢ƒä¸­ï¼Œé‡æ–°loadæ¨¡å‹ï¼Œç„¶åç›´æ¥saveï¼Œåœ¨ä¿å­˜çš„æ—¶å€™æ·»åŠ å‚æ•°</p><p><code>torch.save(model.state_dict(),model_path,_use_new_zipfile_serialization=False)</code></p><p>å°±å¯ä»¥ä¿å­˜æˆ.pthçš„æ¨¡å‹ï¼Œä¹Ÿèƒ½åœ¨ä½ç‰ˆæœ¬çš„torchç¯å¢ƒä¸­ä½¿ç”¨äº†</p><h2 id=4some-of-the-strides-of-a-given-numpy-array-are-negative>4.some of the strides of a given numpy array are negative.<a hidden class=anchor aria-hidden=true href=#4some-of-the-strides-of-a-given-numpy-array-are-negative>#</a></h2><p>verï¼štorch1.2 è¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šåœ¨åç»­çš„ç‰ˆæœ¬ä¸­è¢«ä¼˜åŒ–ã€‚</p><p><strong>Situation</strong>ï¼š</p><p><a href=https://www.cnblogs.com/devilmaycry812839668/p/13761613.html target=_blank rel=noopener>https://www.cnblogs.com/devilmaycry812839668/p/13761613.html</a>
é—®é¢˜å‡ºç°åœ¨flatæ“ä½œä¸­ï¼Œåå‘åˆ‡ç‰‡<code>[::-1]</code>ä¼šå¯¼è‡´æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸Šä¸è¿ç»­ï¼Œåœ¨æ—§ç‰ˆæœ¬ä¸­æ— æ³•å®ç°ï¼Œå¯¹è¿™æ ·æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚
<strong>Solution1</strong>:
æ‰€ä»¥åœ¨æ‰§å€’æ’åˆ‡ç‰‡çš„æ—¶å€™æ‰§è¡Œï¼Œ<code>img2 = np.ascontiguousarray(img)</code> ä½¿å¾—æ•°æ®åœ¨å†…å­˜ç©ºé—´ä¸Šè¿ç»­ã€‚</p><p><strong>Solution2</strong>:</p><p>æˆ–è€…æ‰§è¡Œå€’æ’åˆ‡ç‰‡çš„æ—¶å€™ï¼Œç›´æ¥<code>return img.copy()</code></p><h2 id=5è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€>5.è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€<a hidden class=anchor aria-hidden=true href=#5è¯»å–loaderçš„æ—¶å€™å›¾åƒçš„å¤§å°ä¸ä¸€>#</a></h2><p>ä½¿ç”¨Cropå¯¹å›¾åƒè¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¸æ³¨æ„çš„è¯å°±æ˜¯ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œå›¾åƒçš„sizeéšæœºæ”¹å˜ï¼Œå¯¼è‡´çš„è¾“å‡ºä¸ç»Ÿä¸€ã€‚ä¹Ÿå¯èƒ½æ˜¯Cropå‡½æ•°å†™çš„æœ‰é—®é¢˜ã€‚</p><p><strong>bug info</strong>å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ RuntimeError: invalid argument 0: Sizes of tensors must match except in dimension 0. Got <span class=m>182</span> and <span class=m>360</span> in dimension <span class=m>2</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Solutionï¼š</strong></p><p>resizeï¼Œsppï¼Œpaddingï¼Œ<strong>adaptiveMaxPooling</strong>ï¼ˆè‡ªé€‚åº”çš„poolingï¼Œpoolingåˆ°æŒ‡å®šçš„sizeï¼ˆchannelé™¤å¤–ï¼‰ï¼‰</p><h2 id=6bus-error-dataloader-num_worker>6.bus error dataloader num_worker<a hidden class=anchor aria-hidden=true href=#6bus-error-dataloader-num_worker>#</a></h2><p>åŸå› æš‚æ—¶è¿˜ä¸æ˜¯å¤ªæ¸…æ¥šï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠnum_workerè®¾ç½®ä¸º0 æ¥è§£å†³è¿™ä¸ªé—®é¢˜.jpg</p><h2 id=7bus-errorinsufficient-shared-memoryshm>7.bus errorï¼šinsufficient shared memoryï¼ˆshmï¼‰<a hidden class=anchor aria-hidden=true href=#7bus-errorinsufficient-shared-memoryshm>#</a></h2><p>è¿™ç§åŸå› é€šå¸¸ä¼šåœ¨dockerç¯å¢ƒä¸­å‡ºç°ï¼Œç”±äºæœªæŒ‡å®šshmå®¹é‡å¤§å°ï¼Œæ¯”å¦‚<code>ipc=host</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œå°±ä¼šå¯¼è‡´dockerçš„shmåªæœ‰64mï¼Œäºæ˜¯åœ¨è¿è¡Œçš„æ—¶å€™å°±ä¼šå‡ºé—®é¢˜ã€‚è¿™ç§æƒ…å†µä¸‹<strong>åªèƒ½é‡æ–°run docker</strong>ï¼ˆç›®å‰åªæ‰¾åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼‰ã€‚</p><p>å¦‚æœè¦å¦¥åçš„è¯ï¼Œå°±åªèƒ½<strong>è¯•ç€å‡å°batch_size</strong>ã€‚ä½†æ˜¯éšç€æ¨¡å‹çš„è®¾è®¡ä¸Šï¼Œè¿™å…¶å®ä¸æ˜¯ä¸€ä¸ªå¯ä»¥é€ƒé¿çš„é—®é¢˜ï¼Œä¹Ÿä¼šå¢åŠ è«é¡»æœ‰çš„å…¶ä»–æˆæœ¬ï¼Œæ‰€ä»¥ã€‚</p><h2 id=8è®­ç»ƒè¿‡ç¨‹ä¸­cacheå’Œmemoryçš„å ç”¨é€æ¸å‡é«˜>8.è®­ç»ƒè¿‡ç¨‹ä¸­Cacheå’ŒMemoryçš„å ç”¨é€æ¸å‡é«˜<a hidden class=anchor aria-hidden=true href=#8è®­ç»ƒè¿‡ç¨‹ä¸­cacheå’Œmemoryçš„å ç”¨é€æ¸å‡é«˜>#</a></h2><p>ä¸»è¦çš„ä½“ç°æ˜¯ï¼š<strong>é€æ¸å‡é«˜</strong>è¿™ä¸€ç‚¹ï¼Œè€Œä¸æ˜¯ç¨³å®šçš„æƒ…å†µï¼›</p><p>æœ‰ç‚¹ç„å­¦ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªiterationç»“æŸçš„æ—¶å€™ä½¿ç”¨æ¸…æ¥šæ˜¾å­˜çš„å‡½æ•°ï¼Œç«Ÿç„¶å°±èƒ½è¿›è¡Œæ§åˆ¶äº†ï¼Œè™½ç„¶æˆ‘ä¸çŸ¥é“ä¸ºå•¥æ¸…æ¥šæ˜¾å­˜çš„å‡½æ•°ä¼šé¡ºä¾¿è¿å†…å­˜ä¸­çš„cacheä¹Ÿä¸€èµ·æ¸…é™¤äº†ï¼Œä½†æ˜¯å°±æ˜¯ï¼Œå­¦ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>empty_cache</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=9æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ>9.æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ<a hidden class=anchor aria-hidden=true href=#9æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ç®—æ³•æ²¡æœ‰å­¦ä¹ æ•ˆæœ>#</a></h2><p>æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œåˆ†æå¯èƒ½å‡ºç°å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>æŸä¸€éƒ¨åˆ†çš„å­¦ä¹ å‚æ•°å¯èƒ½çš„lrè¿‡é«˜ï¼Œæƒé‡è¿‡é«˜ï¼Œå¯¼è‡´è¯¯å·®å¿«é€Ÿä¼ æ’­ã€‚</li><li>é—®é¢˜çš„å¤æ‚åº¦è¿‡é«˜ï¼Œç®—æ³•overpoweräº†æŠŠã€‚</li></ul><p>é’ˆå¯¹äºç¬¬ä¸€ç‚¹çš„è¯ï¼Œæˆ‘ä»¬å‚è€ƒå·¥ç¨‹ç¬”è®°ä¸­çš„å­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥å³å¯ã€‚</p><p>å¦‚æœæ˜¯é—®é¢˜çš„å¤æ‚åº¦è¿‡é«˜ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯é—®é¢˜å¯¹äºæˆ‘ä»¬çš„æ¨¡å‹æ¥è¯´å·²ç»overpowerçš„ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å»åŠ æ·±ç½‘ç»œçš„å±‚æ•°ï¼Œæˆ–è€…å¯¹ç½‘ç»œè¿›è¡Œè¿›ä¸€æ­¥çš„è®¾è®¡å’Œå¯¹æ•°æ®çš„åˆ†æé—®é¢˜ã€‚</p><h2 id=10ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»>10.ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»<a hidden class=anchor aria-hidden=true href=#10ç±»å‹è½¬æ¢é—®é¢˜æ±‡æ€»>#</a></h2><ol><li><p>æ¯”å¦‚<code>scatter_</code>éœ€è¦å°†æ•°æ®ä»int32çš„æ ¼å¼è½¬æ¢æˆint64ï¼Œæˆ‘ä»¬è¦æŒæ¡ä¸€ä¸‹åœ¨Pytorchä¸­è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢çš„æŠ€å·§ã€‚</p></li><li><p><strong>Expected object of scalar type Float but got scalar type Double for argument #2 &rsquo;target&rsquo;</strong> æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œä¸€ä¸ªæ˜¯np.float32,å¦ä¸€ä¸ªæ˜¯64
å‚è€ƒè§£å†³æ–¹æ¡ˆï¼š<a href=https://stackoverflow.com/questions/56741087/how-to-fix-runtimeerror-expected-object-of-scalar-type-float-but-got-scalar-typ target=_blank rel=noopener>é‡è¦</a></p></li><li><p><strong>Expected object of scalar type Long but got scalar type Float for argument</strong>
å¸Œæœ›å¾—åˆ°çš„æ˜¯Longå‹æ ‡é‡æ•°æ®ï¼Œä½†æ˜¯å¾—åˆ°äº†Floatå‹çš„æ•°æ®ï¼ˆå®é™…ä¸Šå¯èƒ½æ˜¯æˆ‘ä»¬è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ä½¿ç”¨äº†å°æ•°å¸¦æ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿèƒ½å°†å…¶è½¬åŒ–å°±æ˜¯äº†ï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Longtensor</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>type</span><span class=p>(</span><span class=n>torch</span><span class=o>.</span><span class=n>longtensor</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>RuntimeError: Input type (torch.cuda.FloatTensor) and weight type (torch.DoubleTensor) should be the same</strong>
<strong>RuntimeError: Input type (torch.cuda.ByteTensor) and weight type (torch.cuda.FloatTensor) should be the same</strong>é—®é¢˜å®é™…ä¸Šéƒ½æ˜¯å’Œæƒé‡çš„æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œéœ€è¦å°†å­—èŠ‚å‹æˆ–è€…æ˜¯FLoatå‹å‘Weightçš„æ•°æ®ç±»å‹è½¬æ¢ï¼Œä½†æ˜¯å¯èƒ½è¿™é‡Œçš„é—®é¢˜å®é™…ä¸Šå‡ºç°åœ¨å°±æ˜¯æˆ‘ä»¬å¯¼å…¥çš„æ•°æ®ç±»å‹æ˜¯ä¸æ­£ç¡®çš„ã€‚è¿˜æ˜¯ä½¿ç”¨<code>type()</code>å‘½ä»¤æ¥è¿›è¡Œæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä½†æ˜¯å…³é”®è¿˜æ˜¯ï¼š<strong>æ£€æŸ¥è¾“å…¥æ•°æ®çš„ç±»å‹ä»¥åŠæ•°å€¼èŒƒå›´ï¼ŒåŒæ—¶çœ‹çœ‹åœ¨è¿›è¡Œdataloaderçš„æ—¶å€™æœ‰æ²¡æœ‰æŒ‡å®što_tensorçš„å˜æ¢ç­‰ç­‰</strong></p></li></ol><p><a href=https://www.jianshu.com/p/75dff8e7ed18 target=_blank rel=noopener>å‚è€ƒèµ„æ–™é“¾æ¥</a></p><p><strong>è¿›è¡Œæ•°æ®è½¬æ¢çš„å‡ ç§æ–¹å¼</strong></p><ol><li><p>ä½¿ç”¨å‡½æ•°<code>tensor1.type_as(tensor2)</code>å°†1çš„æ•°æ®ç±»å‹è½¬æ¢æˆ2çš„æ•°æ®ç±»å‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>tensor_1</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>FloatTensor</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>tensor_2</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>IntTensor</span><span class=p>([</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>tensor_1</span> <span class=o>=</span> <span class=n>tensor_1</span><span class=o>.</span><span class=n>type_as</span><span class=p>(</span><span class=n>tensor_2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>tensor.type(torch.IntTensor)</code></p></li><li><p><code>tensor.long()</code>,<code>tensor.char()</code>,<code>tensor.int()</code>,<code>tensor.byte()</code>,<code>tensor.double()</code></p></li><li><p><code>tenosr.to(torch.long)</code></p></li></ol><h2 id=11æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»>11.æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»<a hidden class=anchor aria-hidden=true href=#11æ•°æ®ç»´åº¦ä¸å¯¹åº”é—®é¢˜æ±‡æ€»>#</a></h2><ol><li><p><strong>multi-target not supported at</strong>é—®é¢˜å®é™…ä¸Šå¯ä»¥ç¿»è¯‘æˆï¼šç»´åº¦ä¸Šå’Œäº¤å‰ç†µæŸå¤±å‡½æ•°çš„éœ€æ±‚ä¸å¯¹åº”ã€‚åœ¨ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œtargetçš„å½¢çŠ¶åº”è¯¥æ˜¯å’Œlabelçš„å½¢çŠ¶ä¸€è‡´æˆ–è€…æ˜¯åªæœ‰batchsizeè¿™ä¸€ä¸ªç»´åº¦çš„ã€‚å¦‚æœtargetæ˜¯è¿™æ ·çš„ã€batchszieï¼Œ1ã€‘å°±ä¼šå‡ºç°ä¸Šè¿°çš„é”™è¯¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ä½¿ç”¨squeeze</span><span class=err>ï¼ˆï¼‰</span><span class=n>å‡½æ•°é™ä½ç»´åº¦</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=12å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜>12.å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜<a hidden class=anchor aria-hidden=true href=#12å–å‡ºå…·ä½“æ•°å€¼æ—¶å€™çš„é—®é¢˜>#</a></h2><ol><li>**RuntimeError: Can&rsquo;t call numpy() on Variable that requires grad. Use var.detach().numpy()**å¯¹äºè¾“å‡ºçš„ç»“æœè¦è½¬æ¢æˆå…·ä½“çš„æ•°å€¼çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬åç»­è¿˜éœ€è¦è¿™ä¸ªæ•°å€¼çš„æ¢¯åº¦ï¼Œå°±ä¸èƒ½è½¬æ¢åˆ°<code>cpu</code>åå†è½¬æ¢åˆ°<code>numpy</code>,å°±å¥½æ¯”è¯´ï¼Œæˆ‘ä»¬è¦å–å‡ºLossçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨item()å–å‡ºå…·ä½“çš„æ•°å€¼ï¼Œè€Œä¸éœ€è¦è½¬åˆ°CPU<a href=#>ä¸Š</a></li></ol><h2 id=13cpuå ç”¨99>13.CPUå ç”¨99%<a hidden class=anchor aria-hidden=true href=#13cpuå ç”¨99>#</a></h2><p>é—®é¢˜æè¿°ï¼šä½¿ç”¨torchè‡ªå¸¦çš„datasetä¸­çš„cifar10çš„æ—¶å€™ï¼Œåœ¨æ¯ä¸ªepochç»“æŸçš„æ—¶å€™ï¼ŒCPUå ç”¨ç‡é«˜è¾¾99%ï¼Œå¹¶ä¸éšç€num_workderè€Œæ”¹å˜ï¼Œé—®é¢˜å¯èƒ½ç”±äºpytorchå¼€è¾Ÿäº†å¤ªå¤šçš„çº¿ç¨‹</p><p><a href=https://blog.csdn.net/stay_zezo/article/details/107809409 target=_blank rel=noopener>windows10ä¸‹pytorchçš„GPUåˆ©ç”¨ç‡ä½ï¼Œå ç”¨ç‡ä½_stay_zezoçš„åšå®¢-CSDNåšå®¢</a></p><p>å¯èƒ½æ˜¯ç”±äºGPUè¿ç®—å¤ªå¿«äº†ï¼Œå¯ç”¨äº†å¤šçº¿ç¨‹è¿›è¡ŒåŠ è½½æ•°æ®ï¼Œè¿™ç§æ—¶å€™å¯ç”¨<code>pin_memory=true</code> èƒ½èµ·åˆ°ä¸€å®šçš„ä½œç”¨æŠŠï¼ŒåŠ å¿«ä¸€ç‚¹æ•°æ®è¯»å–ã€‚</p><p>æœ€ç»ˆè§£å†³æ–¹æ¡ˆ ï¼š<code>pin-memory=false</code> åæ­£åŸå› å¾ˆç¥å¥‡ï¼Œä½†æ˜¯æœ€ç»ˆå°±æ˜¯å› ä¸ºè¿™ä¸ªè§£å†³çš„ï¼Œå¯èƒ½æ˜¯å› ä¸ºmemoryè¶…äº†ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½éœ€è¦é‡æ–°empty_cache é‡æ–°è£…è¿›é¡µï¼Œæ‰€ä»¥åè€ŒåŠ é‡äº†CPUçš„è´Ÿæ‹…</p><h2 id=14-é¢„æµ‹å€¼å…¨ä¸º0æ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹æŸå¤±ä¿æŒä¸€è‡´å…¨å‡ç­‰>14. é¢„æµ‹å€¼å…¨ä¸º0ï¼Œæ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼ŒæŸå¤±ä¿æŒä¸€è‡´ï¼ˆå…¨å‡ç­‰ï¼‰<a hidden class=anchor aria-hidden=true href=#14-é¢„æµ‹å€¼å…¨ä¸º0æ¨¡å‹æ”¶æ•›åˆ°å¥‡æ€ªçš„åœ°æ–¹æŸå¤±ä¿æŒä¸€è‡´å…¨å‡ç­‰>#</a></h2><p>è¿™ç§æƒ…å†µé€šå¸¸æ˜¯ç”±äºæ¨¡å‹è®¾è®¡ä¸­å­˜åœ¨ä¸€ç‚¹é—®é¢˜ï¼š</p><p>æ¯”å¦‚è¿™æ¬¡æ˜¯ç”±äºæ¨¡å‹ä¸­fcåé¢æ·»åŠ äº†reluï¼Œè¿™æ ·å¯¼è‡´è¾“å‡ºçš„è´Ÿå€¼å…¨è¢«æŠ‘åˆ¶äº†ï¼Œå¯¼è‡´å­¦ä¹ å‡ºç°äº†ä¸¥é‡çš„é”™è¯¯åæœã€‚</p><h2 id=15æ¨¡å‹éƒ¨åˆ†-è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡>15.æ¨¡å‹éƒ¨åˆ†ï¼š è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡<a hidden class=anchor aria-hidden=true href=#15æ¨¡å‹éƒ¨åˆ†-è®­ç»ƒä¸­æ¨¡å‹å‡†ç¡®ç‡ä¸ä¸Šå‡>#</a></h2><p>ç”±äºæ¡†æ¶å·²ç»éªŒè¯è¿‡æ˜¯å¯ä»¥è¿›è¡Œæ­£å¸¸è®­ç»ƒçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å‡ºç°æ¨¡å‹çš„å‡†ç¡®ç‡ä¸ä¸Šå‡å¯èƒ½æ˜¯ç”±äºæ¨¡å‹æœ¬èº«è®¾è®¡ï¼ˆå†…éƒ¨ä»£ç ç¼–å†™ï¼‰ä¸Šçš„é—®é¢˜ã€‚</p><h2 id=16-on-entry-to-sgemm-parameter-number-8-had-an-illegal-value>16. On entry to SGEMM parameter number 8 had an illegal value<a hidden class=anchor aria-hidden=true href=#16-on-entry-to-sgemm-parameter-number-8-had-an-illegal-value>#</a></h2><p>Tracing failed sanity checks!
Graphs differed across invocations!</p><p>fcçš„é—®é¢˜ï¼Œè¾“å…¥fcå’Œå¯¹åº”çš„ç½‘ç»œè¾“å…¥å±‚ä¸ä¸€è‡´ï¼Œæ£€æŸ¥é˜¶æ®µæ•°ç›®å’Œfeatureè¾“å‡ºçš„ç‰¹å¾ç»´åº¦</p><h2 id=17-cuda-error-device-side-assert-triggered-cuda-kernel-errors-might-be-asynchronously-reported-at-some-other-api-call>17. CUDA error: device-side assert triggered CUDA kernel errors might be asynchronously reported at some other API call<a hidden class=anchor aria-hidden=true href=#17-cuda-error-device-side-assert-triggered-cuda-kernel-errors-might-be-asynchronously-reported-at-some-other-api-call>#</a></h2><p>è¿™ä¸ªé—®é¢˜çš„å‡ºç°çš„æ ¹æœ¬åŸå› åœ¨äºï¼š</p><p>ç»´åº¦ä¸åŒ¹é…ï¼šæ ‡ç­¾çš„dimension è¶…å‡ºäº†å…¨è¿æ¥å±‚æœ€åè¾“å‡ºçš„dimensionï¼Œè¿™ä¸€éƒ¨åˆ†é”™è¯¯çš„è§¦å‘ï¼Œå’ŒLossçš„è®¡ç®—ï¼ŒAccçš„è®¡ç®—ï¼Œæœ‰ç€å¼ºçƒˆçš„ç›¸å…³å…³ç³»ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒç›¸å…³çš„éªŒè¯å’Œè®­ç»ƒç¯èŠ‚ï¼Œéœ€è¦ä¿æŒè®­ç»ƒæ•°æ®é›†å’ŒéªŒè¯æ•°æ®é›†åœ¨ç±»åˆ«æ•°ç›®ä¸Šçš„ä¸€è‡´æ€§ï¼Œè€Œåœ¨æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®é›†å¤–çš„æ•°æ®è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¿å…è¿›è¡ŒLossçš„è®¡ç®—ï¼Œåœ¨å¯¹Accè¿›è¡Œè®¡ç®—çš„æ—¶å€™ï¼Œä¹Ÿå°½é‡é¿å…Torchä¸­çš„è‡ªæœ‰åº“ï¼Œé¿å…äº§ç”Ÿè¯¥ç±»çš„é—®é¢˜/</p><h2 id=runtimeerror-the-derivative-for-target-is-not-implemented>RuntimeError the derivative for target is not implemented<a hidden class=anchor aria-hidden=true href=#runtimeerror-the-derivative-for-target-is-not-implemented>#</a></h2><p>é—®é¢˜é€šå¸¸å‡ºç°åœ¨æŸå¤±è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºæˆ‘ä»¬åœ¨æŸå¤±ä¸­çš„ç¬¬äºŒé¡¹ <code>targets</code>ä¸åº”è¯¥æœ‰æ¢¯åº¦ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹å´å­˜åœ¨æ¢¯åº¦å¯¼è‡´çš„.</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä»…å–å‡º <code>tensor</code>çš„<code>data</code>æˆ–è€…ä½¿ç”¨<code>detach</code>and<code>copy</code>æ¥è¿›è¡Œæ•°å€¼çš„ä¼ é€’</p><h2 id=only-tensors-created-explicitly-by-the-user-graph-leaves-support-the-deepcopy-protocol-at-the-moment>Only Tensors created explicitly by the user (graph leaves) support the deepcopy protocol at the moment<a hidden class=anchor aria-hidden=true href=#only-tensors-created-explicitly-by-the-user-graph-leaves-support-the-deepcopy-protocol-at-the-moment>#</a></h2><p>è¯¥é”™è¯¯æ˜¯ç”±deepcopyå’Œrequire_grad, require_fnåŒæ—¶æ„æˆ, å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªéœ€è¦è®¡ç®—æ¢¯åº¦çš„éå¶å­èŠ‚ç‚¹è¿›è¡Œdeepcopyå°±ä¼šè§¦å‘è¿™ä¸ªé”™è¯¯ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œå­˜å‚¨çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>save</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>feature</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span><span class=o>.</span><span class=n>numpy</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://hugotest-phi.vercel.app/tags/python/>Python</a></li><li><a href=https://hugotest-phi.vercel.app/tags/pytorch/>Pytorch</a></li></ul><nav class=paginav><a class=prev href=https://hugotest-phi.vercel.app/posts/nerualnetworktraining/><span class=title>Â« Prev</span><br><span>Training Strategy</span>
</a><a class=next href=https://hugotest-phi.vercel.app/posts/loss-whyzero/><span class=title>Next Â»</span><br><span>Loss-WhyZero</span></a></nav></footer><div id=disqus_thread></div><script>function loadDisqus(){var e=document,t=e.createElement("script");t.src="https://aiken-hugo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t),window.disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.location.href.substring(18)}}var runningOnBrowser=typeof window!="undefined",isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout(function(){if(!isBot&&supportsIntersectionObserver){var e=new IntersectionObserver(function(t){t[0].isIntersecting&&(loadDisqus(),e.disconnect())},{threshold:[0]});e.observe(document.getElementById("disqus_thread"))}else loadDisqus()},1)</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2024 <a href=https://hugotest-phi.vercel.app/>aiken's blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container>Visitors: <span id=busuanzi_value_site_uv></span>
Views: <span id=busuanzi_value_site_pv></span></span></footer><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("busuanzi_value_site_uv"),t=document.getElementById("busuanzi_value_site_pv"),o=13863,i=16993;if(!e||!t){console.error("Busuanzi elements not found.");return}const n=new MutationObserver(e=>{for(let t of e)if(t.type==="childList"){n.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML||0)+o;break}}),s=new MutationObserver(e=>{for(let t of e)if(t.type==="childList"){s.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML||0)+i;break}});n.observe(e,{childList:!0}),s.observe(t,{childList:!0})})</script><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))}),document.getElementById("theme-toggle-nav").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.js",function(){pangu.spacingPage()})</script></body></html>