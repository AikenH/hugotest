<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>破解本地自托管Emby服务 | aiken's blog</title>
<meta name=keywords content="NAS,nginx,Web,emby"><meta name=description content="Intro 问题描述
以 emby 为例，学习如何对这种自托管的服务，请求验证网站的软件进行破解，破解的整体思路分为以下的两类：

一种是改客户端，一种是改服务端。两种方式的最终原理一样，都是搭建仿冒认证服务器，客户端访问伪服务器拿到授权信息；【3】

因此无论是那种方法我们都需要搭建伪验证服务器：所以以下的操作是必须的：

抓取定位到验证服务器的地址，并获取验证服务器返回的验证信息格式；
使用 Nginx 搭建虚拟的验证服务器，使其返回激活/验证信息；

如果是修改客户端，则在搭建完验证站后需要：

修改 Host 文件，将请求验证服务器的请求劫持到本地搭建的服务上；
需要伪服务器和客户端都要安装自签名证书

如果是修改服务端，则后续需要：

修改服务端源文件，将默认的认证服务器 mb3admin.com 地址直接改成伪服务器
这样就不需要安装自签名证书

如果是使用 Docker 进行部署的 emby 可以使用别人修改好的服务端的镜像进行部署安装（like 开心版）
本文主要介绍验证服务器的搭建、修改客户端的方法，以及一些其他的注意事项；"><meta name=author content="aikenhong"><link rel=canonical href=https://aikenh.cn/hugotest/posts/emby_localhost_crack_by_nginx/><link crossorigin=anonymous href=/hugotest/assets/css/stylesheet.2f85ca17c12c62fa86b1e474b8a51aca4856f0d645debfe4922a4d5ddc6aa978.css integrity="sha256-L4XKF8EsYvqGseR0uKUaykhW8NZF3r/kkipNXdxqqXg=" rel="preload stylesheet" as=style><link rel=icon href=https://aikenh.cn/favicon/ghost.ico><link rel=icon type=image/png sizes=16x16 href=https://aikenh.cn/favicon/ghost-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aikenh.cn/favicon/ghost-32x32.png><link rel=apple-touch-icon href=https://aikenh.cn/favicon/ghost-apple-touch-icon.png><link rel=mask-icon href=https://aikenh.cn/favicon/ghost-192x192.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aikenh.cn/hugotest/posts/emby_localhost_crack_by_nginx/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://cdn.jsdmirror.com/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdmirror.com/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdmirror.com/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.css><script defer src=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.js></script><script defer src=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-tc-webfont@1.0.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel=stylesheet><meta property="og:url" content="https://aikenh.cn/hugotest/posts/emby_localhost_crack_by_nginx/"><meta property="og:site_name" content="aiken's blog"><meta property="og:title" content="破解本地自托管Emby服务"><meta property="og:description" content="Intro 问题描述 以 emby 为例，学习如何对这种自托管的服务，请求验证网站的软件进行破解，破解的整体思路分为以下的两类：
一种是改客户端，一种是改服务端。两种方式的最终原理一样，都是搭建仿冒认证服务器，客户端访问伪服务器拿到授权信息；【3】
因此无论是那种方法我们都需要搭建伪验证服务器：所以以下的操作是必须的：
抓取定位到验证服务器的地址，并获取验证服务器返回的验证信息格式； 使用 Nginx 搭建虚拟的验证服务器，使其返回激活/验证信息； 如果是修改客户端，则在搭建完验证站后需要：
修改 Host 文件，将请求验证服务器的请求劫持到本地搭建的服务上； 需要伪服务器和客户端都要安装自签名证书 如果是修改服务端，则后续需要：
修改服务端源文件，将默认的认证服务器 mb3admin.com 地址直接改成伪服务器 这样就不需要安装自签名证书 如果是使用 Docker 进行部署的 emby 可以使用别人修改好的服务端的镜像进行部署安装（like 开心版）
本文主要介绍验证服务器的搭建、修改客户端的方法，以及一些其他的注意事项；"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-10T14:05:15+00:00"><meta property="article:modified_time" content="2023-11-10T14:05:15+00:00"><meta property="article:tag" content="NAS"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="Web"><meta property="article:tag" content="Emby"><meta property="og:image" content="https://aikenh.cn/cover/cover12.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aikenh.cn/cover/cover12.jpeg"><meta name=twitter:title content="破解本地自托管Emby服务"><meta name=twitter:description content="Intro 问题描述
以 emby 为例，学习如何对这种自托管的服务，请求验证网站的软件进行破解，破解的整体思路分为以下的两类：

一种是改客户端，一种是改服务端。两种方式的最终原理一样，都是搭建仿冒认证服务器，客户端访问伪服务器拿到授权信息；【3】

因此无论是那种方法我们都需要搭建伪验证服务器：所以以下的操作是必须的：

抓取定位到验证服务器的地址，并获取验证服务器返回的验证信息格式；
使用 Nginx 搭建虚拟的验证服务器，使其返回激活/验证信息；

如果是修改客户端，则在搭建完验证站后需要：

修改 Host 文件，将请求验证服务器的请求劫持到本地搭建的服务上；
需要伪服务器和客户端都要安装自签名证书

如果是修改服务端，则后续需要：

修改服务端源文件，将默认的认证服务器 mb3admin.com 地址直接改成伪服务器
这样就不需要安装自签名证书

如果是使用 Docker 进行部署的 emby 可以使用别人修改好的服务端的镜像进行部署安装（like 开心版）
本文主要介绍验证服务器的搭建、修改客户端的方法，以及一些其他的注意事项；"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aikenh.cn/hugotest/posts/"},{"@type":"ListItem","position":2,"name":"破解本地自托管Emby服务","item":"https://aikenh.cn/hugotest/posts/emby_localhost_crack_by_nginx/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"破解本地自托管Emby服务","name":"破解本地自托管Emby服务","description":"Intro 问题描述 以 emby 为例，学习如何对这种自托管的服务，请求验证网站的软件进行破解，破解的整体思路分为以下的两类：\n一种是改客户端，一种是改服务端。两种方式的最终原理一样，都是搭建仿冒认证服务器，客户端访问伪服务器拿到授权信息；【3】\n因此无论是那种方法我们都需要搭建伪验证服务器：所以以下的操作是必须的：\n抓取定位到验证服务器的地址，并获取验证服务器返回的验证信息格式； 使用 Nginx 搭建虚拟的验证服务器，使其返回激活/验证信息； 如果是修改客户端，则在搭建完验证站后需要：\n修改 Host 文件，将请求验证服务器的请求劫持到本地搭建的服务上； 需要伪服务器和客户端都要安装自签名证书 如果是修改服务端，则后续需要：\n修改服务端源文件，将默认的认证服务器 mb3admin.com 地址直接改成伪服务器 这样就不需要安装自签名证书 如果是使用 Docker 进行部署的 emby 可以使用别人修改好的服务端的镜像进行部署安装（like 开心版）\n本文主要介绍验证服务器的搭建、修改客户端的方法，以及一些其他的注意事项；\n","keywords":["NAS","nginx","Web","emby"],"articleBody":"Intro 问题描述 以 emby 为例，学习如何对这种自托管的服务，请求验证网站的软件进行破解，破解的整体思路分为以下的两类：\n一种是改客户端，一种是改服务端。两种方式的最终原理一样，都是搭建仿冒认证服务器，客户端访问伪服务器拿到授权信息；【3】\n因此无论是那种方法我们都需要搭建伪验证服务器：所以以下的操作是必须的：\n抓取定位到验证服务器的地址，并获取验证服务器返回的验证信息格式； 使用 Nginx 搭建虚拟的验证服务器，使其返回激活/验证信息； 如果是修改客户端，则在搭建完验证站后需要：\n修改 Host 文件，将请求验证服务器的请求劫持到本地搭建的服务上； 需要伪服务器和客户端都要安装自签名证书 如果是修改服务端，则后续需要：\n修改服务端源文件，将默认的认证服务器 mb3admin.com 地址直接改成伪服务器 这样就不需要安装自签名证书 如果是使用 Docker 进行部署的 emby 可以使用别人修改好的服务端的镜像进行部署安装（like 开心版）\n本文主要介绍验证服务器的搭建、修改客户端的方法，以及一些其他的注意事项；\nServer 伪验证服务器搭建 CA 证书申请 什么是证书：什么是 SSL 认证？- SSL/TLS 认证简介 - AWS (amazon.com) 这里由于我们并没有真正拥有认证网站 md3admin 的域名故而没有对应的证书文件，因此需要为自己的服务自签发一个假的证书文件，并手动让浏览器信任该证书，保证在将该域名通过 hosts 修改转移到自己的服务上时，浏览器能正常请求该页面。\n下面介绍证书的签发过程（转载自参考文献:【2】)：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -p //nginx/cert/mb3admin.com \u0026\u0026 cd //nginx/cert/mb3admin.com # 生成 CA 密钥 openssl genrsa -out ca.key 2048 # 生成 CA 证书 openssl req -x509 -new -nodes -key ca.key -subj \"/C=CN/ST=Beijing/L=Beijing/O=/OU=/CN=/emailAddress=\" -days 36500 -out ca.crt # 将 CA 转换成 p12 格式，并指定密码 （） openssl pkcs12 -export -clcerts -in ./ca.crt -inkey ca.key -out ca.p12 -password pass: # 将 p12 格式的证书 Base64 编码 base64 ca.p12 # Base64 一行不能超过 76 字符，超过则添加回车换行符。如果因为换行的原因，不能安装证书，可以使用 -w 参数 base64 -w 0 ca.p12 # 将 CA 转换成 pem 格式 openssl x509 -outform pem -in ca.crt -out ca.pem # 生成服务端私钥 server.key openssl genrsa -out server.key 2048 # 生成服务端证书请求 server.csr openssl req -new -sha256 -key server.key -out server.csr -subj \"/C=CN/L=Beijing/O=/OU=/CN=mb3admin.com/CN=*.mb3admin.com\" # 生成服务端证书 server.crt openssl x509 -req -extfile \u003c(printf \"subjectAltName=DNS:mb3admin.com,DNS:*.mb3admin.com\") -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt 上述代码中替换一下自己的相关信息即可（也可以直接去参考资源中获取直接执行的代码）：\n\\ \\ \\ 生成对应证书后，对证书的操作还有以下的两步，我们首先介绍证书安装，在对 Nginx 进行配置。\nNginx 配置：将 server.crt 和 server.key 放到 nginx 存放的地方，方便后面配置 Nginx 证书安装：便于浏览器后续正常访问 证书安装 双击打开证书目录中的 crt 进行证书安装，会显示“无法验证到一个受信任的证书颁发机构”，这是因为我们只是自签发并没有找第三方机构认证，不要紧直接安装即可。\n没有安装证书的情况下也可能会发现验证信息正确但是激活失败的情况\n这里简单介绍以下 ubuntu 信任证书的方法【2】（nas 和 ios 可参考该文）\n1 sudo cp ca.crt /usr/local/share/ca-certificates/zhuangzhuang.crt \u0026\u0026 sudo update-ca-certificates Nginx 设置 Nginx 可以直接在 conf.d/default.conf 中新增以下代码片段\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 server { listen 443 ssl; listen [::]:443 ssl; server_name mb3admin.com; ssl_certificate /etc/nginx/cert/mb3admin.com/server.crt; ssl_certificate_key /etc/nginx/cert/mb3admin.com/server.key; ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Headers *; add_header Access-Control-Allow-Method *; add_header Access-Control-Allow-Credentials true; location /admin/service/registration/validateDevice { default_type application/json; return 200 '{\"cacheExpirationDays\": 365,\"message\": \"Device Valid\",\"resultCode\": \"GOOD\"}'; } location /admin/service/registration/validate { default_type application/json; return 200 '{\"featId\":\"\",\"registered\":true,\"expDate\":\"2099-01-01\",\"key\":\"\"}'; } location /admin/service/registration/getStatus { default_type application/json; return 200 '{\"deviceStatus\":\"0\",\"planType\":\"Lifetime\",\"subscriptions\":{}}'; } location /emby/Plugins/SecurityInfo { default_type application/json; return 200 '{\"SupporterKey\": \"\", \"IsMBSupporter\": true}'; } } 可以看到其中最为关键的是以下的几个点：\n设置好 servername 为验证网址的域名 mb3admin.com; 将以下的域名子路径都设置为返回对应的验证信息 /admin/service/registration/validateDevice /admin/service/registration/validate /admin/service/registration/getStatus /emby/Plugins/SecurityInfo ssl_certificate 和 ssl_certificate_key 填写好对应的证书文件地址存放地址 Hosts 文件修改 linux 修改 host 文件地址：/etc/hosts\n1 sudo echo \" \" \u003e\u003e /etc/hosts Windows 修改 host 文件地址：C:\\Windows\\System32\\drivers\\etc\\hosts\n1 2 .... 修改完立即刷新 dns 不需重启立即生效的方法,在 powershell 执行：\n1 ipconfig /flushdns Test 服务测试 完成上面的服务和 Host 修改后，可以登录对应的网站进行测试或者使用 curl 进行测试：\n可以通过浏览器访问： https://mb3admin.com/admin/service/registration/validateDevice/ 或者 https://mb3admin.com/admin/service/registration/validate/ 查看返回信息是否正确；\n或者在 powershell 中执行以下命令查看返回信息是否正确，这里需要注意的是可能会与 WSL2 部署的 docker 混淆，但是该指令是否生效我们还是要在宿主机上的 powershell 查看。\n1 curl -ik https://mb3admin.com/admin/service/registration/validateDevice/ -k 参数是为了忽略证书不受信任的 https 访问安全限制导致访问失败的问题。例如如下相关报错\n1 \u003e Curl(60) issuer certificate is invalid 如果使用 curl 能够正常返回，但是网页的返回信息有误，或者无法打开网页，可能就要考虑如下的原因：\n证书信任问题，可能要看是否正确配置和安装相关证书 浏览器缓存问题，可以使用隐私(InPrivate)模式再次访问,或者清楚缓存后再次访问； 代理的问题，具体的配置如下 Clash 代理配置 若是由于设置了代理导致网站测试失败，这种情况下可以关掉代理再做测试，或者新增规则，配置验证网址不走代理。\n配置规则的方法以 Clash 为例如下：\n1 2 3 4 5 parsers: # array - url: \u003c你的订阅地址\u003e yaml: prepend-rules: - DOMAIN-SUFFIX,\u003c直连的域名\u003e,DIRECT 添加 DOMAIN-SUFFIX 设置对应的域名为直链即可；\nActivate 激活 访问 emby 服务页面，在 emby premiere 选单中随便选取密钥存储即可，这里会显示无效的密钥但是不要紧，可以切换主题看看是否已经激活成功。\n或者在控制台界面看是否已经有金标即可：\nIOS 使用小火箭解锁 emby 详细图文请访问参考资料【5】，下面是简单的摘要：\n第一步 default.conf（长按） -\u003e 编辑纯文本，将以下代码贴到底部：\n1 2 3 4 [Script] EmbyPremiere = type=http-response,script-path=https://raw.githubusercontent.com/rartv/SurgeScript/main/EmbyPremiere/EmbyPremiere.js,pattern=^https?:\\/\\/mb3admin.com\\/admin\\/service\\/registration\\/validateDevice,max-size=131072,requires-body=true,timeout=10,enable=true [MITM] hostname = mb3admin.com 第二步 default.conf（右侧的 i 按钮） -\u003e https解密 （界面中应该会有 mb3admin.com 的域名信息）-\u003e 证书-\u003e 生成新的 CA 证书 -\u003e 安装证书 -\u003e 系统中信任证书\n第三步打开 vpn，打开 emby，信任证书选择 ok，激活完成后可以关闭小火箭，后续失效的时候再打开一次即可。\nRef 参考资料 群晖上利用现有nginx搭建emby破解服务 (lengyue524) Nas Emby 伪验证服务站搭建 - ZHUANGZHUANG 学习 Emby 解锁及优化 - Gallen’s Blog (hgl2.com) Emby全平台开心版、认证服务器设置方法 | Velaciela iOS利用小火箭解锁Emby | 胡萝虎的博客 (huluohu.com) Fi","wordCount":"533","inLanguage":"en","image":"https://aikenh.cn/cover/cover12.jpeg","datePublished":"2023-11-10T14:05:15Z","dateModified":"2023-11-10T14:05:15Z","author":[{"@type":"Person","name":"aikenhong"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://aikenh.cn/hugotest/posts/emby_localhost_crack_by_nginx/"},"publisher":{"@type":"Organization","name":"aiken's blog","logo":{"@type":"ImageObject","url":"https://aikenh.cn/favicon/ghost.ico"}}}</script></head><body id=top><script type=module src=https://cdn.jsdmirror.com/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js defer></script><script nomodule src=https://cdn.jsdmirror.com/npm/ionicons@7.1.0/dist/ionicons/ionicons.js defer></script><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aikenh.cn/hugotest/ accesskey=h title="aiken's blog (Alt + H)">aiken's blog</a><div class=logo-switches><button id=theme-toggle-nav accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aikenh.cn/hugotest/ title=home><span>home</span></a></li><li><a href=https://aikenh.cn/hugotest/posts/ title=posts><span>posts</span></a></li><li><a href=https://aikenh.cn/hugotest/tags/ title=tags><span>tags</span></a></li><li><a href=https://aikenh.cn/hugotest/categories/ title=categories><span>categories</span></a></li><li><a href=https://aikenh.cn/hugotest/archives/ title=archives><span>archives</span></a></li><li><a href=https://aikenh.cn/hugotest/about/ title=about><span>about</span></a></li><li><a href=https://aikenh.cn/hugotest/search title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><div class=sidebar><ul><li class=logo style=--bg:#333><a href=#><div class=logo-icon><img src=/logo/logo.png></div><div class=logo-text>Aiken's Blog</div></a></li><div class=menulist><li style=--bg:#f44336><a href=https://aikenh.cn/hugotest/ title=home><div class=logo-icon><ion-icon name=home-outline></ion-icon></div><div class=logo-text>home</div></a></li><li style=--bg:#b145e9><a href=https://aikenh.cn/hugotest/posts/ title=posts><div class=logo-icon><ion-icon name=newspaper-outline></ion-icon></div><div class=logo-text>posts</div></a></li><li style=--bg:#0f93c7><a href=https://aikenh.cn/hugotest/tags/ title=tags><div class=logo-icon><ion-icon name=pricetags-outline></ion-icon></div><div class=logo-text>tags</div></a></li><li style=--bg:#ffa117><a href=https://aikenh.cn/hugotest/categories/ title=categories><div class=logo-icon><ion-icon name=grid-outline></ion-icon></div><div class=logo-text>categories</div></a></li><li style=--bg:#0fc70f><a href=https://aikenh.cn/hugotest/archives/ title=archives><div class=logo-icon><ion-icon name=folder-outline></ion-icon></div><div class=logo-text>archives</div></a></li><li style=--bg:#d16111><a href=https://aikenh.cn/hugotest/about/ title=about><div class=logo-icon><ion-icon name=person></ion-icon></div><div class=logo-text>about</div></a></li><li style=--bg:#15c095><a href=https://aikenh.cn/hugotest/search title="search (Alt + /)" accesskey=/><div class=logo-icon><ion-icon name=search></ion-icon></div><div class=logo-text>search</div></a></li></div><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt +T)"><li><div class=logo-icon id=moon><ion-icon name=moon-outline></ion-icon></div><div class=logo-icon id=sun><ion-icon name=sunny-outline></ion-icon></div></li></button></div></ul></div><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aikenh.cn/hugotest/>Home</a>&nbsp;»&nbsp;<a href=https://aikenh.cn/hugotest/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">破解本地自托管Emby服务</h1><div class=post-meta><span title='2023-11-10 14:05:15 +0000 UTC'>November 10, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;533 words&nbsp;·&nbsp;aikenhong&nbsp;·&nbsp;<a href=/tags/nas> NAS</a>&nbsp;·&nbsp;<a href=/tags/nginx> nginx</a>&nbsp;·&nbsp;<a href=/tags/web> Web</a>&nbsp;·&nbsp;<a href=/tags/emby> emby</a>&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/emby_localhost_crack_by_nginx.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://aikenh.cn/cover/cover12.jpeg alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#intro-%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0 aria-label="Intro 问题描述">Intro 问题描述</a></li><li><a href=#server-%e4%bc%aa%e9%aa%8c%e8%af%81%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%90%ad%e5%bb%ba aria-label="Server 伪验证服务器搭建">Server 伪验证服务器搭建</a><ul class=header-level-2><li><a href=#ca-%e8%af%81%e4%b9%a6%e7%94%b3%e8%af%b7 aria-label="CA 证书申请">CA 证书申请</a></li><li><a href=#%e8%af%81%e4%b9%a6%e5%ae%89%e8%a3%85 aria-label=证书安装>证书安装</a></li><li><a href=#nginx-%e8%ae%be%e7%bd%ae aria-label="Nginx 设置">Nginx 设置</a></li><li><a href=#hosts-%e6%96%87%e4%bb%b6%e4%bf%ae%e6%94%b9 aria-label="Hosts 文件修改">Hosts 文件修改</a></li></ul></li><li><a href=#test-%e6%9c%8d%e5%8a%a1%e6%b5%8b%e8%af%95 aria-label="Test 服务测试">Test 服务测试</a><ul class=header-level-2><li><a href=#clash-%e4%bb%a3%e7%90%86%e9%85%8d%e7%bd%ae aria-label="Clash 代理配置">Clash 代理配置</a></li><li><a href=#activate-%e6%bf%80%e6%b4%bb aria-label="Activate 激活">Activate 激活</a></li></ul></li><li><a href=#ios-%e4%bd%bf%e7%94%a8%e5%b0%8f%e7%81%ab%e7%ae%ad%e8%a7%a3%e9%94%81-emby aria-label="IOS 使用小火箭解锁 emby">IOS 使用小火箭解锁 emby</a></li><li><a href=#ref-%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label="Ref 参考资料">Ref 参考资料</a></li><li><a href=#fi aria-label=Fi>Fi</a></li></ul></div></details></div></aside><script>let activeElement,elements;document.addEventListener("DOMContentLoaded",function(){if(checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),elements.length>0){activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")}const t=document.getElementById("top-link");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{const e=window.pageYOffset||document.documentElement.scrollTop;if(e===0)return;elements&&elements.length>0&&(elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase(),n=document.querySelector(`.inner ul li a[href="#${t}"]`);n.classList.remove("read")}),activeElement=Array.from(elements).find(t=>{if(getOffsetTop(t)-e>0&&getOffsetTop(t)-e<window.innerHeight/2)return t})||activeElement,elements.forEach((t)=>{const o=encodeURI(t.getAttribute("id")).toLowerCase(),s=document.querySelector(`.inner ul li a[href="#${o}"]`);if(t===activeElement){s.classList.add("active");const e=document.querySelector(".toc .inner"),t=s.offsetTop,n=e.clientHeight,o=s.clientHeight,i=t-n/2+o/2;e.scrollTo({top:i,behavior:"smooth"})}else getOffsetTop(t)<e&&s.classList.add("read"),s.classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return!document.querySelector(".hugo-encryptor-prompt")&&elements.length!=0&&(elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),console.log("Elements re-queried:",elements)),0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=intro-问题描述>Intro 问题描述<a hidden class=anchor aria-hidden=true href=#intro-问题描述>#</a></h2><p>以 emby 为例，学习如何对这种自托管的服务，请求验证网站的软件进行破解，破解的整体思路分为以下的两类：</p><blockquote><p>一种是改客户端，一种是改服务端。两种方式的最终原理一样，都是搭建仿冒认证服务器，客户端访问伪服务器拿到授权信息；【3】</p></blockquote><p>因此无论是那种方法我们都需要搭建伪验证服务器：所以以下的操作是必须的：</p><ol><li>抓取定位到验证服务器的地址，并获取验证服务器返回的验证信息格式；</li><li>使用 Nginx 搭建虚拟的验证服务器，使其返回激活/验证信息；</li></ol><p>如果是<strong>修改客户端</strong>，则在搭建完验证站后需要：</p><ul><li>修改 Host 文件，将请求验证服务器的请求劫持到本地搭建的服务上；</li><li>需要伪服务器和客户端都要安装自签名证书</li></ul><p>如果是<strong>修改服务端</strong>，则后续需要：</p><ul><li>修改服务端源文件，将默认的认证服务器 mb3admin.com 地址直接改成伪服务器</li><li>这样就<strong>不需要安装自签名证书</strong></li></ul><p>如果是使用 Docker 进行部署的 emby 可以使用别人修改好的服务端的镜像进行部署安装（like 开心版）</p><p>本文主要介绍验证服务器的搭建、修改客户端的方法，以及一些其他的注意事项；</p><h2 id=server-伪验证服务器搭建>Server 伪验证服务器搭建<a hidden class=anchor aria-hidden=true href=#server-伪验证服务器搭建>#</a></h2><h3 id=ca-证书申请>CA 证书申请<a hidden class=anchor aria-hidden=true href=#ca-证书申请>#</a></h3><blockquote><p>什么是证书：<a href=https://aws.amazon.com/cn/what-is/ssl-certificate/ target=_blank rel=noopener>什么是 SSL 认证？- SSL/TLS 认证简介 - AWS (amazon.com)</a></p></blockquote><p>这里由于我们并没有真正拥有认证网站 md3admin 的域名故而没有对应的证书文件，因此需要为自己的服务自签发一个假的证书文件，并手动让浏览器信任该证书，保证在将该域名通过 hosts 修改转移到自己的服务上时，浏览器能正常请求该页面。</p><p>下面介绍证书的签发过程（转载自参考文献:【2】)：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p &lt;username&gt;/&lt;docker-file-path&gt;/nginx/cert/mb3admin.com <span class=o>&amp;&amp;</span> <span class=nb>cd</span> &lt;username&gt;/&lt;docker-file-path&gt;/nginx/cert/mb3admin.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成 CA 密钥</span>
</span></span><span class=line><span class=cl>openssl genrsa -out ca.key <span class=m>2048</span> 
</span></span><span class=line><span class=cl><span class=c1># 生成 CA 证书</span>
</span></span><span class=line><span class=cl>openssl req -x509 -new -nodes -key ca.key -subj <span class=s2>&#34;/C=CN/ST=Beijing/L=Beijing/O=&lt;username&gt;/OU=&lt;username&gt;/CN=&lt;username&gt;/emailAddress=&lt;user-email&gt;&#34;</span> -days <span class=m>36500</span> -out ca.crt
</span></span><span class=line><span class=cl><span class=c1># 将 CA 转换成 p12 格式，并指定密码 （&lt;username&gt;）</span>
</span></span><span class=line><span class=cl>openssl pkcs12 -export -clcerts -in ./ca.crt -inkey ca.key -out ca.p12 -password pass:&lt;username&gt;
</span></span><span class=line><span class=cl><span class=c1># 将 p12 格式的证书 Base64 编码</span>
</span></span><span class=line><span class=cl>base64 ca.p12
</span></span><span class=line><span class=cl><span class=c1># Base64 一行不能超过 76 字符，超过则添加回车换行符。如果因为换行的原因，不能安装证书，可以使用 -w 参数</span>
</span></span><span class=line><span class=cl>base64 -w <span class=m>0</span> ca.p12
</span></span><span class=line><span class=cl><span class=c1># 将 CA 转换成 pem 格式</span>
</span></span><span class=line><span class=cl>openssl x509 -outform pem -in ca.crt -out ca.pem
</span></span><span class=line><span class=cl><span class=c1># 生成服务端私钥 server.key</span>
</span></span><span class=line><span class=cl>openssl genrsa -out server.key <span class=m>2048</span>
</span></span><span class=line><span class=cl><span class=c1># 生成服务端证书请求 server.csr</span>
</span></span><span class=line><span class=cl>openssl req -new -sha256 -key server.key -out server.csr -subj <span class=s2>&#34;/C=CN/L=Beijing/O=&lt;username&gt;/OU=&lt;username&gt;/CN=mb3admin.com/CN=*.mb3admin.com&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 生成服务端证书 server.crt</span>
</span></span><span class=line><span class=cl>openssl x509 -req -extfile &lt;<span class=o>(</span><span class=nb>printf</span> <span class=s2>&#34;subjectAltName=DNS:mb3admin.com,DNS:*.mb3admin.com&#34;</span><span class=o>)</span> -days <span class=m>3650</span> -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt
</span></span></code></pre></td></tr></table></div></div><p>上述代码中替换一下自己的相关信息即可（也可以直接去参考资源中获取直接执行的代码）：</p><ul><li><code>\&lt;username\></code></li><li><code>\&lt;user-email\></code></li><li><code>\&lt;docker-file-path\></code></li></ul><p>生成对应证书后，对证书的操作还有以下的两步，我们首先介绍证书安装，在对 Nginx 进行配置。</p><ul><li>Nginx 配置：将 server.crt 和 server.key 放到 nginx 存放的地方，方便后面配置 Nginx</li><li>证书安装：便于浏览器后续正常访问</li></ul><h3 id=证书安装>证书安装<a hidden class=anchor aria-hidden=true href=#证书安装>#</a></h3><p>双击打开证书目录中的 crt 进行证书安装，会显示“无法验证到一个受信任的证书颁发机构”，这是因为我们只是自签发并没有找第三方机构认证，不要紧直接安装即可。</p><blockquote><p>没有安装证书的情况下也可能会发现验证信息正确但是激活失败的情况</p></blockquote><p>这里简单介绍以下 ubuntu 信任证书的方法【2】（nas 和 ios 可参考该文）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo cp ca.crt /usr/local/share/ca-certificates/zhuangzhuang.crt <span class=o>&amp;&amp;</span> sudo update-ca-certificates
</span></span></code></pre></td></tr></table></div></div><h3 id=nginx-设置>Nginx 设置<a hidden class=anchor aria-hidden=true href=#nginx-设置>#</a></h3><p>Nginx 可以直接在 conf.d/default.conf 中新增以下代码片段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>listen</span> <span class=err>443</span> <span class=err>ssl;</span>
</span></span><span class=line><span class=cl>    <span class=err>listen</span> <span class=err>[::]:443</span> <span class=err>ssl;</span>
</span></span><span class=line><span class=cl>    <span class=err>server_name</span> <span class=err>mb3admin.com;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>ssl_certificate</span> <span class=err>/etc/nginx/cert/mb3admin.com/server.crt;</span>
</span></span><span class=line><span class=cl>    <span class=err>ssl_certificate_key</span> <span class=err>/etc/nginx/cert/mb3admin.com/server.key;</span>
</span></span><span class=line><span class=cl>	<span class=err>ssl_session_timeout</span> <span class=err>5m;</span>
</span></span><span class=line><span class=cl>    <span class=err>ssl_protocols</span> <span class=err>TLSv1</span> <span class=err>TLSv1.1</span> <span class=err>TLSv1.2;</span>
</span></span><span class=line><span class=cl>    <span class=err>ssl_ciphers</span> <span class=err>ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span>
</span></span><span class=line><span class=cl>    <span class=err>ssl_prefer_server_ciphers</span> <span class=err>on;</span>
</span></span><span class=line><span class=cl>    <span class=err>add_header</span> <span class=err>Access-Control-Allow-Origin</span> <span class=err>*;</span>
</span></span><span class=line><span class=cl>    <span class=err>add_header</span> <span class=err>Access-Control-Allow-Headers</span> <span class=err>*;</span>
</span></span><span class=line><span class=cl>    <span class=err>add_header</span> <span class=err>Access-Control-Allow-Method</span> <span class=err>*;</span>
</span></span><span class=line><span class=cl>    <span class=err>add_header</span> <span class=err>Access-Control-Allow-Credentials</span> <span class=err>true;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>location</span> <span class=err>/admin/service/registration/validateDevice</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>        <span class=err>default_type</span> <span class=err>application/json;</span>
</span></span><span class=line><span class=cl>        <span class=err>return</span> <span class=err>200</span> <span class=err>&#39;{</span><span class=nt>&#34;cacheExpirationDays&#34;</span><span class=p>:</span> <span class=mi>365</span><span class=p>,</span><span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Device Valid&#34;</span><span class=p>,</span><span class=nt>&#34;resultCode&#34;</span><span class=p>:</span> <span class=s2>&#34;GOOD&#34;</span><span class=p>}</span><span class=err>&#39;;</span>
</span></span><span class=line><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>location</span> <span class=err>/admin/service/registration/validate</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>default_type</span> <span class=err>application/json;</span>
</span></span><span class=line><span class=cl>        <span class=err>return</span> <span class=err>200</span> <span class=err>&#39;{</span><span class=nt>&#34;featId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;registered&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;expDate&#34;</span><span class=p>:</span><span class=s2>&#34;2099-01-01&#34;</span><span class=p>,</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}</span><span class=err>&#39;;</span>
</span></span><span class=line><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>location</span> <span class=err>/admin/service/registration/getStatus</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>default_type</span> <span class=err>application/json;</span>
</span></span><span class=line><span class=cl>        <span class=err>return</span> <span class=err>200</span> <span class=err>&#39;{</span><span class=nt>&#34;deviceStatus&#34;</span><span class=p>:</span><span class=s2>&#34;0&#34;</span><span class=p>,</span><span class=nt>&#34;planType&#34;</span><span class=p>:</span><span class=s2>&#34;Lifetime&#34;</span><span class=p>,</span><span class=nt>&#34;subscriptions&#34;</span><span class=p>:{}}</span><span class=err>&#39;;</span>
</span></span><span class=line><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=err>location</span> <span class=err>/emby/Plugins/SecurityInfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>default_type</span> <span class=err>application/json;</span>
</span></span><span class=line><span class=cl>        <span class=err>return</span> <span class=err>200</span> <span class=err>&#39;{</span><span class=nt>&#34;SupporterKey&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nt>&#34;IsMBSupporter&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>}</span><span class=err>&#39;;</span>
</span></span><span class=line><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到其中最为关键的是以下的几个点：</p><ol><li>设置好 servername 为验证网址的域名 mb3admin.com;</li><li>将以下的域名子路径都设置为返回对应的验证信息</li></ol><ul><li><code>/admin/service/registration/validateDevice</code></li><li><code>/admin/service/registration/validate</code></li><li><code>/admin/service/registration/getStatus</code></li><li><code>/emby/Plugins/SecurityInfo</code></li></ul><ol start=3><li>ssl_certificate 和 ssl_certificate_key 填写好对应的证书文件地址存放地址</li></ol><h3 id=hosts-文件修改>Hosts 文件修改<a hidden class=anchor aria-hidden=true href=#hosts-文件修改>#</a></h3><p>linux 修改 host 文件地址：<code>/etc/hosts</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo <span class=nb>echo</span> <span class=s2>&#34;&lt;server_ip&gt;    &lt;domain_address&gt;&#34;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></td></tr></table></div></div><p>Windows 修改 host 文件地址：<code>C:\Windows\System32\drivers\etc\hosts</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>&lt;server_ip&gt; &lt;domain_address&gt;
</span></span></code></pre></td></tr></table></div></div><p>修改完立即刷新 dns 不需重启立即生效的方法,在 powershell 执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>ipconfig</span> <span class=p>/</span><span class=n>flushdns</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=test-服务测试>Test 服务测试<a hidden class=anchor aria-hidden=true href=#test-服务测试>#</a></h2><p>完成上面的服务和 Host 修改后，可以登录对应的网站进行测试或者使用 curl 进行测试：</p><p>可以通过浏览器访问： <a href=https://mb3admin.com/admin/service/registration/validateDevice/ target=_blank rel=noopener>https://mb3admin.com/admin/service/registration/validateDevice/</a>
或者 <a href=https://mb3admin.com/admin/service/registration/validate/ target=_blank rel=noopener>https://mb3admin.com/admin/service/registration/validate/</a>
查看返回信息是否正确；</p><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112095033.png><img alt=image.png loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112095033.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112095033.png style="display:block;margin:0 auto" alt=image.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p>或者在 <strong>powershell</strong> 中执行以下命令查看返回信息是否正确，这里需要注意的是可能会与 WSL2 部署的 docker 混淆，但是该指令是否生效我们还是要在宿主机上的 powershell 查看。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>curl </span><span class=n>-ik</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>mb3admin</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>admin</span><span class=p>/</span><span class=n>service</span><span class=p>/</span><span class=n>registration</span><span class=p>/</span><span class=n>validateDevice</span><span class=p>/</span>
</span></span></code></pre></td></tr></table></div></div><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112095026.png><img alt=image.png loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112095026.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112095026.png style="display:block;margin:0 auto" alt=image.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p><code>-k</code> 参数是为了忽略<strong>证书不受信任的 https 访问安全限制</strong>导致访问失败的问题。例如如下相关报错</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>&gt; Curl(60) issuer certificate is invalid 
</span></span></code></pre></td></tr></table></div></div><p>如果使用 curl 能够正常返回，但是网页的返回信息有误，或者无法打开网页，可能就要考虑如下的原因：</p><ul><li><strong>证书信任问题</strong>，可能要看是否正确配置和安装相关证书</li><li><strong>浏览器缓存问题</strong>，可以使用隐私(InPrivate)模式再次访问,或者清楚缓存后再次访问；</li><li><strong>代理的问题</strong>，具体的配置如下</li></ul><h3 id=clash-代理配置>Clash 代理配置<a hidden class=anchor aria-hidden=true href=#clash-代理配置>#</a></h3><p>若是由于设置了代理导致网站测试失败，这种情况下可以关掉代理再做测试，或者新增规则，配置验证网址不走代理。</p><p>配置规则的方法以 Clash 为例如下：</p><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231111161114.png><img alt=image.png loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231111161114.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231111161114.png style="display:block;margin:0 auto" alt=image.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>parsers: # array
</span></span><span class=line><span class=cl>    - url: &lt;你的订阅地址&gt;
</span></span><span class=line><span class=cl>      yaml:
</span></span><span class=line><span class=cl>        prepend-rules:
</span></span><span class=line><span class=cl>            - DOMAIN-SUFFIX,&lt;直连的域名&gt;,DIRECT
</span></span></code></pre></td></tr></table></div></div><p>添加 DOMAIN-SUFFIX 设置对应的域名为直链即可；</p><h3 id=activate-激活>Activate 激活<a hidden class=anchor aria-hidden=true href=#activate-激活>#</a></h3><p>访问 emby 服务页面，在 <code>emby premiere</code> 选单中随便选取密钥存储即可，这里会显示无效的密钥但是不要紧，可以切换主题看看是否已经激活成功。</p><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112100556.png><img alt=image.png loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112100556.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112100556.png style="display:block;margin:0 auto" alt=image.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p>或者在控制台界面看是否已经有金标即可：</p><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112100635.png><img alt=image.png loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112100635.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20231112100635.png style="display:block;margin:0 auto" alt=image.png></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><h2 id=ios-使用小火箭解锁-emby>IOS 使用小火箭解锁 emby<a hidden class=anchor aria-hidden=true href=#ios-使用小火箭解锁-emby>#</a></h2><p>详细图文请访问参考资料【5】，下面是简单的摘要：</p><p>第一步 default.conf（长按） -> 编辑纯文本，将以下代码贴到底部：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>Script<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>EmbyPremiere</span> <span class=o>=</span> <span class=nv>type</span><span class=o>=</span>http-response,script-path<span class=o>=</span>https://raw.githubusercontent.com/rartv/SurgeScript/main/EmbyPremiere/EmbyPremiere.js,pattern<span class=o>=</span>^https?:<span class=se>\/\/</span>mb3admin.com<span class=se>\/</span>admin<span class=se>\/</span>service<span class=se>\/</span>registration<span class=se>\/</span>validateDevice,max-size<span class=o>=</span>131072,requires-body<span class=o>=</span>true,timeout<span class=o>=</span>10,enable<span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>[</span>MITM<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>hostname</span> <span class=o>=</span> mb3admin.com
</span></span></code></pre></td></tr></table></div></div><p>第二步 default.conf（右侧的 i 按钮） -> <code>https解密</code> （界面中应该会有 mb3admin.com 的域名信息）-> 证书-> 生成新的 CA 证书 -> 安装证书 -> 系统中信任证书</p><p>第三步打开 vpn，打开 emby，信任证书选择 ok，激活完成后可以关闭小火箭，后续失效的时候再打开一次即可。</p><h2 id=ref-参考资料>Ref 参考资料<a hidden class=anchor aria-hidden=true href=#ref-参考资料>#</a></h2><ol><li><a href=https://lengyue524.github.io/emby/2021/10/19/%E7%BE%A4%E6%99%96%E4%B8%8A%E5%88%A9%E7%94%A8%E7%8E%B0%E6%9C%89nginx%E6%90%AD%E5%BB%BAemby%E7%A0%B4%E8%A7%A3%E6%9C%8D%E5%8A%A1.html target=_blank rel=noopener>群晖上利用现有nginx搭建emby破解服务 (lengyue524)</a></li><li><a href=https://zhuangzhuang.io/2022/01/08/emby-carck.html target=_blank rel=noopener>Nas Emby 伪验证服务站搭建 - ZHUANGZHUANG</a></li><li><a href=https://hgl2.com/2023/unlock-emby/ target=_blank rel=noopener>学习 Emby 解锁及优化 - Gallen&rsquo;s Blog (hgl2.com)</a></li><li><a href=https://velaciela.ms/emby-free-premier target=_blank rel=noopener>Emby全平台开心版、认证服务器设置方法 | Velaciela</a></li><li><a href=https://www.huluohu.com/posts/186/ target=_blank rel=noopener>iOS利用小火箭解锁Emby | 胡萝虎的博客 (huluohu.com)</a></li></ol><h2 id=fi>Fi<a hidden class=anchor aria-hidden=true href=#fi>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://aikenh.cn/hugotest/tags/nas/>NAS</a></li><li><a href=https://aikenh.cn/hugotest/tags/nginx/>Nginx</a></li><li><a href=https://aikenh.cn/hugotest/tags/web/>Web</a></li><li><a href=https://aikenh.cn/hugotest/tags/emby/>Emby</a></li></ul><nav class=paginav><a class=prev href=https://aikenh.cn/hugotest/posts/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E4%B8%AD%E5%BF%832/><span class=title>« Prev</span><br><span>树莓派家庭影音中心2</span>
</a><a class=next href=https://aikenh.cn/hugotest/posts/deploy_server_byipv6_03_ddnsgo/><span class=title>Next »</span><br><span>使用Ipv6部署服务03 DDNS-go 动态域名解析</span></a></nav></footer><div id=disqus_thread></div><script>function loadDisqus(){var e=document,t=e.createElement("script");t.src="https://aiken-hugo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t),window.disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.location.href.substring(18)}}var runningOnBrowser=typeof window!="undefined",isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout(function(){if(!isBot&&supportsIntersectionObserver){var e=new IntersectionObserver(function(t){t[0].isIntersecting&&(loadDisqus(),e.disconnect())},{threshold:[0]});e.observe(document.getElementById("disqus_thread"))}else loadDisqus()},1)</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2024 <a href=https://aikenh.cn/hugotest/>aiken's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container>Visitors: <span id=busuanzi_value_site_uv></span>
Views: <span id=busuanzi_value_site_pv></span></span></footer><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("busuanzi_value_site_uv"),t=document.getElementById("busuanzi_value_site_pv"),o=13863,i=16993;if(!e||!t){console.error("Busuanzi elements not found.");return}const n=new MutationObserver(e=>{for(let t of e)if(t.type==="childList"){n.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML||0)+o;break}}),s=new MutationObserver(e=>{for(let t of e)if(t.type==="childList"){s.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML||0)+i;break}});n.observe(e,{childList:!0}),s.observe(t,{childList:!0})})</script><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))}),document.getElementById("theme-toggle-nav").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.js",function(){pangu.spacingPage()})</script></body></html>