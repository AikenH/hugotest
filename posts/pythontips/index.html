<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>（转）What the Fuck Python！ 一些python特性 | aiken's blog</title>
<meta name=keywords content="Langs,Python"><meta name=description content="
What the f*ck Python! 🐍
一些有趣且鲜为人知的 Python 特性.

English
| 中文

[![WTFPL 2.0][license-image]][license-url] [![Commit id][commit-image]][commit-url] [![996.icu][996.icu-image]][996.icu-url]
Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.
这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!
虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性.  我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!
如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:
PS: 如果你不是第一次读了, 你可以在这里
获取变动内容.
那么, 让我们开始吧&mldr;

Table of Contents/目录


Table of Contents/目录

Structure of the Examples/示例结构

Usage/用法

👀 Examples/示例


Section: Strain your brain!/大脑运动!


> Strings can be tricky sometimes/微妙的字符串 *

> Time for some hash brownies!/是时候来点蛋糕了!

> Return return everywhere!/到处返回！

> Deep down, we&rsquo;re all the same./本质上,我们都一样. *

> For what?/为什么?

> Evaluation time discrepancy/执行时机差异

> is is not what it is!/出人意料的is!

> A tic-tac-toe where X wins in the first attempt!/一蹴即至!

> The sticky output function/麻烦的输出

> is not ... is not is (not ...)/is not ... 不是 is (not ...)

> The surprising comma/意外的逗号

> Backslashes at the end of string/字符串末尾的反斜杠

> not knot!/别纠结!

> Half triple-quoted strings/三个引号

> Midnight time doesn&rsquo;t exist?/不存在的午夜?

> What&rsquo;s wrong with booleans?/布尔你咋了?

> Class attributes and instance attributes/类属性和实例属性

> yielding None/生成 None

> Mutating the immutable!/强人所难

> The disappearing variable from outer scope/消失的外部变量

> When True is actually False/真亦假

> From filled to None in one instruction&mldr;/从有到无&mldr;

> Subclass relationships/子类关系 *

> The mysterious key type conversion/神秘的键型转换 *

> Let&rsquo;s see if you can guess this?/看看你能否猜到这一点?



Section: Appearances are deceptive!/外表是靠不住的!


> Skipping lines?/跳过一行?

> Teleportation/空间移动 *

> Well, something is fishy&mldr;/嗯, 有些可疑&mldr;



Section: Watch out for the landmines!/小心地雷!


> Modifying a dictionary while iterating over it/迭代字典时的修改

> Stubborn del operator/坚强的 del *

> Deleting a list item while iterating/迭代列表时删除元素

> Loop variables leaking out!/循环变量泄漏!

> Beware of default mutable arguments!/当心默认的可变参数!

> Catching the Exceptions/捕获异常

> Same operands, different story!/同人不同命!

> The out of scope variable/外部作用域变量

> Be careful with chained operations/小心链式操作

> Name resolution ignoring class scope/忽略类作用域的名称解析

> Needle in a Haystack/大海捞针



Section: The Hidden treasures!/隐藏的宝藏!


> Okay Python, Can you make me fly?/Python, 可否带我飞? *

> goto, but why?/goto, 但为什么? *

> Brace yourself!/做好思想准备 *

> Let&rsquo;s meet Friendly Language Uncle For Life/让生活更友好 *

> Even Python understands that love is complicated/连Python也知道爱是难言的 *

> Yes, it exists!/是的, 它存在!

> Inpinity/无限 *

> Mangling time!修饰时间! *



Section: Miscellaneous/杂项


> += is faster/更快的 += 

> Let&rsquo;s make a giant string!/来做个巨大的字符串吧!

> Explicit typecast of strings/字符串的显式类型转换

> Minor Ones/小知识点





Contributing/贡献

Acknowledgements/致谢

🎓 License/许可


Help/帮助

Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?

Need a pdf version?/需要来一份pdf版的?

Follow Commit/追踪Commit

996.icu





Structure of the Examples/示例结构
所有示例的结构都如下所示:"><meta name=author content="aikenhong"><link rel=canonical href=https://aikenh.cn/hugotest/posts/pythontips/><link crossorigin=anonymous href=/hugotest/assets/css/stylesheet.2f85ca17c12c62fa86b1e474b8a51aca4856f0d645debfe4922a4d5ddc6aa978.css integrity="sha256-L4XKF8EsYvqGseR0uKUaykhW8NZF3r/kkipNXdxqqXg=" rel="preload stylesheet" as=style><link rel=icon href=https://aikenh.cn/favicon/ghost.ico><link rel=icon type=image/png sizes=16x16 href=https://aikenh.cn/favicon/ghost-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aikenh.cn/favicon/ghost-32x32.png><link rel=apple-touch-icon href=https://aikenh.cn/favicon/ghost-apple-touch-icon.png><link rel=mask-icon href=https://aikenh.cn/favicon/ghost-192x192.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aikenh.cn/hugotest/posts/pythontips/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://cdn.jsdmirror.com/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdmirror.com/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdmirror.com/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.css><script defer src=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.js></script><script defer src=https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-tc-webfont@1.0.0/style.css><link rel=stylesheet href=https://cdn.jsdmirror.com/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel=stylesheet><meta property="og:url" content="https://aikenh.cn/hugotest/posts/pythontips/"><meta property="og:site_name" content="aiken's blog"><meta property="og:title" content="（转）What the Fuck Python！ 一些python特性"><meta property="og:description" content="
What the f*ck Python! 🐍一些有趣且鲜为人知的 Python 特性.
English| 中文[![WTFPL 2.0][license-image]][license-url] [![Commit id][commit-image]][commit-url] [![996.icu][996.icu-image]][996.icu-url]Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.
这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!
虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性. 我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!
如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:
PS: 如果你不是第一次读了, 你可以在这里 获取变动内容.
那么, 让我们开始吧…
Table of Contents/目录 Table of Contents/目录 Structure of the Examples/示例结构 Usage/用法 👀 Examples/示例 Section: Strain your brain!/大脑运动! > Strings can be tricky sometimes/微妙的字符串 * > Time for some hash brownies!/是时候来点蛋糕了! > Return return everywhere!/到处返回！ > Deep down, we’re all the same./本质上,我们都一样. * > For what?/为什么? > Evaluation time discrepancy/执行时机差异 > is is not what it is!/出人意料的is! > A tic-tac-toe where X wins in the first attempt!/一蹴即至! > The sticky output function/麻烦的输出 > is not ... is not is (not ...)/is not ... 不是 is (not ...) > The surprising comma/意外的逗号 > Backslashes at the end of string/字符串末尾的反斜杠 > not knot!/别纠结! > Half triple-quoted strings/三个引号 > Midnight time doesn’t exist?/不存在的午夜? > What’s wrong with booleans?/布尔你咋了? > Class attributes and instance attributes/类属性和实例属性 > yielding None/生成 None > Mutating the immutable!/强人所难 > The disappearing variable from outer scope/消失的外部变量 > When True is actually False/真亦假 > From filled to None in one instruction…/从有到无… > Subclass relationships/子类关系 * > The mysterious key type conversion/神秘的键型转换 * > Let’s see if you can guess this?/看看你能否猜到这一点? Section: Appearances are deceptive!/外表是靠不住的! > Skipping lines?/跳过一行? > Teleportation/空间移动 * > Well, something is fishy…/嗯, 有些可疑… Section: Watch out for the landmines!/小心地雷! > Modifying a dictionary while iterating over it/迭代字典时的修改 > Stubborn del operator/坚强的 del * > Deleting a list item while iterating/迭代列表时删除元素 > Loop variables leaking out!/循环变量泄漏! > Beware of default mutable arguments!/当心默认的可变参数! > Catching the Exceptions/捕获异常 > Same operands, different story!/同人不同命! > The out of scope variable/外部作用域变量 > Be careful with chained operations/小心链式操作 > Name resolution ignoring class scope/忽略类作用域的名称解析 > Needle in a Haystack/大海捞针 Section: The Hidden treasures!/隐藏的宝藏! > Okay Python, Can you make me fly?/Python, 可否带我飞? * > goto, but why?/goto, 但为什么? * > Brace yourself!/做好思想准备 * > Let’s meet Friendly Language Uncle For Life/让生活更友好 * > Even Python understands that love is complicated/连Python也知道爱是难言的 * > Yes, it exists!/是的, 它存在! > Inpinity/无限 * > Mangling time!修饰时间! * Section: Miscellaneous/杂项 > += is faster/更快的 += > Let’s make a giant string!/来做个巨大的字符串吧! > Explicit typecast of strings/字符串的显式类型转换 > Minor Ones/小知识点 Contributing/贡献 Acknowledgements/致谢 🎓 License/许可 Help/帮助 Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜? Need a pdf version?/需要来一份pdf版的? Follow Commit/追踪Commit 996.icu Structure of the Examples/示例结构 所有示例的结构都如下所示:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-28T06:24:23+00:00"><meta property="article:modified_time" content="2021-11-28T06:24:23+00:00"><meta property="article:tag" content="Langs"><meta property="article:tag" content="Python"><meta property="og:image" content="https://aikenh.cn/cover/cover5.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aikenh.cn/cover/cover5.jpeg"><meta name=twitter:title content="（转）What the Fuck Python！ 一些python特性"><meta name=twitter:description content="
What the f*ck Python! 🐍
一些有趣且鲜为人知的 Python 特性.

English
| 中文

[![WTFPL 2.0][license-image]][license-url] [![Commit id][commit-image]][commit-url] [![996.icu][996.icu-image]][996.icu-url]
Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.
这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!
虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性.  我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!
如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:
PS: 如果你不是第一次读了, 你可以在这里
获取变动内容.
那么, 让我们开始吧&mldr;

Table of Contents/目录


Table of Contents/目录

Structure of the Examples/示例结构

Usage/用法

👀 Examples/示例


Section: Strain your brain!/大脑运动!


> Strings can be tricky sometimes/微妙的字符串 *

> Time for some hash brownies!/是时候来点蛋糕了!

> Return return everywhere!/到处返回！

> Deep down, we&rsquo;re all the same./本质上,我们都一样. *

> For what?/为什么?

> Evaluation time discrepancy/执行时机差异

> is is not what it is!/出人意料的is!

> A tic-tac-toe where X wins in the first attempt!/一蹴即至!

> The sticky output function/麻烦的输出

> is not ... is not is (not ...)/is not ... 不是 is (not ...)

> The surprising comma/意外的逗号

> Backslashes at the end of string/字符串末尾的反斜杠

> not knot!/别纠结!

> Half triple-quoted strings/三个引号

> Midnight time doesn&rsquo;t exist?/不存在的午夜?

> What&rsquo;s wrong with booleans?/布尔你咋了?

> Class attributes and instance attributes/类属性和实例属性

> yielding None/生成 None

> Mutating the immutable!/强人所难

> The disappearing variable from outer scope/消失的外部变量

> When True is actually False/真亦假

> From filled to None in one instruction&mldr;/从有到无&mldr;

> Subclass relationships/子类关系 *

> The mysterious key type conversion/神秘的键型转换 *

> Let&rsquo;s see if you can guess this?/看看你能否猜到这一点?



Section: Appearances are deceptive!/外表是靠不住的!


> Skipping lines?/跳过一行?

> Teleportation/空间移动 *

> Well, something is fishy&mldr;/嗯, 有些可疑&mldr;



Section: Watch out for the landmines!/小心地雷!


> Modifying a dictionary while iterating over it/迭代字典时的修改

> Stubborn del operator/坚强的 del *

> Deleting a list item while iterating/迭代列表时删除元素

> Loop variables leaking out!/循环变量泄漏!

> Beware of default mutable arguments!/当心默认的可变参数!

> Catching the Exceptions/捕获异常

> Same operands, different story!/同人不同命!

> The out of scope variable/外部作用域变量

> Be careful with chained operations/小心链式操作

> Name resolution ignoring class scope/忽略类作用域的名称解析

> Needle in a Haystack/大海捞针



Section: The Hidden treasures!/隐藏的宝藏!


> Okay Python, Can you make me fly?/Python, 可否带我飞? *

> goto, but why?/goto, 但为什么? *

> Brace yourself!/做好思想准备 *

> Let&rsquo;s meet Friendly Language Uncle For Life/让生活更友好 *

> Even Python understands that love is complicated/连Python也知道爱是难言的 *

> Yes, it exists!/是的, 它存在!

> Inpinity/无限 *

> Mangling time!修饰时间! *



Section: Miscellaneous/杂项


> += is faster/更快的 += 

> Let&rsquo;s make a giant string!/来做个巨大的字符串吧!

> Explicit typecast of strings/字符串的显式类型转换

> Minor Ones/小知识点





Contributing/贡献

Acknowledgements/致谢

🎓 License/许可


Help/帮助

Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?

Need a pdf version?/需要来一份pdf版的?

Follow Commit/追踪Commit

996.icu





Structure of the Examples/示例结构
所有示例的结构都如下所示:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aikenh.cn/hugotest/posts/"},{"@type":"ListItem","position":2,"name":"（转）What the Fuck Python！ 一些python特性","item":"https://aikenh.cn/hugotest/posts/pythontips/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"（转）What the Fuck Python！ 一些python特性","name":"（转）What the Fuck Python！ 一些python特性","description":"\nWhat the f*ck Python! 🐍\r一些有趣且鲜为人知的 Python 特性.\nEnglish\r| 中文\r[![WTFPL 2.0][license-image]][license-url] [![Commit id][commit-image]][commit-url] [![996.icu][996.icu-image]][996.icu-url]\rPython, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.\n这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!\n虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性. 我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!\n如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:\nPS: 如果你不是第一次读了, 你可以在这里 获取变动内容.\n那么, 让我们开始吧\u0026hellip;\nTable of Contents/目录 Table of Contents/目录 Structure of the Examples/示例结构 Usage/用法 👀 Examples/示例 Section: Strain your brain!/大脑运动! \u0026gt; Strings can be tricky sometimes/微妙的字符串 * \u0026gt; Time for some hash brownies!/是时候来点蛋糕了! \u0026gt; Return return everywhere!/到处返回！ \u0026gt; Deep down, we\u0026rsquo;re all the same./本质上,我们都一样. * \u0026gt; For what?/为什么? \u0026gt; Evaluation time discrepancy/执行时机差异 \u0026gt; is is not what it is!/出人意料的is! \u0026gt; A tic-tac-toe where X wins in the first attempt!/一蹴即至! \u0026gt; The sticky output function/麻烦的输出 \u0026gt; is not ... is not is (not ...)/is not ... 不是 is (not ...) \u0026gt; The surprising comma/意外的逗号 \u0026gt; Backslashes at the end of string/字符串末尾的反斜杠 \u0026gt; not knot!/别纠结! \u0026gt; Half triple-quoted strings/三个引号 \u0026gt; Midnight time doesn\u0026rsquo;t exist?/不存在的午夜? \u0026gt; What\u0026rsquo;s wrong with booleans?/布尔你咋了? \u0026gt; Class attributes and instance attributes/类属性和实例属性 \u0026gt; yielding None/生成 None \u0026gt; Mutating the immutable!/强人所难 \u0026gt; The disappearing variable from outer scope/消失的外部变量 \u0026gt; When True is actually False/真亦假 \u0026gt; From filled to None in one instruction\u0026hellip;/从有到无\u0026hellip; \u0026gt; Subclass relationships/子类关系 * \u0026gt; The mysterious key type conversion/神秘的键型转换 * \u0026gt; Let\u0026rsquo;s see if you can guess this?/看看你能否猜到这一点? Section: Appearances are deceptive!/外表是靠不住的! \u0026gt; Skipping lines?/跳过一行? \u0026gt; Teleportation/空间移动 * \u0026gt; Well, something is fishy\u0026hellip;/嗯, 有些可疑\u0026hellip; Section: Watch out for the landmines!/小心地雷! \u0026gt; Modifying a dictionary while iterating over it/迭代字典时的修改 \u0026gt; Stubborn del operator/坚强的 del * \u0026gt; Deleting a list item while iterating/迭代列表时删除元素 \u0026gt; Loop variables leaking out!/循环变量泄漏! \u0026gt; Beware of default mutable arguments!/当心默认的可变参数! \u0026gt; Catching the Exceptions/捕获异常 \u0026gt; Same operands, different story!/同人不同命! \u0026gt; The out of scope variable/外部作用域变量 \u0026gt; Be careful with chained operations/小心链式操作 \u0026gt; Name resolution ignoring class scope/忽略类作用域的名称解析 \u0026gt; Needle in a Haystack/大海捞针 Section: The Hidden treasures!/隐藏的宝藏! \u0026gt; Okay Python, Can you make me fly?/Python, 可否带我飞? * \u0026gt; goto, but why?/goto, 但为什么? * \u0026gt; Brace yourself!/做好思想准备 * \u0026gt; Let\u0026rsquo;s meet Friendly Language Uncle For Life/让生活更友好 * \u0026gt; Even Python understands that love is complicated/连Python也知道爱是难言的 * \u0026gt; Yes, it exists!/是的, 它存在! \u0026gt; Inpinity/无限 * \u0026gt; Mangling time!修饰时间! * Section: Miscellaneous/杂项 \u0026gt; += is faster/更快的 += \u0026gt; Let\u0026rsquo;s make a giant string!/来做个巨大的字符串吧! \u0026gt; Explicit typecast of strings/字符串的显式类型转换 \u0026gt; Minor Ones/小知识点 Contributing/贡献 Acknowledgements/致谢 🎓 License/许可 Help/帮助 Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜? Need a pdf version?/需要来一份pdf版的? Follow Commit/追踪Commit 996.icu Structure of the Examples/示例结构 所有示例的结构都如下所示:\n","keywords":["Langs","Python"],"articleBody":"\nWhat the f*ck Python! 🐍\r一些有趣且鲜为人知的 Python 特性.\nEnglish\r| 中文\r[![WTFPL 2.0][license-image]][license-url] [![Commit id][commit-image]][commit-url] [![996.icu][996.icu-image]][996.icu-url]\rPython, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.\n这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!\n虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性. 我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!\n如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:\nPS: 如果你不是第一次读了, 你可以在这里 获取变动内容.\n那么, 让我们开始吧…\nTable of Contents/目录 Table of Contents/目录 Structure of the Examples/示例结构 Usage/用法 👀 Examples/示例 Section: Strain your brain!/大脑运动! \u003e Strings can be tricky sometimes/微妙的字符串 * \u003e Time for some hash brownies!/是时候来点蛋糕了! \u003e Return return everywhere!/到处返回！ \u003e Deep down, we’re all the same./本质上,我们都一样. * \u003e For what?/为什么? \u003e Evaluation time discrepancy/执行时机差异 \u003e is is not what it is!/出人意料的is! \u003e A tic-tac-toe where X wins in the first attempt!/一蹴即至! \u003e The sticky output function/麻烦的输出 \u003e is not ... is not is (not ...)/is not ... 不是 is (not ...) \u003e The surprising comma/意外的逗号 \u003e Backslashes at the end of string/字符串末尾的反斜杠 \u003e not knot!/别纠结! \u003e Half triple-quoted strings/三个引号 \u003e Midnight time doesn’t exist?/不存在的午夜? \u003e What’s wrong with booleans?/布尔你咋了? \u003e Class attributes and instance attributes/类属性和实例属性 \u003e yielding None/生成 None \u003e Mutating the immutable!/强人所难 \u003e The disappearing variable from outer scope/消失的外部变量 \u003e When True is actually False/真亦假 \u003e From filled to None in one instruction…/从有到无… \u003e Subclass relationships/子类关系 * \u003e The mysterious key type conversion/神秘的键型转换 * \u003e Let’s see if you can guess this?/看看你能否猜到这一点? Section: Appearances are deceptive!/外表是靠不住的! \u003e Skipping lines?/跳过一行? \u003e Teleportation/空间移动 * \u003e Well, something is fishy…/嗯, 有些可疑… Section: Watch out for the landmines!/小心地雷! \u003e Modifying a dictionary while iterating over it/迭代字典时的修改 \u003e Stubborn del operator/坚强的 del * \u003e Deleting a list item while iterating/迭代列表时删除元素 \u003e Loop variables leaking out!/循环变量泄漏! \u003e Beware of default mutable arguments!/当心默认的可变参数! \u003e Catching the Exceptions/捕获异常 \u003e Same operands, different story!/同人不同命! \u003e The out of scope variable/外部作用域变量 \u003e Be careful with chained operations/小心链式操作 \u003e Name resolution ignoring class scope/忽略类作用域的名称解析 \u003e Needle in a Haystack/大海捞针 Section: The Hidden treasures!/隐藏的宝藏! \u003e Okay Python, Can you make me fly?/Python, 可否带我飞? * \u003e goto, but why?/goto, 但为什么? * \u003e Brace yourself!/做好思想准备 * \u003e Let’s meet Friendly Language Uncle For Life/让生活更友好 * \u003e Even Python understands that love is complicated/连Python也知道爱是难言的 * \u003e Yes, it exists!/是的, 它存在! \u003e Inpinity/无限 * \u003e Mangling time!修饰时间! * Section: Miscellaneous/杂项 \u003e += is faster/更快的 += \u003e Let’s make a giant string!/来做个巨大的字符串吧! \u003e Explicit typecast of strings/字符串的显式类型转换 \u003e Minor Ones/小知识点 Contributing/贡献 Acknowledgements/致谢 🎓 License/许可 Help/帮助 Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜? Need a pdf version?/需要来一份pdf版的? Follow Commit/追踪Commit 996.icu Structure of the Examples/示例结构 所有示例的结构都如下所示:\n\u003e 一个精选的标题 * 标题末尾的星号表示该示例在第一版中不存在，是最近添加的.\n1 2 # 准备代码. # 释放魔法... Output (Python version):\n1 2 \u003e\u003e\u003e 触发语句 出乎意料的输出结果 (可选): 对意外输出结果的简短描述.\n💡 说明: 简要说明发生了什么以及为什么会发生. 1 如有必要, 举例说明 Output: 1 2 \u003e\u003e\u003e 触发语句 # 一些让魔法变得容易理解的例子 # 一些正常的输入 注意: 所有的示例都在 Python 3.5.2 版本的交互解释器上测试过, 如果不特别说明应该适用于所有 Python 版本.\nUsage/用法 我个人建议, 最好依次阅读下面的示例, 并对每个示例:\n仔细阅读设置例子最开始的代码. 如果您是一位经验丰富的 Python 程序员, 那么大多数时候您都能成功预期到后面的结果. 阅读输出结果, 确认结果是否如你所料. 确认你是否知道这背后的原理. 如果不知道, 深呼吸然后阅读说明 (如果你还是看不明白, 别沉默! 可以在这 提个 issue). 如果知道, 给自己点奖励, 然后去看下一个例子. PS: 你也可以在命令行阅读 WTFpython. 我们有 pypi 包 和 npm 包(支持代码高亮).(译: 这两个都是英文版的)\n安装 npm 包 wtfpython 1 $ npm install -g wtfpython 或者, 安装 pypi 包 wtfpython 1 $ pip install wtfpython -U 现在, 在命令行中运行 wtfpython, 你就可以开始浏览了.\n👀 Examples/示例 Section: Strain your brain!/大脑运动! \u003e Strings can be tricky sometimes/微妙的字符串 * 1.\n1 2 3 4 5 \u003e\u003e\u003e a = \"some_string\" \u003e\u003e\u003e id(a) 140420665652016 \u003e\u003e\u003e id(\"some\" + \"_\" + \"string\") # 注意两个的id值是相同的. 140420665652016 2.\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u003e\u003e\u003e a = \"wtf\" \u003e\u003e\u003e b = \"wtf\" \u003e\u003e\u003e a is b True \u003e\u003e\u003e a = \"wtf!\" \u003e\u003e\u003e b = \"wtf!\" \u003e\u003e\u003e a is b False \u003e\u003e\u003e a, b = \"wtf!\", \"wtf!\" \u003e\u003e\u003e a is b True # 3.7 版本返回结果为 False. 3.\n1 2 3 4 \u003e\u003e\u003e 'a' * 20 is 'aaaaaaaaaaaaaaaaaaaa' True \u003e\u003e\u003e 'a' * 21 is 'aaaaaaaaaaaaaaaaaaaaa' False # 3.7 版本返回结果为 True 很好理解, 对吧?\n💡 说明: 这些行为是由于 Cpython 在编译优化时, 某些情况下会尝试使用已经存在的不可变对象而不是每次都创建一个新对象. (这种行为被称作字符串的驻留[string interning])\n发生驻留之后, 许多变量可能指向内存中的相同字符串对象. (从而节省内存)\n在上面的代码中, 字符串是隐式驻留的. 何时发生隐式驻留则取决于具体的实现. 这里有一些方法可以用来猜测字符串是否会被驻留:\n所有长度为 0 和长度为 1 的字符串都被驻留.\n字符串在编译时被实现 ('wtf' 将被驻留, 但是 ''.join(['w', 't', 'f']) 将不会被驻留)\n字符串中只包含字母，数字或下划线时将会驻留. 所以 'wtf!' 由于包含 ! 而未被驻留. 可以在这里 找到 CPython 对此规则的实现.\n当在同一行将 a 和 b 的值设置为 \"wtf!\" 的时候, Python 解释器会创建一个新对象, 然后同时引用第二个变量(译: 仅适用于3.7以下, 详细情况请看这里 ). 如果你在不同的行上进行赋值操作, 它就不会“知道”已经有一个 wtf！ 对象 (因为 \"wtf!\" 不是按照上面提到的方式被隐式驻留的). 它是一种编译器优化, 特别适用于交互式环境.\n常量折叠(constant folding) 是 Python 中的一种 窥孔优化(peephole optimization) 技术. 这意味着在编译时表达式 'a'*20 会被替换为 'aaaaaaaaaaaaaaaaaaaa' 以减少运行时的时钟周期. 只有长度小于 20 的字符串才会发生常量折叠. (为啥? 想象一下由于表达式 'a'*10**10 而生成的 .pyc 文件的大小). 相关的源码实现在这里 .\n如果你是使用 3.7 版本中运行上述示例代码, 会发现部分代码的运行结果与注释说明相同. 这是因为在 3.7 版本中, 常量折叠已经从窥孔优化器迁移至新的 AST 优化器, 后者可以以更高的一致性来执行优化. (由 Eugene Toder 和 INADA Naoki 在 bpo-29469 和 bpo-11549 中贡献.)\n(译: 但是在最新的 3.8 版本中, 结果又变回去了. 虽然 3.8 版本和 3.7 版本一样, 都是使用 AST 优化器. 目前不确定官方对 3.8 版本的 AST 做了什么调整.)\n\u003e Time for some hash brownies!/是时候来点蛋糕了! hash brownie指一种含有大麻成分的蛋糕, 所以这里是句双关 1.\n1 2 3 4 some_dict = {} some_dict[5.5] = \"Ruby\" some_dict[5.0] = \"JavaScript\" some_dict[5] = \"Python\" Output:\n1 2 3 4 5 6 \u003e\u003e\u003e some_dict[5.5] \"Ruby\" \u003e\u003e\u003e some_dict[5.0] \"Python\" \u003e\u003e\u003e some_dict[5] \"Python\" “Python” 消除了 “JavaScript” 的存在?\n💡 说明: Python 字典通过检查键值是否相等和比较哈希值来确定两个键是否相同. 具有相同值的不可变对象在Python中始终具有相同的哈希值. 1 2 3 4 \u003e\u003e\u003e 5 == 5.0 True \u003e\u003e\u003e hash(5) == hash(5.0) True 注意: 具有不同值的对象也可能具有相同的哈希值（哈希冲突）. 当执行 some_dict[5] = \"Python\" 语句时, 因为Python将 5 和 5.0 识别为 some_dict 的同一个键, 所以已有值 “JavaScript” 就被 “Python” 覆盖了. 这个 StackOverflow的 回答 漂亮地解释了这背后的基本原理. \u003e Return return everywhere!/到处返回！ 1 2 3 4 5 def some_func(): try: return 'from_try' finally: return 'from_finally' Output:\n1 2 \u003e\u003e\u003e some_func() 'from_finally' 💡 说明: 当在 “try…finally” 语句的 try 中执行 return, break 或 continue 后, finally 子句依然会执行. 函数的返回值由最后执行的 return 语句决定. 由于 finally 子句一定会执行, 所以 finally 子句中的 return 将始终是最后执行的语句. \u003e Deep down, we’re all the same./本质上,我们都一样. * 1 2 class WTF: pass Output:\n1 2 3 4 5 6 7 8 \u003e\u003e\u003e WTF() == WTF() # 两个不同的对象应该不相等 False \u003e\u003e\u003e WTF() is WTF() # 也不相同 False \u003e\u003e\u003e hash(WTF()) == hash(WTF()) # 哈希值也应该不同 True \u003e\u003e\u003e id(WTF()) == id(WTF()) True 💡 说明: 当调用 id 函数时, Python 创建了一个 WTF 类的对象并传给 id 函数. 然后 id 函数获取其id值 (也就是内存地址), 然后丢弃该对象. 该对象就被销毁了.\n当我们连续两次进行这个操作时, Python会将相同的内存地址分配给第二个对象. 因为 (在CPython中) id 函数使用对象的内存地址作为对象的id值, 所以两个对象的id值是相同的.\n综上, 对象的id值仅仅在对象的生命周期内唯一. 在对象被销毁之后, 或被创建之前, 其他对象可以具有相同的id值.\n那为什么 is 操作的结果为 False 呢? 让我们看看这段代码.\n1 2 3 class WTF(object): def __init__(self): print(\"I\") def __del__(self): print(\"D\") Output:\n1 2 3 4 5 6 7 8 9 10 11 12 \u003e\u003e\u003e WTF() is WTF() I I D D False \u003e\u003e\u003e id(WTF()) == id(WTF()) I D I D True 正如你所看到的, 对象销毁的顺序是造成所有不同之处的原因.\n\u003e For what?/为什么? 1 2 3 4 some_string = \"wtf\" some_dict = {} for i, some_dict[i] in enumerate(some_string): pass Output:\n1 2 \u003e\u003e\u003e some_dict # 创建了索引字典. {0: 'w', 1: 't', 2: 'f'} 💡 说明: Python 语法 中对 for 的定义是:\nfor_stmt: 'for' exprlist 'in' testlist ':' suite ['else' ':' suite] 其中 exprlist 指分配目标. 这意味着对可迭代对象中的每一项都会执行类似 {exprlist} = {next_value} 的操作.\n一个有趣的例子说明了这一点:\n1 2 3 for i in range(4): print(i) i = 10 Output:\n0\r1\r2\r3 你可曾觉得这个循环只会运行一次?\n💡 说明:\n由于循环在Python中工作方式, 赋值语句 i = 10 并不会影响迭代循环, 在每次迭代开始之前, 迭代器(这里指 range(4)) 生成的下一个元素就被解包并赋值给目标列表的变量(这里指 i)了. 在每一次的迭代中, enumerate(some_string) 函数就生成一个新值 i (计数器增加) 并从 some_string 中获取一个字符. 然后将字典 some_dict 键 i (刚刚分配的) 的值设为该字符. 本例中循环的展开可以简化为:\n1 2 3 4 \u003e\u003e\u003e i, some_dict[i] = (0, 'w') \u003e\u003e\u003e i, some_dict[i] = (1, 't') \u003e\u003e\u003e i, some_dict[i] = (2, 'f') \u003e\u003e\u003e some_dict \u003e Evaluation time discrepancy/执行时机差异 1.\n1 2 3 array = [1, 8, 15] g = (x for x in array if array.count(x) \u003e 0) array = [2, 8, 22] Output:\n1 2 \u003e\u003e\u003e print(list(g)) [8] 2.\n1 2 3 4 5 6 7 array_1 = [1,2,3,4] g1 = (x for x in array_1) array_1 = [1,2,3,4,5] array_2 = [1,2,3,4] g2 = (x for x in array_2) array_2[:] = [1,2,3,4,5] Output:\n1 2 3 4 5 \u003e\u003e\u003e print(list(g1)) [1,2,3,4] \u003e\u003e\u003e print(list(g2)) [1,2,3,4,5] 💡 说明 在生成器 表达式中, in 子句在声明时执行, 而条件子句则是在运行时执行. 所以在运行前, array 已经被重新赋值为 [2, 8, 22], 因此对于之前的 1, 8 和 15, 只有 count(8) 的结果是大于 0 的, 所以生成器只会生成 8. 第二部分中 g1 和 g2 的输出差异则是由于变量 array_1 和 array_2 被重新赋值的方式导致的. 在第一种情况下, array_1 被绑定到新对象 [1,2,3,4,5], 因为 in 子句是在声明时被执行的， 所以它仍然引用旧对象 [1,2,3,4](并没有被销毁). 在第二种情况下, 对 array_2 的切片赋值将相同的旧对象 [1,2,3,4] 原地更新为 [1,2,3,4,5]. 因此 g2 和 array_2 仍然引用同一个对象(这个对象现在已经更新为 [1,2,3,4,5]). \u003e is is not what it is!/出人意料的is! 下面是一个在互联网上非常有名的例子.\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u003e\u003e\u003e a = 256 \u003e\u003e\u003e b = 256 \u003e\u003e\u003e a is b True \u003e\u003e\u003e a = 257 \u003e\u003e\u003e b = 257 \u003e\u003e\u003e a is b False \u003e\u003e\u003e a = 257; b = 257 \u003e\u003e\u003e a is b True 💡 说明: is 和 == 的区别\nis 运算符检查两个运算对象是否引用自同一对象 (即, 它检查两个运算对象是否相同). == 运算符比较两个运算对象的值是否相等. 因此 is 代表引用相同, == 代表值相等. 下面的例子可以很好的说明这点, 1 2 3 4 \u003e\u003e\u003e [] == [] True \u003e\u003e\u003e [] is [] # 这两个空列表位于不同的内存地址. False 256 是一个已经存在的对象, 而 257 不是\n当你启动Python 的时候, 数值为 -5 到 256 的对象就已经被分配好了. 这些数字因为经常被使用, 所以会被提前准备好.\nPython 通过这种创建小整数池的方式来避免小整数频繁的申请和销毁内存空间.\n引用自 https://docs.python.org/3/c-api/long.html 当前的实现为-5到256之间的所有整数保留一个整数对象数组, 当你创建了一个该范围内的整数时, 你只需要返回现有对象的引用. 所以改变1的值是有可能的. 我怀疑这种行为在Python中是未定义行为. :-)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u003e\u003e\u003e id(256) 10922528 \u003e\u003e\u003e a = 256 \u003e\u003e\u003e b = 256 \u003e\u003e\u003e id(a) 10922528 \u003e\u003e\u003e id(b) 10922528 \u003e\u003e\u003e id(257) 140084850247312 \u003e\u003e\u003e x = 257 \u003e\u003e\u003e y = 257 \u003e\u003e\u003e id(x) 140084850247440 \u003e\u003e\u003e id(y) 140084850247344 这里解释器并没有智能到能在执行 y = 257 时意识到我们已经创建了一个整数 257, 所以它在内存中又新建了另一个对象.\n当 a 和 b 在同一行中使用相同的值初始化时，会指向同一个对象.\n1 2 3 4 5 6 7 8 9 10 11 \u003e\u003e\u003e a, b = 257, 257 \u003e\u003e\u003e id(a) 140640774013296 \u003e\u003e\u003e id(b) 140640774013296 \u003e\u003e\u003e a = 257 \u003e\u003e\u003e b = 257 \u003e\u003e\u003e id(a) 140640774013392 \u003e\u003e\u003e id(b) 140640774013488 当 a 和 b 在同一行中被设置为 257 时, Python 解释器会创建一个新对象, 然后同时引用第二个变量. 如果你在不同的行上进行, 它就不会 “知道” 已经存在一个 257 对象了. 这是一种特别为交互式环境做的编译器优化. 当你在实时解释器中输入两行的时候, 他们会单独编译, 因此也会单独进行优化. 如果你在 .py 文件中尝试这个例子, 则不会看到相同的行为, 因为文件是一次性编译的. \u003e A tic-tac-toe where X wins in the first attempt!/一蹴即至! 1 2 3 4 # 我们先初始化一个变量row row = [\"\"]*3 #row i['', '', ''] # 并创建一个变量board board = [row]*3 Output:\n1 2 3 4 5 6 7 8 9 \u003e\u003e\u003e board [['', '', ''], ['', '', ''], ['', '', '']] \u003e\u003e\u003e board[0] ['', '', ''] \u003e\u003e\u003e board[0][0] '' \u003e\u003e\u003e board[0][0] = \"X\" \u003e\u003e\u003e board [['X', '', ''], ['X', '', ''], ['X', '', '']] 我们有没有赋值过3个 “X” 呢？\n💡 说明: 当我们初始化 row 变量时, 下面这张图展示了内存中的情况。\n而当通过对 row 做乘法来初始化 board 时, 内存中的情况则如下图所示 (每个元素 board[0], board[1] 和 board[2] 都和 row 一样引用了同一列表.)\n我们可以通过不使用变量 row 生成 board 来避免这种情况. (这个 issue提出了这个需求.)\n1 2 3 4 \u003e\u003e\u003e board = [['']*3 for _ in range(3)] \u003e\u003e\u003e board[0][0] = \"X\" \u003e\u003e\u003e board [['X', '', ''], ['', '', ''], ['', '', '']] \u003e The sticky output function/麻烦的输出 1 2 3 4 5 6 7 8 9 funcs = [] results = [] for x in range(7): def some_func(): return x funcs.append(some_func) results.append(some_func()) # 注意这里函数被执行了 funcs_results = [func() for func in funcs] Output:\n1 2 3 4 \u003e\u003e\u003e results [0, 1, 2, 3, 4, 5, 6] \u003e\u003e\u003e funcs_results [6, 6, 6, 6, 6, 6, 6] 即使每次在迭代中将 some_func 加入 funcs 前的 x 值都不相同, 所有的函数还是都返回6.\n// 再换个例子\n1 2 3 \u003e\u003e\u003e powers_of_x = [lambda x: x**i for i in range(10)] \u003e\u003e\u003e [f(2) for f in powers_of_x] [512, 512, 512, 512, 512, 512, 512, 512, 512, 512] 💡 说明: 当在循环内部定义一个函数时, 如果该函数在其主体中使用了循环变量, 则闭包函数将与循环变量绑定, 而不是它的值. 因此, 所有的函数都是使用最后分配给变量的值来进行计算的.\n可以通过将循环变量作为命名变量传递给函数来获得预期的结果. 为什么这样可行? 因为这会在函数内再次定义一个局部变量.\n1 2 3 4 5 funcs = [] for x in range(7): def some_func(x=x): return x funcs.append(some_func) Output:\n1 2 3 \u003e\u003e\u003e funcs_results = [func() for func in funcs] \u003e\u003e\u003e funcs_results [0, 1, 2, 3, 4, 5, 6] \u003e is not ... is not is (not ...)/is not ... 不是 is (not ...) 1 2 3 4 \u003e\u003e\u003e 'something' is not None True \u003e\u003e\u003e 'something' is (not None) False 💡 说明: is not 是个单独的二元运算符, 与分别使用 is 和 not 不同. 如果操作符两侧的变量指向同一个对象, 则 is not 的结果为 False, 否则结果为 True. \u003e The surprising comma/意外的逗号 Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u003e\u003e\u003e def f(x, y,): ... print(x, y) ... \u003e\u003e\u003e def g(x=4, y=5,): ... print(x, y) ... \u003e\u003e\u003e def h(x, **kwargs,): File \"\", line 1 def h(x, **kwargs,): ^ SyntaxError: invalid syntax \u003e\u003e\u003e def h(*args,): File \"\", line 1 def h(*args,): ^ SyntaxError: invalid syntax 💡 说明: 在Python函数的形式参数列表中, 尾随逗号并不一定是合法的. 在Python中, 参数列表部分用前置逗号定义, 部分用尾随逗号定义. 这种冲突导致逗号被夹在中间, 没有规则定义它.(译:这一句看得我也很懵逼,只能强翻了.详细解释看下面的讨论帖会一目了然.) 注意: 尾随逗号的问题已经在Python 3.6中被修复 了. 而这篇帖子 中则简要讨论了Python中尾随逗号的不同用法. \u003e Backslashes at the end of string/字符串末尾的反斜杠 Output:\n\u003e\u003e\u003e print(\"\\\\ C:\\\\\")\r\\ C:\\\r\u003e\u003e\u003e print(r\"\\ C:\")\r\\ C:\r\u003e\u003e\u003e print(r\"\\ C:\\\")\rFile \"\", line 1\rprint(r\"\\ C:\\\")\r^\rSyntaxError: EOL while scanning string literal 💡 说明: 在以 r 开头的原始字符串中, 反斜杠并没有特殊含义. 1 2 \u003e\u003e\u003e print(repr(r\"wt\\\"f\")) 'wt\\\\\"f' 解释器所做的只是简单的改变了反斜杠的行为, 因此会直接放行反斜杠及后一个的字符. 这就是反斜杠在原始字符串末尾不起作用的原因. \u003e not knot!/别纠结! 1 2 x = True y = False Output:\n1 2 3 4 5 6 7 \u003e\u003e\u003e not x == y True \u003e\u003e\u003e x == not y File \"\", line 1 x == not y ^ SyntaxError: invalid syntax 💡 说明: 运算符的优先级会影响表达式的求值顺序, 而在 Python 中 == 运算符的优先级要高于 not 运算符. 所以 not x == y 相当于 not (x == y), 同时等价于 not (True == False), 最后的运算结果就是 True. 之所以 x == not y 会抛一个 SyntaxError 异常, 是因为它会被认为等价于 (x == not) y, 而不是你一开始期望的 x == (not y). 解释器期望 not 标记是 not in 操作符的一部分 (因为 == 和 not in 操作符具有相同的优先级), 但是它在 not 标记后面找不到 in 标记, 所以会抛出 SyntaxError 异常. \u003e Half triple-quoted strings/三个引号 Output:\n1 2 3 4 5 6 7 \u003e\u003e\u003e print('wtfpython''') wtfpython \u003e\u003e\u003e print(\"wtfpython\"\"\") wtfpython \u003e\u003e\u003e # 下面的语句会抛出 `SyntaxError` 异常 \u003e\u003e\u003e # print('''wtfpython') \u003e\u003e\u003e # print(\"\"\"wtfpython\") 💡 说明: Python 提供隐式的字符串连接 , 例如, \u003e\u003e\u003e print(\"wtf\" \"python\")\rwtfpython\r\u003e\u003e\u003e print(\"wtf\" \"\") # or \"wtf\"\"\"\rwtf ''' 和 \"\"\" 在 Python中也是字符串定界符, Python 解释器在先遇到三个引号的的时候会尝试再寻找三个终止引号作为定界符, 如果不存在则会导致 SyntaxError 异常. \u003e Midnight time doesn’t exist?/不存在的午夜? 1 2 3 4 5 6 7 8 9 10 11 12 13 from datetime import datetime midnight = datetime(2018, 1, 1, 0, 0) midnight_time = midnight.time() noon = datetime(2018, 1, 1, 12, 0) noon_time = noon.time() if midnight_time: print(\"Time at midnight is\", midnight_time) if noon_time: print(\"Time at noon is\", noon_time) Output:\n1 ('Time at noon is', datetime.time(12, 0)) midnight_time 并没有被输出.\n💡 说明: 在Python 3.5之前, 如果 datetime.time 对象存储的UTC的午夜时间(译: 就是 00:00), 那么它的布尔值会被认为是 False. 当使用 if obj: 语句来检查 obj 是否为 null 或者某些“空”值的时候, 很容易出错.\n\u003e What’s wrong with booleans?/布尔你咋了? 1.\n1 2 3 4 5 6 7 8 9 10 # 一个简单的例子, 统计下面可迭代对象中的布尔型值的个数和整型值的个数 mixed_list = [False, 1.0, \"some_string\", 3, True, [], False] integers_found_so_far = 0 booleans_found_so_far = 0 for item in mixed_list: if isinstance(item, int): integers_found_so_far += 1 elif isinstance(item, bool): booleans_found_so_far += 1 Output:\n1 2 3 4 \u003e\u003e\u003e integers_found_so_far 4 \u003e\u003e\u003e booleans_found_so_far 0 2.\n1 2 3 4 another_dict = {} another_dict[True] = \"JavaScript\" another_dict[1] = \"Ruby\" another_dict[1.0] = \"Python\" Output:\n1 2 \u003e\u003e\u003e another_dict[True] \"Python\" 3.\n1 2 3 4 5 6 \u003e\u003e\u003e some_bool = True \u003e\u003e\u003e \"wtf\"*some_bool 'wtf' \u003e\u003e\u003e some_bool = False \u003e\u003e\u003e \"wtf\"*some_bool '' 💡 说明: 布尔值是 int 的子类\n1 2 3 4 \u003e\u003e\u003e isinstance(True, int) True \u003e\u003e\u003e isinstance(False, int) True 所以 True 的整数值是 1, 而 False 的整数值是 0.\n1 2 \u003e\u003e\u003e True == 1 == 1.0 and False == 0 == 0.0 True 关于其背后的原理, 请看这个 StackOverflow 的回答 .\n\u003e Class attributes and instance attributes/类属性和实例属性 1.\n1 2 3 4 5 6 7 8 class A: x = 1 class B(A): pass class C(A): pass Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u003e\u003e\u003e A.x, B.x, C.x (1, 1, 1) \u003e\u003e\u003e B.x = 2 \u003e\u003e\u003e A.x, B.x, C.x (1, 2, 1) \u003e\u003e\u003e A.x = 3 \u003e\u003e\u003e A.x, B.x, C.x (3, 2, 3) \u003e\u003e\u003e a = A() \u003e\u003e\u003e a.x, A.x (3, 3) \u003e\u003e\u003e a.x += 1 \u003e\u003e\u003e a.x, A.x (4, 3) 2.\n1 2 3 4 5 6 7 8 class SomeClass: some_var = 15 some_list = [5] another_list = [5] def __init__(self, x): self.some_var = x + 1 self.some_list = self.some_list + [x] self.another_list += [x] Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u003e\u003e\u003e some_obj = SomeClass(420) \u003e\u003e\u003e some_obj.some_list [5, 420] \u003e\u003e\u003e some_obj.another_list [5, 420] \u003e\u003e\u003e another_obj = SomeClass(111) \u003e\u003e\u003e another_obj.some_list [5, 111] \u003e\u003e\u003e another_obj.another_list [5, 420, 111] \u003e\u003e\u003e another_obj.another_list is SomeClass.another_list True \u003e\u003e\u003e another_obj.another_list is some_obj.another_list True 💡 说明: 类变量和实例变量在内部是通过类对象的字典来处理(译: 就是 __dict__ 属性). 如果在当前类的字典中找不到的话就去它的父类中寻找. += 运算符会在原地修改可变对象, 而不是创建新对象. 因此, 在这种情况下, 修改一个实例的属性会影响其他实例和类属性. \u003e yielding None/生成 None 1 2 3 4 some_iterable = ('a', 'b') def some_func(val): return \"something\" Output:\n1 2 3 4 5 6 7 8 9 10 \u003e\u003e\u003e [x for x in some_iterable] ['a', 'b'] \u003e\u003e\u003e [(yield x) for x in some_iterable] \u003cgenerator object \u003clistcomp\u003e at 0x7f70b0a4ad58\u003e \u003e\u003e\u003e list([(yield x) for x in some_iterable]) ['a', 'b'] \u003e\u003e\u003e list((yield x) for x in some_iterable) ['a', None, 'b', None] \u003e\u003e\u003e list(some_func((yield x)) for x in some_iterable) ['a', 'something', 'b', 'something'] 💡 说明: 来源和解释可以在这里找到: https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions 相关错误报告: http://bugs.python.org/issue10544 这个bug在3.7以后的版本中不被推荐使用, 并在3.8中被修复. 因此在3.8中尝试在推导式中使用 yield, 只会得到一个 SyntaxError. 详细内容可以看3.7更新内容 , 3.8更新内容 . \u003e Mutating the immutable!/强人所难 1 2 some_tuple = (\"A\", \"tuple\", \"with\", \"values\") another_tuple = ([1, 2], [3, 4], [5, 6]) Output:\n1 2 3 4 5 6 7 8 9 \u003e\u003e\u003e some_tuple[2] = \"change this\" TypeError: 'tuple' object does not support item assignment \u003e\u003e\u003e another_tuple[2].append(1000) # 这里不出现错误 \u003e\u003e\u003e another_tuple ([1, 2], [3, 4], [5, 6, 1000]) \u003e\u003e\u003e another_tuple[2] += [99, 999] TypeError: 'tuple' object does not support item assignment \u003e\u003e\u003e another_tuple ([1, 2], [3, 4], [5, 6, 1000, 99, 999]) 我还以为元组是不可变的呢…\n💡 说明: 引用 https://docs.python.org/2/reference/datamodel.html 不可变序列 不可变序列的对象一旦创建就不能再改变. (如果对象包含对其他对象的引用，则这些其他对象可能是可变的并且可能会被修改; 但是，由不可变对象直接引用的对象集合不能更改.)\n+= 操作符在原地修改了列表. 元素赋值操作并不工作, 但是当异常抛出时, 元素已经在原地被修改了.\n(译: 对于不可变对象, 这里指tuple, += 并不是原子操作, 而是 extend 和 = 两个动作, 这里 = 操作虽然会抛出异常, 但 extend 操作已经修改成功了. 详细解释可以看这里 )\n\u003e The disappearing variable from outer scope/消失的外部变量 1 2 3 4 5 e = 7 try: raise Exception() except Exception as e: pass Output (Python 2.x):\n1 2 \u003e\u003e\u003e print(e) # prints nothing Output (Python 3.x):\n1 2 \u003e\u003e\u003e print(e) NameError: name 'e' is not defined 💡 说明: 出处: https://docs.python.org/3/reference/compound_stmts.html#except 当使用 as 为目标分配异常的时候, 将在except子句的末尾清除该异常.\n这就好像\n1 2 except E as N: foo 会被翻译成\n1 2 3 4 5 except E as N: try: foo finally: del N 这意味着异常必须在被赋值给其他变量才能在 except 子句之后引用它. 而异常之所以会被清除, 则是由于上面附加的回溯信息(trackback)会和栈帧(stack frame)形成循环引用, 使得该栈帧中的所有本地变量在下一次垃圾回收发生之前都处于活动状态.(译: 也就是说不会被回收)\n子句在 Python 中并没有独立的作用域. 示例中的所有内容都处于同一作用域内, 所以变量 e 会由于执行了 except 子句而被删除. 而对于有独立的内部作用域的函数来说情况就不一样了. 下面的例子说明了这一点:\n1 2 3 4 5 6 def f(x): del(x) print(x) x = 5 y = [5, 4, 3] Output:\n1 2 3 4 5 6 7 8 \u003e\u003e\u003ef(x) UnboundLocalError: local variable 'x' referenced before assignment \u003e\u003e\u003ef(y) UnboundLocalError: local variable 'x' referenced before assignment \u003e\u003e\u003e x 5 \u003e\u003e\u003e y [5, 4, 3] 在 Python 2.x 中, Exception() 实例被赋值给了变量 e, 所以当你尝试打印结果的时候, 它的输出为空.（译: 正常的Exception实例打印出来就是空）\nOutput (Python 2.x):\n1 2 3 4 \u003e\u003e\u003e e Exception() \u003e\u003e\u003e print e # 没有打印任何内容! \u003e When True is actually False/真亦假 1 2 3 True = False if True == False: print(\"I've lost faith in truth!\") Output:\nI've lost faith in truth! 💡 说明: 最初, Python 并没有 bool 型 (人们用0表示假值, 用非零值比如1作为真值). 后来他们添加了 True, False, 和 bool 型, 但是, 为了向后兼容, 他们没法把 True 和 False 设置为常量, 只是设置成了内置变量. Python 3 由于不再需要向后兼容, 终于可以修复这个问题了, 所以这个例子无法在 Python 3.x 中执行! \u003e From filled to None in one instruction…/从有到无… 1 2 3 4 5 6 7 8 9 some_list = [1, 2, 3] some_dict = { \"key_1\": 1, \"key_2\": 2, \"key_3\": 3 } some_list = some_list.append(4) some_dict = some_dict.update({\"key_4\": 4}) Output:\n1 2 3 4 \u003e\u003e\u003e print(some_list) None \u003e\u003e\u003e print(some_dict) None 💡 说明: 大多数修改序列/映射对象的方法, 比如 list.append, dict.update, list.sort 等等. 都是原地修改对象并返回 None. 这样做的理由是, 如果操作可以原地完成, 就可以避免创建对象的副本来提高性能. (参考这里 )\n\u003e Subclass relationships/子类关系 * Output:\n1 2 3 4 5 6 7 \u003e\u003e\u003e from collections import Hashable \u003e\u003e\u003e issubclass(list, object) True \u003e\u003e\u003e issubclass(object, Hashable) True \u003e\u003e\u003e issubclass(list, Hashable) False 子类关系应该是可传递的, 对吧? (即, 如果 A 是 B 的子类, B 是 C 的子类, 那么 A 应该 是 C 的子类.)\n💡 说明: Python 中的子类关系并不一定是传递的. 任何人都可以在元类中随意定义 __subclasscheck__. 当 issubclass(cls, Hashable) 被调用时, 它只是在 cls 中寻找 __hash__ 方法或者从继承的父类中寻找 __hash__ 方法. 由于 object is 可散列的(hashable), 但是 list 是不可散列的, 所以它打破了这种传递关系. 在这里 可以找到更详细的解释. \u003e The mysterious key type conversion/神秘的键型转换 * 1 2 3 4 class SomeClass(str): pass some_dict = {'s':42} Output:\n1 2 3 4 5 6 7 8 \u003e\u003e\u003e type(list(some_dict.keys())[0]) str \u003e\u003e\u003e s = SomeClass('s') \u003e\u003e\u003e some_dict[s] = 40 \u003e\u003e\u003e some_dict # 预期: 两个不同的键值对 {'s': 40} \u003e\u003e\u003e type(list(some_dict.keys())[0]) str 💡 说明: 由于 SomeClass 会从 str 自动继承 __hash__ 方法, 所以 s 对象和 \"s\" 字符串的哈希值是相同的.\n而 SomeClass(\"s\") == \"s\" 为 True 是因为 SomeClass 也继承了 str 类 __eq__ 方法.\n由于两者的哈希值相同且相等, 所以它们在字典中表示相同的键.\n如果想要实现期望的功能, 我们可以重定义 SomeClass 的 __eq__ 方法.\n1 2 3 4 5 6 7 8 9 10 11 12 13 class SomeClass(str): def __eq__(self, other): return ( type(self) is SomeClass and type(other) is SomeClass and super().__eq__(other) ) # 当我们自定义 __eq__ 方法时, Python 不会再自动继承 __hash__ 方法 # 所以我们也需要定义它 __hash__ = str.__hash__ some_dict = {'s':42} Output:\n1 2 3 4 5 6 7 \u003e\u003e\u003e s = SomeClass('s') \u003e\u003e\u003e some_dict[s] = 40 \u003e\u003e\u003e some_dict {'s': 40, 's': 42} \u003e\u003e\u003e keys = list(some_dict.keys()) \u003e\u003e\u003e type(keys[0]), type(keys[1]) (__main__.SomeClass, str) \u003e Let’s see if you can guess this?/看看你能否猜到这一点? 1 a, b = a[b] = {}, 5 Output:\n1 2 \u003e\u003e\u003e a {5: ({...}, 5)} 💡 说明: 根据 Python 语言参考 , 赋值语句的形式如下\n(target_list \"=\")+ (expression_list | yield_expression) 赋值语句计算表达式列表(expression list)(牢记 这可以是单个表达式或以逗号分隔的列表, 后者返回元组)并将单个结果对象从左到右分配给目标列表中的每一项.\n(target_list \"=\")+ 中的 + 意味着可以有一个或多个目标列表. 在这个例子中, 目标列表是 a, b 和 a[b] (注意表达式列表只能有一个, 在我们的例子中是 {}, 5).\n表达式列表计算结束后, 将其值自动解包后从左到右分配给目标列表(target list). 因此, 在我们的例子中, 首先将 {}, 5 元组并赋值给 a, b, 然后我们就可以得到 a = {} 且 b = 5.\na 被赋值的 {} 是可变对象.\n第二个目标列表是 a[b] (你可能觉得这里会报错, 因为在之前的语句中 a 和 b 都还没有被定义. 但是别忘了, 我们刚刚将 a 赋值 {} 且将 b 赋值为 5).\n现在, 我们将通过将字典中键 5 的值设置为元组 ({}, 5) 来创建循环引用 (输出中的 {...} 指与 a 引用了相同的对象). 下面是一个更简单的循环引用的例子\n1 2 3 4 5 6 7 8 9 \u003e\u003e\u003e some_list = some_list[0] = [0] \u003e\u003e\u003e some_list [[...]] \u003e\u003e\u003e some_list[0] [[...]] \u003e\u003e\u003e some_list is some_list[0] True \u003e\u003e\u003e some_list[0][0][0][0][0][0] == some_list True 我们的例子就是这种情况 (a[b][0] 与 a 是相同的对象)\n总结一下, 你也可以把例子拆成\n1 2 a, b = {}, 5 a[b] = a, b 并且可以通过 a[b][0] 与 a 是相同的对象来证明是循环引用\n1 2 \u003e\u003e\u003e a[b][0] is a True Section: Appearances are deceptive!/外表是靠不住的! \u003e Skipping lines?/跳过一行? Output:\n1 2 3 4 \u003e\u003e\u003e value = 11 \u003e\u003e\u003e valuе = 32 \u003e\u003e\u003e value 11 什么鬼?\n注意: 如果你想要重现的话最简单的方法是直接复制上面的代码片段到你的文件或命令行里.\n💡 说明: 一些非西方字符虽然看起来和英语字母相同, 但会被解释器识别为不同的字母.\n1 2 3 4 5 6 7 8 9 10 11 \u003e\u003e\u003e ord('е') # 西里尔语的 'e' (Ye) 1077 \u003e\u003e\u003e ord('e') # 拉丁语的 'e', 用于英文并使用标准键盘输入 101 \u003e\u003e\u003e 'е' == 'e' False \u003e\u003e\u003e value = 42 # 拉丁语 e \u003e\u003e\u003e valuе = 23 # 西里尔语 'e', Python 2.x 的解释器在这会抛出 `SyntaxError` 异常 \u003e\u003e\u003e value 42 内置的 ord() 函数可以返回一个字符的 Unicode 代码点 , 这里西里尔语 ’e’ 和拉丁语 ’e’ 的代码点不同证实了上述例子.\n\u003e Teleportation/空间移动 * 1 2 3 4 5 6 7 8 9 import numpy as np def energy_send(x): # 初始化一个 numpy 数组 np.array([float(x)]) def energy_receive(): # 返回一个空的 numpy 数组 return np.empty((), dtype=np.float).tolist() Output:\n1 2 3 \u003e\u003e\u003e energy_send(123.456) \u003e\u003e\u003e energy_receive() 123.456 谁来给我发个诺贝尔奖?\n💡 说明: 注意在 energy_send 函数中创建的 numpy 数组并没有返回, 因此内存空间被释放并可以被重新分配. numpy.empty() 直接返回下一段空闲内存，而不重新初始化. 而这个内存点恰好就是刚刚释放的那个(通常情况下, 并不绝对). \u003e Well, something is fishy…/嗯，有些可疑… 1 2 3 4 5 6 7 8 def square(x): \"\"\" 一个通过加法计算平方的简单函数. \"\"\" sum_so_far = 0 for counter in range(x): sum_so_far = sum_so_far + x return sum_so_far Output (Python 2.x):\n1 2 \u003e\u003e\u003e square(10) 10 难道不应该是100吗?\n注意: 如果你无法重现, 可以尝试运行这个文件mixed_tabs_and_spaces.py .\n💡 说明: 不要混用制表符(tab)和空格(space)! 在上面的例子中, return 的前面是\"1个制表符\", 而其他部分的代码前面是 “4个空格”.\nPython是这么处理制表符的:\n首先, 制表符会从左到右依次被替换成8个空格, 直到被替换后的字符总数是八的倍数 \u003c…\u003e\n因此, square 函数最后一行的制表符会被替换成8个空格, 导致return语句进入循环语句里面.\nPython 3 很友好, 在这种情况下会自动抛出错误.\nOutput (Python 3.x):\n1 TabError: inconsistent use of tabs and spaces in indentation Section: Watch out for the landmines!/小心地雷! \u003e Modifying a dictionary while iterating over it/迭代字典时的修改 1 2 3 4 5 6 x = {0: None} for i in x: del x[i] x[i+1] = None print(i) Output (Python 2.7- Python 3.5):\n0\r1\r2\r3\r4\r5\r6\r7 是的, 它运行了八次然后才停下来.\n💡 说明: Python不支持对字典进行迭代的同时修改它. 它之所以运行8次, 是因为字典会自动扩容以容纳更多键值(我们有8次删除记录, 因此需要扩容). 这实际上是一个实现细节. (译: 应该是因为字典的初始最小值是8, 扩容会导致散列表地址发生变化而中断循环.) 在不同的Python实现中删除键的处理方式以及调整大小的时间可能会有所不同.(译: 就是说什么时候扩容在不同版本中可能是不同的, 在3.6及3.7的版本中到5 就会自动扩容了. 以后也有可能再次发生变化. 这是为了避免散列冲突. 顺带一提, 后面两次扩容会扩展为32和256. 即8-\u003e32-\u003e256.) 更多的信息, 你可以参考这个StackOverflow的回答 , 它详细的解释一个类似的例子. \u003e Stubborn del operator/坚强的 del * 1 2 3 class SomeClass: def __del__(self): print(\"Deleted!\") Output: 1.\n1 2 3 4 5 \u003e\u003e\u003e x = SomeClass() \u003e\u003e\u003e y = x \u003e\u003e\u003e del x # 这里应该会输出 \"Deleted!\" \u003e\u003e\u003e del y Deleted! 唷, 终于删除了. 你可能已经猜到了在我们第一次尝试删除 x 时是什么让 __del__ 免于被调用的. 那让我们给这个例子增加点难度.\n2.\n1 2 3 4 5 6 7 8 9 \u003e\u003e\u003e x = SomeClass() \u003e\u003e\u003e y = x \u003e\u003e\u003e del x \u003e\u003e\u003e y # 检查一下y是否存在 \u003c__main__.SomeClass instance at 0x7f98a1a67fc8\u003e \u003e\u003e\u003e del y # 像之前一样, 这里应该会输出 \"Deleted!\" \u003e\u003e\u003e globals() # 好吧, 并没有. 让我们看一下所有的全局变量 Deleted! {'__builtins__': \u003cmodule '__builtin__' (built-in)\u003e, 'SomeClass': \u003cclass __main__.SomeClass at 0x7f98a1a5f668\u003e, '__package__': None, '__name__': '__main__', '__doc__': None} 好了，现在它被删除了 :confused:\n💡 说明: del x 并不会立刻调用 x.__del__(). 每当遇到 del x, Python 会将 x 的引用数减1, 当 x 的引用数减到0时就会调用 x.__del__(). 在第二个例子中, y.__del__() 之所以未被调用, 是因为前一条语句 (\u003e\u003e\u003e y) 对同一对象创建了另一个引用, 从而防止在执行 del y 后对象的引用数变为0. 调用 globals 导致引用被销毁, 因此我们可以看到 “Deleted!” 终于被输出了. (译: 这其实是 Python 交互解释器的特性, 它会自动让 _ 保存上一个表达式输出的值, 详细可以看这里 .) \u003e Deleting a list item while iterating/迭代列表时删除元素 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 list_1 = [1, 2, 3, 4] list_2 = [1, 2, 3, 4] list_3 = [1, 2, 3, 4] list_4 = [1, 2, 3, 4] for idx, item in enumerate(list_1): del item for idx, item in enumerate(list_2): list_2.remove(item) for idx, item in enumerate(list_3[:]): list_3.remove(item) for idx, item in enumerate(list_4): list_4.pop(idx) Output:\n1 2 3 4 5 6 7 8 \u003e\u003e\u003e list_1 [1, 2, 3, 4] \u003e\u003e\u003e list_2 [2, 4] \u003e\u003e\u003e list_3 [] \u003e\u003e\u003e list_4 [2, 4] 你能猜到为什么输出是 [2, 4] 吗?\n💡 说明: 在迭代时修改对象是一个很愚蠢的主意. 正确的做法是迭代对象的副本, list_3[:] 就是这么做的.\n1 2 3 4 5 \u003e\u003e\u003e some_list = [1, 2, 3, 4] \u003e\u003e\u003e id(some_list) 139798789457608 \u003e\u003e\u003e id(some_list[:]) # 注意python为切片列表创建了新对象. 139798779601192 del, remove 和 pop 的不同:\ndel var_name 只是从本地或全局命名空间中删除了 var_name (这就是为什么 list_1 没有受到影响). remove 会删除第一个匹配到的指定值, 而不是特定的索引, 如果找不到值则抛出 ValueError 异常. pop 则会删除指定索引处的元素并返回它, 如果指定了无效的索引则抛出 IndexError 异常. 为什么输出是 [2, 4]?\n列表迭代是按索引进行的, 所以当我们从 list_2 或 list_4 中删除 1 时, 列表的内容就变成了 [2, 3, 4]. 剩余元素会依次位移, 也就是说, 2 的索引会变为 0, 3 会变为 1. 由于下一次迭代将获取索引为 1 的元素 (即 3), 因此 2 将被彻底的跳过. 类似的情况会交替发生在列表中的每个元素上. 参考这个StackOverflow的回答 来解释这个例子 关于Python中字典的类似例子, 可以参考这个Stackoverflow的回答 . \u003e Loop variables leaking out!/循环变量泄漏! 1.\n1 2 3 4 for x in range(7): if x == 6: print(x, ': for x inside loop') print(x, ': x in global') Output:\n1 2 6 : for x inside loop 6 : x in global 但是 x 从未在循环外被定义…\n2.\n1 2 3 4 5 6 # 这次我们先初始化x x = -1 for x in range(7): if x == 6: print(x, ': for x inside loop') print(x, ': x in global') Output:\n1 2 6 : for x inside loop 6 : x in global 3.\nx = 1\rprint([x for x in range(5)])\rprint(x, ': x in global') Output (on Python 2.x):\n[0, 1, 2, 3, 4]\r(4, ': x in global') Output (on Python 3.x):\n[0, 1, 2, 3, 4]\r1 : x in global 💡 说明: 在 Python 中, for 循环使用所在作用域并在结束后保留定义的循环变量. 如果我们曾在全局命名空间中定义过循环变量. 在这种情况下, 它会重新绑定现有变量.\nPython 2.x 和 Python 3.x 解释器在列表推导式示例中的输出差异, 在文档 What’s New In Python 3.0 中可以找到相关的解释:\n“列表推导不再支持句法形式 [... for var in item1, item2, ...]. 取而代之的是 [... for var in (item1, item2, ...)]. 另外, 注意列表推导具有不同的语义: 它们更接近于 list() 构造函数中生成器表达式的语法糖(译: 这一句我也不是很明白), 特别是循环控制变量不再泄漏到周围的作用域中.”\n\u003e Beware of default mutable arguments!/当心默认的可变参数! 1 2 3 def some_func(default_arg=[]): default_arg.append(\"some_string\") return default_arg Output:\n1 2 3 4 5 6 7 8 \u003e\u003e\u003e some_func() ['some_string'] \u003e\u003e\u003e some_func() ['some_string', 'some_string'] \u003e\u003e\u003e some_func([]) ['some_string'] \u003e\u003e\u003e some_func() ['some_string', 'some_string', 'some_string'] 💡 说明: Python中函数的默认可变参数并不是每次调用该函数时都会被初始化. 相反, 它们会使用最近分配的值作为默认值. 当我们明确的将 [] 作为参数传递给 some_func 的时候, 就不会使用 default_arg 的默认值, 所以函数会返回我们所期望的结果.\n1 2 3 def some_func(default_arg=[]): default_arg.append(\"some_string\") return default_arg Output:\n1 2 3 4 5 6 7 8 9 10 11 \u003e\u003e\u003e some_func.__defaults__ # 这里会显示函数的默认参数的值 ([],) \u003e\u003e\u003e some_func() \u003e\u003e\u003e some_func.__defaults__ (['some_string'],) \u003e\u003e\u003e some_func() \u003e\u003e\u003e some_func.__defaults__ (['some_string', 'some_string'],) \u003e\u003e\u003e some_func([]) \u003e\u003e\u003e some_func.__defaults__ (['some_string', 'some_string'],) 避免可变参数导致的错误的常见做法是将 None 指定为参数的默认值, 然后检查是否有值传给对应的参数. 例:\n1 2 3 4 5 def some_func(default_arg=None): if not default_arg: default_arg = [] default_arg.append(\"some_string\") return default_arg \u003e Catching the Exceptions/捕获异常 1 2 3 4 5 6 7 8 9 10 11 12 some_list = [1, 2, 3] try: # 这里会抛出异常 ``IndexError`` print(some_list[4]) except IndexError, ValueError: print(\"Caught!\") try: # 这里会抛出异常 ``ValueError`` some_list.remove(4) except IndexError, ValueError: print(\"Caught again!\") Output (Python 2.x):\n1 2 3 Caught! ValueError: list.remove(x): x not in list Output (Python 3.x):\n1 2 3 4 File \"\", line 3 except IndexError, ValueError: ^ SyntaxError: invalid syntax 💡 说明: 如果你想要同时捕获多个不同类型的异常时, 你需要将它们用括号包成一个元组作为第一个参数传递. 第二个参数是可选名称, 如果你提供, 它将与被捕获的异常实例绑定. 例,\n1 2 3 4 5 6 7 some_list = [1, 2, 3] try: # 这里会抛出异常 ``ValueError`` some_list.remove(4) except (IndexError, ValueError), e: print(\"Caught again!\") print(e) Output (Python 2.x):\nCaught again!\rlist.remove(x): x not in list Output (Python 3.x):\n1 2 3 4 File \"\", line 4 except (IndexError, ValueError), e: ^ IndentationError: unindent does not match any outer indentation level 在 Python 3 中, 用逗号区分异常与可选名称是无效的; 正确的做法是使用 as 关键字. 例,\n1 2 3 4 5 6 7 some_list = [1, 2, 3] try: some_list.remove(4) except (IndexError, ValueError) as e: print(\"Caught again!\") print(e) Output:\nCaught again!\rlist.remove(x): x not in list \u003e Same operands, different story!/同人不同命! 1.\n1 2 3 a = [1, 2, 3, 4] b = a a = a + [5, 6, 7, 8] Output:\n1 2 3 4 \u003e\u003e\u003e a [1, 2, 3, 4, 5, 6, 7, 8] \u003e\u003e\u003e b [1, 2, 3, 4] 2.\n1 2 3 a = [1, 2, 3, 4] b = a a += [5, 6, 7, 8] Output:\n1 2 3 4 \u003e\u003e\u003e a [1, 2, 3, 4, 5, 6, 7, 8] \u003e\u003e\u003e b [1, 2, 3, 4, 5, 6, 7, 8] 💡 说明: a += b 并不总是与 a = a + b 表现相同. 类实现 op= 运算符的方式 也许 是不同的, 列表就是这样做的.\n表达式 a = a + [5,6,7,8] 会生成一个新列表, 并让 a 引用这个新列表, 同时保持 b 不变.\n表达式 a += [5,6,7,8] 实际上是使用的是 “extend” 函数, 所以 a 和 b 仍然指向已被修改的同一列表.\n\u003e The out of scope variable/外部作用域变量 1 2 3 4 5 6 7 a = 1 def some_func(): return a def another_func(): a += 1 return a Output:\n1 2 3 4 \u003e\u003e\u003e some_func() 1 \u003e\u003e\u003e another_func() UnboundLocalError: local variable 'a' referenced before assignment 💡 说明: 当你在作用域中对变量进行赋值时, 变量会变成该作用域内的局部变量. 因此 a 会变成 another_func 函数作用域中的局部变量, 但它在函数作用域中并没有被初始化, 所以会引发错误.\n可以阅读这个 简短却很棒的指南, 了解更多关于 Python 中命名空间和作用域的工作原理.\n想要在 another_func 中修改外部作用域变量 a 的话, 可以使用 global 关键字.\n1 2 3 4 def another_func() global a a += 1 return a Output:\n1 2 \u003e\u003e\u003e another_func() 2 \u003e Be careful with chained operations/小心链式操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u003e\u003e\u003e (False == False) in [False] # 可以理解 False \u003e\u003e\u003e False == (False in [False]) # 可以理解 False \u003e\u003e\u003e False == False in [False] # 为毛? True \u003e\u003e\u003e True is False == False False \u003e\u003e\u003e False is False is False True \u003e\u003e\u003e 1 \u003e 0 \u003c 1 True \u003e\u003e\u003e (1 \u003e 0) \u003c 1 False \u003e\u003e\u003e 1 \u003e (0 \u003c 1) False 💡 说明: 根据 https://docs.python.org/2/reference/expressions.html#not-in 形式上, 如果 a, b, c, …, y, z 是表达式, 而 op1, op2, …, opN 是比较运算符, 那么除了每个表达式最多只出现一次以外 a op1 b op2 c … y opN z 就等于 a op1 b and b op2 c and … y opN z.\n虽然上面的例子似乎很愚蠢, 但是像 a == b == c 或 0 \u003c= x \u003c= 100 就很棒了.\nFalse is False is False 相当于 (False is False) and (False is False) True is False == False 相当于 True is False and False == False, 由于语句的第一部分 (True is False) 等于 False, 因此整个表达式的结果为 False. 1 \u003e 0 \u003c 1 相当于 1 \u003e 0 and 0 \u003c 1, 所以最终结果为 True. 表达式 (1 \u003e 0) \u003c 1 相当于 True \u003c 1 且 1 2 3 4 \u003e\u003e\u003e int(True) 1 \u003e\u003e\u003e True + 1 # 与这个例子无关，只是好玩 2 所以, 1 \u003c 1 等于 False \u003e Name resolution ignoring class scope/忽略类作用域的名称解析 1.\n1 2 3 4 x = 5 class SomeClass: x = 17 y = (x for i in range(10)) Output:\n1 2 \u003e\u003e\u003e list(SomeClass.y)[0] 5 2.\n1 2 3 4 x = 5 class SomeClass: x = 17 y = [x for i in range(10)] Output (Python 2.x):\n1 2 \u003e\u003e\u003e SomeClass.y[0] 17 Output (Python 3.x):\n1 2 \u003e\u003e\u003e SomeClass.y[0] 5 💡 说明: 类定义中嵌套的作用域会忽略类内的名称绑定. 生成器表达式有它自己的作用域. 从 Python 3.X 开始, 列表推导式也有自己的作用域. \u003e Needle in a Haystack/大海捞针 1.\n1 x, y = (0, 1) if True else None, None Output:\n\u003e\u003e\u003e x, y # 期望的结果是 (0, 1)\r((0, 1), None) 几乎每个 Python 程序员都遇到过类似的情况.\n2.\n1 2 3 4 5 6 7 8 9 10 t = ('one', 'two') for i in t: print(i) t = ('one') for i in t: print(i) t = () print(t) Output:\n1 2 3 4 5 6 one two o n e tuple() 💡 说明: 对于 1, 正确的语句是 x, y = (0, 1) if True else (None, None). 对于 2, 正确的语句是 t = ('one',) 或者 t = 'one', (缺少逗号) 否则解释器会认为 t 是一个字符串, 并逐个字符对其进行迭代. () 是一个特殊的标记，表示空元组. Section: The Hidden treasures!/隐藏的宝藏! This section contains few of the lesser-known interesting things about Python that most beginners like me are unaware of (well, not anymore).\n\u003e Okay Python, Can you make me fly?/Python, 可否带我飞? * 好, 去吧.\n1 import antigravity Output: 嘘.. 这是个超级秘密.\n💡 说明: antigravity 模块是 Python 开发人员发布的少数复活节彩蛋之一. import antigravity 会打开一个 Python 的经典 XKCD 漫画 页面. 不止如此. 这个复活节彩蛋里还有一个复活节彩蛋. 如果你看一下代码 , 就会发现还有一个函数实现了 XKCD’s geohashing 算法 . \u003e goto, but why?/goto, 但为什么? * 1 2 3 4 5 6 7 8 9 from goto import goto, label for i in range(9): for j in range(9): for k in range(9): print(\"I'm trapped, please rescue!\") if k == 2: goto .breakout # 从多重循环中跳出 label .breakout print(\"Freedom!\") Output (Python 2.3):\n1 2 3 I'm trapped, please rescue! I'm trapped, please rescue! Freedom! 💡 说明: 2004年4月1日, Python 宣布 加入一个可用的 goto 作为愚人节礼物. 当前版本的 Python 并没有这个模块. 就算可以用, 也请不要使用它. 这里是为什么Python中没有 goto 的原因 . \u003e Brace yourself!/做好思想准备 * 如果你不喜欢在Python中使用空格来表示作用域, 你可以导入 C 风格的 {},\n1 from __future__ import braces Output:\n1 2 3 File \"some_file.py\", line 1 from __future__ import braces SyntaxError: not a chance 想用大括号? 没门! 觉得不爽, 请去用java.\n💡 说明: 通常 __future__ 会提供 Python 未来版本的功能. 然而，这里的 “未来” 是一个讽刺. 这是一个表达社区对此类问题态度的复活节彩蛋. \u003e Let’s meet Friendly Language Uncle For Life/让生活更友好 * Output (Python 3.x)\n1 2 3 4 5 6 7 8 9 \u003e\u003e\u003e from __future__ import barry_as_FLUFL \u003e\u003e\u003e \"Ruby\" != \"Python\" # 这里没什么疑问 File \"some_file.py\", line 1 \"Ruby\" != \"Python\" ^ SyntaxError: invalid syntax \u003e\u003e\u003e \"Ruby\" \u003c\u003e \"Python\" True 这就对了.\n💡 说明: 相关的 PEP-401 发布于 2009年4月1日 (所以你现在知道这意味着什么了吧).\n引用 PEP-401\n意识到 Python 3.0 里的 != 运算符是一个会引起手指疼痛的恐怖错误, FLUFL 将 \u003c\u003e 运算符恢复为唯一写法.\nUncle Barry 在 PEP 中还分享了其他东西; 你可以在这里 获得他们.\n(译: 虽然文档中没写，但应该是只能在交互解释器中使用.)\n\u003e Even Python understands that love is complicated/连Python也知道爱是难言的 * 1 import this 等等, this 是什么? this 是爱 :heart:\nOutput:\nThe Zen of Python, by Tim Peters\rBeautiful is better than ugly.\r优美胜于丑陋（Python 以编写优美的代码为目标）\rExplicit is better than implicit.\r明了胜于晦涩（优美的代码应当是明了的，命名规范，风格相似）\rSimple is better than complex.\r简洁胜于复杂（优美的代码应当是简洁的，不要有复杂的内部实现）\rComplex is better than complicated.\r复杂胜于凌乱（如果复杂不可避免，那代码间也不能有难懂的关系，要保持接口简洁）\rFlat is better than nested.\r扁平胜于嵌套（优美的代码应当是扁平的，不能有太多的嵌套）\rSparse is better than dense.\r间隔胜于紧凑（优美的代码有适当的间隔，不要奢望一行代码解决问题）\rReadability counts.\r可读性很重要（优美的代码一定是可读的）\rSpecial cases aren't special enough to break the rules.\r没有特例特殊到需要违背这些规则（这些规则至高无上）\rAlthough practicality beats purity.\r尽管我们更倾向于实用性\rErrors should never pass silently.\r不要安静的包容所有错误\rUnless explicitly silenced.\r除非你确定需要这样做（精准地捕获异常，不写 except:pass 风格的代码）\rIn the face of ambiguity, refuse the temptation to guess.\r拒绝诱惑你去猜测的暧昧事物\rThere should be one-- and preferably only one --obvious way to do it.\r而是尽量找一种，最好是唯一一种明显的解决方案（如果不确定，就用穷举法）\rAlthough that way may not be obvious at first unless you're Dutch.\r虽然这并不容易，因为你不是 Python 之父（这里的 Dutch 是指 Guido ）\rNow is better than never.\r现在行动好过永远不行动\rAlthough never is often better than *right* now.\r尽管不行动要好过鲁莽行动\rIf the implementation is hard to explain, it's a bad idea.\r如果你无法向人描述你的方案，那肯定不是一个好方案；\rIf the implementation is easy to explain, it may be a good idea.\r如果你能轻松向人描述你的方案，那也许会是一个好方案（方案测评标准）\rNamespaces are one honking great idea -- let's do more of those!\r命名空间是一种绝妙的理念，我们应当多加利用（倡导与号召） 这是 Python 之禅!\n1 2 3 4 5 6 7 8 9 10 11 \u003e\u003e\u003e love = this \u003e\u003e\u003e this is love True \u003e\u003e\u003e love is True False \u003e\u003e\u003e love is False False \u003e\u003e\u003e love is not True or False True \u003e\u003e\u003e love is not True or False; love is love # 爱是难言的 True 💡 说明: this 模块是关于 Python 之禅的复活节彩蛋 (PEP 20 ). 如果你认为这已经够有趣的了, 可以看看 this.py 的实现. 有趣的是, Python 之禅的实现代码违反了他自己 (这可能是唯一会发生这种情况的地方). * 至于 love is not True or False; love is love, 意外却又不言而喻. \u003e Yes, it exists!/是的, 它存在! 循环的 else. 一个典型的例子:\n1 2 3 4 5 6 7 def does_exists_num(l, to_find): for num in l: if num == to_find: print(\"Exists!\") break else: print(\"Does not exist\") Output:\n1 2 3 4 5 \u003e\u003e\u003e some_list = [1, 2, 3, 4, 5] \u003e\u003e\u003e does_exists_num(some_list, 4) Exists! \u003e\u003e\u003e does_exists_num(some_list, -1) Does not exist 异常的 else . 例,\n1 2 3 4 5 6 try: pass except: print(\"Exception occurred!!!\") else: print(\"Try block executed successfully...\") Output:\n1 Try block executed successfully... 💡 说明: 循环后的 else 子句只会在循环没有触发 break 语句, 正常结束的情况下才会执行. try 之后的 else 子句也被称为 “完成子句”, 因为在 try 语句中到达 else 子句意味着try块实际上已成功完成. \u003e Inpinity/无限 * 英文拼写是有意的, 请不要为此提交补丁. (译: 这里是为了突出 Python 中无限的定义与Pi 有关, 所以将两个单词拼接了.)\nOutput (Python 3.x):\n1 2 3 4 5 \u003e\u003e\u003e infinity = float('infinity') \u003e\u003e\u003e hash(infinity) 314159 \u003e\u003e\u003e hash(float('-inf')) -314159 💡 说明: infinity 的哈希值是 10⁵ x π. 有意思的是, float('-inf') 的哈希值在 Python 3 中是 “-10⁵ x π” , 而在 Python 2 中是 “-10⁵ x e”. \u003e Mangling time!/修饰时间! * 1 2 3 4 class Yo(object): def __init__(self): self.__honey = True self.bitch = True Output:\n1 2 3 4 5 6 \u003e\u003e\u003e Yo().bitch True \u003e\u003e\u003e Yo().__honey AttributeError: 'Yo' object has no attribute '__honey' \u003e\u003e\u003e Yo()._Yo__honey True 为什么 Yo()._Yo__honey 能运行? 只有印度人理解.(译: 这个梗可能是指印度音乐人Yo Yo Honey Singh )\n💡 说明: 名字修饰 用于避免不同命名空间之间名称冲突. 在 Python 中, 解释器会通过给类中以 __ (双下划线)开头且结尾最多只有一个下划线的类成员名称加上_NameOfTheClass 来修饰(mangles)名称. 所以, 要访问 __honey 对象,我们需要加上 _Yo 以防止与其他类中定义的相同名称的属性发生冲突. Section: Miscellaneous/杂项 \u003e += is faster/更快的 += 1 2 3 4 5 6 # 用 \"+\" 连接三个字符串: \u003e\u003e\u003e timeit.timeit(\"s1 = s1 + s2 + s3\", setup=\"s1 = ' ' * 100000; s2 = ' ' * 100000; s3 = ' ' * 100000\", number=100) 0.25748300552368164 # 用 \"+=\" 连接三个字符串: \u003e\u003e\u003e timeit.timeit(\"s1 += s2 + s3\", setup=\"s1 = ' ' * 100000; s2 = ' ' * 100000; s3 = ' ' * 100000\", number=100) 0.012188911437988281 💡 说明: 连接两个以上的字符串时 += 比 + 更快, 因为在计算过程中第一个字符串 (例如, s1 += s2 + s3 中的 s1) 不会被销毁.(译: 就是 += 执行的是追加操作，少了一个销毁新建的动作.) \u003e Let’s make a giant string!/来做个巨大的字符串吧！ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 def add_string_with_plus(iters): s = \"\" for i in range(iters): s += \"xyz\" assert len(s) == 3*iters def add_bytes_with_plus(iters): s = b\"\" for i in range(iters): s += b\"xyz\" assert len(s) == 3*iters def add_string_with_format(iters): fs = \"{}\"*iters s = fs.format(*([\"xyz\"]*iters)) assert len(s) == 3*iters def add_string_with_join(iters): l = [] for i in range(iters): l.append(\"xyz\") s = \"\".join(l) assert len(s) == 3*iters def convert_list_to_string(l, iters): s = \"\".join(l) assert len(s) == 3*iters Output:\n1 2 3 4 5 6 7 8 9 10 11 \u003e\u003e\u003e timeit(add_string_with_plus(10000)) 1000 loops, best of 3: 972 µs per loop \u003e\u003e\u003e timeit(add_bytes_with_plus(10000)) 1000 loops, best of 3: 815 µs per loop \u003e\u003e\u003e timeit(add_string_with_format(10000)) 1000 loops, best of 3: 508 µs per loop \u003e\u003e\u003e timeit(add_string_with_join(10000)) 1000 loops, best of 3: 878 µs per loop \u003e\u003e\u003e l = [\"xyz\"]*10000 \u003e\u003e\u003e timeit(convert_list_to_string(l, 10000)) 10000 loops, best of 3: 80 µs per loop 让我们将迭代次数增加10倍.\n1 2 3 4 5 6 7 8 9 10 11 \u003e\u003e\u003e timeit(add_string_with_plus(100000)) # 执行时间线性增加 100 loops, best of 3: 9.75 ms per loop \u003e\u003e\u003e timeit(add_bytes_with_plus(100000)) # 二次增加 1000 loops, best of 3: 974 ms per loop \u003e\u003e\u003e timeit(add_string_with_format(100000)) # 线性增加 100 loops, best of 3: 5.25 ms per loop \u003e\u003e\u003e timeit(add_string_with_join(100000)) # 线性增加 100 loops, best of 3: 9.85 ms per loop \u003e\u003e\u003e l = [\"xyz\"]*100000 \u003e\u003e\u003e timeit(convert_list_to_string(l, 100000)) # 线性增加 1000 loops, best of 3: 723 µs per loop 💡 说明: 你可以在这获得更多 timeit 的相关信息. 它通常用于衡量代码片段的执行时间. 不要用 + 去生成过长的字符串, 在 Python 中, str 是不可变的, 所以在每次连接中你都要把左右两个字符串复制到新的字符串中. 如果你连接四个长度为10的字符串, 你需要拷贝 (10+10) + ((10+10)+10) + (((10+10)+10)+10) = 90 个字符而不是 40 个字符. 随着字符串的数量和大小的增加, 情况会变得越发的糟糕 (就像add_bytes_with_plus 函数的执行时间一样) 因此, 更建议使用 .format. 或 % 语法 (但是, 对于短字符串, 它们比 + 稍慢一点). 又或者, 如果你所需的内容已经以可迭代对象的形式提供了, 使用 ''.join(可迭代对象) 要快多了. add_string_with_plus 的执行时间没有像 add_bytes_with_plus 一样出现二次增加是因为解释器会如同上一个例子所讨论的一样优化 +=. 用 s = s + \"x\" + \"y\" + \"z\" 替代 s += \"xyz\" 的话, 执行时间就会二次增加了. 1 2 3 4 5 6 7 8 9 10 def add_string_with_plus(iters): s = \"\" for i in range(iters): s = s + \"x\" + \"y\" + \"z\" assert len(s) == 3*iters \u003e\u003e\u003e timeit(add_string_with_plus(10000)) 100 loops, best of 3: 9.87 ms per loop \u003e\u003e\u003e timeit(add_string_with_plus(100000)) # 执行时间二次增加 1 loops, best of 3: 1.09 s per loop \u003e Explicit typecast of strings/字符串的显式类型转换 1 2 3 4 a = float('inf') b = float('nan') c = float('-iNf') # 这些字符串不区分大小写 d = float('nan') Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u003e\u003e\u003e a inf \u003e\u003e\u003e b nan \u003e\u003e\u003e c -inf \u003e\u003e\u003e float('some_other_string') ValueError: could not convert string to float: some_other_string \u003e\u003e\u003e a == -c #inf==inf True \u003e\u003e\u003e None == None # None==None True \u003e\u003e\u003e b == d #但是 nan!=nan False \u003e\u003e\u003e 50/a 0.0 \u003e\u003e\u003e a/a nan \u003e\u003e\u003e 23 + b nan 💡 说明: 'inf' 和 'nan' 是特殊的字符串(不区分大小写), 当显示转换成 float 型时, 它们分别用于表示数学意义上的 “无穷大” 和 “非数字”.\n\u003e Minor Ones/小知识点 join() 是一个字符串操作而不是列表操作. (第一次接触会觉得有点违反直觉)\n💡 说明: 如果 join() 是字符串方法 那么它就可以处理任何可迭代的对象(列表，元组，迭代器). 如果它是列表方法, 则必须在每种类型中单独实现. 另外, 在 list 对象的通用API中实现一个专用于字符串的方法没有太大的意义.\n看着奇怪但能正确运行的语句:\n[] = () 语句在语义上是正确的 (解包一个空的 tuple 并赋值给 list) 'a'[0][0][0][0][0] 在语义上也是正确的, 因为在 Python 中字符串同时也是序列 (可迭代对象支持使用整数索引访问元素). 3 --0-- 5 == 8 和 --5 == 5 在语义上都是正确的, 且结果等于 True.(译: 3减负0等于3，再减负5相当于加5等于8；负的负5等于5.) 鉴于 a 是一个数字, ++a 和 --a 都是有效的 Python 语句, 但其效果与 C, C++ 或 Java 等不一样.\n1 2 3 4 5 6 7 \u003e\u003e\u003e a = 5 \u003e\u003e\u003e a 5 \u003e\u003e\u003e ++a 5 \u003e\u003e\u003e --a 5 💡 说明:\npython 里没有 ++ 操作符. 这其实是两个 + 操作符. ++a 被解析为 +(+a) 最后等于 a. --a 同理. 这个 StackOverflow 回答 讨论了为什么 Python 中缺少增量和减量运算符. Python 使用 2个字节存储函数中的本地变量. 理论上, 这意味着函数中只能定义65536个变量. 但是，Python 内置了一个方便的解决方案，可用于存储超过2^16个变量名. 下面的代码演示了当定义了超过65536个局部变量时堆栈中发生的情况 (警告: 这段代码会打印大约2^18行文本, 请做好准备!):\n1 2 3 4 5 6 7 8 9 import dis exec(\"\"\" def f(): \"\"\" + \"\"\" \"\"\".join([\"X\"+str(x)+\"=\" + str(x) for x in range(65539)])) f() print(dis.dis(f)) 你的 Python 代码 并不会多线程同时运行 (是的, 你没听错!). 虽然你觉得会产生多个线程并让它们同时执行你的代码, 但是, 由于 全局解释锁 的存在, 你所做的只是让你的线程依次在同一个核心上执行. Python 多线程适用于IO密集型的任务, 但如果想要并行处理CPU密集型的任务, 你应该会想使用 multiprocessing 模块.\n列表切片超出索引边界而不引发任何错误\n1 2 3 \u003e\u003e\u003e some_list = [1, 2, 3, 4, 5] \u003e\u003e\u003e some_list[111:] [] int('١٢٣٤٥٦٧٨٩') 在 Python 3 中会返回 123456789. 在 Python 中, 十进制字符包括数字字符, 以及可用于形成十进制数字的所有字符, 例如: U+0660, ARABIC-INDIC DIGIT ZERO. 这有一个关于此的 有趣故事 .\n'abc'.count('') == 4. 这有一个 count 方法的相近实现, 能更好的说明问题\n1 2 3 4 5 def count(s, sub): result = 0 for i in range(len(s) + 1 - len(sub)): result += (s[i:i + len(sub)] == sub) return result 这个行为是由于空子串('')与原始字符串中长度为0的切片相匹配导致的.\nContributing/贡献 欢迎各种补丁! 详情请看CONTRIBUTING.md .(译: 这是给原库提贡献的要求模版)\n你可以通过新建 issue 或者在上 Gitter 与我们进行讨论.\n(译: 如果你想对这个翻译项目提供帮助, 请看这里 )\nAcknowledgements/致谢 这个系列最初的想法和设计灵感来自于 Denys Dovhan 的项目 wtfjs . 社区的强大支持让它成长为现在的模样.\nSome nice Links!/一些不错的资源 https://www.youtube.com/watch?v=sH4XF6pKKmk https://www.reddit.com/r/Python/comments/3cu6ej/what_are_some_wtf_things_about_python https://sopython.com/wiki/Common_Gotchas_In_Python https://stackoverflow.com/questions/530530/python-2-x-gotchas-and-landmines https://stackoverflow.com/questions/1011431/common-pitfalls-in-python https://www.python.org/doc/humor/ https://www.codementor.io/satwikkansal/python-practices-for-efficient-code-performance-memory-and-usability-aze6oiq65 🎓 License/许可 © Satwik Kansal Help/帮助 如果您有任何想法或建议，欢迎分享.\nSurprise your geeky pythonist friends?/想给你的极客朋友一个惊喜? 您可以使用这些快链向 Twitter 和 Linkedin 上的朋友推荐 wtfpython,\nTwitter | Linkedin Need a pdf version?/需要来一份pdf版的? 我收到一些想要pdf版本的需求. 你可以快速在这 获得.\nFollow Commit/追踪Commit 这是中文版 fork 时所处的原库 Commit, 当原库更新时我会跟随更新.\n996.icu ","wordCount":"6825","inLanguage":"en","image":"https://aikenh.cn/cover/cover5.jpeg","datePublished":"2021-11-28T06:24:23Z","dateModified":"2021-11-28T06:24:23Z","author":[{"@type":"Person","name":"aikenhong"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://aikenh.cn/hugotest/posts/pythontips/"},"publisher":{"@type":"Organization","name":"aiken's blog","logo":{"@type":"ImageObject","url":"https://aikenh.cn/favicon/ghost.ico"}}}</script></head><body id=top><script type=module src=https://cdn.jsdmirror.com/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js defer></script><script nomodule src=https://cdn.jsdmirror.com/npm/ionicons@7.1.0/dist/ionicons/ionicons.js defer></script><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aikenh.cn/hugotest/ accesskey=h title="aiken's blog (Alt + H)">aiken's blog</a><div class=logo-switches><button id=theme-toggle-nav accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aikenh.cn/hugotest/ title=home><span>home</span></a></li><li><a href=https://aikenh.cn/hugotest/posts/ title=posts><span>posts</span></a></li><li><a href=https://aikenh.cn/hugotest/tags/ title=tags><span>tags</span></a></li><li><a href=https://aikenh.cn/hugotest/categories/ title=categories><span>categories</span></a></li><li><a href=https://aikenh.cn/hugotest/archives/ title=archives><span>archives</span></a></li><li><a href=https://aikenh.cn/hugotest/about/ title=about><span>about</span></a></li><li><a href=https://aikenh.cn/hugotest/search title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><div class=sidebar><ul><li class=logo style=--bg:#333><a href=#><div class=logo-icon><img src=/logo/logo.png></div><div class=logo-text>Aiken's Blog</div></a></li><div class=menulist><li style=--bg:#f44336><a href=https://aikenh.cn/hugotest/ title=home><div class=logo-icon><ion-icon name=home-outline></ion-icon></div><div class=logo-text>home</div></a></li><li style=--bg:#b145e9><a href=https://aikenh.cn/hugotest/posts/ title=posts><div class=logo-icon><ion-icon name=newspaper-outline></ion-icon></div><div class=logo-text>posts</div></a></li><li style=--bg:#0f93c7><a href=https://aikenh.cn/hugotest/tags/ title=tags><div class=logo-icon><ion-icon name=pricetags-outline></ion-icon></div><div class=logo-text>tags</div></a></li><li style=--bg:#ffa117><a href=https://aikenh.cn/hugotest/categories/ title=categories><div class=logo-icon><ion-icon name=grid-outline></ion-icon></div><div class=logo-text>categories</div></a></li><li style=--bg:#0fc70f><a href=https://aikenh.cn/hugotest/archives/ title=archives><div class=logo-icon><ion-icon name=folder-outline></ion-icon></div><div class=logo-text>archives</div></a></li><li style=--bg:#d16111><a href=https://aikenh.cn/hugotest/about/ title=about><div class=logo-icon><ion-icon name=person></ion-icon></div><div class=logo-text>about</div></a></li><li style=--bg:#15c095><a href=https://aikenh.cn/hugotest/search title="search (Alt + /)" accesskey=/><div class=logo-icon><ion-icon name=search></ion-icon></div><div class=logo-text>search</div></a></li></div><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt +T)"><li><div class=logo-icon id=moon><ion-icon name=moon-outline></ion-icon></div><div class=logo-icon id=sun><ion-icon name=sunny-outline></ion-icon></div></li></button></div></ul></div><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aikenh.cn/hugotest/>Home</a>&nbsp;»&nbsp;<a href=https://aikenh.cn/hugotest/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">（转）What the Fuck Python！ 一些python特性</h1><div class=post-meta><span title='2021-11-28 06:24:23 +0000 UTC'>November 28, 2021</span>&nbsp;·&nbsp;33 min&nbsp;·&nbsp;6825 words&nbsp;·&nbsp;aikenhong&nbsp;·&nbsp;<a href=/tags/langs> Langs</a>&nbsp;·&nbsp;<a href=/tags/python> Python</a>&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/PythonTips.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://aikenh.cn/cover/cover5.jpeg alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=# aria-label="What the f*ck Python! 🐍">What the f*ck Python! 🐍</a></li><li><a href=#table-of-contents%e7%9b%ae%e5%bd%95 aria-label="Table of Contents/目录">Table of Contents/目录</a></li><li><a href=#structure-of-the-examples%e7%a4%ba%e4%be%8b%e7%bb%93%e6%9e%84 aria-label="Structure of the Examples/示例结构">Structure of the Examples/示例结构</a><ul class=header-level-2><ul class=header-level-2><li><a href=#-%e4%b8%80%e4%b8%aa%e7%b2%be%e9%80%89%e7%9a%84%e6%a0%87%e9%a2%98- aria-label="> 一个精选的标题 *">> 一个精选的标题 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e aria-label="💡 说明:">💡 说明:</a></li></ul></li></ul></ul></li><li><a href=#usage%e7%94%a8%e6%b3%95 aria-label=Usage/用法>Usage/用法</a></li><li><a href=#-examples%e7%a4%ba%e4%be%8b aria-label="👀 Examples/示例">👀 Examples/示例</a><ul class=header-level-1><li><a href=#section-strain-your-brain%e5%a4%a7%e8%84%91%e8%bf%90%e5%8a%a8 aria-label="Section: Strain your brain!/大脑运动!">Section: Strain your brain!/大脑运动!</a><ul class=header-level-2><li><a href=#-strings-can-be-tricky-sometimes%e5%be%ae%e5%a6%99%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2- aria-label="> Strings can be tricky sometimes/微妙的字符串 *">> Strings can be tricky sometimes/微妙的字符串 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-1 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-time-for-some-hash-brownies%e6%98%af%e6%97%b6%e5%80%99%e6%9d%a5%e7%82%b9%e8%9b%8b%e7%b3%95%e4%ba%86 aria-label="> Time for some hash brownies!/是时候来点蛋糕了!">> Time for some hash brownies!/是时候来点蛋糕了!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-2 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-return-return-everywhere%e5%88%b0%e5%a4%84%e8%bf%94%e5%9b%9e aria-label="> Return return everywhere!/到处返回！">> Return return everywhere!/到处返回！</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-3 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-deep-down-were-all-the-same%e6%9c%ac%e8%b4%a8%e4%b8%8a%e6%88%91%e4%bb%ac%e9%83%bd%e4%b8%80%e6%a0%b7- aria-label="> Deep down, we&rsquo;re all the same./本质上,我们都一样. *">> Deep down, we&rsquo;re all the same./本质上,我们都一样. *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-4 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-for-what%e4%b8%ba%e4%bb%80%e4%b9%88 aria-label="> For what?/为什么?">> For what?/为什么?</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-5 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-evaluation-time-discrepancy%e6%89%a7%e8%a1%8c%e6%97%b6%e6%9c%ba%e5%b7%ae%e5%bc%82 aria-label="> Evaluation time discrepancy/执行时机差异">> Evaluation time discrepancy/执行时机差异</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-6 aria-label="💡 说明">💡 说明</a></li></ul></li><li><a href=#-is-is-not-what-it-is%e5%87%ba%e4%ba%ba%e6%84%8f%e6%96%99%e7%9a%84is aria-label="> is is not what it is!/出人意料的is!">> <code>is</code> is not what it is!/出人意料的<code>is</code>!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-7 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-a-tic-tac-toe-where-x-wins-in-the-first-attempt%e4%b8%80%e8%b9%b4%e5%8d%b3%e8%87%b3 aria-label="> A tic-tac-toe where X wins in the first attempt!/一蹴即至!">> A tic-tac-toe where X wins in the first attempt!/一蹴即至!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-8 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-the-sticky-output-function%e9%ba%bb%e7%83%a6%e7%9a%84%e8%be%93%e5%87%ba aria-label="> The sticky output function/麻烦的输出">> The sticky output function/麻烦的输出</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-9 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-is-not--is-not-is-not-is-not--%e4%b8%8d%e6%98%af-is-not- aria-label="> is not ... is not is (not ...)/is not ... 不是 is (not ...)">> <code>is not ...</code> is not <code>is (not ...)</code>/<code>is not ...</code> 不是 <code>is (not ...)</code></a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-10 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-the-surprising-comma%e6%84%8f%e5%a4%96%e7%9a%84%e9%80%97%e5%8f%b7 aria-label="> The surprising comma/意外的逗号">> The surprising comma/意外的逗号</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-11 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-backslashes-at-the-end-of-string%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%9c%ab%e5%b0%be%e7%9a%84%e5%8f%8d%e6%96%9c%e6%9d%a0 aria-label="> Backslashes at the end of string/字符串末尾的反斜杠">> Backslashes at the end of string/字符串末尾的反斜杠</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-12 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-not-knot%e5%88%ab%e7%ba%a0%e7%bb%93 aria-label="> not knot!/别纠结!">> not knot!/别纠结!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-13 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-half-triple-quoted-strings%e4%b8%89%e4%b8%aa%e5%bc%95%e5%8f%b7 aria-label="> Half triple-quoted strings/三个引号">> Half triple-quoted strings/三个引号</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-14 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-midnight-time-doesnt-exist%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84%e5%8d%88%e5%a4%9c aria-label="> Midnight time doesn&rsquo;t exist?/不存在的午夜?">> Midnight time doesn&rsquo;t exist?/不存在的午夜?</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-15 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-whats-wrong-with-booleans%e5%b8%83%e5%b0%94%e4%bd%a0%e5%92%8b%e4%ba%86 aria-label="> What&rsquo;s wrong with booleans?/布尔你咋了?">> What&rsquo;s wrong with booleans?/布尔你咋了?</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-16 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-class-attributes-and-instance-attributes%e7%b1%bb%e5%b1%9e%e6%80%a7%e5%92%8c%e5%ae%9e%e4%be%8b%e5%b1%9e%e6%80%a7 aria-label="> Class attributes and instance attributes/类属性和实例属性">> Class attributes and instance attributes/类属性和实例属性</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-17 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-yielding-none%e7%94%9f%e6%88%90-none aria-label="> yielding None/生成 None">> yielding None/生成 None</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-18 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-mutating-the-immutable%e5%bc%ba%e4%ba%ba%e6%89%80%e9%9a%be aria-label="> Mutating the immutable!/强人所难">> Mutating the immutable!/强人所难</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-19 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-the-disappearing-variable-from-outer-scope%e6%b6%88%e5%a4%b1%e7%9a%84%e5%a4%96%e9%83%a8%e5%8f%98%e9%87%8f aria-label="> The disappearing variable from outer scope/消失的外部变量">> The disappearing variable from outer scope/消失的外部变量</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-20 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-when-true-is-actually-false%e7%9c%9f%e4%ba%a6%e5%81%87 aria-label="> When True is actually False/真亦假">> When True is actually False/真亦假</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-21 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-from-filled-to-none-in-one-instruction%e4%bb%8e%e6%9c%89%e5%88%b0%e6%97%a0 aria-label="> From filled to None in one instruction&mldr;/从有到无&mldr;">> From filled to None in one instruction&mldr;/从有到无&mldr;</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-22 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-subclass-relationships%e5%ad%90%e7%b1%bb%e5%85%b3%e7%b3%bb- aria-label="> Subclass relationships/子类关系 *">> Subclass relationships/子类关系 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-23 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-the-mysterious-key-type-conversion%e7%a5%9e%e7%a7%98%e7%9a%84%e9%94%ae%e5%9e%8b%e8%bd%ac%e6%8d%a2- aria-label="> The mysterious key type conversion/神秘的键型转换 *">> The mysterious key type conversion/神秘的键型转换 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-24 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-lets-see-if-you-can-guess-this%e7%9c%8b%e7%9c%8b%e4%bd%a0%e8%83%bd%e5%90%a6%e7%8c%9c%e5%88%b0%e8%bf%99%e4%b8%80%e7%82%b9 aria-label="> Let&rsquo;s see if you can guess this?/看看你能否猜到这一点?">> Let&rsquo;s see if you can guess this?/看看你能否猜到这一点?</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-25 aria-label="💡 说明:">💡 说明:</a></li></ul></li></ul></li><li><a href=#section-appearances-are-deceptive%e5%a4%96%e8%a1%a8%e6%98%af%e9%9d%a0%e4%b8%8d%e4%bd%8f%e7%9a%84 aria-label="Section: Appearances are deceptive!/外表是靠不住的!">Section: Appearances are deceptive!/外表是靠不住的!</a><ul class=header-level-2><li><a href=#-skipping-lines%e8%b7%b3%e8%bf%87%e4%b8%80%e8%a1%8c aria-label="> Skipping lines?/跳过一行?">> Skipping lines?/跳过一行?</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-26 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-teleportation%e7%a9%ba%e9%97%b4%e7%a7%bb%e5%8a%a8- aria-label="> Teleportation/空间移动 *">> Teleportation/空间移动 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-27 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-well-something-is-fishy%e5%97%af%e6%9c%89%e4%ba%9b%e5%8f%af%e7%96%91 aria-label="> Well, something is fishy&mldr;/嗯，有些可疑&mldr;">> Well, something is fishy&mldr;/嗯，有些可疑&mldr;</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-28 aria-label="💡 说明:">💡 说明:</a></li></ul></li></ul></li><li><a href=#section-watch-out-for-the-landmines%e5%b0%8f%e5%bf%83%e5%9c%b0%e9%9b%b7 aria-label="Section: Watch out for the landmines!/小心地雷!">Section: Watch out for the landmines!/小心地雷!</a><ul class=header-level-2><li><a href=#-modifying-a-dictionary-while-iterating-over-it%e8%bf%ad%e4%bb%a3%e5%ad%97%e5%85%b8%e6%97%b6%e7%9a%84%e4%bf%ae%e6%94%b9 aria-label="> Modifying a dictionary while iterating over it/迭代字典时的修改">> Modifying a dictionary while iterating over it/迭代字典时的修改</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-29 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-stubborn-del-operator%e5%9d%9a%e5%bc%ba%e7%9a%84-del- aria-label="> Stubborn del operator/坚强的 del *">> Stubborn <code>del</code> operator/坚强的 <code>del</code> *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-30 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-deleting-a-list-item-while-iterating%e8%bf%ad%e4%bb%a3%e5%88%97%e8%a1%a8%e6%97%b6%e5%88%a0%e9%99%a4%e5%85%83%e7%b4%a0 aria-label="> Deleting a list item while iterating/迭代列表时删除元素">> Deleting a list item while iterating/迭代列表时删除元素</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-31 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-loop-variables-leaking-out%e5%be%aa%e7%8e%af%e5%8f%98%e9%87%8f%e6%b3%84%e6%bc%8f aria-label="> Loop variables leaking out!/循环变量泄漏!">> Loop variables leaking out!/循环变量泄漏!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-32 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-beware-of-default-mutable-arguments%e5%bd%93%e5%bf%83%e9%bb%98%e8%ae%a4%e7%9a%84%e5%8f%af%e5%8f%98%e5%8f%82%e6%95%b0 aria-label="> Beware of default mutable arguments!/当心默认的可变参数!">> Beware of default mutable arguments!/当心默认的可变参数!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-33 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-catching-the-exceptions%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8 aria-label="> Catching the Exceptions/捕获异常">> Catching the Exceptions/捕获异常</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-34 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-same-operands-different-story%e5%90%8c%e4%ba%ba%e4%b8%8d%e5%90%8c%e5%91%bd aria-label="> Same operands, different story!/同人不同命!">> Same operands, different story!/同人不同命!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-35 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-the-out-of-scope-variable%e5%a4%96%e9%83%a8%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%8f%98%e9%87%8f aria-label="> The out of scope variable/外部作用域变量">> The out of scope variable/外部作用域变量</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-36 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-be-careful-with-chained-operations%e5%b0%8f%e5%bf%83%e9%93%be%e5%bc%8f%e6%93%8d%e4%bd%9c aria-label="> Be careful with chained operations/小心链式操作">> Be careful with chained operations/小心链式操作</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-37 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-name-resolution-ignoring-class-scope%e5%bf%bd%e7%95%a5%e7%b1%bb%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%9a%84%e5%90%8d%e7%a7%b0%e8%a7%a3%e6%9e%90 aria-label="> Name resolution ignoring class scope/忽略类作用域的名称解析">> Name resolution ignoring class scope/忽略类作用域的名称解析</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-38 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-needle-in-a-haystack%e5%a4%a7%e6%b5%b7%e6%8d%9e%e9%92%88 aria-label="> Needle in a Haystack/大海捞针">> Needle in a Haystack/大海捞针</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-39 aria-label="💡 说明:">💡 说明:</a></li></ul></li></ul></li><li><a href=#section-the-hidden-treasures%e9%9a%90%e8%97%8f%e7%9a%84%e5%ae%9d%e8%97%8f aria-label="Section: The Hidden treasures!/隐藏的宝藏!">Section: The Hidden treasures!/隐藏的宝藏!</a><ul class=header-level-2><li><a href=#-okay-python-can-you-make-me-flypython-%e5%8f%af%e5%90%a6%e5%b8%a6%e6%88%91%e9%a3%9e- aria-label="> Okay Python, Can you make me fly?/Python, 可否带我飞? *">> Okay Python, Can you make me fly?/Python, 可否带我飞? *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-40 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-goto-but-whygoto-%e4%bd%86%e4%b8%ba%e4%bb%80%e4%b9%88- aria-label="> goto, but why?/goto, 但为什么? *">> <code>goto</code>, but why?/<code>goto</code>, 但为什么? *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-41 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-brace-yourself%e5%81%9a%e5%a5%bd%e6%80%9d%e6%83%b3%e5%87%86%e5%a4%87- aria-label="> Brace yourself!/做好思想准备 *">> Brace yourself!/做好思想准备 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-42 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-lets-meet-friendly-language-uncle-for-life%e8%ae%a9%e7%94%9f%e6%b4%bb%e6%9b%b4%e5%8f%8b%e5%a5%bd- aria-label="> Let&rsquo;s meet Friendly Language Uncle For Life/让生活更友好 *">> Let&rsquo;s meet Friendly Language Uncle For Life/让生活更友好 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-43 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-even-python-understands-that-love-is-complicated%e8%bf%9epython%e4%b9%9f%e7%9f%a5%e9%81%93%e7%88%b1%e6%98%af%e9%9a%be%e8%a8%80%e7%9a%84- aria-label="> Even Python understands that love is complicated/连Python也知道爱是难言的 *">> Even Python understands that love is complicated/连Python也知道爱是难言的 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-44 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-yes-it-exists%e6%98%af%e7%9a%84-%e5%ae%83%e5%ad%98%e5%9c%a8 aria-label="> Yes, it exists!/是的, 它存在!">> Yes, it exists!/是的, 它存在!</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-45 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-inpinity%e6%97%a0%e9%99%90- aria-label="> Inpinity/无限 *">> Inpinity/无限 *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-46 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-mangling-time%e4%bf%ae%e9%a5%b0%e6%97%b6%e9%97%b4- aria-label="> Mangling time!/修饰时间! *">> Mangling time!/修饰时间! *</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-47 aria-label="💡 说明:">💡 说明:</a></li></ul></li></ul></li><li><a href=#section-miscellaneous%e6%9d%82%e9%a1%b9 aria-label="Section: Miscellaneous/杂项">Section: Miscellaneous/杂项</a><ul class=header-level-2><li><a href=#--is-faster%e6%9b%b4%e5%bf%ab%e7%9a%84- aria-label="> += is faster/更快的 +=">> <code>+=</code> is faster/更快的 <code>+=</code></a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-48 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-lets-make-a-giant-string%e6%9d%a5%e5%81%9a%e4%b8%aa%e5%b7%a8%e5%a4%a7%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%90%a7 aria-label="> Let&rsquo;s make a giant string!/来做个巨大的字符串吧！">> Let&rsquo;s make a giant string!/来做个巨大的字符串吧！</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-49 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-explicit-typecast-of-strings%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e6%98%be%e5%bc%8f%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2 aria-label="> Explicit typecast of strings/字符串的显式类型转换">> Explicit typecast of strings/字符串的显式类型转换</a><ul class=header-level-3><li><a href=#-%e8%af%b4%e6%98%8e-50 aria-label="💡 说明:">💡 说明:</a></li></ul></li><li><a href=#-minor-ones%e5%b0%8f%e7%9f%a5%e8%af%86%e7%82%b9 aria-label="> Minor Ones/小知识点">> Minor Ones/小知识点</a></li></ul></li></ul></li><li><a href=#contributing%e8%b4%a1%e7%8c%ae aria-label=Contributing/贡献>Contributing/贡献</a></li><li><a href=#acknowledgements%e8%87%b4%e8%b0%a2 aria-label=Acknowledgements/致谢>Acknowledgements/致谢</a><ul class=header-level-3><ul class=header-level-3><ul class=header-level-3><li><a href=#some-nice-links%e4%b8%80%e4%ba%9b%e4%b8%8d%e9%94%99%e7%9a%84%e8%b5%84%e6%ba%90 aria-label="Some nice Links!/一些不错的资源">Some nice Links!/一些不错的资源</a></li></ul></ul></ul></li><li><a href=#-license%e8%ae%b8%e5%8f%af aria-label="🎓 License/许可">🎓 License/许可</a><ul class=header-level-1><li><a href=#help%e5%b8%ae%e5%8a%a9 aria-label=Help/帮助>Help/帮助</a></li><li><a href=#surprise-your-geeky-pythonist-friends%e6%83%b3%e7%bb%99%e4%bd%a0%e7%9a%84%e6%9e%81%e5%ae%a2%e6%9c%8b%e5%8f%8b%e4%b8%80%e4%b8%aa%e6%83%8a%e5%96%9c aria-label="Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?">Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?</a></li><li><a href=#need-a-pdf-version%e9%9c%80%e8%a6%81%e6%9d%a5%e4%b8%80%e4%bb%bdpdf%e7%89%88%e7%9a%84 aria-label="Need a pdf version?/需要来一份pdf版的?">Need a pdf version?/需要来一份pdf版的?</a></li><li><a href=#follow-commit%e8%bf%bd%e8%b8%aacommit aria-label="Follow Commit/追踪Commit">Follow Commit/追踪Commit</a></li><li><a href=#996icu aria-label=996.icu>996.icu</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;document.addEventListener("DOMContentLoaded",function(){if(checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),elements.length>0){activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")}const t=document.getElementById("top-link");t&&t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{const e=window.pageYOffset||document.documentElement.scrollTop;if(e===0)return;elements&&elements.length>0&&(elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase(),n=document.querySelector(`.inner ul li a[href="#${t}"]`);n.classList.remove("read")}),activeElement=Array.from(elements).find(t=>{if(getOffsetTop(t)-e>0&&getOffsetTop(t)-e<window.innerHeight/2)return t})||activeElement,elements.forEach((t)=>{const o=encodeURI(t.getAttribute("id")).toLowerCase(),s=document.querySelector(`.inner ul li a[href="#${o}"]`);if(t===activeElement){s.classList.add("active");const e=document.querySelector(".toc .inner"),t=s.offsetTop,n=e.clientHeight,o=s.clientHeight,i=t-n/2+o/2;e.scrollTo({top:i,behavior:"smooth"})}else getOffsetTop(t)<e&&s.classList.add("read"),s.classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return!document.querySelector(".hugo-encryptor-prompt")&&elements.length!=0&&(elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),console.log("Elements re-queried:",elements)),0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p align=center><img src=/images/logo.png alt></p><h1 align=center>What the f*ck Python! 🐍</h1><p align=center>一些有趣且鲜为人知的 Python 特性.</p><p align=center><a href=https://github.com/satwikkansal/wtfpython>English</a>
| <a href=#>中文</a></p>[![WTFPL 2.0][license-image]][license-url] [![Commit id][commit-image]][commit-url] [![996.icu][996.icu-image]][996.icu-url]<p>Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.</p><p>这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!</p><p>虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性. 我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!</p><p>如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 :sweat_smile:</p><p>PS: 如果你不是第一次读了, 你可以在<a href=https://github.com/satwikkansal/wtfpython/releases/ target=_blank rel=noopener>这里</a>
获取变动内容.</p><p>那么, 让我们开始吧&mldr;</p><h1 id=table-of-contents目录>Table of Contents/目录<a hidden class=anchor aria-hidden=true href=#table-of-contents目录>#</a></h1><ul><li><a href=#table-of-contents%e7%9b%ae%e5%bd%95>Table of Contents/目录</a></li><li><a href=#structure-of-the-examples%e7%a4%ba%e4%be%8b%e7%bb%93%e6%9e%84>Structure of the Examples/示例结构</a></li><li><a href=#usage%e7%94%a8%e6%b3%95>Usage/用法</a></li><li><a href=#-examples%e7%a4%ba%e4%be%8b>👀 Examples/示例</a><ul><li><a href=#section-strain-your-brain%e5%a4%a7%e8%84%91%e8%bf%90%e5%8a%a8>Section: Strain your brain!/大脑运动!</a><ul><li><a href=#-strings-can-be-tricky-sometimes%e5%be%ae%e5%a6%99%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2->> Strings can be tricky sometimes/微妙的字符串 *</a></li><li><a href=#-time-for-some-hash-brownies%e6%98%af%e6%97%b6%e5%80%99%e6%9d%a5%e7%82%b9%e8%9b%8b%e7%b3%95%e4%ba%86>> Time for some hash brownies!/是时候来点蛋糕了!</a></li><li><a href=#-return-return-everywhere%e5%88%b0%e5%a4%84%e8%bf%94%e5%9b%9e>> Return return everywhere!/到处返回！</a></li><li><a href=#-deep-down-were-all-the-same%e6%9c%ac%e8%b4%a8%e4%b8%8a%e6%88%91%e4%bb%ac%e9%83%bd%e4%b8%80%e6%a0%b7->> Deep down, we&rsquo;re all the same./本质上,我们都一样. *</a></li><li><a href=#-for-what%e4%b8%ba%e4%bb%80%e4%b9%88>> For what?/为什么?</a></li><li><a href=#-evaluation-time-discrepancy%e6%89%a7%e8%a1%8c%e6%97%b6%e6%9c%ba%e5%b7%ae%e5%bc%82>> Evaluation time discrepancy/执行时机差异</a></li><li><a href=#-is-is-not-what-it-is%e5%87%ba%e4%ba%ba%e6%84%8f%e6%96%99%e7%9a%84is>> <code>is</code> is not what it is!/出人意料的<code>is</code>!</a></li><li><a href=#-a-tic-tac-toe-where-x-wins-in-the-first-attempt%e4%b8%80%e8%b9%b4%e5%8d%b3%e8%87%b3>> A tic-tac-toe where X wins in the first attempt!/一蹴即至!</a></li><li><a href=#-the-sticky-output-function%e9%ba%bb%e7%83%a6%e7%9a%84%e8%be%93%e5%87%ba>> The sticky output function/麻烦的输出</a></li><li><a href=#-is-not--is-not-is-not-is-not--%e4%b8%8d%e6%98%af-is-not->> <code>is not ...</code> is not <code>is (not ...)</code>/<code>is not ...</code> 不是 <code>is (not ...)</code></a></li><li><a href=#-the-surprising-comma%e6%84%8f%e5%a4%96%e7%9a%84%e9%80%97%e5%8f%b7>> The surprising comma/意外的逗号</a></li><li><a href=#-backslashes-at-the-end-of-string%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%9c%ab%e5%b0%be%e7%9a%84%e5%8f%8d%e6%96%9c%e6%9d%a0>> Backslashes at the end of string/字符串末尾的反斜杠</a></li><li><a href=#-not-knot%e5%88%ab%e7%ba%a0%e7%bb%93>> not knot!/别纠结!</a></li><li><a href=#-half-triple-quoted-strings%e4%b8%89%e4%b8%aa%e5%bc%95%e5%8f%b7>> Half triple-quoted strings/三个引号</a></li><li><a href=#-midnight-time-doesnt-exist%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84%e5%8d%88%e5%a4%9c>> Midnight time doesn&rsquo;t exist?/不存在的午夜?</a></li><li><a href=#-whats-wrong-with-booleans%e5%b8%83%e5%b0%94%e4%bd%a0%e5%92%8b%e4%ba%86>> What&rsquo;s wrong with booleans?/布尔你咋了?</a></li><li><a href=#-class-attributes-and-instance-attributes%e7%b1%bb%e5%b1%9e%e6%80%a7%e5%92%8c%e5%ae%9e%e4%be%8b%e5%b1%9e%e6%80%a7>> Class attributes and instance attributes/类属性和实例属性</a></li><li><a href=#-yielding-none%e7%94%9f%e6%88%90-none>> yielding None/生成 None</a></li><li><a href=#-mutating-the-immutable%e5%bc%ba%e4%ba%ba%e6%89%80%e9%9a%be>> Mutating the immutable!/强人所难</a></li><li><a href=#-the-disappearing-variable-from-outer-scope%e6%b6%88%e5%a4%b1%e7%9a%84%e5%a4%96%e9%83%a8%e5%8f%98%e9%87%8f>> The disappearing variable from outer scope/消失的外部变量</a></li><li><a href=#-when-true-is-actually-false%e7%9c%9f%e4%ba%a6%e5%81%87>> When True is actually False/真亦假</a></li><li><a href=#-from-filled-to-none-in-one-instruction%e4%bb%8e%e6%9c%89%e5%88%b0%e6%97%a0>> From filled to None in one instruction&mldr;/从有到无&mldr;</a></li><li><a href=#-subclass-relationships%e5%ad%90%e7%b1%bb%e5%85%b3%e7%b3%bb->> Subclass relationships/子类关系 *</a></li><li><a href=#-the-mysterious-key-type-conversion%e7%a5%9e%e7%a7%98%e7%9a%84%e9%94%ae%e5%9e%8b%e8%bd%ac%e6%8d%a2->> The mysterious key type conversion/神秘的键型转换 *</a></li><li><a href=#-lets-see-if-you-can-guess-this%e7%9c%8b%e7%9c%8b%e4%bd%a0%e8%83%bd%e5%90%a6%e7%8c%9c%e5%88%b0%e8%bf%99%e4%b8%80%e7%82%b9>> Let&rsquo;s see if you can guess this?/看看你能否猜到这一点?</a></li></ul></li><li><a href=#section-appearances-are-deceptive%e5%a4%96%e8%a1%a8%e6%98%af%e9%9d%a0%e4%b8%8d%e4%bd%8f%e7%9a%84>Section: Appearances are deceptive!/外表是靠不住的!</a><ul><li><a href=#-skipping-lines%e8%b7%b3%e8%bf%87%e4%b8%80%e8%a1%8c>> Skipping lines?/跳过一行?</a></li><li><a href=#-teleportation%e7%a9%ba%e9%97%b4%e7%a7%bb%e5%8a%a8->> Teleportation/空间移动 *</a></li><li><a href=#-well-something-is-fishy%e5%97%af%e6%9c%89%e4%ba%9b%e5%8f%af%e7%96%91>> Well, something is fishy&mldr;/嗯, 有些可疑&mldr;</a></li></ul></li><li><a href=#section-watch-out-for-the-landmines%e5%b0%8f%e5%bf%83%e5%9c%b0%e9%9b%b7>Section: Watch out for the landmines!/小心地雷!</a><ul><li><a href=#-modifying-a-dictionary-while-iterating-over-it%e8%bf%ad%e4%bb%a3%e5%ad%97%e5%85%b8%e6%97%b6%e7%9a%84%e4%bf%ae%e6%94%b9>> Modifying a dictionary while iterating over it/迭代字典时的修改</a></li><li><a href=#-stubborn-del-operator%e5%9d%9a%e5%bc%ba%e7%9a%84-del->> Stubborn <code>del</code> operator/坚强的 <code>del</code> *</a></li><li><a href=#-deleting-a-list-item-while-iterating%e8%bf%ad%e4%bb%a3%e5%88%97%e8%a1%a8%e6%97%b6%e5%88%a0%e9%99%a4%e5%85%83%e7%b4%a0>> Deleting a list item while iterating/迭代列表时删除元素</a></li><li><a href=#-loop-variables-leaking-out%e5%be%aa%e7%8e%af%e5%8f%98%e9%87%8f%e6%b3%84%e6%bc%8f>> Loop variables leaking out!/循环变量泄漏!</a></li><li><a href=#-beware-of-default-mutable-arguments%e5%bd%93%e5%bf%83%e9%bb%98%e8%ae%a4%e7%9a%84%e5%8f%af%e5%8f%98%e5%8f%82%e6%95%b0>> Beware of default mutable arguments!/当心默认的可变参数!</a></li><li><a href=#-catching-the-exceptions%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8>> Catching the Exceptions/捕获异常</a></li><li><a href=#-same-operands-different-story%e5%90%8c%e4%ba%ba%e4%b8%8d%e5%90%8c%e5%91%bd>> Same operands, different story!/同人不同命!</a></li><li><a href=#-the-out-of-scope-variable%e5%a4%96%e9%83%a8%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%8f%98%e9%87%8f>> The out of scope variable/外部作用域变量</a></li><li><a href=#-be-careful-with-chained-operations%e5%b0%8f%e5%bf%83%e9%93%be%e5%bc%8f%e6%93%8d%e4%bd%9c>> Be careful with chained operations/小心链式操作</a></li><li><a href=#-name-resolution-ignoring-class-scope%e5%bf%bd%e7%95%a5%e7%b1%bb%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%9a%84%e5%90%8d%e7%a7%b0%e8%a7%a3%e6%9e%90>> Name resolution ignoring class scope/忽略类作用域的名称解析</a></li><li><a href=#-needle-in-a-haystack%e5%a4%a7%e6%b5%b7%e6%8d%9e%e9%92%88>> Needle in a Haystack/大海捞针</a></li></ul></li><li><a href=#section-the-hidden-treasures%e9%9a%90%e8%97%8f%e7%9a%84%e5%ae%9d%e8%97%8f>Section: The Hidden treasures!/隐藏的宝藏!</a><ul><li><a href=#-okay-python-can-you-make-me-flypython-%e5%8f%af%e5%90%a6%e5%b8%a6%e6%88%91%e9%a3%9e->> Okay Python, Can you make me fly?/Python, 可否带我飞? *</a></li><li><a href=#-goto-but-whygoto-%e4%bd%86%e4%b8%ba%e4%bb%80%e4%b9%88->> <code>goto</code>, but why?/<code>goto</code>, 但为什么? *</a></li><li><a href=#-brace-yourself%e5%81%9a%e5%a5%bd%e6%80%9d%e6%83%b3%e5%87%86%e5%a4%87->> Brace yourself!/做好思想准备 *</a></li><li><a href=#-lets-meet-friendly-language-uncle-for-life%e8%ae%a9%e7%94%9f%e6%b4%bb%e6%9b%b4%e5%8f%8b%e5%a5%bd->> Let&rsquo;s meet Friendly Language Uncle For Life/让生活更友好 *</a></li><li><a href=#-even-python-understands-that-love-is-complicated%e8%bf%9ePython%e4%b9%9f%e7%9f%a5%e9%81%93%e7%88%b1%e6%98%af%e9%9a%be%e8%a8%80%e7%9a%84->> Even Python understands that love is complicated/连Python也知道爱是难言的 *</a></li><li><a href=#-yes-it-exists%e6%98%af%e7%9a%84-%e5%ae%83%e5%ad%98%e5%9c%a8>> Yes, it exists!/是的, 它存在!</a></li><li><a href=#-inpinity%e6%97%a0%e9%99%90->> Inpinity/无限 *</a></li><li><a href=#-mangling-time%e4%bf%ae%e9%a5%b0%e6%97%b6%e9%97%b4->> Mangling time!修饰时间! *</a></li></ul></li><li><a href=#section-miscellaneous%e6%9d%82%e9%a1%b9>Section: Miscellaneous/杂项</a><ul><li><a href=#--is-faster%e6%9b%b4%e5%bf%ab%e7%9a%84->> <code>+=</code> is faster/更快的 <code>+=</code></a></li><li><a href=#-lets-make-a-giant-string%e6%9d%a5%e5%81%9a%e4%b8%aa%e5%b7%a8%e5%a4%a7%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%90%a7>> Let&rsquo;s make a giant string!/来做个巨大的字符串吧!</a></li><li><a href=#-explicit-typecast-of-strings%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e6%98%be%e5%bc%8f%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2>> Explicit typecast of strings/字符串的显式类型转换</a></li><li><a href=#-minor-ones%e5%b0%8f%e7%9f%a5%e8%af%86%e7%82%b9>> Minor Ones/小知识点</a></li></ul></li></ul></li><li><a href=#contributing%e8%b4%a1%e7%8c%ae>Contributing/贡献</a></li><li><a href=#acknowledgements%e8%87%b4%e8%b0%a2>Acknowledgements/致谢</a></li><li><a href=#-license%e8%ae%b8%e5%8f%af>🎓 License/许可</a><ul><li><a href=#help%e5%b8%ae%e5%8a%a9>Help/帮助</a></li><li><a href=#surprise-your-geeky-pythonist-friends%e6%83%b3%e7%bb%99%e4%bd%a0%e7%9a%84%e6%9e%81%e5%ae%a2%e6%9c%8b%e5%8f%8b%e4%b8%80%e4%b8%aa%e6%83%8a%e5%96%9c>Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?</a></li><li><a href=#need-a-pdf-version%e9%9c%80%e8%a6%81%e6%9d%a5%e4%b8%80%e4%bb%bdpdf%e7%89%88%e7%9a%84>Need a pdf version?/需要来一份pdf版的?</a></li><li><a href=#follow-commit%e8%bf%bd%e8%b8%aaCommit>Follow Commit/追踪Commit</a></li><li><a href=#996icu>996.icu</a></li></ul></li></ul><h1 id=structure-of-the-examples示例结构>Structure of the Examples/示例结构<a hidden class=anchor aria-hidden=true href=#structure-of-the-examples示例结构>#</a></h1><p>所有示例的结构都如下所示:</p><blockquote><h3 id=-一个精选的标题->> 一个精选的标题 *<a hidden class=anchor aria-hidden=true href=#-一个精选的标题->#</a></h3><p>标题末尾的星号表示该示例在第一版中不存在，是最近添加的.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 准备代码.</span>
</span></span><span class=line><span class=cl><span class=c1># 释放魔法...</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python version):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>触发语句</span>
</span></span><span class=line><span class=cl><span class=n>出乎意料的输出结果</span>
</span></span></code></pre></td></tr></table></div></div><p>(可选): 对意外输出结果的简短描述.</p><h4 id=-说明>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明>#</a></h4><ul><li>简要说明发生了什么以及为什么会发生.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>如有必要</span><span class=p>,</span> <span class=n>举例说明</span>
</span></span></code></pre></td></tr></table></div></div><strong>Output:</strong><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>触发语句</span> <span class=c1># 一些让魔法变得容易理解的例子</span>
</span></span><span class=line><span class=cl><span class=c1># 一些正常的输入</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></blockquote><p><strong>注意:</strong> 所有的示例都在 Python 3.5.2 版本的交互解释器上测试过, 如果不特别说明应该适用于所有 Python 版本.</p><h1 id=usage用法>Usage/用法<a hidden class=anchor aria-hidden=true href=#usage用法>#</a></h1><p>我个人建议, 最好依次阅读下面的示例, 并对每个示例:</p><ul><li>仔细阅读设置例子最开始的代码. 如果您是一位经验丰富的 Python 程序员, 那么大多数时候您都能成功预期到后面的结果.</li><li>阅读输出结果,<ul><li>确认结果是否如你所料.</li><li>确认你是否知道这背后的原理.<ul><li>如果不知道, 深呼吸然后阅读说明 (如果你还是看不明白, 别沉默! 可以在<a href=https://github.com/satwikkansal/wtfPython target=_blank rel=noopener>这</a>
提个 issue).</li><li>如果知道, 给自己点奖励, 然后去看下一个例子.</li></ul></li></ul></li></ul><p>PS: 你也可以在命令行阅读 WTFpython. 我们有 pypi 包 和 npm 包(支持代码高亮).(译: 这两个都是英文版的)</p><p>安装 npm 包 <a href=https://www.npmjs.com/package/wtfpython target=_blank rel=noopener><code>wtfpython</code></a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ npm install -g wtfpython
</span></span></code></pre></td></tr></table></div></div><p>或者, 安装 pypi 包 <a href=https://pypi.python.org/pypi/wtfpython target=_blank rel=noopener><code>wtfpython</code></a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ pip install wtfpython -U
</span></span></code></pre></td></tr></table></div></div><p>现在, 在命令行中运行 <code>wtfpython</code>, 你就可以开始浏览了.</p><hr><h1 id=-examples示例>👀 Examples/示例<a hidden class=anchor aria-hidden=true href=#-examples示例>#</a></h1><h2 id=section-strain-your-brain大脑运动>Section: Strain your brain!/大脑运动!<a hidden class=anchor aria-hidden=true href=#section-strain-your-brain大脑运动>#</a></h2><h3 id=-strings-can-be-tricky-sometimes微妙的字符串->> Strings can be tricky sometimes/微妙的字符串 *<a hidden class=anchor aria-hidden=true href=#-strings-can-be-tricky-sometimes微妙的字符串->#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;some_string&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140420665652016</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=s2>&#34;some&#34;</span> <span class=o>+</span> <span class=s2>&#34;_&#34;</span> <span class=o>+</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span> <span class=c1># 注意两个的id值是相同的.</span>
</span></span><span class=line><span class=cl><span class=mi>140420665652016</span>
</span></span></code></pre></td></tr></table></div></div><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;wtf&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=s2>&#34;wtf&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=ow>is</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=s2>&#34;wtf!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=s2>&#34;wtf!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=ow>is</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=s2>&#34;wtf!&#34;</span><span class=p>,</span> <span class=s2>&#34;wtf!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=ow>is</span> <span class=n>b</span> 
</span></span><span class=line><span class=cl><span class=kc>True</span> <span class=c1># 3.7 版本返回结果为 False.</span>
</span></span></code></pre></td></tr></table></div></div><p>3.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>20</span> <span class=ow>is</span> <span class=s1>&#39;aaaaaaaaaaaaaaaaaaaa&#39;</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>21</span> <span class=ow>is</span> <span class=s1>&#39;aaaaaaaaaaaaaaaaaaaaa&#39;</span>
</span></span><span class=line><span class=cl><span class=kc>False</span> <span class=c1># 3.7 版本返回结果为 True</span>
</span></span></code></pre></td></tr></table></div></div><p>很好理解, 对吧?</p><h4 id=-说明-1>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-1>#</a></h4><ul><li><p>这些行为是由于 Cpython 在编译优化时, 某些情况下会尝试使用已经存在的不可变对象而不是每次都创建一个新对象. (这种行为被称作字符串的驻留[string interning])</p></li><li><p>发生驻留之后, 许多变量可能指向内存中的相同字符串对象. (从而节省内存)</p></li><li><p>在上面的代码中, 字符串是隐式驻留的. 何时发生隐式驻留则取决于具体的实现. 这里有一些方法可以用来猜测字符串是否会被驻留:</p><ul><li><p>所有长度为 0 和长度为 1 的字符串都被驻留.</p></li><li><p>字符串在编译时被实现 (<code>'wtf'</code> 将被驻留, 但是 <code>''.join(['w', 't', 'f'])</code> 将不会被驻留)</p></li><li><p>字符串中只包含字母，数字或下划线时将会驻留. 所以 <code>'wtf!'</code> 由于包含 <code>!</code> 而未被驻留. 可以在<a href=https://github.com/python/cpython/blob/3.6/Objects/codeobject.c#L19 target=_blank rel=noopener>这里</a>
找到 CPython 对此规则的实现.</p><img src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212111.png alt></li></ul></li><li><p>当在同一行将 <code>a</code> 和 <code>b</code> 的值设置为 <code>"wtf!"</code> 的时候, Python 解释器会创建一个新对象, 然后同时引用第二个变量(译: 仅适用于3.7以下, 详细情况请看<a href=https://github.com/leisurelicht/wtfpython-cn/issues/13 target=_blank rel=noopener>这里</a>
). 如果你在不同的行上进行赋值操作, 它就不会“知道”已经有一个 <code>wtf！</code> 对象 (因为 <code>"wtf!"</code> 不是按照上面提到的方式被隐式驻留的). 它是一种编译器优化, 特别适用于交互式环境.</p></li><li><p>常量折叠(constant folding) 是 Python 中的一种 <a href=https://en.wikipedia.org/wiki/Peephole_optimization target=_blank rel=noopener>窥孔优化(peephole optimization)</a>
技术. 这意味着在编译时表达式 <code>'a'*20</code> 会被替换为 <code>'aaaaaaaaaaaaaaaaaaaa'</code> 以减少运行时的时钟周期. 只有长度小于 20 的字符串才会发生常量折叠. (为啥? 想象一下由于表达式 <code>'a'*10**10</code> 而生成的 <code>.pyc</code> 文件的大小). 相关的源码实现在<a href=https://github.com/python/cpython/blob/3.6/Python/peephole.c#L288 target=_blank rel=noopener>这里</a>
.</p></li><li><p>如果你是使用 3.7 版本中运行上述示例代码, 会发现部分代码的运行结果与注释说明相同. 这是因为在 3.7 版本中, 常量折叠已经从窥孔优化器迁移至新的 AST 优化器, 后者可以以更高的一致性来执行优化. (由 Eugene Toder 和 INADA Naoki 在 <a href=https://bugs.python.org/issue29469 target=_blank rel=noopener>bpo-29469</a>
和 <a href=https://bugs.python.org/issue11549 target=_blank rel=noopener>bpo-11549</a>
中贡献.)</p></li><li><p>(译: 但是在最新的 3.8 版本中, 结果又变回去了. 虽然 3.8 版本和 3.7 版本一样, 都是使用 AST 优化器. 目前不确定官方对 3.8 版本的 AST 做了什么调整.)</p></li></ul><hr><h3 id=-time-for-some-hash-brownies是时候来点蛋糕了>> Time for some hash brownies!/是时候来点蛋糕了!<a hidden class=anchor aria-hidden=true href=#-time-for-some-hash-brownies是时候来点蛋糕了>#</a></h3><ul><li>hash brownie指一种含有大麻成分的蛋糕, 所以这里是句双关</li></ul><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_dict</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>some_dict</span><span class=p>[</span><span class=mf>5.5</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Ruby&#34;</span>
</span></span><span class=line><span class=cl><span class=n>some_dict</span><span class=p>[</span><span class=mf>5.0</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;JavaScript&#34;</span>
</span></span><span class=line><span class=cl><span class=n>some_dict</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Python&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span><span class=p>[</span><span class=mf>5.5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Ruby&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span><span class=p>[</span><span class=mf>5.0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Python&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Python&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>&ldquo;Python&rdquo; 消除了 &ldquo;JavaScript&rdquo; 的存在?</p><h4 id=-说明-2>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-2>#</a></h4><ul><li>Python 字典通过检查键值是否相等和比较哈希值来确定两个键是否相同.</li><li>具有相同值的不可变对象在Python中始终具有相同的哈希值.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=mi>5</span> <span class=o>==</span> <span class=mf>5.0</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>hash</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span> <span class=o>==</span> <span class=nb>hash</span><span class=p>(</span><span class=mf>5.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><strong>注意:</strong> 具有不同值的对象也可能具有相同的哈希值（哈希冲突）.</li><li>当执行 <code>some_dict[5] = "Python"</code> 语句时, 因为Python将 <code>5</code> 和 <code>5.0</code> 识别为 <code>some_dict</code> 的同一个键, 所以已有值 &ldquo;JavaScript&rdquo; 就被 &ldquo;Python&rdquo; 覆盖了.</li><li>这个 StackOverflow的 <a href=https://stackoverflow.com/a/32211042/4354153 target=_blank rel=noopener>回答</a>
漂亮地解释了这背后的基本原理.</li></ul><hr><h3 id=-return-return-everywhere到处返回>> Return return everywhere!/到处返回！<a hidden class=anchor aria-hidden=true href=#-return-return-everywhere到处返回>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;from_try&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;from_finally&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;from_finally&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-3>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-3>#</a></h4><ul><li>当在 &ldquo;try&mldr;finally&rdquo; 语句的 <code>try</code> 中执行 <code>return</code>, <code>break</code> 或 <code>continue</code> 后, <code>finally</code> 子句依然会执行.</li><li>函数的返回值由最后执行的 <code>return</code> 语句决定. 由于 <code>finally</code> 子句一定会执行, 所以 <code>finally</code> 子句中的 <code>return</code> 将始终是最后执行的语句.</li></ul><hr><h3 id=-deep-down-were-all-the-same本质上我们都一样->> Deep down, we&rsquo;re all the same./本质上,我们都一样. *<a hidden class=anchor aria-hidden=true href=#-deep-down-were-all-the-same本质上我们都一样->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>WTF</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>WTF</span><span class=p>()</span> <span class=o>==</span> <span class=n>WTF</span><span class=p>()</span> <span class=c1># 两个不同的对象应该不相等</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>WTF</span><span class=p>()</span> <span class=ow>is</span> <span class=n>WTF</span><span class=p>()</span> <span class=c1># 也不相同</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>hash</span><span class=p>(</span><span class=n>WTF</span><span class=p>())</span> <span class=o>==</span> <span class=nb>hash</span><span class=p>(</span><span class=n>WTF</span><span class=p>())</span> <span class=c1># 哈希值也应该不同</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>WTF</span><span class=p>())</span> <span class=o>==</span> <span class=nb>id</span><span class=p>(</span><span class=n>WTF</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-4>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-4>#</a></h4><ul><li><p>当调用 <code>id</code> 函数时, Python 创建了一个 <code>WTF</code> 类的对象并传给 <code>id</code> 函数. 然后 <code>id</code> 函数获取其id值 (也就是内存地址), 然后丢弃该对象. 该对象就被销毁了.</p></li><li><p>当我们连续两次进行这个操作时, Python会将相同的内存地址分配给第二个对象. 因为 (在CPython中) <code>id</code> 函数使用对象的内存地址作为对象的id值, 所以两个对象的id值是相同的.</p></li><li><p>综上, 对象的id值仅仅在对象的生命周期内唯一. 在对象被销毁之后, 或被创建之前, 其他对象可以具有相同的id值.</p></li><li><p>那为什么 <code>is</code> 操作的结果为 <code>False</code> 呢? 让我们看看这段代码.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>WTF</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;I&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__del__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>WTF</span><span class=p>()</span> <span class=ow>is</span> <span class=n>WTF</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>I</span>
</span></span><span class=line><span class=cl><span class=n>I</span>
</span></span><span class=line><span class=cl><span class=n>D</span>
</span></span><span class=line><span class=cl><span class=n>D</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>WTF</span><span class=p>())</span> <span class=o>==</span> <span class=nb>id</span><span class=p>(</span><span class=n>WTF</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>I</span>
</span></span><span class=line><span class=cl><span class=n>D</span>
</span></span><span class=line><span class=cl><span class=n>I</span>
</span></span><span class=line><span class=cl><span class=n>D</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><p>正如你所看到的, 对象销毁的顺序是造成所有不同之处的原因.</p></li></ul><hr><h3 id=-for-what为什么>> For what?/为什么?<a hidden class=anchor aria-hidden=true href=#-for-what为什么>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_string</span> <span class=o>=</span> <span class=s2>&#34;wtf&#34;</span>
</span></span><span class=line><span class=cl><span class=n>some_dict</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>some_dict</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>some_string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span> <span class=c1># 创建了索引字典.</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s1>&#39;t&#39;</span><span class=p>,</span> <span class=mi>2</span><span class=p>:</span> <span class=s1>&#39;f&#39;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-5>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-5>#</a></h4><ul><li><p><a href=https://docs.python.org/3/reference/grammar.html target=_blank rel=noopener>Python 语法</a>
中对 <code>for</code> 的定义是:</p><pre tabindex=0><code>for_stmt: &#39;for&#39; exprlist &#39;in&#39; testlist &#39;:&#39; suite [&#39;else&#39; &#39;:&#39; suite]
</code></pre><p>其中 <code>exprlist</code> 指分配目标. 这意味着对可迭代对象中的<strong>每一项都会执行</strong>类似 <code>{exprlist} = {next_value}</code> 的操作.</p><p>一个有趣的例子说明了这一点:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>10</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><pre tabindex=0><code>0
1
2
3
</code></pre><p>你可曾觉得这个循环只会运行一次?</p><p><strong>💡 说明:</strong></p><ul><li>由于循环在Python中工作方式, 赋值语句 <code>i = 10</code> 并不会影响迭代循环, 在每次迭代开始之前, 迭代器(这里指 <code>range(4)</code>) 生成的下一个元素就被解包并赋值给目标列表的变量(这里指 <code>i</code>)了.</li></ul></li><li><p>在每一次的迭代中, <code>enumerate(some_string)</code> 函数就生成一个新值 <code>i</code> (计数器增加) 并从 <code>some_string</code> 中获取一个字符. 然后将字典 <code>some_dict</code> 键 <code>i</code> (刚刚分配的) 的值设为该字符. 本例中循环的展开可以简化为:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>i</span><span class=p>,</span> <span class=n>some_dict</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>i</span><span class=p>,</span> <span class=n>some_dict</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;t&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>i</span><span class=p>,</span> <span class=n>some_dict</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-evaluation-time-discrepancy执行时机差异>> Evaluation time discrepancy/执行时机差异<a hidden class=anchor aria-hidden=true href=#-evaluation-time-discrepancy执行时机差异>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>array</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>15</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>array</span> <span class=k>if</span> <span class=n>array</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>array</span> <span class=o>=</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>22</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>g</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>8</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>array_1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>g1</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>array_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>array_1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>array_2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>g2</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>array_2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>array_2</span><span class=p>[:]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>g1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>g2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-6>💡 说明<a hidden class=anchor aria-hidden=true href=#-说明-6>#</a></h4><ul><li>在<a href=https://wiki.python.org/moin/Generators target=_blank rel=noopener>生成器</a>
表达式中, <code>in</code> 子句在声明时执行, 而条件子句则是在运行时执行.</li><li>所以在运行前, <code>array</code> 已经被重新赋值为 <code>[2, 8, 22]</code>, 因此对于之前的 <code>1</code>, <code>8</code> 和 <code>15</code>, 只有 <code>count(8)</code> 的结果是大于 <code>0</code> 的, 所以生成器只会生成 <code>8</code>.</li><li>第二部分中 <code>g1</code> 和 <code>g2</code> 的输出差异则是由于变量 <code>array_1</code> 和 <code>array_2</code> 被重新赋值的方式导致的.</li><li>在第一种情况下, <code>array_1</code> 被绑定到新对象 <code>[1,2,3,4,5]</code>, 因为 <code>in</code> 子句是在声明时被执行的， 所以它仍然引用旧对象 <code>[1,2,3,4]</code>(并没有被销毁).</li><li>在第二种情况下, 对 <code>array_2</code> 的切片赋值将相同的旧对象 <code>[1,2,3,4]</code> 原地更新为 <code>[1,2,3,4,5]</code>. 因此 <code>g2</code> 和 <code>array_2</code> 仍然引用同一个对象(这个对象现在已经更新为 <code>[1,2,3,4,5]</code>).</li></ul><hr><h3 id=-is-is-not-what-it-is出人意料的is>> <code>is</code> is not what it is!/出人意料的<code>is</code>!<a hidden class=anchor aria-hidden=true href=#-is-is-not-what-it-is出人意料的is>#</a></h3><p>下面是一个在互联网上非常有名的例子.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=ow>is</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=ow>is</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>257</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=ow>is</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-7>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-7>#</a></h4><p><strong><code>is</code> 和 <code>==</code> 的区别</strong></p><ul><li><code>is</code> 运算符检查两个运算对象是否引用自同一对象 (即, 它检查两个运算对象是否相同).</li><li><code>==</code> 运算符比较两个运算对象的值是否相等.</li><li>因此 <code>is</code> 代表引用相同, <code>==</code> 代表值相等. 下面的例子可以很好的说明这点,<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>[]</span> <span class=o>==</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>[]</span> <span class=ow>is</span> <span class=p>[]</span> <span class=c1># 这两个空列表位于不同的内存地址.</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p><strong><code>256</code> 是一个已经存在的对象, 而 <code>257</code> 不是</strong></p><p>当你启动Python 的时候, 数值为 <code>-5</code> 到 <code>256</code> 的对象就已经被分配好了. 这些数字因为经常被使用, 所以会被提前准备好.</p><p>Python 通过这种创建小整数池的方式来避免小整数频繁的申请和销毁内存空间.</p><p>引用自 <a href=https://docs.python.org/3/c-api/long.html target=_blank rel=noopener>https://docs.python.org/3/c-api/long.html</a></p><blockquote><p>当前的实现为-5到256之间的所有整数保留一个整数对象数组, 当你创建了一个该范围内的整数时, 你只需要返回现有对象的引用. 所以改变1的值是有可能的. 我怀疑这种行为在Python中是未定义行为. :-)</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>10922528</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>10922528</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>10922528</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=mi>257</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140084850247312</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140084850247440</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140084850247344</span>
</span></span></code></pre></td></tr></table></div></div><p>这里解释器并没有智能到能在执行 <code>y = 257</code> 时意识到我们已经创建了一个整数 <code>257</code>, 所以它在内存中又新建了另一个对象.</p><p><strong>当 <code>a</code> 和 <code>b</code> 在同一行中使用相同的值初始化时，会指向同一个对象.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>257</span><span class=p>,</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140640774013296</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140640774013296</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>257</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140640774013392</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>140640774013488</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>当 a 和 b 在同一行中被设置为 <code>257</code> 时, Python 解释器会创建一个新对象, 然后同时引用第二个变量. 如果你在不同的行上进行, 它就不会 &ldquo;知道&rdquo; 已经存在一个 <code>257</code> 对象了.</li><li>这是一种特别为交互式环境做的编译器优化. 当你在实时解释器中输入两行的时候, 他们会单独编译, 因此也会单独进行优化. 如果你在 <code>.py</code> 文件中尝试这个例子, 则不会看到相同的行为, 因为文件是一次性编译的.</li></ul><hr><h3 id=-a-tic-tac-toe-where-x-wins-in-the-first-attempt一蹴即至>> A tic-tac-toe where X wins in the first attempt!/一蹴即至!<a hidden class=anchor aria-hidden=true href=#-a-tic-tac-toe-where-x-wins-in-the-first-attempt一蹴即至>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 我们先初始化一个变量row</span>
</span></span><span class=line><span class=cl><span class=n>row</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=o>*</span><span class=mi>3</span> <span class=c1>#row i[&#39;&#39;, &#39;&#39;, &#39;&#39;]</span>
</span></span><span class=line><span class=cl><span class=c1># 并创建一个变量board</span>
</span></span><span class=line><span class=cl><span class=n>board</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span><span class=p>]</span><span class=o>*</span><span class=mi>3</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;X&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=s1>&#39;X&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;X&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;X&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>]]</span>
</span></span></code></pre></td></tr></table></div></div><p>我们有没有赋值过3个 &ldquo;X&rdquo; 呢？</p><h4 id=-说明-8>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-8>#</a></h4><p>当我们初始化 <code>row</code> 变量时, 下面这张图展示了内存中的情况。</p><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212128.png><img alt=image loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212128.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212128.png style="display:block;margin:0 auto" alt=image></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p>而当通过对 <code>row</code> 做乘法来初始化 <code>board</code> 时, 内存中的情况则如下图所示 (每个元素 <code>board[0]</code>, <code>board[1]</code> 和 <code>board[2]</code> 都和 <code>row</code> 一样引用了同一列表.)</p><p><div class=post-img-view><a data-fancybox=gallery href=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212130.png><img alt=image loading=lazy src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212130.png class=responsive-image src=https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/img/20210911212130.png style="display:block;margin:0 auto" alt=image></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></p><p>我们可以通过不使用变量 <code>row</code> 生成 <code>board</code> 来避免这种情况. (<a href=https://github.com/satwikkansal/wtfpython/issues/68 target=_blank rel=noopener>这个</a>
issue提出了这个需求.)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span> <span class=o>=</span> <span class=p>[[</span><span class=s1>&#39;&#39;</span><span class=p>]</span><span class=o>*</span><span class=mi>3</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;X&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>board</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=s1>&#39;X&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>]]</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=-the-sticky-output-function麻烦的输出>> The sticky output function/麻烦的输出<a hidden class=anchor aria-hidden=true href=#-the-sticky-output-function麻烦的输出>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>funcs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>some_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>    <span class=n>funcs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>some_func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>some_func</span><span class=p>())</span> <span class=c1># 注意这里函数被执行了</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>funcs_results</span> <span class=o>=</span> <span class=p>[</span><span class=n>func</span><span class=p>()</span> <span class=k>for</span> <span class=n>func</span> <span class=ow>in</span> <span class=n>funcs</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>results</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>funcs_results</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>即使每次在迭代中将 <code>some_func</code> 加入 <code>funcs</code> 前的 <code>x</code> 值都不相同, 所有的函数还是都返回6.</p><p>// 再换个例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>powers_of_x</span> <span class=o>=</span> <span class=p>[</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>**</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>[</span><span class=n>f</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>powers_of_x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>512</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-9>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-9>#</a></h4><ul><li><p>当在循环内部定义一个函数时, 如果该函数在其主体中使用了循环变量, 则闭包函数将与循环变量绑定, 而不是它的值. 因此, 所有的函数都是使用最后分配给变量的值来进行计算的.</p></li><li><p>可以通过将循环变量作为命名变量传递给函数来获得预期的结果. <strong>为什么这样可行?</strong> 因为这会在函数内再次定义一个局部变量.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>funcs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>some_func</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>    <span class=n>funcs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>some_func</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>funcs_results</span> <span class=o>=</span> <span class=p>[</span><span class=n>func</span><span class=p>()</span> <span class=k>for</span> <span class=n>func</span> <span class=ow>in</span> <span class=n>funcs</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>funcs_results</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-is-not--is-not-is-not-is-not--不是-is-not->> <code>is not ...</code> is not <code>is (not ...)</code>/<code>is not ...</code> 不是 <code>is (not ...)</code><a hidden class=anchor aria-hidden=true href=#-is-not--is-not-is-not-is-not--不是-is-not->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;something&#39;</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;something&#39;</span> <span class=ow>is</span> <span class=p>(</span><span class=ow>not</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-10>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-10>#</a></h4><ul><li><code>is not</code> 是个单独的二元运算符, 与分别使用 <code>is</code> 和 <code>not</code> 不同.</li><li>如果操作符两侧的变量指向同一个对象, 则 <code>is not</code> 的结果为 <code>False</code>, 否则结果为 <code>True</code>.</li></ul><hr><h3 id=-the-surprising-comma意外的逗号>> The surprising comma/意外的逗号<a hidden class=anchor aria-hidden=true href=#-the-surprising-comma意外的逗号>#</a></h3><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,):</span>
</span></span><span class=line><span class=cl><span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>g</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=mi>5</span><span class=p>,):</span>
</span></span><span class=line><span class=cl><span class=o>...</span>     <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>h</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>,):</span>
</span></span><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;&lt;stdin&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>h</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>,):</span>
</span></span><span class=line><span class=cl>                     <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>syntax</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>h</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,):</span>
</span></span><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;&lt;stdin&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>h</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,):</span>
</span></span><span class=line><span class=cl>                <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>syntax</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-11>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-11>#</a></h4><ul><li>在Python函数的形式参数列表中, 尾随逗号并不一定是合法的.</li><li>在Python中, 参数列表部分用前置逗号定义, 部分用尾随逗号定义. 这种冲突导致逗号被夹在中间, 没有规则定义它.(译:这一句看得我也很懵逼,只能强翻了.详细解释看下面的讨论帖会一目了然.)</li><li><strong>注意:</strong> 尾随逗号的问题已经在Python 3.6中被<a href=https://bugs.python.org/issue9232 target=_blank rel=noopener>修复</a>
了. 而这篇<a href=https://bugs.python.org/issue9232#msg248399 target=_blank rel=noopener>帖子</a>
中则简要讨论了Python中尾随逗号的不同用法.</li></ul><hr><h3 id=-backslashes-at-the-end-of-string字符串末尾的反斜杠>> Backslashes at the end of string/字符串末尾的反斜杠<a hidden class=anchor aria-hidden=true href=#-backslashes-at-the-end-of-string字符串末尾的反斜杠>#</a></h3><p><strong>Output:</strong></p><pre tabindex=0><code>&gt;&gt;&gt; print(&#34;\\ C:\\&#34;)
\ C:\
&gt;&gt;&gt; print(r&#34;\ C:&#34;)
\ C:
&gt;&gt;&gt; print(r&#34;\ C:\&#34;)

    File &#34;&lt;stdin&gt;&#34;, line 1
      print(r&#34;\ C:\&#34;)
                     ^
SyntaxError: EOL while scanning string literal
</code></pre><h4 id=-说明-12>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-12>#</a></h4><ul><li>在以 <code>r</code> 开头的原始字符串中, 反斜杠并没有特殊含义.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;wt</span><span class=se>\&#34;</span><span class=s2>f&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;wt</span><span class=se>\\</span><span class=s1>&#34;f&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li><li>解释器所做的只是简单的改变了反斜杠的行为, 因此会直接放行反斜杠及后一个的字符. 这就是反斜杠在原始字符串末尾不起作用的原因.</li></ul><hr><h3 id=-not-knot别纠结>> not knot!/别纠结!<a hidden class=anchor aria-hidden=true href=#-not-knot别纠结>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=ow>not</span> <span class=n>x</span> <span class=o>==</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>x</span> <span class=o>==</span> <span class=ow>not</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;&lt;input&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>==</span> <span class=ow>not</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>           <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>syntax</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-13>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-13>#</a></h4><ul><li>运算符的优先级会影响表达式的求值顺序, 而在 Python 中 <code>==</code> 运算符的优先级要高于 <code>not</code> 运算符.</li><li>所以 <code>not x == y</code> 相当于 <code>not (x == y)</code>, 同时等价于 <code>not (True == False)</code>, 最后的运算结果就是 <code>True</code>.</li><li>之所以 <code>x == not y</code> 会抛一个 <code>SyntaxError</code> 异常, 是因为它会被认为等价于 <code>(x == not) y</code>, 而不是你一开始期望的 <code>x == (not y)</code>.</li><li>解释器期望 <code>not</code> 标记是 <code>not in</code> 操作符的一部分 (因为 <code>==</code> 和 <code>not in</code> 操作符具有相同的优先级), 但是它在 <code>not</code> 标记后面找不到 <code>in</code> 标记, 所以会抛出 <code>SyntaxError</code> 异常.</li></ul><hr><h3 id=-half-triple-quoted-strings三个引号>> Half triple-quoted strings/三个引号<a hidden class=anchor aria-hidden=true href=#-half-triple-quoted-strings三个引号>#</a></h3><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;wtfpython&#39;&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>wtfpython</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;wtfpython&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>wtfpython</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=c1># 下面的语句会抛出 `SyntaxError` 异常</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=c1># print(&#39;&#39;&#39;wtfpython&#39;)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=c1># print(&#34;&#34;&#34;wtfpython&#34;)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-14>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-14>#</a></h4><ul><li>Python 提供隐式的<a href=https://docs.python.org/2/reference/lexical_analysis.html#string-literal-concatenation target=_blank rel=noopener>字符串连接</a>
, 例如,<pre tabindex=0><code>&gt;&gt;&gt; print(&#34;wtf&#34; &#34;python&#34;)
wtfpython
&gt;&gt;&gt; print(&#34;wtf&#34; &#34;&#34;) # or &#34;wtf&#34;&#34;&#34;
wtf
</code></pre></li><li><code>'''</code> 和 <code>"""</code> 在 Python中也是字符串定界符, Python 解释器在先遇到三个引号的的时候会尝试再寻找三个终止引号作为定界符, 如果不存在则会导致 <code>SyntaxError</code> 异常.</li></ul><hr><h3 id=-midnight-time-doesnt-exist不存在的午夜>> Midnight time doesn&rsquo;t exist?/不存在的午夜?<a hidden class=anchor aria-hidden=true href=#-midnight-time-doesnt-exist不存在的午夜>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>midnight</span> <span class=o>=</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2018</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>midnight_time</span> <span class=o>=</span> <span class=n>midnight</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>noon</span> <span class=o>=</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2018</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>noon_time</span> <span class=o>=</span> <span class=n>noon</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>midnight_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Time at midnight is&#34;</span><span class=p>,</span> <span class=n>midnight_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>noon_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Time at noon is&#34;</span><span class=p>,</span> <span class=n>noon_time</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span><span class=s1>&#39;Time at noon is&#39;</span>, datetime.time<span class=o>(</span>12, 0<span class=o>))</span>
</span></span></code></pre></td></tr></table></div></div><p>midnight_time 并没有被输出.</p><h4 id=-说明-15>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-15>#</a></h4><p>在Python 3.5之前, 如果 <code>datetime.time</code> 对象存储的UTC的午夜时间(译: 就是 <code>00:00</code>), 那么它的布尔值会被认为是 <code>False</code>. 当使用 <code>if obj:</code> 语句来检查 <code>obj</code> 是否为 <code>null</code> 或者某些“空”值的时候, 很容易出错.</p><hr><h3 id=-whats-wrong-with-booleans布尔你咋了>> What&rsquo;s wrong with booleans?/布尔你咋了?<a hidden class=anchor aria-hidden=true href=#-whats-wrong-with-booleans布尔你咋了>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 一个简单的例子, 统计下面可迭代对象中的布尔型值的个数和整型值的个数</span>
</span></span><span class=line><span class=cl><span class=n>mixed_list</span> <span class=o>=</span> <span class=p>[</span><span class=kc>False</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=s2>&#34;some_string&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=p>[],</span> <span class=kc>False</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>integers_found_so_far</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>booleans_found_so_far</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>mixed_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>integers_found_so_far</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>booleans_found_so_far</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>integers_found_so_far</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>booleans_found_so_far</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>another_dict</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>another_dict</span><span class=p>[</span><span class=kc>True</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;JavaScript&#34;</span>
</span></span><span class=line><span class=cl><span class=n>another_dict</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Ruby&#34;</span>
</span></span><span class=line><span class=cl><span class=n>another_dict</span><span class=p>[</span><span class=mf>1.0</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Python&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_dict</span><span class=p>[</span><span class=kc>True</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;Python&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>3.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_bool</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s2>&#34;wtf&#34;</span><span class=o>*</span><span class=n>some_bool</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;wtf&#39;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_bool</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s2>&#34;wtf&#34;</span><span class=o>*</span><span class=n>some_bool</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-16>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-16>#</a></h4><ul><li><p>布尔值是 <code>int</code> 的子类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>isinstance</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>isinstance</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>所以 <code>True</code> 的整数值是 <code>1</code>, 而 <code>False</code> 的整数值是 <code>0</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>True</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>==</span> <span class=mf>1.0</span> <span class=ow>and</span> <span class=kc>False</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>==</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>关于其背后的原理, 请看这个 StackOverflow 的<a href=https://stackoverflow.com/a/8169049/4354153 target=_blank rel=noopener>回答</a>
.</p></li></ul><hr><h3 id=-class-attributes-and-instance-attributes类属性和实例属性>> Class attributes and instance attributes/类属性和实例属性<a hidden class=anchor aria-hidden=true href=#-class-attributes-and-instance-attributes类属性和实例属性>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span><span class=p>(</span><span class=n>A</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>C</span><span class=p>(</span><span class=n>A</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>A</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>B</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>C</span><span class=o>.</span><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>B</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>A</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>B</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>C</span><span class=o>.</span><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>A</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>A</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>B</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>C</span><span class=o>.</span><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=n>A</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>A</span><span class=o>.</span><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>A</span><span class=o>.</span><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SomeClass</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>some_var</span> <span class=o>=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>    <span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>another_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>some_var</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>some_list</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>some_list</span> <span class=o>+</span> <span class=p>[</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>another_list</span> <span class=o>+=</span> <span class=p>[</span><span class=n>x</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_obj</span> <span class=o>=</span> <span class=n>SomeClass</span><span class=p>(</span><span class=mi>420</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_obj</span><span class=o>.</span><span class=n>some_list</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>420</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_obj</span><span class=o>.</span><span class=n>another_list</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>420</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_obj</span> <span class=o>=</span> <span class=n>SomeClass</span><span class=p>(</span><span class=mi>111</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_obj</span><span class=o>.</span><span class=n>some_list</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>111</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_obj</span><span class=o>.</span><span class=n>another_list</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>420</span><span class=p>,</span> <span class=mi>111</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_obj</span><span class=o>.</span><span class=n>another_list</span> <span class=ow>is</span> <span class=n>SomeClass</span><span class=o>.</span><span class=n>another_list</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_obj</span><span class=o>.</span><span class=n>another_list</span> <span class=ow>is</span> <span class=n>some_obj</span><span class=o>.</span><span class=n>another_list</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-17>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-17>#</a></h4><ul><li>类变量和实例变量在内部是通过类对象的字典来处理(译: 就是 <code>__dict__</code> 属性). 如果在当前类的字典中找不到的话就去它的父类中寻找.</li><li><code>+=</code> 运算符会在原地修改可变对象, 而不是创建新对象. 因此, 在这种情况下, 修改一个实例的属性会影响其他实例和类属性.</li></ul><hr><h3 id=-yielding-none生成-none>> yielding None/生成 None<a hidden class=anchor aria-hidden=true href=#-yielding-none生成-none>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_iterable</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_func</span><span class=p>(</span><span class=n>val</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;something&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>some_iterable</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>[(</span><span class=k>yield</span> <span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>some_iterable</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>generator</span> <span class=nb>object</span> <span class=o>&lt;</span><span class=n>listcomp</span><span class=o>&gt;</span> <span class=n>at</span> <span class=mh>0x7f70b0a4ad58</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>list</span><span class=p>([(</span><span class=k>yield</span> <span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>some_iterable</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>list</span><span class=p>((</span><span class=k>yield</span> <span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>some_iterable</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>list</span><span class=p>(</span><span class=n>some_func</span><span class=p>((</span><span class=k>yield</span> <span class=n>x</span><span class=p>))</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>some_iterable</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;something&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;something&#39;</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-18>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-18>#</a></h4><ul><li>来源和解释可以在这里找到: <a href=https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions target=_blank rel=noopener>https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions</a></li><li>相关错误报告: <a href=http://bugs.python.org/issue10544 target=_blank rel=noopener>http://bugs.python.org/issue10544</a></li><li>这个bug在3.7以后的版本中不被推荐使用, 并在3.8中被修复. 因此在3.8中尝试在推导式中使用 yield, 只会得到一个 SyntaxError. 详细内容可以看<a href=https://docs.python.org/dev/whatsnew/3.7.html#deprecated-python-behavior target=_blank rel=noopener>3.7更新内容</a>
, <a href=https://docs.python.org/dev/whatsnew/3.8.html#changes-in-python-behavior target=_blank rel=noopener>3.8更新内容</a>
.</li></ul><hr><h3 id=-mutating-the-immutable强人所难>> Mutating the immutable!/强人所难<a hidden class=anchor aria-hidden=true href=#-mutating-the-immutable强人所难>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_tuple</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;tuple&#34;</span><span class=p>,</span> <span class=s2>&#34;with&#34;</span><span class=p>,</span> <span class=s2>&#34;values&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>another_tuple</span> <span class=o>=</span> <span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_tuple</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;change this&#34;</span>
</span></span><span class=line><span class=cl><span class=ne>TypeError</span><span class=p>:</span> <span class=s1>&#39;tuple&#39;</span> <span class=nb>object</span> <span class=n>does</span> <span class=ow>not</span> <span class=n>support</span> <span class=n>item</span> <span class=n>assignment</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_tuple</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span> <span class=c1># 这里不出现错误</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_tuple</span>
</span></span><span class=line><span class=cl><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>1000</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_tuple</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+=</span> <span class=p>[</span><span class=mi>99</span><span class=p>,</span> <span class=mi>999</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=ne>TypeError</span><span class=p>:</span> <span class=s1>&#39;tuple&#39;</span> <span class=nb>object</span> <span class=n>does</span> <span class=ow>not</span> <span class=n>support</span> <span class=n>item</span> <span class=n>assignment</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_tuple</span>
</span></span><span class=line><span class=cl><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>999</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p>我还以为元组是不可变的呢&mldr;</p><h4 id=-说明-19>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-19>#</a></h4><ul><li><p>引用 <a href=https://docs.python.org/2/reference/datamodel.html target=_blank rel=noopener>https://docs.python.org/2/reference/datamodel.html</a></p><blockquote><p>不可变序列
不可变序列的对象一旦创建就不能再改变. (如果对象包含对其他对象的引用，则这些其他对象可能是可变的并且可能会被修改; 但是，由不可变对象直接引用的对象集合不能更改.)</p></blockquote></li><li><p><code>+=</code> 操作符在原地修改了列表. 元素赋值操作并不工作, 但是当异常抛出时, 元素已经在原地被修改了.</p></li></ul><p>(译: 对于不可变对象, 这里指tuple, <code>+=</code> 并不是原子操作, 而是 <code>extend</code> 和 <code>=</code> 两个动作, 这里 <code>=</code> 操作虽然会抛出异常, 但 <code>extend</code> 操作已经修改成功了. 详细解释可以看<a href=https://segmentfault.com/a/1190000010767068 target=_blank rel=noopener>这里</a>
)</p><hr><h3 id=-the-disappearing-variable-from-outer-scope消失的外部变量>> The disappearing variable from outer scope/消失的外部变量<a hidden class=anchor aria-hidden=true href=#-the-disappearing-variable-from-outer-scope消失的外部变量>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>raise</span> <span class=ne>Exception</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># prints nothing</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 3.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=ne>NameError</span><span class=p>:</span> <span class=n>name</span> <span class=s1>&#39;e&#39;</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>defined</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-20>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-20>#</a></h4><ul><li><p>出处: <a href=https://docs.python.org/3/reference/compound_stmts.html#except target=_blank rel=noopener>https://docs.python.org/3/reference/compound_stmts.html#except</a></p><p>当使用 <code>as</code> 为目标分配异常的时候, 将在except子句的末尾清除该异常.</p><p>这就好像</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>except</span> <span class=n>E</span> <span class=k>as</span> <span class=n>N</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>foo</span>
</span></span></code></pre></td></tr></table></div></div><p>会被翻译成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>except</span> <span class=n>E</span> <span class=k>as</span> <span class=n>N</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>foo</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>del</span> <span class=n>N</span>
</span></span></code></pre></td></tr></table></div></div><p>这意味着异常必须在被赋值给其他变量才能在 <code>except</code> 子句之后引用它. 而异常之所以会被清除, 则是由于上面附加的回溯信息(trackback)会和栈帧(stack frame)形成循环引用, 使得该栈帧中的所有本地变量在下一次垃圾回收发生之前都处于活动状态.(译: 也就是说不会被回收)</p></li><li><p>子句在 Python 中并没有独立的作用域. 示例中的所有内容都处于同一作用域内, 所以变量 <code>e</code> 会由于执行了 <code>except</code> 子句而被删除. 而对于有独立的内部作用域的函数来说情况就不一样了. 下面的例子说明了这一点:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>del</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=n>f</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=ne>UnboundLocalError</span><span class=p>:</span> <span class=n>local</span> <span class=n>variable</span> <span class=s1>&#39;x&#39;</span> <span class=n>referenced</span> <span class=n>before</span> <span class=n>assignment</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=n>f</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=ne>UnboundLocalError</span><span class=p>:</span> <span class=n>local</span> <span class=n>variable</span> <span class=s1>&#39;x&#39;</span> <span class=n>referenced</span> <span class=n>before</span> <span class=n>assignment</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>x</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>在 Python 2.x 中, <code>Exception()</code> 实例被赋值给了变量 <code>e</code>, 所以当你尝试打印结果的时候, 它的输出为空.（译: 正常的Exception实例打印出来就是空）</p><p><strong>Output (Python 2.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>e</span>
</span></span><span class=line><span class=cl><span class=ne>Exception</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span> <span class=n>e</span>
</span></span><span class=line><span class=cl><span class=c1># 没有打印任何内容!</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-when-true-is-actually-false真亦假>> When True is actually False/真亦假<a hidden class=anchor aria-hidden=true href=#-when-true-is-actually-false真亦假>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kc>True</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=kc>True</span> <span class=o>==</span> <span class=kc>False</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;I&#39;ve lost faith in truth!&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><pre tabindex=0><code>I&#39;ve lost faith in truth!
</code></pre><h4 id=-说明-21>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-21>#</a></h4><ul><li>最初, Python 并没有 <code>bool</code> 型 (人们用0表示假值, 用非零值比如1作为真值). 后来他们添加了 <code>True</code>, <code>False</code>, 和 <code>bool</code> 型, 但是, 为了向后兼容, 他们没法把 <code>True</code> 和 <code>False</code> 设置为常量, 只是设置成了内置变量.</li><li>Python 3 由于不再需要向后兼容, 终于可以修复这个问题了, 所以这个例子无法在 Python 3.x 中执行!</li></ul><hr><h3 id=-from-filled-to-none-in-one-instruction从有到无>> From filled to None in one instruction&mldr;/从有到无&mldr;<a hidden class=anchor aria-hidden=true href=#-from-filled-to-none-in-one-instruction从有到无>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>some_dict</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;key_1&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;key_2&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;key_3&#34;</span><span class=p>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>some_list</span> <span class=o>=</span> <span class=n>some_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>some_dict</span> <span class=o>=</span> <span class=n>some_dict</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;key_4&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>some_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>some_dict</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-22>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-22>#</a></h4><p>大多数修改序列/映射对象的方法, 比如 <code>list.append</code>, <code>dict.update</code>, <code>list.sort</code> 等等. 都是原地修改对象并返回 <code>None</code>. 这样做的理由是, 如果操作可以原地完成, 就可以避免创建对象的副本来提高性能. (参考<a href=http://docs.python.org/2/faq/design.html#why-doesn-t-list-sort-return-the-sorted-list target=_blank rel=noopener>这里</a>
)</p><hr><h3 id=-subclass-relationships子类关系->> Subclass relationships/子类关系 *<a hidden class=anchor aria-hidden=true href=#-subclass-relationships子类关系->#</a></h3><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>Hashable</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>issubclass</span><span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>object</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>issubclass</span><span class=p>(</span><span class=nb>object</span><span class=p>,</span> <span class=n>Hashable</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>issubclass</span><span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=n>Hashable</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><p>子类关系应该是可传递的, 对吧? (即, 如果 <code>A</code> 是 <code>B</code> 的子类, <code>B</code> 是 <code>C</code> 的子类, 那么 <code>A</code> <em>应该</em> 是 <code>C</code> 的子类.)</p><h4 id=-说明-23>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-23>#</a></h4><ul><li>Python 中的子类关系并不一定是传递的. 任何人都可以在元类中随意定义 <code>__subclasscheck__</code>.</li><li>当 <code>issubclass(cls, Hashable)</code> 被调用时, 它只是在 <code>cls</code> 中寻找 <code>__hash__</code> 方法或者从继承的父类中寻找 <code>__hash__</code> 方法.</li><li>由于 <code>object</code> is 可散列的(hashable), 但是 <code>list</code> 是不可散列的, 所以它打破了这种传递关系.</li><li>在<a href=https://www.naftaliharris.com/blog/python-subclass-intransitivity/ target=_blank rel=noopener>这里</a>
可以找到更详细的解释.</li></ul><hr><h3 id=-the-mysterious-key-type-conversion神秘的键型转换->> The mysterious key type conversion/神秘的键型转换 *<a hidden class=anchor aria-hidden=true href=#-the-mysterious-key-type-conversion神秘的键型转换->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SomeClass</span><span class=p>(</span><span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>some_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;s&#39;</span><span class=p>:</span><span class=mi>42</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>type</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>some_dict</span><span class=o>.</span><span class=n>keys</span><span class=p>())[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>str</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>s</span> <span class=o>=</span> <span class=n>SomeClass</span><span class=p>(</span><span class=s1>&#39;s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span><span class=p>[</span><span class=n>s</span><span class=p>]</span> <span class=o>=</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span> <span class=c1># 预期: 两个不同的键值对</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s1>&#39;s&#39;</span><span class=p>:</span> <span class=mi>40</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>type</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>some_dict</span><span class=o>.</span><span class=n>keys</span><span class=p>())[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>str</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-24>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-24>#</a></h4><ul><li><p>由于 <code>SomeClass</code> 会从 <code>str</code> 自动继承 <code>__hash__</code> 方法, 所以 <code>s</code> 对象和 <code>"s"</code> 字符串的哈希值是相同的.</p></li><li><p>而 <code>SomeClass("s") == "s"</code> 为 <code>True</code> 是因为 <code>SomeClass</code> 也继承了 <code>str</code> 类 <code>__eq__</code> 方法.</p></li><li><p>由于两者的哈希值相同且相等, 所以它们在字典中表示相同的键.</p></li><li><p>如果想要实现期望的功能, 我们可以重定义 <code>SomeClass</code> 的 <code>__eq__</code> 方法.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SomeClass</span><span class=p>(</span><span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=fm>__eq__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=ow>is</span> <span class=n>SomeClass</span>
</span></span><span class=line><span class=cl>          <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>other</span><span class=p>)</span> <span class=ow>is</span> <span class=n>SomeClass</span>
</span></span><span class=line><span class=cl>          <span class=ow>and</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__eq__</span><span class=p>(</span><span class=n>other</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># 当我们自定义 __eq__ 方法时, Python 不会再自动继承 __hash__ 方法</span>
</span></span><span class=line><span class=cl>  <span class=c1># 所以我们也需要定义它</span>
</span></span><span class=line><span class=cl>  <span class=fm>__hash__</span> <span class=o>=</span> <span class=nb>str</span><span class=o>.</span><span class=fm>__hash__</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>some_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;s&#39;</span><span class=p>:</span><span class=mi>42</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>s</span> <span class=o>=</span> <span class=n>SomeClass</span><span class=p>(</span><span class=s1>&#39;s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span><span class=p>[</span><span class=n>s</span><span class=p>]</span> <span class=o>=</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_dict</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s1>&#39;s&#39;</span><span class=p>:</span> <span class=mi>40</span><span class=p>,</span> <span class=s1>&#39;s&#39;</span><span class=p>:</span> <span class=mi>42</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>some_dict</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>type</span><span class=p>(</span><span class=n>keys</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=nb>type</span><span class=p>(</span><span class=n>keys</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>__main__</span><span class=o>.</span><span class=n>SomeClass</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-lets-see-if-you-can-guess-this看看你能否猜到这一点>> Let&rsquo;s see if you can guess this?/看看你能否猜到这一点?<a hidden class=anchor aria-hidden=true href=#-lets-see-if-you-can-guess-this看看你能否猜到这一点>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=o>=</span> <span class=p>{},</span> <span class=mi>5</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=mi>5</span><span class=p>:</span> <span class=p>({</span><span class=o>...</span><span class=p>},</span> <span class=mi>5</span><span class=p>)}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-25>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-25>#</a></h4><ul><li><p>根据 <a href=https://docs.python.org/2/reference/simple_stmts.html#assignment-statements target=_blank rel=noopener>Python 语言参考</a>
, 赋值语句的形式如下</p><pre tabindex=0><code>(target_list &#34;=&#34;)+ (expression_list | yield_expression)
</code></pre><blockquote><p>赋值语句计算表达式列表(expression list)(牢记 这可以是单个表达式或以逗号分隔的列表, 后者返回元组)并将单个结果对象从左到右分配给目标列表中的每一项.</p></blockquote></li><li><p><code>(target_list "=")+</code> 中的 <code>+</code> 意味着可以有<strong>一个或多个</strong>目标列表. 在这个例子中, 目标列表是 <code>a, b</code> 和 <code>a[b]</code> (注意表达式列表只能有一个, 在我们的例子中是 <code>{}, 5</code>).</p></li><li><p>表达式列表计算结束后, 将其值自动解包后<strong>从左到右</strong>分配给目标列表(target list). 因此, 在我们的例子中, 首先将 <code>{}, 5</code> 元组并赋值给 <code>a, b</code>, 然后我们就可以得到 <code>a = {}</code> 且 <code>b = 5</code>.</p></li><li><p><code>a</code> 被赋值的 <code>{}</code> 是可变对象.</p></li><li><p>第二个目标列表是 <code>a[b]</code> (你可能觉得这里会报错, 因为在之前的语句中 <code>a</code> 和 <code>b</code> 都还没有被定义. 但是别忘了, 我们刚刚将 <code>a</code> 赋值 <code>{}</code> 且将 <code>b</code> 赋值为 <code>5</code>).</p></li><li><p>现在, 我们将通过将字典中键 <code>5</code> 的值设置为元组 <code>({}, 5)</code> 来创建循环引用 (输出中的 <code>{...}</code> 指与 <code>a</code> 引用了相同的对象). 下面是一个更简单的循环引用的例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span> <span class=o>=</span> <span class=n>some_list</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=o>...</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=o>...</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span> <span class=ow>is</span> <span class=n>some_list</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>some_list</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><p>我们的例子就是这种情况 (<code>a[b][0]</code> 与 <code>a</code> 是相同的对象)</p></li><li><p>总结一下, 你也可以把例子拆成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=p>{},</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span>
</span></span></code></pre></td></tr></table></div></div><p>并且可以通过 <code>a[b][0]</code> 与 <code>a</code> 是相同的对象来证明是循环引用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=p>[</span><span class=n>b</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=ow>is</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><hr><h2 id=section-appearances-are-deceptive外表是靠不住的>Section: Appearances are deceptive!/外表是靠不住的!<a hidden class=anchor aria-hidden=true href=#section-appearances-are-deceptive外表是靠不住的>#</a></h2><h3 id=-skipping-lines跳过一行>> Skipping lines?/跳过一行?<a hidden class=anchor aria-hidden=true href=#-skipping-lines跳过一行>#</a></h3><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>11</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>valuе</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=mi>11</span>
</span></span></code></pre></td></tr></table></div></div><p>什么鬼?</p><p><strong>注意:</strong> 如果你想要重现的话最简单的方法是直接复制上面的代码片段到你的文件或命令行里.</p><h4 id=-说明-26>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-26>#</a></h4><p>一些非西方字符虽然看起来和英语字母相同, 但会被解释器识别为不同的字母.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;е&#39;</span><span class=p>)</span> <span class=c1># 西里尔语的 &#39;e&#39; (Ye)</span>
</span></span><span class=line><span class=cl><span class=mi>1077</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;e&#39;</span><span class=p>)</span> <span class=c1># 拉丁语的 &#39;e&#39;, 用于英文并使用标准键盘输入</span>
</span></span><span class=line><span class=cl><span class=mi>101</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;е&#39;</span> <span class=o>==</span> <span class=s1>&#39;e&#39;</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>42</span> <span class=c1># 拉丁语 e</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>valuе</span> <span class=o>=</span> <span class=mi>23</span> <span class=c1># 西里尔语 &#39;e&#39;, Python 2.x 的解释器在这会抛出 `SyntaxError` 异常</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>value</span>
</span></span><span class=line><span class=cl><span class=mi>42</span>
</span></span></code></pre></td></tr></table></div></div><p>内置的 <code>ord()</code> 函数可以返回一个字符的 Unicode <a href=https://en.wikipedia.org/wiki/Code_point target=_blank rel=noopener>代码点</a>
, 这里西里尔语 &rsquo;e&rsquo; 和拉丁语 &rsquo;e&rsquo; 的代码点不同证实了上述例子.</p><hr><h3 id=-teleportation空间移动->> Teleportation/空间移动 *<a hidden class=anchor aria-hidden=true href=#-teleportation空间移动->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>energy_send</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 初始化一个 numpy 数组</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=nb>float</span><span class=p>(</span><span class=n>x</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>energy_receive</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 返回一个空的 numpy 数组</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>((),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float</span><span class=p>)</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>energy_send</span><span class=p>(</span><span class=mf>123.456</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>energy_receive</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=mf>123.456</span>
</span></span></code></pre></td></tr></table></div></div><p>谁来给我发个诺贝尔奖?</p><h4 id=-说明-27>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-27>#</a></h4><ul><li>注意在 <code>energy_send</code> 函数中创建的 numpy 数组并没有返回, 因此内存空间被释放并可以被重新分配.</li><li><code>numpy.empty()</code> 直接返回下一段空闲内存，而不重新初始化. 而这个内存点恰好就是刚刚释放的那个(通常情况下, 并不绝对).</li></ul><hr><h3 id=-well-something-is-fishy嗯有些可疑>> Well, something is fishy&mldr;/嗯，有些可疑&mldr;<a hidden class=anchor aria-hidden=true href=#-well-something-is-fishy嗯有些可疑>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>square</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    一个通过加法计算平方的简单函数.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sum_so_far</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>counter</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sum_so_far</span> <span class=o>=</span> <span class=n>sum_so_far</span> <span class=o>+</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>sum_so_far</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>square</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>10</span>
</span></span></code></pre></td></tr></table></div></div><p>难道不应该是100吗?</p><p><strong>注意:</strong> 如果你无法重现, 可以尝试运行这个文件<a href=/mixed_tabs_and_spaces.py>mixed_tabs_and_spaces.py</a>
.</p><h4 id=-说明-28>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-28>#</a></h4><ul><li><p><strong>不要混用制表符(tab)和空格(space)!</strong> 在上面的例子中, return 的前面是"1个制表符", 而其他部分的代码前面是 &ldquo;4个空格&rdquo;.</p></li><li><p>Python是这么处理制表符的:</p><blockquote><p>首先, 制表符会从左到右依次被替换成8个空格, 直到被替换后的字符总数是八的倍数 &lt;&mldr;></p></blockquote></li><li><p>因此, <code>square</code> 函数最后一行的制表符会被替换成8个空格, 导致return语句进入循环语句里面.</p></li><li><p>Python 3 很友好, 在这种情况下会自动抛出错误.</p><p><strong>Output (Python 3.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ne>TabError</span><span class=p>:</span> <span class=n>inconsistent</span> <span class=n>use</span> <span class=n>of</span> <span class=n>tabs</span> <span class=ow>and</span> <span class=n>spaces</span> <span class=ow>in</span> <span class=n>indentation</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><hr><h2 id=section-watch-out-for-the-landmines小心地雷>Section: Watch out for the landmines!/小心地雷!<a hidden class=anchor aria-hidden=true href=#section-watch-out-for-the-landmines小心地雷>#</a></h2><h3 id=-modifying-a-dictionary-while-iterating-over-it迭代字典时的修改>> Modifying a dictionary while iterating over it/迭代字典时的修改<a hidden class=anchor aria-hidden=true href=#-modifying-a-dictionary-while-iterating-over-it迭代字典时的修改>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=kc>None</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>x</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>del</span> <span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.7- Python 3.5):</strong></p><pre tabindex=0><code>0
1
2
3
4
5
6
7
</code></pre><p>是的, 它运行了<strong>八次</strong>然后才停下来.</p><h4 id=-说明-29>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-29>#</a></h4><ul><li>Python不支持对字典进行迭代的同时修改它.</li><li>它之所以运行8次, 是因为字典会自动扩容以容纳更多键值(我们有8次删除记录, 因此需要扩容). 这实际上是一个实现细节. (译: 应该是因为字典的初始最小值是8, 扩容会导致散列表地址发生变化而中断循环.)</li><li>在不同的Python实现中删除键的处理方式以及调整大小的时间可能会有所不同.(译: 就是说什么时候扩容在不同版本中可能是不同的, 在3.6及3.7的版本中到<a href=https://github.com/python/cpython/blob/v3.6.1/Objects/dictobject.c#L103-L110 target=_blank rel=noopener>5</a>
就会自动扩容了. 以后也有可能再次发生变化. 这是为了避免散列冲突. 顺带一提, 后面两次扩容会扩展为32和256. 即<code>8->32->256</code>.)</li><li>更多的信息, 你可以参考这个StackOverflow的<a href=https://stackoverflow.com/questions/44763802/bug-in-python-dict target=_blank rel=noopener>回答</a>
, 它详细的解释一个类似的例子.</li></ul><hr><h3 id=-stubborn-del-operator坚强的-del->> Stubborn <code>del</code> operator/坚强的 <code>del</code> *<a hidden class=anchor aria-hidden=true href=#-stubborn-del-operator坚强的-del->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SomeClass</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__del__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Deleted!&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong>
1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>x</span> <span class=o>=</span> <span class=n>SomeClass</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>y</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>del</span> <span class=n>x</span> <span class=c1># 这里应该会输出 &#34;Deleted!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>del</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=n>Deleted</span><span class=err>!</span>
</span></span></code></pre></td></tr></table></div></div><p>唷, 终于删除了. 你可能已经猜到了在我们第一次尝试删除 <code>x</code> 时是什么让 <code>__del__</code> 免于被调用的. 那让我们给这个例子增加点难度.</p><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>x</span> <span class=o>=</span> <span class=n>SomeClass</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>y</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>del</span> <span class=n>x</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>y</span> <span class=c1># 检查一下y是否存在</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>__main__</span><span class=o>.</span><span class=n>SomeClass</span> <span class=n>instance</span> <span class=n>at</span> <span class=mh>0x7f98a1a67fc8</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>del</span> <span class=n>y</span> <span class=c1># 像之前一样, 这里应该会输出 &#34;Deleted!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>globals</span><span class=p>()</span> <span class=c1># 好吧, 并没有. 让我们看一下所有的全局变量</span>
</span></span><span class=line><span class=cl><span class=n>Deleted</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>:</span> <span class=o>&lt;</span><span class=n>module</span> <span class=s1>&#39;__builtin__&#39;</span> <span class=p>(</span><span class=n>built</span><span class=o>-</span><span class=ow>in</span><span class=p>)</span><span class=o>&gt;</span><span class=p>,</span> <span class=s1>&#39;SomeClass&#39;</span><span class=p>:</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>__main__</span><span class=o>.</span><span class=n>SomeClass</span> <span class=n>at</span> <span class=mh>0x7f98a1a5f668</span><span class=o>&gt;</span><span class=p>,</span> <span class=s1>&#39;__package__&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span> <span class=s1>&#39;__name__&#39;</span><span class=p>:</span> <span class=s1>&#39;__main__&#39;</span><span class=p>,</span> <span class=s1>&#39;__doc__&#39;</span><span class=p>:</span> <span class=kc>None</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>好了，现在它被删除了 :confused:</p><h4 id=-说明-30>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-30>#</a></h4><ul><li><code>del x</code> 并不会立刻调用 <code>x.__del__()</code>.</li><li>每当遇到 <code>del x</code>, Python 会将 <code>x</code> 的引用数减1, 当 <code>x</code> 的引用数减到0时就会调用 <code>x.__del__()</code>.</li><li>在第二个例子中, <code>y.__del__()</code> 之所以未被调用, 是因为前一条语句 (<code>>>> y</code>) 对同一对象创建了另一个引用, 从而防止在执行 <code>del y</code> 后对象的引用数变为0.</li><li>调用 <code>globals</code> 导致引用被销毁, 因此我们可以看到 &ldquo;Deleted!&rdquo; 终于被输出了.</li><li>(译: 这其实是 Python 交互解释器的特性, 它会自动让 <code>_</code> 保存上一个表达式输出的值, 详细可以看<a href=https://www.cnblogs.com/leisurelylicht/p/diao-pi-de-kong-zhi-tai.html target=_blank rel=noopener>这里</a>
.)</li></ul><hr><h3 id=-deleting-a-list-item-while-iterating迭代列表时删除元素>> Deleting a list item while iterating/迭代列表时删除元素<a hidden class=anchor aria-hidden=true href=#-deleting-a-list-item-while-iterating迭代列表时删除元素>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>list_1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>list_2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>list_3</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>list_4</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>list_1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>del</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>list_2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>list_2</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>list_3</span><span class=p>[:]):</span>
</span></span><span class=line><span class=cl>    <span class=n>list_3</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>list_4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>list_4</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>list_1</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>list_2</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>list_3</span>
</span></span><span class=line><span class=cl><span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>list_4</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>你能猜到为什么输出是 <code>[2, 4]</code> 吗?</p><h4 id=-说明-31>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-31>#</a></h4><ul><li><p>在迭代时修改对象是一个很愚蠢的主意. 正确的做法是迭代对象的副本, <code>list_3[:]</code> 就是这么做的.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>some_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>139798789457608</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>id</span><span class=p>(</span><span class=n>some_list</span><span class=p>[:])</span> <span class=c1># 注意python为切片列表创建了新对象.</span>
</span></span><span class=line><span class=cl><span class=mi>139798779601192</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p><strong><code>del</code>, <code>remove</code> 和 <code>pop</code> 的不同:</strong></p><ul><li><code>del var_name</code> 只是从本地或全局命名空间中删除了 <code>var_name</code> (这就是为什么 <code>list_1</code> 没有受到影响).</li><li><code>remove</code> 会删除第一个匹配到的指定值, 而不是特定的索引, 如果找不到值则抛出 <code>ValueError</code> 异常.</li><li><code>pop</code> 则会删除指定索引处的元素并返回它, 如果指定了无效的索引则抛出 <code>IndexError</code> 异常.</li></ul><p><strong>为什么输出是 <code>[2, 4]</code>?</strong></p><ul><li>列表迭代是按索引进行的, 所以当我们从 <code>list_2</code> 或 <code>list_4</code> 中删除 <code>1</code> 时, 列表的内容就变成了 <code>[2, 3, 4]</code>. 剩余元素会依次位移, 也就是说, <code>2</code> 的索引会变为 0, <code>3</code> 会变为 1. 由于下一次迭代将获取索引为 1 的元素 (即 <code>3</code>), 因此 <code>2</code> 将被彻底的跳过. 类似的情况会交替发生在列表中的每个元素上.</li></ul><ul><li>参考这个StackOverflow的<a href=https://stackoverflow.com/questions/45946228/what-happens-when-you-try-to-delete-a-list-element-while-iterating-over-it target=_blank rel=noopener>回答</a>
来解释这个例子</li><li>关于Python中字典的类似例子, 可以参考这个Stackoverflow的<a href=https://stackoverflow.com/questions/45877614/how-to-change-all-the-dictionary-keys-in-a-for-loop-with-d-items target=_blank rel=noopener>回答</a>
.</li></ul><hr><h3 id=-loop-variables-leaking-out循环变量泄漏>> Loop variables leaking out!/循环变量泄漏!<a hidden class=anchor aria-hidden=true href=#-loop-variables-leaking-out循环变量泄漏>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>==</span> <span class=mi>6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=s1>&#39;: for x inside loop&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=s1>&#39;: x in global&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mi>6</span> <span class=p>:</span> <span class=k>for</span> <span class=n>x</span> <span class=n>inside</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=mi>6</span> <span class=p>:</span> <span class=n>x</span> <span class=ow>in</span> <span class=k>global</span>
</span></span></code></pre></td></tr></table></div></div><p>但是 <code>x</code> 从未在循环外被定义&mldr;</p><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 这次我们先初始化x</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>==</span> <span class=mi>6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=s1>&#39;: for x inside loop&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=s1>&#39;: x in global&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mi>6</span> <span class=p>:</span> <span class=k>for</span> <span class=n>x</span> <span class=n>inside</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=mi>6</span> <span class=p>:</span> <span class=n>x</span> <span class=ow>in</span> <span class=k>global</span>
</span></span></code></pre></td></tr></table></div></div><p>3.</p><pre tabindex=0><code>x = 1
print([x for x in range(5)])
print(x, &#39;: x in global&#39;)
</code></pre><p><strong>Output (on Python 2.x):</strong></p><pre tabindex=0><code>[0, 1, 2, 3, 4]
(4, &#39;: x in global&#39;)
</code></pre><p><strong>Output (on Python 3.x):</strong></p><pre tabindex=0><code>[0, 1, 2, 3, 4]
1 : x in global
</code></pre><h4 id=-说明-32>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-32>#</a></h4><ul><li><p>在 Python 中, for 循环使用所在作用域并在结束后保留定义的循环变量. 如果我们曾在全局命名空间中定义过循环变量. 在这种情况下, 它会重新绑定现有变量.</p></li><li><p>Python 2.x 和 Python 3.x 解释器在列表推导式示例中的输出差异, 在文档 <a href=https://docs.python.org/3/whatsnew/3.0.html target=_blank rel=noopener>What’s New In Python 3.0</a>
中可以找到相关的解释:</p><blockquote><p>&ldquo;列表推导不再支持句法形式 <code>[... for var in item1, item2, ...]</code>. 取而代之的是 <code>[... for var in (item1, item2, ...)]</code>. 另外, 注意列表推导具有不同的语义: 它们更接近于 <code>list()</code> 构造函数中生成器表达式的语法糖(译: 这一句我也不是很明白), 特别是循环控制变量不再泄漏到周围的作用域中.&rdquo;</p></blockquote></li></ul><hr><h3 id=-beware-of-default-mutable-arguments当心默认的可变参数>> Beware of default mutable arguments!/当心默认的可变参数!<a hidden class=anchor aria-hidden=true href=#-beware-of-default-mutable-arguments当心默认的可变参数>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_func</span><span class=p>(</span><span class=n>default_arg</span><span class=o>=</span><span class=p>[]):</span>
</span></span><span class=line><span class=cl>    <span class=n>default_arg</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;some_string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>default_arg</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;some_string&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;some_string&#39;</span><span class=p>,</span> <span class=s1>&#39;some_string&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>([])</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;some_string&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;some_string&#39;</span><span class=p>,</span> <span class=s1>&#39;some_string&#39;</span><span class=p>,</span> <span class=s1>&#39;some_string&#39;</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-33>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-33>#</a></h4><ul><li><p>Python中函数的默认可变参数并不是每次调用该函数时都会被初始化. 相反, 它们会使用最近分配的值作为默认值. 当我们明确的将 <code>[]</code> 作为参数传递给 <code>some_func</code> 的时候, 就不会使用 <code>default_arg</code> 的默认值, 所以函数会返回我们所期望的结果.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_func</span><span class=p>(</span><span class=n>default_arg</span><span class=o>=</span><span class=p>[]):</span>
</span></span><span class=line><span class=cl>    <span class=n>default_arg</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;some_string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>default_arg</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=o>.</span><span class=vm>__defaults__</span> <span class=c1># 这里会显示函数的默认参数的值</span>
</span></span><span class=line><span class=cl><span class=p>([],)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=o>.</span><span class=vm>__defaults__</span>
</span></span><span class=line><span class=cl><span class=p>([</span><span class=s1>&#39;some_string&#39;</span><span class=p>],)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=o>.</span><span class=vm>__defaults__</span>
</span></span><span class=line><span class=cl><span class=p>([</span><span class=s1>&#39;some_string&#39;</span><span class=p>,</span> <span class=s1>&#39;some_string&#39;</span><span class=p>],)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>([])</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=o>.</span><span class=vm>__defaults__</span>
</span></span><span class=line><span class=cl><span class=p>([</span><span class=s1>&#39;some_string&#39;</span><span class=p>,</span> <span class=s1>&#39;some_string&#39;</span><span class=p>],)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>避免可变参数导致的错误的常见做法是将 <code>None</code> 指定为参数的默认值, 然后检查是否有值传给对应的参数. 例:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_func</span><span class=p>(</span><span class=n>default_arg</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>default_arg</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>default_arg</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>default_arg</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;some_string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>default_arg</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-catching-the-exceptions捕获异常>> Catching the Exceptions/捕获异常<a hidden class=anchor aria-hidden=true href=#-catching-the-exceptions捕获异常>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 这里会抛出异常 ``IndexError``</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>some_list</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>IndexError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Caught!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 这里会抛出异常 ``ValueError``</span>
</span></span><span class=line><span class=cl>    <span class=n>some_list</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>IndexError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Caught again!&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Caught</span><span class=err>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=ne>ValueError</span><span class=p>:</span> <span class=nb>list</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>x</span><span class=p>):</span> <span class=n>x</span> <span class=ow>not</span> <span class=ow>in</span> <span class=nb>list</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 3.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;&lt;input&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>IndexError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                     <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>syntax</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-34>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-34>#</a></h4><ul><li><p>如果你想要同时捕获多个不同类型的异常时, 你需要将它们用括号包成一个元组作为第一个参数传递. 第二个参数是可选名称, 如果你提供, 它将与被捕获的异常实例绑定. 例,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=c1># 这里会抛出异常 ``ValueError``</span>
</span></span><span class=line><span class=cl>   <span class=n>some_list</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=p>(</span><span class=ne>IndexError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>),</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Caught again!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.x):</strong></p><pre tabindex=0><code>Caught again!
list.remove(x): x not in list
</code></pre><p><strong>Output (Python 3.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;&lt;input&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=p>(</span><span class=ne>IndexError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>),</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                     <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>IndentationError</span><span class=p>:</span> <span class=n>unindent</span> <span class=n>does</span> <span class=ow>not</span> <span class=k>match</span> <span class=nb>any</span> <span class=n>outer</span> <span class=n>indentation</span> <span class=n>level</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>在 Python 3 中, 用逗号区分异常与可选名称是无效的; 正确的做法是使用 <code>as</code> 关键字. 例,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>some_list</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=p>(</span><span class=ne>IndexError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Caught again!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><pre tabindex=0><code>Caught again!
list.remove(x): x not in list
</code></pre></li></ul><hr><h3 id=-same-operands-different-story同人不同命>> Same operands, different story!/同人不同命!<a hidden class=anchor aria-hidden=true href=#-same-operands-different-story同人不同命>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>+=</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-35>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-35>#</a></h4><ul><li><p><code>a += b</code> 并不总是与 <code>a = a + b</code> 表现相同. 类实现 <em><code>op=</code></em> 运算符的方式 <em>也许</em> 是不同的, 列表就是这样做的.</p></li><li><p>表达式 <code>a = a + [5,6,7,8]</code> 会生成一个新列表, 并让 <code>a</code> 引用这个新列表, 同时保持 <code>b</code> 不变.</p></li><li><p>表达式 <code>a += [5,6,7,8]</code> 实际上是使用的是 &ldquo;extend&rdquo; 函数, 所以 <code>a</code> 和 <code>b</code> 仍然指向已被修改的同一列表.</p></li></ul><hr><h3 id=-the-out-of-scope-variable外部作用域变量>> The out of scope variable/外部作用域变量<a hidden class=anchor aria-hidden=true href=#-the-out-of-scope-variable外部作用域变量>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>some_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>another_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=ne>UnboundLocalError</span><span class=p>:</span> <span class=n>local</span> <span class=n>variable</span> <span class=s1>&#39;a&#39;</span> <span class=n>referenced</span> <span class=n>before</span> <span class=n>assignment</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-36>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-36>#</a></h4><ul><li><p>当你在作用域中对变量进行赋值时, 变量会变成该作用域内的局部变量. 因此 <code>a</code> 会变成 <code>another_func</code> 函数作用域中的局部变量, 但它在函数作用域中并没有被初始化, 所以会引发错误.</p></li><li><p>可以阅读<a href=http://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html target=_blank rel=noopener>这个</a>
简短却很棒的指南, 了解更多关于 Python 中命名空间和作用域的工作原理.</p></li><li><p>想要在 <code>another_func</code> 中修改外部作用域变量 <code>a</code> 的话, 可以使用 <code>global</code> 关键字.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>another_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>another_func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-be-careful-with-chained-operations小心链式操作>> Be careful with chained operations/小心链式操作<a hidden class=anchor aria-hidden=true href=#-be-careful-with-chained-operations小心链式操作>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>(</span><span class=kc>False</span> <span class=o>==</span> <span class=kc>False</span><span class=p>)</span> <span class=ow>in</span> <span class=p>[</span><span class=kc>False</span><span class=p>]</span> <span class=c1># 可以理解</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>False</span> <span class=o>==</span> <span class=p>(</span><span class=kc>False</span> <span class=ow>in</span> <span class=p>[</span><span class=kc>False</span><span class=p>])</span> <span class=c1># 可以理解</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>False</span> <span class=o>==</span> <span class=kc>False</span> <span class=ow>in</span> <span class=p>[</span><span class=kc>False</span><span class=p>]</span> <span class=c1># 为毛?</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>True</span> <span class=ow>is</span> <span class=kc>False</span> <span class=o>==</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>False</span> <span class=ow>is</span> <span class=kc>False</span> <span class=ow>is</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=mi>1</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=mi>1</span> <span class=o>&gt;</span> <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-37>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-37>#</a></h4><p>根据 <a href=https://docs.python.org/2/reference/expressions.html#not-in target=_blank rel=noopener>https://docs.python.org/2/reference/expressions.html#not-in</a></p><blockquote><p>形式上, 如果 a, b, c, &mldr;, y, z 是表达式, 而 op1, op2, &mldr;, opN 是比较运算符, 那么除了每个表达式最多只出现一次以外 a op1 b op2 c &mldr; y opN z 就等于 a op1 b and b op2 c and &mldr; y opN z.</p></blockquote><p>虽然上面的例子似乎很愚蠢, 但是像 <code>a == b == c</code> 或 <code>0 &lt;= x &lt;= 100</code> 就很棒了.</p><ul><li><code>False is False is False</code> 相当于 <code>(False is False) and (False is False)</code></li><li><code>True is False == False</code> 相当于 <code>True is False and False == False</code>, 由于语句的第一部分 (<code>True is False</code>) 等于 <code>False</code>, 因此整个表达式的结果为 <code>False</code>.</li><li><code>1 > 0 &lt; 1</code> 相当于 <code>1 > 0 and 0 &lt; 1</code>, 所以最终结果为 <code>True</code>.</li><li>表达式 <code>(1 > 0) &lt; 1</code> 相当于 <code>True &lt; 1</code> 且<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>int</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>True</span> <span class=o>+</span> <span class=mi>1</span> <span class=c1># 与这个例子无关，只是好玩</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>
</span></span></code></pre></td></tr></table></div></div>所以, <code>1 &lt; 1</code> 等于 <code>False</code></li></ul><hr><h3 id=-name-resolution-ignoring-class-scope忽略类作用域的名称解析>> Name resolution ignoring class scope/忽略类作用域的名称解析<a hidden class=anchor aria-hidden=true href=#-name-resolution-ignoring-class-scope忽略类作用域的名称解析>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SomeClass</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=mi>17</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>list</span><span class=p>(</span><span class=n>SomeClass</span><span class=o>.</span><span class=n>y</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span></code></pre></td></tr></table></div></div><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SomeClass</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=mi>17</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>SomeClass</span><span class=o>.</span><span class=n>y</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>17</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 3.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>SomeClass</span><span class=o>.</span><span class=n>y</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-38>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-38>#</a></h4><ul><li>类定义中嵌套的作用域会忽略类内的名称绑定.</li><li>生成器表达式有它自己的作用域.</li><li>从 Python 3.X 开始, 列表推导式也有自己的作用域.</li></ul><hr><h3 id=-needle-in-a-haystack大海捞针>> Needle in a Haystack/大海捞针<a hidden class=anchor aria-hidden=true href=#-needle-in-a-haystack大海捞针>#</a></h3><p>1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=kc>True</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><pre tabindex=0><code>&gt;&gt;&gt; x, y  # 期望的结果是 (0, 1)
((0, 1), None)
</code></pre><p>几乎每个 Python 程序员都遇到过类似的情况.</p><p>2.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;one&#39;</span><span class=p>,</span> <span class=s1>&#39;two&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>t</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;one&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>t</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>one</span>
</span></span><span class=line><span class=cl><span class=n>two</span>
</span></span><span class=line><span class=cl><span class=n>o</span>
</span></span><span class=line><span class=cl><span class=n>n</span>
</span></span><span class=line><span class=cl><span class=n>e</span>
</span></span><span class=line><span class=cl><span class=nb>tuple</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-39>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-39>#</a></h4><ul><li>对于 1, 正确的语句是 <code>x, y = (0, 1) if True else (None, None)</code>.</li><li>对于 2, 正确的语句是 <code>t = ('one',)</code> 或者 <code>t = 'one',</code> (缺少逗号) 否则解释器会认为 <code>t</code> 是一个字符串, 并逐个字符对其进行迭代.</li><li><code>()</code> 是一个特殊的标记，表示空元组.</li></ul><hr><hr><h2 id=section-the-hidden-treasures隐藏的宝藏>Section: The Hidden treasures!/隐藏的宝藏!<a hidden class=anchor aria-hidden=true href=#section-the-hidden-treasures隐藏的宝藏>#</a></h2><p>This section contains few of the lesser-known interesting things about Python that most beginners like me are unaware of (well, not anymore).</p><h3 id=-okay-python-can-you-make-me-flypython-可否带我飞->> Okay Python, Can you make me fly?/Python, 可否带我飞? *<a hidden class=anchor aria-hidden=true href=#-okay-python-can-you-make-me-flypython-可否带我飞->#</a></h3><p>好, 去吧.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>antigravity</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong>
嘘.. 这是个超级秘密.</p><h4 id=-说明-40>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-40>#</a></h4><ul><li><code>antigravity</code> 模块是 Python 开发人员发布的少数复活节彩蛋之一.</li><li><code>import antigravity</code> 会打开一个 Python 的<a href=http://xkcd.com/353/ target=_blank rel=noopener>经典 XKCD 漫画</a>
页面.</li><li>不止如此. 这个<strong>复活节彩蛋里还有一个复活节彩蛋</strong>. 如果你看一下<a href=https://github.com/python/cpython/blob/master/Lib/antigravity.py#L7-L17 target=_blank rel=noopener>代码</a>
, 就会发现还有一个函数实现了 <a href=https://xkcd.com/426/ target=_blank rel=noopener>XKCD&rsquo;s geohashing 算法</a>
.</li></ul><hr><h3 id=-goto-but-whygoto-但为什么->> <code>goto</code>, but why?/<code>goto</code>, 但为什么? *<a hidden class=anchor aria-hidden=true href=#-goto-but-whygoto-但为什么->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>goto</span> <span class=kn>import</span> <span class=n>goto</span><span class=p>,</span> <span class=n>label</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;I&#39;m trapped, please rescue!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>k</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>goto</span> <span class=o>.</span><span class=n>breakout</span> <span class=c1># 从多重循环中跳出</span>
</span></span><span class=line><span class=cl><span class=n>label</span> <span class=o>.</span><span class=n>breakout</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Freedom!&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output (Python 2.3):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>I</span><span class=s1>&#39;m trapped, please rescue!</span>
</span></span><span class=line><span class=cl><span class=n>I</span><span class=s1>&#39;m trapped, please rescue!</span>
</span></span><span class=line><span class=cl><span class=n>Freedom</span><span class=err>!</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-41>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-41>#</a></h4><ul><li>2004年4月1日, Python <a href=https://mail.python.org/pipermail/python-announce-list/2004-April/002982.html target=_blank rel=noopener>宣布</a>
加入一个可用的 <code>goto</code> 作为愚人节礼物.</li><li>当前版本的 Python 并没有这个模块.</li><li>就算可以用, 也请不要使用它. 这里是为什么Python中没有 <code>goto</code> 的<a href=https://docs.python.org/3/faq/design.html#why-is-there-no-goto target=_blank rel=noopener>原因</a>
.</li></ul><hr><h3 id=-brace-yourself做好思想准备->> Brace yourself!/做好思想准备 *<a hidden class=anchor aria-hidden=true href=#-brace-yourself做好思想准备->#</a></h3><p>如果你不喜欢在Python中使用空格来表示作用域, 你可以导入 C 风格的 {},</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>braces</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;some_file.py&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>braces</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=ow>not</span> <span class=n>a</span> <span class=n>chance</span>
</span></span></code></pre></td></tr></table></div></div><p>想用大括号? 没门! 觉得不爽, 请去用java.</p><h4 id=-说明-42>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-42>#</a></h4><ul><li>通常 <code>__future__</code> 会提供 Python 未来版本的功能. 然而，这里的 “未来” 是一个讽刺.</li><li>这是一个表达社区对此类问题态度的复活节彩蛋.</li></ul><hr><h3 id=-lets-meet-friendly-language-uncle-for-life让生活更友好->> Let&rsquo;s meet Friendly Language Uncle For Life/让生活更友好 *<a hidden class=anchor aria-hidden=true href=#-lets-meet-friendly-language-uncle-for-life让生活更友好->#</a></h3><p><strong>Output (Python 3.x)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>barry_as_FLUFL</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s2>&#34;Ruby&#34;</span> <span class=o>!=</span> <span class=s2>&#34;Python&#34;</span> <span class=c1># 这里没什么疑问</span>
</span></span><span class=line><span class=cl>  <span class=n>File</span> <span class=s2>&#34;some_file.py&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Ruby&#34;</span> <span class=o>!=</span> <span class=s2>&#34;Python&#34;</span>
</span></span><span class=line><span class=cl>              <span class=o>^</span>
</span></span><span class=line><span class=cl><span class=ne>SyntaxError</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>syntax</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s2>&#34;Ruby&#34;</span> <span class=o>&lt;&gt;</span> <span class=s2>&#34;Python&#34;</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><p>这就对了.</p><h4 id=-说明-43>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-43>#</a></h4><ul><li><p>相关的 <a href=https://www.python.org/dev/peps/pep-0401/ target=_blank rel=noopener>PEP-401</a>
发布于 2009年4月1日 (所以你现在知道这意味着什么了吧).</p></li><li><p>引用 PEP-401</p><blockquote><p>意识到 Python 3.0 里的 != 运算符是一个会引起手指疼痛的恐怖错误, FLUFL 将 &lt;> 运算符恢复为唯一写法.</p></blockquote></li><li><p>Uncle Barry 在 PEP 中还分享了其他东西; 你可以在<a href=https://www.python.org/dev/peps/pep-0401/ target=_blank rel=noopener>这里</a>
获得他们.</p></li><li><p>(译: 虽然文档中没写，但应该是只能在交互解释器中使用.)</p></li></ul><hr><h3 id=-even-python-understands-that-love-is-complicated连python也知道爱是难言的->> Even Python understands that love is complicated/连Python也知道爱是难言的 *<a hidden class=anchor aria-hidden=true href=#-even-python-understands-that-love-is-complicated连python也知道爱是难言的->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>this</span>
</span></span></code></pre></td></tr></table></div></div><p>等等, <strong>this</strong> 是什么? <code>this</code> 是爱 :heart:</p><p><strong>Output:</strong></p><pre tabindex=0><code>The Zen of Python, by Tim Peters

Beautiful is better than ugly.
优美胜于丑陋（Python 以编写优美的代码为目标）
Explicit is better than implicit.
明了胜于晦涩（优美的代码应当是明了的，命名规范，风格相似）
Simple is better than complex.
简洁胜于复杂（优美的代码应当是简洁的，不要有复杂的内部实现）
Complex is better than complicated.
复杂胜于凌乱（如果复杂不可避免，那代码间也不能有难懂的关系，要保持接口简洁）
Flat is better than nested.
扁平胜于嵌套（优美的代码应当是扁平的，不能有太多的嵌套）
Sparse is better than dense.
间隔胜于紧凑（优美的代码有适当的间隔，不要奢望一行代码解决问题）
Readability counts.
可读性很重要（优美的代码一定是可读的）
Special cases aren&#39;t special enough to break the rules.
没有特例特殊到需要违背这些规则（这些规则至高无上）
Although practicality beats purity.
尽管我们更倾向于实用性
Errors should never pass silently.
不要安静的包容所有错误
Unless explicitly silenced.
除非你确定需要这样做（精准地捕获异常，不写 except:pass 风格的代码）
In the face of ambiguity, refuse the temptation to guess.
拒绝诱惑你去猜测的暧昧事物
There should be one-- and preferably only one --obvious way to do it.
而是尽量找一种，最好是唯一一种明显的解决方案（如果不确定，就用穷举法）
Although that way may not be obvious at first unless you&#39;re Dutch.
虽然这并不容易，因为你不是 Python 之父（这里的 Dutch 是指 Guido ）
Now is better than never.
现在行动好过永远不行动
Although never is often better than *right* now.
尽管不行动要好过鲁莽行动
If the implementation is hard to explain, it&#39;s a bad idea.
如果你无法向人描述你的方案，那肯定不是一个好方案；
If the implementation is easy to explain, it may be a good idea.
如果你能轻松向人描述你的方案，那也许会是一个好方案（方案测评标准）
Namespaces are one honking great idea -- let&#39;s do more of those!
命名空间是一种绝妙的理念，我们应当多加利用（倡导与号召）
</code></pre><p>这是 Python 之禅!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>love</span> <span class=o>=</span> <span class=n>this</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>this</span> <span class=ow>is</span> <span class=n>love</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>love</span> <span class=ow>is</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>love</span> <span class=ow>is</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>love</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>True</span> <span class=ow>or</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>love</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>True</span> <span class=ow>or</span> <span class=kc>False</span><span class=p>;</span> <span class=n>love</span> <span class=ow>is</span> <span class=n>love</span>  <span class=c1># 爱是难言的</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-44>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-44>#</a></h4><ul><li><code>this</code> 模块是关于 Python 之禅的复活节彩蛋 (<a href=https://www.python.org/dev/peps/pep-0020 target=_blank rel=noopener>PEP 20</a>
).</li><li>如果你认为这已经够有趣的了, 可以看看 <a href=https://hg.python.org/cpython/file/c3896275c0f6/Lib/this.py target=_blank rel=noopener>this.py</a>
的实现. 有趣的是, Python 之禅的实现代码违反了他自己 (这可能是唯一会发生这种情况的地方).
*
至于 <code>love is not True or False; love is love</code>, 意外却又不言而喻.</li></ul><hr><h3 id=-yes-it-exists是的-它存在>> Yes, it exists!/是的, 它存在!<a hidden class=anchor aria-hidden=true href=#-yes-it-exists是的-它存在>#</a></h3><p><strong>循环的 <code>else</code>.</strong> 一个典型的例子:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>does_exists_num</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>to_find</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>l</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=n>num</span> <span class=o>==</span> <span class=n>to_find</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Exists!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=k>break</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Does not exist&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>does_exists_num</span><span class=p>(</span><span class=n>some_list</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Exists</span><span class=err>!</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>does_exists_num</span><span class=p>(</span><span class=n>some_list</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Does</span> <span class=ow>not</span> <span class=n>exist</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>异常的 <code>else</code> .</strong> 例,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Exception occurred!!!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Try block executed successfully...&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Try</span> <span class=n>block</span> <span class=n>executed</span> <span class=n>successfully</span><span class=o>...</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-45>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-45>#</a></h4><ul><li>循环后的 <code>else</code> 子句只会在循环没有触发 <code>break</code> 语句, 正常结束的情况下才会执行.</li><li>try 之后的 <code>else</code> 子句也被称为 &ldquo;完成子句&rdquo;, 因为在 <code>try</code> 语句中到达 <code>else</code> 子句意味着try块实际上已成功完成.</li></ul><hr><h3 id=-inpinity无限->> Inpinity/无限 *<a hidden class=anchor aria-hidden=true href=#-inpinity无限->#</a></h3><p>英文拼写是有意的, 请不要为此提交补丁.
(译: 这里是为了突出 Python 中无限的定义与<a href=https://en.wikipedia.org/wiki/Pi target=_blank rel=noopener>Pi</a>
有关, 所以将两个单词拼接了.)</p><p><strong>Output (Python 3.x):</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>infinity</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;infinity&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>hash</span><span class=p>(</span><span class=n>infinity</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>314159</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>hash</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=s1>&#39;-inf&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=mi>314159</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-46>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-46>#</a></h4><ul><li>infinity 的哈希值是 10⁵ x π.</li><li>有意思的是, <code>float('-inf')</code> 的哈希值在 Python 3 中是 &ldquo;-10⁵ x π&rdquo; , 而在 Python 2 中是 &ldquo;-10⁵ x e&rdquo;.</li></ul><hr><h3 id=-mangling-time修饰时间->> Mangling time!/修饰时间! *<a hidden class=anchor aria-hidden=true href=#-mangling-time修饰时间->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Yo</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__honey</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bitch</span> <span class=o>=</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>Yo</span><span class=p>()</span><span class=o>.</span><span class=n>bitch</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>Yo</span><span class=p>()</span><span class=o>.</span><span class=n>__honey</span>
</span></span><span class=line><span class=cl><span class=ne>AttributeError</span><span class=p>:</span> <span class=s1>&#39;Yo&#39;</span> <span class=nb>object</span> <span class=n>has</span> <span class=n>no</span> <span class=n>attribute</span> <span class=s1>&#39;__honey&#39;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>Yo</span><span class=p>()</span><span class=o>.</span><span class=n>_Yo__honey</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><p>为什么 <code>Yo()._Yo__honey</code> 能运行? 只有印度人理解.(译: 这个梗可能是指印度音乐人<a href=https://en.wikipedia.org/wiki/Yo_Yo_Honey_Singh target=_blank rel=noopener>Yo Yo Honey Singh</a>
)</p><h4 id=-说明-47>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-47>#</a></h4><ul><li><a href=https://en.wikipedia.org/wiki/Name_mangling target=_blank rel=noopener>名字修饰</a>
用于避免不同命名空间之间名称冲突.</li><li>在 Python 中, 解释器会通过给类中以 <code>__</code> (双下划线)开头且结尾最多只有一个下划线的类成员名称加上<code>_NameOfTheClass</code> 来修饰(mangles)名称.</li><li>所以, 要访问 <code>__honey</code> 对象,我们需要加上 <code>_Yo</code> 以防止与其他类中定义的相同名称的属性发生冲突.</li></ul><hr><hr><h2 id=section-miscellaneous杂项>Section: Miscellaneous/杂项<a hidden class=anchor aria-hidden=true href=#section-miscellaneous杂项>#</a></h2><h3 id=--is-faster更快的->> <code>+=</code> is faster/更快的 <code>+=</code><a hidden class=anchor aria-hidden=true href=#--is-faster更快的->#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 用 &#34;+&#34; 连接三个字符串:</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=o>.</span><span class=n>timeit</span><span class=p>(</span><span class=s2>&#34;s1 = s1 + s2 + s3&#34;</span><span class=p>,</span> <span class=n>setup</span><span class=o>=</span><span class=s2>&#34;s1 = &#39; &#39; * 100000; s2 = &#39; &#39; * 100000; s3 = &#39; &#39; * 100000&#34;</span><span class=p>,</span> <span class=n>number</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mf>0.25748300552368164</span>
</span></span><span class=line><span class=cl><span class=c1># 用 &#34;+=&#34; 连接三个字符串:</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=o>.</span><span class=n>timeit</span><span class=p>(</span><span class=s2>&#34;s1 += s2 + s3&#34;</span><span class=p>,</span> <span class=n>setup</span><span class=o>=</span><span class=s2>&#34;s1 = &#39; &#39; * 100000; s2 = &#39; &#39; * 100000; s3 = &#39; &#39; * 100000&#34;</span><span class=p>,</span> <span class=n>number</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mf>0.012188911437988281</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-48>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-48>#</a></h4><ul><li>连接两个以上的字符串时 <code>+=</code> 比 <code>+</code> 更快, 因为在计算过程中第一个字符串 (例如, <code>s1 += s2 + s3</code> 中的 <code>s1</code>) 不会被销毁.(译: 就是 <code>+=</code> 执行的是追加操作，少了一个销毁新建的动作.)</li></ul><hr><h3 id=-lets-make-a-giant-string来做个巨大的字符串吧>> Let&rsquo;s make a giant string!/来做个巨大的字符串吧！<a hidden class=anchor aria-hidden=true href=#-lets-make-a-giant-string来做个巨大的字符串吧>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_string_with_plus</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>+=</span> <span class=s2>&#34;xyz&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=o>*</span><span class=n>iters</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_bytes_with_plus</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>+=</span> <span class=sa>b</span><span class=s2>&#34;xyz&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=o>*</span><span class=n>iters</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_string_with_format</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>fs</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>*</span><span class=n>iters</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>fs</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>*</span><span class=p>([</span><span class=s2>&#34;xyz&#34;</span><span class=p>]</span><span class=o>*</span><span class=n>iters</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=o>*</span><span class=n>iters</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_string_with_join</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>l</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>l</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;xyz&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=o>*</span><span class=n>iters</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>convert_list_to_string</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=o>*</span><span class=n>iters</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_plus</span><span class=p>(</span><span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=mi>1000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>972</span> <span class=n>µs</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_bytes_with_plus</span><span class=p>(</span><span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=mi>1000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>815</span> <span class=n>µs</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_format</span><span class=p>(</span><span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=mi>1000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>508</span> <span class=n>µs</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_join</span><span class=p>(</span><span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=mi>1000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>878</span> <span class=n>µs</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>l</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;xyz&#34;</span><span class=p>]</span><span class=o>*</span><span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>convert_list_to_string</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=mi>10000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>80</span> <span class=n>µs</span> <span class=n>per</span> <span class=n>loop</span>
</span></span></code></pre></td></tr></table></div></div><p>让我们将迭代次数增加10倍.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_plus</span><span class=p>(</span><span class=mi>100000</span><span class=p>))</span> <span class=c1># 执行时间线性增加</span>
</span></span><span class=line><span class=cl><span class=mi>100</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mf>9.75</span> <span class=n>ms</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_bytes_with_plus</span><span class=p>(</span><span class=mi>100000</span><span class=p>))</span> <span class=c1># 二次增加</span>
</span></span><span class=line><span class=cl><span class=mi>1000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>974</span> <span class=n>ms</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_format</span><span class=p>(</span><span class=mi>100000</span><span class=p>))</span> <span class=c1># 线性增加</span>
</span></span><span class=line><span class=cl><span class=mi>100</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mf>5.25</span> <span class=n>ms</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_join</span><span class=p>(</span><span class=mi>100000</span><span class=p>))</span> <span class=c1># 线性增加</span>
</span></span><span class=line><span class=cl><span class=mi>100</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mf>9.85</span> <span class=n>ms</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>l</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;xyz&#34;</span><span class=p>]</span><span class=o>*</span><span class=mi>100000</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>convert_list_to_string</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=mi>100000</span><span class=p>))</span> <span class=c1># 线性增加</span>
</span></span><span class=line><span class=cl><span class=mi>1000</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mi>723</span> <span class=n>µs</span> <span class=n>per</span> <span class=n>loop</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-49>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-49>#</a></h4><ul><li>你可以在这获得更多 <a href=https://docs.python.org/3/library/timeit.html target=_blank rel=noopener>timeit</a>
的相关信息. 它通常用于衡量代码片段的执行时间.</li><li>不要用 <code>+</code> 去生成过长的字符串, 在 Python 中, <code>str</code> 是不可变的, 所以在每次连接中你都要把左右两个字符串复制到新的字符串中. 如果你连接四个长度为10的字符串, 你需要拷贝 (10+10) + ((10+10)+10) + (((10+10)+10)+10) = 90 个字符而不是 40 个字符. 随着字符串的数量和大小的增加, 情况会变得越发的糟糕 (就像<code>add_bytes_with_plus</code> 函数的执行时间一样)</li><li>因此, 更建议使用 <code>.format.</code> 或 <code>%</code> 语法 (但是, 对于短字符串, 它们比 <code>+</code> 稍慢一点).</li><li>又或者, 如果你所需的内容已经以可迭代对象的形式提供了, 使用 <code>''.join(可迭代对象)</code> 要快多了.</li><li><code>add_string_with_plus</code> 的执行时间没有像 <code>add_bytes_with_plus</code> 一样出现二次增加是因为解释器会如同上一个例子所讨论的一样优化 <code>+=</code>. 用 <code>s = s + "x" + "y" + "z"</code> 替代 <code>s += "xyz"</code> 的话, 执行时间就会二次增加了.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_string_with_plus</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>iters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=n>s</span> <span class=o>+</span> <span class=s2>&#34;x&#34;</span> <span class=o>+</span> <span class=s2>&#34;y&#34;</span> <span class=o>+</span> <span class=s2>&#34;z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=o>*</span><span class=n>iters</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_plus</span><span class=p>(</span><span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=mi>100</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mf>9.87</span> <span class=n>ms</span> <span class=n>per</span> <span class=n>loop</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>timeit</span><span class=p>(</span><span class=n>add_string_with_plus</span><span class=p>(</span><span class=mi>100000</span><span class=p>))</span> <span class=c1># 执行时间二次增加</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=n>loops</span><span class=p>,</span> <span class=n>best</span> <span class=n>of</span> <span class=mi>3</span><span class=p>:</span> <span class=mf>1.09</span> <span class=n>s</span> <span class=n>per</span> <span class=n>loop</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><h3 id=-explicit-typecast-of-strings字符串的显式类型转换>> Explicit typecast of strings/字符串的显式类型转换<a hidden class=anchor aria-hidden=true href=#-explicit-typecast-of-strings字符串的显式类型转换>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;inf&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;nan&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;-iNf&#39;</span><span class=p>)</span>  <span class=c1># 这些字符串不区分大小写</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;nan&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Output:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>inf</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=n>nan</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>inf</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;some_other_string&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=ne>ValueError</span><span class=p>:</span> <span class=n>could</span> <span class=ow>not</span> <span class=n>convert</span> <span class=n>string</span> <span class=n>to</span> <span class=nb>float</span><span class=p>:</span> <span class=n>some_other_string</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>==</span> <span class=o>-</span><span class=n>c</span> <span class=c1>#inf==inf</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kc>None</span> <span class=o>==</span> <span class=kc>None</span> <span class=c1># None==None</span>
</span></span><span class=line><span class=cl><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>b</span> <span class=o>==</span> <span class=n>d</span> <span class=c1>#但是 nan!=nan</span>
</span></span><span class=line><span class=cl><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=mi>50</span><span class=o>/</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span><span class=o>/</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>nan</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=mi>23</span> <span class=o>+</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=n>nan</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=-说明-50>💡 说明:<a hidden class=anchor aria-hidden=true href=#-说明-50>#</a></h4><p><code>'inf'</code> 和 <code>'nan'</code> 是特殊的字符串(不区分大小写), 当显示转换成 <code>float</code> 型时, 它们分别用于表示数学意义上的 &ldquo;无穷大&rdquo; 和 &ldquo;非数字&rdquo;.</p><hr><h3 id=-minor-ones小知识点>> Minor Ones/小知识点<a hidden class=anchor aria-hidden=true href=#-minor-ones小知识点>#</a></h3><ul><li><p><code>join()</code> 是一个字符串操作而不是列表操作. (第一次接触会觉得有点违反直觉)</p><p><strong>💡 说明:</strong>
如果 <code>join()</code> 是字符串方法 那么它就可以处理任何可迭代的对象(列表，元组，迭代器). 如果它是列表方法, 则必须在每种类型中单独实现. 另外, 在 <code>list</code> 对象的通用API中实现一个专用于字符串的方法没有太大的意义.</p></li><li><p>看着奇怪但能正确运行的语句:</p><ul><li><code>[] = ()</code> 语句在语义上是正确的 (解包一个空的 <code>tuple</code> 并赋值给 <code>list</code>)</li><li><code>'a'[0][0][0][0][0]</code> 在语义上也是正确的, 因为在 Python 中字符串同时也是<a href=https://docs.python.org/3/glossary.html#term-sequence target=_blank rel=noopener>序列</a>
(可迭代对象支持使用整数索引访问元素).</li><li><code>3 --0-- 5 == 8</code> 和 <code>--5 == 5</code> 在语义上都是正确的, 且结果等于 <code>True</code>.(译: 3减负0等于3，再减负5相当于加5等于8；负的负5等于5.)</li></ul></li><li><p>鉴于 <code>a</code> 是一个数字, <code>++a</code> 和 <code>--a</code> 都是有效的 Python 语句, 但其效果与 C, C++ 或 Java 等不一样.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=o>++</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=o>--</span><span class=n>a</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>💡 说明:</strong></p><ul><li>python 里没有 <code>++</code> 操作符. 这其实是两个 <code>+</code> 操作符.</li><li><code>++a</code> 被解析为 <code>+(+a)</code> 最后等于 <code>a</code>. <code>--a</code> 同理.</li><li>这个 StackOverflow <a href=https://stackoverflow.com/questions/3654830/why-are-there-no-and-operators-in-python target=_blank rel=noopener>回答</a>
讨论了为什么 Python 中缺少增量和减量运算符.</li></ul></li><li><p>Python 使用 2个字节存储函数中的本地变量. 理论上, 这意味着函数中只能定义65536个变量. 但是，Python 内置了一个方便的解决方案，可用于存储超过2^16个变量名. 下面的代码演示了当定义了超过65536个局部变量时堆栈中发生的情况 (警告: 这段代码会打印大约2^18行文本, 请做好准备!):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>dis</span>
</span></span><span class=line><span class=cl><span class=n>exec</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>def f():
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span> <span class=o>+</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s2>&#34;X&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>65539</span><span class=p>)]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>f</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>你的 <em>Python 代码</em> 并不会多线程同时运行 (是的, 你没听错!). 虽然你觉得会产生多个线程并让它们同时执行你的代码, 但是, 由于 <a href=https://wiki.python.org/moin/GlobalInterpreterLock target=_blank rel=noopener>全局解释锁</a>
的存在, 你所做的只是让你的线程依次在同一个核心上执行. Python 多线程适用于IO密集型的任务, 但如果想要并行处理CPU密集型的任务, 你应该会想使用 <a href=https://docs.python.org/2/library/multiprocessing.html target=_blank rel=noopener>multiprocessing</a>
模块.</p></li><li><p>列表切片超出索引边界而不引发任何错误</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>some_list</span><span class=p>[</span><span class=mi>111</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=p>[]</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>int('١٢٣٤٥٦٧٨٩')</code> 在 Python 3 中会返回 <code>123456789</code>. 在 Python 中, 十进制字符包括数字字符, 以及可用于形成十进制数字的所有字符, 例如: U+0660, ARABIC-INDIC DIGIT ZERO. 这有一个关于此的 <a href=http://chris.improbable.org/2014/8/25/adventures-in-unicode-digits/ target=_blank rel=noopener>有趣故事</a>
.</p></li><li><p><code>'abc'.count('') == 4</code>. 这有一个 <code>count</code> 方法的相近实现, 能更好的说明问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>count</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>sub</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>sub</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>+=</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>sub</span><span class=p>)]</span> <span class=o>==</span> <span class=n>sub</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span></code></pre></td></tr></table></div></div><p>这个行为是由于空子串(<code>''</code>)与原始字符串中长度为0的切片相匹配导致的.</p></li></ul><hr><h1 id=contributing贡献>Contributing/贡献<a hidden class=anchor aria-hidden=true href=#contributing贡献>#</a></h1><p>欢迎各种补丁! 详情请看<a href=https://github.com/satwikkansal/wtfpython/blob/master/CONTRIBUTING.md target=_blank rel=noopener>CONTRIBUTING.md</a>
.(译: 这是给原库提贡献的要求模版)</p><p>你可以通过新建 <a href=https://github.com/satwikkansal/wtfpython/issues/new target=_blank rel=noopener>issue</a>
或者在上 <a href=https://gitter.im/wtfpython/Lobby target=_blank rel=noopener>Gitter</a>
与我们进行讨论.</p><p>(译: 如果你想对这个翻译项目提供帮助, 请看<a href=https://github.com/leisurelicht/wtfpython-cn/blob/master/CONTRIBUTING.md target=_blank rel=noopener>这里</a>
)</p><h1 id=acknowledgements致谢>Acknowledgements/致谢<a hidden class=anchor aria-hidden=true href=#acknowledgements致谢>#</a></h1><p>这个系列最初的想法和设计灵感来自于 Denys Dovhan 的项目 <a href=https://github.com/denysdovhan/wtfjs target=_blank rel=noopener>wtfjs</a>
. 社区的强大支持让它成长为现在的模样.</p><h4 id=some-nice-links一些不错的资源>Some nice Links!/一些不错的资源<a hidden class=anchor aria-hidden=true href=#some-nice-links一些不错的资源>#</a></h4><ul><li><a href="https://www.youtube.com/watch?v=sH4XF6pKKmk" target=_blank rel=noopener>https://www.youtube.com/watch?v=sH4XF6pKKmk</a></li><li><a href=https://www.reddit.com/r/Python/comments/3cu6ej/what_are_some_wtf_things_about_python target=_blank rel=noopener>https://www.reddit.com/r/Python/comments/3cu6ej/what_are_some_wtf_things_about_python</a></li><li><a href=https://sopython.com/wiki/Common_Gotchas_In_Python target=_blank rel=noopener>https://sopython.com/wiki/Common_Gotchas_In_Python</a></li><li><a href=https://stackoverflow.com/questions/530530/python-2-x-gotchas-and-landmines target=_blank rel=noopener>https://stackoverflow.com/questions/530530/python-2-x-gotchas-and-landmines</a></li><li><a href=https://stackoverflow.com/questions/1011431/common-pitfalls-in-python target=_blank rel=noopener>https://stackoverflow.com/questions/1011431/common-pitfalls-in-python</a></li><li><a href=https://www.python.org/doc/humor/ target=_blank rel=noopener>https://www.python.org/doc/humor/</a></li><li><a href=https://www.codementor.io/satwikkansal/python-practices-for-efficient-code-performance-memory-and-usability-aze6oiq65 target=_blank rel=noopener>https://www.codementor.io/satwikkansal/python-practices-for-efficient-code-performance-memory-and-usability-aze6oiq65</a></li></ul><h1 id=-license许可>🎓 License/许可<a hidden class=anchor aria-hidden=true href=#-license许可>#</a></h1><p><a href=http://www.wtfpl.net target=_blank rel=noopener><div class=post-img-view><a data-fancybox=gallery href="https://img.shields.io/badge/License-WTFPL%202.0-lightgrey.svg?style=flat-square"><img alt="CC 4.0" loading=lazy src="https://img.shields.io/badge/License-WTFPL%202.0-lightgrey.svg?style=flat-square" class=responsive-image src="https://img.shields.io/badge/License-WTFPL%202.0-lightgrey.svg?style=flat-square" style="display:block;margin:0 auto" alt="CC 4.0"></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></a></p><p>© <a href=https://satwikkansal.xyz target=_blank rel=noopener>Satwik Kansal</a></p><h2 id=help帮助>Help/帮助<a hidden class=anchor aria-hidden=true href=#help帮助>#</a></h2><p>如果您有任何想法或建议，欢迎分享.</p><h2 id=surprise-your-geeky-pythonist-friends想给你的极客朋友一个惊喜>Surprise your geeky pythonist friends?/想给你的极客朋友一个惊喜?<a hidden class=anchor aria-hidden=true href=#surprise-your-geeky-pythonist-friends想给你的极客朋友一个惊喜>#</a></h2><p>您可以使用这些快链向 Twitter 和 Linkedin 上的朋友推荐 wtfpython,</p><p><a href="https://twitter.com/intent/tweet?url=https://github.com/satwikkansal/wtfpython&amp;hastags=python,wtfpython" target=_blank rel=noopener>Twitter</a>
| <a href="https://www.linkedin.com/shareArticle?url=https://github.com/satwikkansal&amp;title=What%20the%20f*ck%20Python!&amp;summary=An%20interesting%20collection%20of%20subtle%20and%20tricky%20Python%20snippets." target=_blank rel=noopener>Linkedin</a></p><h2 id=need-a-pdf-version需要来一份pdf版的>Need a pdf version?/需要来一份pdf版的?<a hidden class=anchor aria-hidden=true href=#need-a-pdf-version需要来一份pdf版的>#</a></h2><p>我收到一些想要pdf版本的需求. 你可以快速在<a href=https://satwikkansal.xyz/wtfpython-pdf/ target=_blank rel=noopener>这</a>
获得.</p><h2 id=follow-commit追踪commit>Follow Commit/追踪Commit<a hidden class=anchor aria-hidden=true href=#follow-commit追踪commit>#</a></h2><p>这是中文版 fork 时所处的原库 Commit, 当原库更新时我会跟随更新.</p><p><a href=https://github.com/satwikkansal/wtfpython/commit/30e05a5973930c38cdb59f1c02b85b19b22ac531 target=_blank rel=noopener><div class=post-img-view><a data-fancybox=gallery href=https://img.shields.io/badge/Commit-30e05a-yellow.svg><img alt="Commit id" loading=lazy src=https://img.shields.io/badge/Commit-30e05a-yellow.svg class=responsive-image src=https://img.shields.io/badge/Commit-30e05a-yellow.svg style="display:block;margin:0 auto" alt="Commit id"></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></a></p><h2 id=996icu>996.icu<a hidden class=anchor aria-hidden=true href=#996icu>#</a></h2><p><a href=https://996.icu target=_blank rel=noopener><div class=post-img-view><a data-fancybox=gallery href=https://img.shields.io/badge/link-996.icu-red.svg><img alt=996.icu loading=lazy src=https://img.shields.io/badge/link-996.icu-red.svg class=responsive-image src=https://img.shields.io/badge/link-996.icu-red.svg style="display:block;margin:0 auto" alt=996.icu></a></div><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".responsive-image"),t=window.innerHeight/2.5;e.forEach(function(e){e.style.maxHeight=t+"px"})})</script></a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://aikenh.cn/hugotest/tags/langs/>Langs</a></li><li><a href=https://aikenh.cn/hugotest/tags/python/>Python</a></li></ul><nav class=paginav><a class=prev href=https://aikenh.cn/hugotest/posts/markup_langs/><span class=title>« Prev</span><br><span>python 与标记语言的交互</span>
</a><a class=next href=https://aikenh.cn/hugotest/posts/cpp%E8%A6%81%E7%82%B9%E8%BE%A8%E6%9E%90%E4%B8%8E%E8%A1%A5%E5%85%85/><span class=title>Next »</span><br><span>C++的常见数据类型和操作</span></a></nav></footer><div id=disqus_thread></div><script>function loadDisqus(){var e=document,t=e.createElement("script");t.src="https://aiken-hugo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t),window.disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.location.href.substring(18)}}var runningOnBrowser=typeof window!="undefined",isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout(function(){if(!isBot&&supportsIntersectionObserver){var e=new IntersectionObserver(function(t){t[0].isIntersecting&&(loadDisqus(),e.disconnect())},{threshold:[0]});e.observe(document.getElementById("disqus_thread"))}else loadDisqus()},1)</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2024 <a href=https://aikenh.cn/hugotest/>aiken's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container>Visitors: <span id=busuanzi_value_site_uv></span>
Views: <span id=busuanzi_value_site_pv></span></span></footer><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("busuanzi_value_site_uv"),t=document.getElementById("busuanzi_value_site_pv"),o=13863,i=16993;if(!e||!t){console.error("Busuanzi elements not found.");return}const n=new MutationObserver(e=>{for(let t of e)if(t.type==="childList"){n.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML||0)+o;break}}),s=new MutationObserver(e=>{for(let t of e)if(t.type==="childList"){s.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML||0)+i;break}});n.observe(e,{childList:!0}),s.observe(t,{childList:!0})})</script><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))}),document.getElementById("theme-toggle-nav").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.js",function(){pangu.spacingPage()})</script></body></html>